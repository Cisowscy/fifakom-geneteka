(self.webpackChunkclient=self.webpackChunkclient||[]).push([[736],{336:(jn,Lt,we)=>{"use strict";we.d(Lt,{y:()=>xt});var N=we(138),Ae=we(714),Rt=we(585),f=we(173);var kt=we(57),It=we(971),Ee=we(309);let xt=(()=>{class Vt{constructor(Gt){Gt&&(this._subscribe=Gt)}lift(Gt){const dn=new Vt;return dn.source=this,dn.operator=Gt,dn}subscribe(Gt,dn,wn){const Dn=function Vn(Vt){return Vt&&Vt instanceof N.Lv||function Wt(Vt){return Vt&&(0,It.m)(Vt.next)&&(0,It.m)(Vt.error)&&(0,It.m)(Vt.complete)}(Vt)&&(0,Ae.Nn)(Vt)}(Gt)?Gt:new N.Hp(Gt,dn,wn);return(0,Ee.x)(()=>{const{operator:Fn,source:pt}=this;Dn.add(Fn?Fn.call(Dn,pt):pt?this._subscribe(Dn):this._trySubscribe(Dn))}),Dn}_trySubscribe(Gt){try{return this._subscribe(Gt)}catch(dn){Gt.error(dn)}}forEach(Gt,dn){return new(dn=Ze(dn))((wn,Dn)=>{const Fn=new N.Hp({next:pt=>{try{Gt(pt)}catch(Ge){Dn(Ge),Fn.unsubscribe()}},error:Dn,complete:wn});this.subscribe(Fn)})}_subscribe(Gt){var dn;return null===(dn=this.source)||void 0===dn?void 0:dn.subscribe(Gt)}[Rt.L](){return this}pipe(...Gt){return function Qt(Vt){return 0===Vt.length?f.y:1===Vt.length?Vt[0]:function(Gt){return Vt.reduce((dn,wn)=>wn(dn),Gt)}}(Gt)(this)}toPromise(Gt){return new(Gt=Ze(Gt))((dn,wn)=>{let Dn;this.subscribe(Fn=>Dn=Fn,Fn=>wn(Fn),()=>dn(Dn))})}}return Vt.create=Un=>new Vt(Un),Vt})();function Ze(Vt){var Un;return null!==(Un=Vt??kt.v.Promise)&&void 0!==Un?Un:Promise}},253:(jn,Lt,we)=>{"use strict";we.d(Lt,{x:()=>kt});var N=we(336),Ae=we(714);const f=(0,we(543).d)(Ee=>function(){Ee(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});var it=we(663),Qt=we(309);let kt=(()=>{class Ee extends N.y{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(Ze){const Wt=new It(this,this);return Wt.operator=Ze,Wt}_throwIfClosed(){if(this.closed)throw new f}next(Ze){(0,Qt.x)(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const Wt of this.currentObservers)Wt.next(Ze)}})}error(Ze){(0,Qt.x)(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=Ze;const{observers:Wt}=this;for(;Wt.length;)Wt.shift().error(Ze)}})}complete(){(0,Qt.x)(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:Ze}=this;for(;Ze.length;)Ze.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var Ze;return(null===(Ze=this.observers)||void 0===Ze?void 0:Ze.length)>0}_trySubscribe(Ze){return this._throwIfClosed(),super._trySubscribe(Ze)}_subscribe(Ze){return this._throwIfClosed(),this._checkFinalizedStatuses(Ze),this._innerSubscribe(Ze)}_innerSubscribe(Ze){const{hasError:Wt,isStopped:Vn,observers:Vt}=this;return Wt||Vn?Ae.Lc:(this.currentObservers=null,Vt.push(Ze),new Ae.w0(()=>{this.currentObservers=null,(0,it.P)(Vt,Ze)}))}_checkFinalizedStatuses(Ze){const{hasError:Wt,thrownError:Vn,isStopped:Vt}=this;Wt?Ze.error(Vn):Vt&&Ze.complete()}asObservable(){const Ze=new N.y;return Ze.source=this,Ze}}return Ee.create=(xt,Ze)=>new It(xt,Ze),Ee})();class It extends kt{constructor(xt,Ze){super(),this.destination=xt,this.source=Ze}next(xt){var Ze,Wt;null===(Wt=null===(Ze=this.destination)||void 0===Ze?void 0:Ze.next)||void 0===Wt||Wt.call(Ze,xt)}error(xt){var Ze,Wt;null===(Wt=null===(Ze=this.destination)||void 0===Ze?void 0:Ze.error)||void 0===Wt||Wt.call(Ze,xt)}complete(){var xt,Ze;null===(Ze=null===(xt=this.destination)||void 0===xt?void 0:xt.complete)||void 0===Ze||Ze.call(xt)}_subscribe(xt){var Ze,Wt;return null!==(Wt=null===(Ze=this.source)||void 0===Ze?void 0:Ze.subscribe(xt))&&void 0!==Wt?Wt:Ae.Lc}}},138:(jn,Lt,we)=>{"use strict";we.d(Lt,{Hp:()=>Gt,Lv:()=>Wt});var N=we(971),Ae=we(714),Rt=we(57),f=we(709);function it(){}const Qt=Ee("C",void 0,void 0);function Ee(pt,Ge,Xt){return{kind:pt,value:Ge,error:Xt}}var xt=we(542),Ze=we(309);class Wt extends Ae.w0{constructor(Ge){super(),this.isStopped=!1,Ge?(this.destination=Ge,(0,Ae.Nn)(Ge)&&Ge.add(this)):this.destination=Fn}static create(Ge,Xt,Yt){return new Gt(Ge,Xt,Yt)}next(Ge){this.isStopped?Dn(function It(pt){return Ee("N",pt,void 0)}(Ge),this):this._next(Ge)}error(Ge){this.isStopped?Dn(function kt(pt){return Ee("E",void 0,pt)}(Ge),this):(this.isStopped=!0,this._error(Ge))}complete(){this.isStopped?Dn(Qt,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(Ge){this.destination.next(Ge)}_error(Ge){try{this.destination.error(Ge)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const Vn=Function.prototype.bind;function Vt(pt,Ge){return Vn.call(pt,Ge)}class Un{constructor(Ge){this.partialObserver=Ge}next(Ge){const{partialObserver:Xt}=this;if(Xt.next)try{Xt.next(Ge)}catch(Yt){dn(Yt)}}error(Ge){const{partialObserver:Xt}=this;if(Xt.error)try{Xt.error(Ge)}catch(Yt){dn(Yt)}else dn(Ge)}complete(){const{partialObserver:Ge}=this;if(Ge.complete)try{Ge.complete()}catch(Xt){dn(Xt)}}}class Gt extends Wt{constructor(Ge,Xt,Yt){let jt;if(super(),(0,N.m)(Ge)||!Ge)jt={next:Ge??void 0,error:Xt??void 0,complete:Yt??void 0};else{let tn;this&&Rt.v.useDeprecatedNextContext?(tn=Object.create(Ge),tn.unsubscribe=()=>this.unsubscribe(),jt={next:Ge.next&&Vt(Ge.next,tn),error:Ge.error&&Vt(Ge.error,tn),complete:Ge.complete&&Vt(Ge.complete,tn)}):jt=Ge}this.destination=new Un(jt)}}function dn(pt){Rt.v.useDeprecatedSynchronousErrorHandling?(0,Ze.O)(pt):(0,f.h)(pt)}function Dn(pt,Ge){const{onStoppedNotification:Xt}=Rt.v;Xt&&xt.z.setTimeout(()=>Xt(pt,Ge))}const Fn={closed:!0,next:it,error:function wn(pt){throw pt},complete:it}},714:(jn,Lt,we)=>{"use strict";we.d(Lt,{Lc:()=>Qt,w0:()=>it,Nn:()=>kt});var N=we(971);const Rt=(0,we(543).d)(Ee=>function(Ze){Ee(this),this.message=Ze?`${Ze.length} errors occurred during unsubscription:\n${Ze.map((Wt,Vn)=>`${Vn+1}) ${Wt.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=Ze});var f=we(663);class it{constructor(xt){this.initialTeardown=xt,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let xt;if(!this.closed){this.closed=!0;const{_parentage:Ze}=this;if(Ze)if(this._parentage=null,Array.isArray(Ze))for(const Vt of Ze)Vt.remove(this);else Ze.remove(this);const{initialTeardown:Wt}=this;if((0,N.m)(Wt))try{Wt()}catch(Vt){xt=Vt instanceof Rt?Vt.errors:[Vt]}const{_finalizers:Vn}=this;if(Vn){this._finalizers=null;for(const Vt of Vn)try{It(Vt)}catch(Un){xt=xt??[],Un instanceof Rt?xt=[...xt,...Un.errors]:xt.push(Un)}}if(xt)throw new Rt(xt)}}add(xt){var Ze;if(xt&&xt!==this)if(this.closed)It(xt);else{if(xt instanceof it){if(xt.closed||xt._hasParent(this))return;xt._addParent(this)}(this._finalizers=null!==(Ze=this._finalizers)&&void 0!==Ze?Ze:[]).push(xt)}}_hasParent(xt){const{_parentage:Ze}=this;return Ze===xt||Array.isArray(Ze)&&Ze.includes(xt)}_addParent(xt){const{_parentage:Ze}=this;this._parentage=Array.isArray(Ze)?(Ze.push(xt),Ze):Ze?[Ze,xt]:xt}_removeParent(xt){const{_parentage:Ze}=this;Ze===xt?this._parentage=null:Array.isArray(Ze)&&(0,f.P)(Ze,xt)}remove(xt){const{_finalizers:Ze}=this;Ze&&(0,f.P)(Ze,xt),xt instanceof it&&xt._removeParent(this)}}it.EMPTY=(()=>{const Ee=new it;return Ee.closed=!0,Ee})();const Qt=it.EMPTY;function kt(Ee){return Ee instanceof it||Ee&&"closed"in Ee&&(0,N.m)(Ee.remove)&&(0,N.m)(Ee.add)&&(0,N.m)(Ee.unsubscribe)}function It(Ee){(0,N.m)(Ee)?Ee():Ee.unsubscribe()}},57:(jn,Lt,we)=>{"use strict";we.d(Lt,{v:()=>N});const N={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1}},591:(jn,Lt,we)=>{"use strict";we.d(Lt,{E:()=>Ae});const Ae=new(we(336).y)(it=>it.complete())},957:(jn,Lt,we)=>{"use strict";we.d(Lt,{D:()=>Yt});var N=we(987),Ae=we(817),Rt=we(944),f=we(945);function it(jt,tn=0){return(0,Rt.e)((en,me)=>{en.subscribe((0,f.x)(me,_e=>(0,Ae.f)(me,jt,()=>me.next(_e),tn),()=>(0,Ae.f)(me,jt,()=>me.complete(),tn),_e=>(0,Ae.f)(me,jt,()=>me.error(_e),tn)))})}function Qt(jt,tn=0){return(0,Rt.e)((en,me)=>{me.add(jt.schedule(()=>en.subscribe(me),tn))})}var Ee=we(336),Ze=we(321),Wt=we(971);function Vt(jt,tn){if(!jt)throw new Error("Iterable cannot be null");return new Ee.y(en=>{(0,Ae.f)(en,tn,()=>{const me=jt[Symbol.asyncIterator]();(0,Ae.f)(en,tn,()=>{me.next().then(_e=>{_e.done?en.complete():en.next(_e.value)})},0,!0)})})}var Un=we(331),Gt=we(548),dn=we(806),wn=we(433),Dn=we(470),Fn=we(785),pt=we(181);function Yt(jt,tn){return tn?function Xt(jt,tn){if(null!=jt){if((0,Un.c)(jt))return function kt(jt,tn){return(0,N.Xf)(jt).pipe(Qt(tn),it(tn))}(jt,tn);if((0,dn.z)(jt))return function xt(jt,tn){return new Ee.y(en=>{let me=0;return tn.schedule(function(){me===jt.length?en.complete():(en.next(jt[me++]),en.closed||this.schedule())})})}(jt,tn);if((0,Gt.t)(jt))return function It(jt,tn){return(0,N.Xf)(jt).pipe(Qt(tn),it(tn))}(jt,tn);if((0,Dn.D)(jt))return Vt(jt,tn);if((0,wn.T)(jt))return function Vn(jt,tn){return new Ee.y(en=>{let me;return(0,Ae.f)(en,tn,()=>{me=jt[Ze.h](),(0,Ae.f)(en,tn,()=>{let _e,ke;try{({value:_e,done:ke}=me.next())}catch(De){return void en.error(De)}ke?en.complete():en.next(_e)},0,!0)}),()=>(0,Wt.m)(me?.return)&&me.return()})}(jt,tn);if((0,pt.L)(jt))return function Ge(jt,tn){return Vt((0,pt.Q)(jt),tn)}(jt,tn)}throw(0,Fn.z)(jt)}(jt,tn):(0,N.Xf)(jt)}},987:(jn,Lt,we)=>{"use strict";we.d(Lt,{Xf:()=>Vn});var N=we(929),Ae=we(806),Rt=we(548),f=we(336),it=we(331),Qt=we(470),kt=we(785),It=we(433),Ee=we(181),xt=we(971),Ze=we(709),Wt=we(585);function Vn(pt){if(pt instanceof f.y)return pt;if(null!=pt){if((0,it.c)(pt))return function Vt(pt){return new f.y(Ge=>{const Xt=pt[Wt.L]();if((0,xt.m)(Xt.subscribe))return Xt.subscribe(Ge);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(pt);if((0,Ae.z)(pt))return function Un(pt){return new f.y(Ge=>{for(let Xt=0;Xt<pt.length&&!Ge.closed;Xt++)Ge.next(pt[Xt]);Ge.complete()})}(pt);if((0,Rt.t)(pt))return function Gt(pt){return new f.y(Ge=>{pt.then(Xt=>{Ge.closed||(Ge.next(Xt),Ge.complete())},Xt=>Ge.error(Xt)).then(null,Ze.h)})}(pt);if((0,Qt.D)(pt))return wn(pt);if((0,It.T)(pt))return function dn(pt){return new f.y(Ge=>{for(const Xt of pt)if(Ge.next(Xt),Ge.closed)return;Ge.complete()})}(pt);if((0,Ee.L)(pt))return function Dn(pt){return wn((0,Ee.Q)(pt))}(pt)}throw(0,kt.z)(pt)}function wn(pt){return new f.y(Ge=>{(function Fn(pt,Ge){var Xt,Yt,jt,tn;return(0,N.mG)(this,void 0,void 0,function*(){try{for(Xt=(0,N.KL)(pt);!(Yt=yield Xt.next()).done;)if(Ge.next(Yt.value),Ge.closed)return}catch(en){jt={error:en}}finally{try{Yt&&!Yt.done&&(tn=Xt.return)&&(yield tn.call(Xt))}finally{if(jt)throw jt.error}}Ge.complete()})})(pt,Ge).catch(Xt=>Ge.error(Xt))})}},945:(jn,Lt,we)=>{"use strict";we.d(Lt,{x:()=>Ae});var N=we(138);function Ae(f,it,Qt,kt,It){return new Rt(f,it,Qt,kt,It)}class Rt extends N.Lv{constructor(it,Qt,kt,It,Ee,xt){super(it),this.onFinalize=Ee,this.shouldUnsubscribe=xt,this._next=Qt?function(Ze){try{Qt(Ze)}catch(Wt){it.error(Wt)}}:super._next,this._error=It?function(Ze){try{It(Ze)}catch(Wt){it.error(Wt)}finally{this.unsubscribe()}}:super._error,this._complete=kt?function(){try{kt()}catch(Ze){it.error(Ze)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var it;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:Qt}=this;super.unsubscribe(),!Qt&&(null===(it=this.onFinalize)||void 0===it||it.call(this))}}}},635:(jn,Lt,we)=>{"use strict";we.d(Lt,{U:()=>Rt});var N=we(944),Ae=we(945);function Rt(f,it){return(0,N.e)((Qt,kt)=>{let It=0;Qt.subscribe((0,Ae.x)(kt,Ee=>{kt.next(f.call(it,Ee,It++))}))})}},295:(jn,Lt,we)=>{"use strict";we.d(Lt,{q:()=>f});var N=we(591),Ae=we(944),Rt=we(945);function f(it){return it<=0?()=>N.E:(0,Ae.e)((Qt,kt)=>{let It=0;Qt.subscribe((0,Rt.x)(kt,Ee=>{++It<=it&&(kt.next(Ee),it<=It&&kt.complete())}))})}},542:(jn,Lt,we)=>{"use strict";we.d(Lt,{z:()=>N});const N={setTimeout(Ae,Rt,...f){const{delegate:it}=N;return it?.setTimeout?it.setTimeout(Ae,Rt,...f):setTimeout(Ae,Rt,...f)},clearTimeout(Ae){const{delegate:Rt}=N;return(Rt?.clearTimeout||clearTimeout)(Ae)},delegate:void 0}},321:(jn,Lt,we)=>{"use strict";we.d(Lt,{h:()=>Ae});const Ae=function N(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}()},585:(jn,Lt,we)=>{"use strict";we.d(Lt,{L:()=>N});const N="function"==typeof Symbol&&Symbol.observable||"@@observable"},273:(jn,Lt,we)=>{"use strict";we.d(Lt,{_6:()=>Qt,jO:()=>f,yG:()=>it});var N=we(971);function Rt(kt){return kt[kt.length-1]}function f(kt){return(0,N.m)(Rt(kt))?kt.pop():void 0}function it(kt){return function Ae(kt){return kt&&(0,N.m)(kt.schedule)}(Rt(kt))?kt.pop():void 0}function Qt(kt,It){return"number"==typeof Rt(kt)?kt.pop():It}},663:(jn,Lt,we)=>{"use strict";function N(Ae,Rt){if(Ae){const f=Ae.indexOf(Rt);0<=f&&Ae.splice(f,1)}}we.d(Lt,{P:()=>N})},543:(jn,Lt,we)=>{"use strict";function N(Ae){const f=Ae(it=>{Error.call(it),it.stack=(new Error).stack});return f.prototype=Object.create(Error.prototype),f.prototype.constructor=f,f}we.d(Lt,{d:()=>N})},309:(jn,Lt,we)=>{"use strict";we.d(Lt,{O:()=>f,x:()=>Rt});var N=we(57);let Ae=null;function Rt(it){if(N.v.useDeprecatedSynchronousErrorHandling){const Qt=!Ae;if(Qt&&(Ae={errorThrown:!1,error:null}),it(),Qt){const{errorThrown:kt,error:It}=Ae;if(Ae=null,kt)throw It}}else it()}function f(it){N.v.useDeprecatedSynchronousErrorHandling&&Ae&&(Ae.errorThrown=!0,Ae.error=it)}},817:(jn,Lt,we)=>{"use strict";function N(Ae,Rt,f,it=0,Qt=!1){const kt=Rt.schedule(function(){f(),Qt?Ae.add(this.schedule(null,it)):this.unsubscribe()},it);if(Ae.add(kt),!Qt)return kt}we.d(Lt,{f:()=>N})},173:(jn,Lt,we)=>{"use strict";function N(Ae){return Ae}we.d(Lt,{y:()=>N})},806:(jn,Lt,we)=>{"use strict";we.d(Lt,{z:()=>N});const N=Ae=>Ae&&"number"==typeof Ae.length&&"function"!=typeof Ae},470:(jn,Lt,we)=>{"use strict";we.d(Lt,{D:()=>Ae});var N=we(971);function Ae(Rt){return Symbol.asyncIterator&&(0,N.m)(Rt?.[Symbol.asyncIterator])}},971:(jn,Lt,we)=>{"use strict";function N(Ae){return"function"==typeof Ae}we.d(Lt,{m:()=>N})},331:(jn,Lt,we)=>{"use strict";we.d(Lt,{c:()=>Rt});var N=we(585),Ae=we(971);function Rt(f){return(0,Ae.m)(f[N.L])}},433:(jn,Lt,we)=>{"use strict";we.d(Lt,{T:()=>Rt});var N=we(321),Ae=we(971);function Rt(f){return(0,Ae.m)(f?.[N.h])}},548:(jn,Lt,we)=>{"use strict";we.d(Lt,{t:()=>Ae});var N=we(971);function Ae(Rt){return(0,N.m)(Rt?.then)}},181:(jn,Lt,we)=>{"use strict";we.d(Lt,{L:()=>f,Q:()=>Rt});var N=we(929),Ae=we(971);function Rt(it){return(0,N.FC)(this,arguments,function*(){const kt=it.getReader();try{for(;;){const{value:It,done:Ee}=yield(0,N.qq)(kt.read());if(Ee)return yield(0,N.qq)(void 0);yield yield(0,N.qq)(It)}}finally{kt.releaseLock()}})}function f(it){return(0,Ae.m)(it?.getReader)}},944:(jn,Lt,we)=>{"use strict";we.d(Lt,{e:()=>Rt});var N=we(971);function Rt(f){return it=>{if(function Ae(f){return(0,N.m)(f?.lift)}(it))return it.lift(function(Qt){try{return f(Qt,this)}catch(kt){this.error(kt)}});throw new TypeError("Unable to lift unknown Observable type")}}},709:(jn,Lt,we)=>{"use strict";we.d(Lt,{h:()=>Rt});var N=we(57),Ae=we(542);function Rt(f){Ae.z.setTimeout(()=>{const{onUnhandledError:it}=N.v;if(!it)throw f;it(f)})}},785:(jn,Lt,we)=>{"use strict";function N(Ae){return new TypeError(`You provided ${null!==Ae&&"object"==typeof Ae?"an invalid object":`'${Ae}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}we.d(Lt,{z:()=>N})},929:(jn,Lt,we)=>{"use strict";function It(me,_e,ke,De){return new(ke||(ke=Promise))(function(ze,bt){function An(qn){try{on(De.next(qn))}catch(kn){bt(kn)}}function fr(qn){try{on(De.throw(qn))}catch(kn){bt(kn)}}function on(qn){qn.done?ze(qn.value):function Re(ze){return ze instanceof ke?ze:new ke(function(bt){bt(ze)})}(qn.value).then(An,fr)}on((De=De.apply(me,_e||[])).next())})}function dn(me){return this instanceof dn?(this.v=me,this):new dn(me)}function wn(me,_e,ke){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var Re,De=ke.apply(me,_e||[]),ze=[];return Re={},bt("next"),bt("throw"),bt("return"),Re[Symbol.asyncIterator]=function(){return this},Re;function bt(Zn){De[Zn]&&(Re[Zn]=function(hr){return new Promise(function(Rr,ar){ze.push([Zn,hr,Rr,ar])>1||An(Zn,hr)})})}function An(Zn,hr){try{!function fr(Zn){Zn.value instanceof dn?Promise.resolve(Zn.value.v).then(on,qn):kn(ze[0][2],Zn)}(De[Zn](hr))}catch(Rr){kn(ze[0][3],Rr)}}function on(Zn){An("next",Zn)}function qn(Zn){An("throw",Zn)}function kn(Zn,hr){Zn(hr),ze.shift(),ze.length&&An(ze[0][0],ze[0][1])}}function Fn(me){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var ke,_e=me[Symbol.asyncIterator];return _e?_e.call(me):(me=function Wt(me){var _e="function"==typeof Symbol&&Symbol.iterator,ke=_e&&me[_e],De=0;if(ke)return ke.call(me);if(me&&"number"==typeof me.length)return{next:function(){return me&&De>=me.length&&(me=void 0),{value:me&&me[De++],done:!me}}};throw new TypeError(_e?"Object is not iterable.":"Symbol.iterator is not defined.")}(me),ke={},De("next"),De("throw"),De("return"),ke[Symbol.asyncIterator]=function(){return this},ke);function De(ze){ke[ze]=me[ze]&&function(bt){return new Promise(function(An,fr){!function Re(ze,bt,An,fr){Promise.resolve(fr).then(function(on){ze({value:on,done:An})},bt)}(An,fr,(bt=me[ze](bt)).done,bt.value)})}}}we.d(Lt,{FC:()=>wn,KL:()=>Fn,mG:()=>It,qq:()=>dn})},22:function(jn){jn.exports=function(){"use strict";var Lt,we,N;function Ae(f,it){if(Lt)if(we){var Qt="var sharedChunk = {}; ("+Lt+")(sharedChunk); ("+we+")(sharedChunk);",kt={};Lt(kt),N=it(kt),typeof window<"u"&&(N.workerUrl=window.URL.createObjectURL(new Blob([Qt],{type:"text/javascript"})))}else we=it;else Lt=it}return Ae(0,function(f){var it=Qt;function Qt(i,t,s,u){this.cx=3*i,this.bx=3*(s-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(u-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=t,this.p2x=s,this.p2y=u}function kt(i,t,s,u){const d=new it(i,t,s,u);return function(y){return d.solve(y)}}Qt.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,t){if(void 0===t&&(t=1e-6),i<0)return 0;if(i>1)return 1;for(var s=i,u=0;u<8;u++){var d=this.sampleCurveX(s)-i;if(Math.abs(d)<t)return s;var y=this.sampleCurveDerivativeX(s);if(Math.abs(y)<1e-6)break;s-=d/y}var _=0,b=1;for(s=i,u=0;u<20&&(d=this.sampleCurveX(s),!(Math.abs(d-i)<t));u++)i>d?_=s:b=s,s=.5*(b-_)+_;return s},solve:function(i,t){return this.sampleCurveY(this.solveCurveX(i,t))}};const It=kt(.25,.1,.25,1);function Ee(i,t,s){return Math.min(s,Math.max(t,i))}function xt(i,t,s){const u=s-t,d=((i-t)%u+u)%u+t;return d===t?s:d}function Ze(i,...t){for(const s of t)for(const u in s)i[u]=s[u];return i}let Wt=1;function Vn(i,t){i.forEach(s=>{t[s]&&(t[s]=t[s].bind(t))})}function Vt(i,t,s){const u={};for(const d in i)u[d]=t.call(s||this,i[d],d,i);return u}function Un(i,t,s){const u={};for(const d in i)t.call(s||this,i[d],d,i)&&(u[d]=i[d]);return u}function Gt(i){return Array.isArray(i)?i.map(Gt):"object"==typeof i&&i?Vt(i,Gt):i}const dn={};function wn(i){dn[i]||(typeof console<"u"&&console.warn(i),dn[i]=!0)}function Dn(i,t,s){return(s.y-i.y)*(t.x-i.x)>(t.y-i.y)*(s.x-i.x)}function Fn(i){let t=0;for(let s,u,d=0,y=i.length,_=y-1;d<y;_=d++)s=i[d],u=i[_],t+=(u.x-s.x)*(s.y+u.y);return t}function pt(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Ge(i){const t={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(s,u,d,y)=>{const _=d||y;return t[u]=!_||_.toLowerCase(),""}),t["max-age"]){const s=parseInt(t["max-age"],10);isNaN(s)?delete t["max-age"]:t["max-age"]=s}return t}let Xt,Yt,jt=null;function tn(i){if(null==jt){const t=i.navigator?i.navigator.userAgent:null;jt=!!i.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return jt}function en(i){return typeof ImageBitmap<"u"&&i instanceof ImageBitmap}const me={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(i){const t=requestAnimationFrame(i);return{cancel:()=>cancelAnimationFrame(t)}},getImageData(i,t=0){const s=window.document.createElement("canvas"),u=s.getContext("2d");if(!u)throw new Error("failed to create canvas 2d context");return s.width=i.width,s.height=i.height,u.drawImage(i,0,0,i.width,i.height),u.getImageData(-t,-t,i.width+2*t,i.height+2*t)},resolveURL:i=>(Xt||(Xt=document.createElement("a")),Xt.href=i,Xt.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(null==Yt&&(Yt=matchMedia("(prefers-reduced-motion: reduce)")),Yt.matches)}};var _e=ke;function ke(i,t){this.x=i,this.y=t}ke.prototype={clone:function(){return new ke(this.x,this.y)},add:function(i){return this.clone()._add(i)},sub:function(i){return this.clone()._sub(i)},multByPoint:function(i){return this.clone()._multByPoint(i)},divByPoint:function(i){return this.clone()._divByPoint(i)},mult:function(i){return this.clone()._mult(i)},div:function(i){return this.clone()._div(i)},rotate:function(i){return this.clone()._rotate(i)},rotateAround:function(i,t){return this.clone()._rotateAround(i,t)},matMult:function(i){return this.clone()._matMult(i)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(i){return this.x===i.x&&this.y===i.y},dist:function(i){return Math.sqrt(this.distSqr(i))},distSqr:function(i){var t=i.x-this.x,s=i.y-this.y;return t*t+s*s},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith:function(i){return this.angleWithSep(i.x,i.y)},angleWithSep:function(i,t){return Math.atan2(this.x*t-this.y*i,this.x*i+this.y*t)},_matMult:function(i){var t=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=t,this},_add:function(i){return this.x+=i.x,this.y+=i.y,this},_sub:function(i){return this.x-=i.x,this.y-=i.y,this},_mult:function(i){return this.x*=i,this.y*=i,this},_div:function(i){return this.x/=i,this.y/=i,this},_multByPoint:function(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint:function(i){return this.x/=i.x,this.y/=i.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var i=this.y;return this.y=this.x,this.x=-i,this},_rotate:function(i){var t=Math.cos(i),s=Math.sin(i),u=s*this.x+t*this.y;return this.x=t*this.x-s*this.y,this.y=u,this},_rotateAround:function(i,t){var s=Math.cos(i),u=Math.sin(i),d=t.y+u*(this.x-t.x)+s*(this.y-t.y);return this.x=t.x+s*(this.x-t.x)-u*(this.y-t.y),this.y=d,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},ke.convert=function(i){return i instanceof ke?i:Array.isArray(i)?new ke(i[0],i[1]):i};const De={MAX_PARALLEL_IMAGE_REQUESTS:16,REGISTERED_PROTOCOLS:{}},Re="mapbox-tiles";let ze,An=500,fr=50;function on(){typeof caches>"u"||ze||(ze=caches.open(Re))}let qn=1/0;const kn={supported:!1,testSupport:function(i){!Rr&&hr&&(ar?br(i):Zn=i)}};let Zn,hr,Rr=!1,ar=!1;function br(i){const t=i.createTexture();i.bindTexture(i.TEXTURE_2D,t);try{if(i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,hr),i.isContextLost())return;kn.supported=!0}catch{}i.deleteTexture(t),Rr=!0}typeof document<"u"&&(hr=document.createElement("img"),hr.onload=function(){Zn&&br(Zn),Zn=null,ar=!0},hr.onerror=function(){Rr=!0,Zn=null},hr.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Gi={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(Gi);class mr extends Error{constructor(t,s,u,d){super(`AJAXError: ${s} (${t}): ${u}`),this.status=t,this.statusText=s,this.url=u,this.body=d}}const Hi=pt()?()=>self.worker&&self.worker.referrer:()=>("blob:"===window.location.protocol?window.parent:window).location.href;function Mo(i,t){const s=new AbortController,u=new Request(i.url,{method:i.method||"GET",body:i.body,credentials:i.credentials,headers:i.headers,referrer:Hi(),signal:s.signal});let d=!1,y=!1;return"json"===i.type&&u.headers.set("Accept","application/json"),((_,b,C)=>{if(y)return;const P=Date.now();fetch(u).then(V=>{return V.ok?($=V,null,P,void("arrayBuffer"===i.type?$.arrayBuffer():"json"===i.type?$.json():$.text()).then(ee=>{y||(d=!0,t(null,ee,$.headers.get("Cache-Control"),$.headers.get("Expires")))}).catch(ee=>{y||t(new Error(ee.message))})):V.blob().then($=>t(new mr(V.status,V.statusText,i.url,$)));var $}).catch(V=>{20!==V.code&&t(new Error(V.message))})})(),{cancel:()=>{y=!0,d||s.abort()}}}const Ci=function(i,t){if(/:\/\//.test(i.url)&&!/^https?:|^file:/.test(i.url)){if(pt()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,t);if(!pt()){const u=i.url.substring(0,i.url.indexOf("://"));return(De.REGISTERED_PROTOCOLS[u]||Mo)(i,t)}}if(!(/^file:/.test(s=i.url)||/^file:/.test(Hi())&&!/^\w+:/.test(s))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return Mo(i,t);if(pt()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,t,void 0,!0)}var s;return function(u,d){const y=new XMLHttpRequest;y.open(u.method||"GET",u.url,!0),"arrayBuffer"===u.type&&(y.responseType="arraybuffer");for(const _ in u.headers)y.setRequestHeader(_,u.headers[_]);return"json"===u.type&&(y.responseType="text",y.setRequestHeader("Accept","application/json")),y.withCredentials="include"===u.credentials,y.onerror=()=>{d(new Error(y.statusText))},y.onload=()=>{if((y.status>=200&&y.status<300||0===y.status)&&null!==y.response){let _=y.response;if("json"===u.type)try{_=JSON.parse(y.response)}catch(b){return d(b)}d(null,_,y.getResponseHeader("Cache-Control"),y.getResponseHeader("Expires"))}else{const _=new Blob([y.response],{type:y.getResponseHeader("Content-Type")});d(new mr(y.status,y.statusText,u.url,_))}},y.send(u.body),{cancel:()=>y.abort()}}(i,t)},Qr=function(i,t){return Ci(Ze(i,{type:"arrayBuffer"}),t)};function qi(i){const t=window.document.createElement("a");return t.href=i,t.protocol===window.document.location.protocol&&t.host===window.document.location.host}const tr="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let fn,li;fn=[],li=0;const wr=function(i,t){if(kn.supported&&(i.headers||(i.headers={}),i.headers.accept="image/webp,*/*"),li>=De.MAX_PARALLEL_IMAGE_REQUESTS){const y={requestParameters:i,callback:t,cancelled:!1,cancel(){this.cancelled=!0}};return fn.push(y),y}li++;let s=!1;const u=()=>{if(!s)for(s=!0,li--;fn.length&&li<De.MAX_PARALLEL_IMAGE_REQUESTS;){const y=fn.shift(),{requestParameters:_,callback:b,cancelled:C}=y;C||(y.cancel=wr(_,b).cancel)}},d=Qr(i,(y,_,b,C)=>{var P,V;u(),y?t(y):_&&(P=_,V=(P,V)=>{null!=P?t(P):null!=V&&t(null,V,{cacheControl:b,expires:C})},"function"==typeof createImageBitmap?function($,Z){const J=new Blob([new Uint8Array($)],{type:"image/png"});createImageBitmap(J).then(ee=>{Z(null,ee)}).catch(ee=>{Z(new Error(`Could not load image because of ${ee.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(P,V):function($,Z){const J=new Image;J.onload=()=>{Z(null,J),URL.revokeObjectURL(J.src),J.onload=null,window.requestAnimationFrame(()=>{J.src=tr})},J.onerror=()=>Z(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const ee=new Blob([new Uint8Array($)],{type:"image/png"});J.src=$.byteLength?URL.createObjectURL(ee):tr}(P,V))});return{cancel:()=>{d.cancel(),u()}}};function mn(i,t,s){s[i]&&-1!==s[i].indexOf(t)||(s[i]=s[i]||[],s[i].push(t))}function Xe(i,t,s){if(s&&s[i]){const u=s[i].indexOf(t);-1!==u&&s[i].splice(u,1)}}class Ke{constructor(t,s={}){Ze(this,s),this.type=t}}class T extends Ke{constructor(t,s={}){super("error",Ze({error:t},s))}}class ae{on(t,s){return this._listeners=this._listeners||{},mn(t,s,this._listeners),this}off(t,s){return Xe(t,s,this._listeners),Xe(t,s,this._oneTimeListeners),this}once(t,s){return this._oneTimeListeners=this._oneTimeListeners||{},mn(t,s,this._oneTimeListeners),this}fire(t,s){"string"==typeof t&&(t=new Ke(t,s||{}));const u=t.type;if(this.listens(u)){t.target=this;const d=this._listeners&&this._listeners[u]?this._listeners[u].slice():[];for(const b of d)b.call(this,t);const y=this._oneTimeListeners&&this._oneTimeListeners[u]?this._oneTimeListeners[u].slice():[];for(const b of y)Xe(u,b,this._oneTimeListeners),b.call(this,t);const _=this._eventedParent;_&&(Ze(t,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),_.fire(t))}else t instanceof T&&console.error(t.error);return this}listens(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)}setEventedParent(t,s){return this._eventedParent=t,this._eventedParentData=s,this}}var pe={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};class Te{constructor(t,s,u,d){this.message=(t?`${t}: `:"")+u,d&&(this.identifier=d),null!=s&&s.__line__&&(this.line=s.__line__)}}function Nt(i){const t=i.value;return t?[new Te(i.key,t,"constants have been deprecated as of v8")]:[]}function ht(i,...t){for(const s of t)for(const u in s)i[u]=s[u];return i}function ut(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function Dr(i){if(Array.isArray(i))return i.map(Dr);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const t={};for(const s in i)t[s]=Dr(i[s]);return t}return ut(i)}class lr extends Error{constructor(t,s){super(s),this.message=s,this.key=t}}class Wn{constructor(t,s=[]){this.parent=t,this.bindings={};for(const[u,d]of s)this.bindings[u]=d}concat(t){return new Wn(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const mt={kind:"null"},Qe={kind:"number"},hn={kind:"string"},_t={kind:"boolean"},Or={kind:"color"},Tn={kind:"object"},nn={kind:"value"},gr={kind:"collator"},ki={kind:"formatted"},gi={kind:"resolvedImage"};function Yn(i,t){return{kind:"array",itemType:i,N:t}}function rn(i){if("array"===i.kind){const t=rn(i.itemType);return"number"==typeof i.N?`array<${t}, ${i.N}>`:"value"===i.itemType.kind?"array":`array<${t}>`}return i.kind}const ei=[mt,Qe,hn,_t,Or,ki,Tn,Yn(nn),gi];function yi(i,t){if("error"===t.kind)return null;if("array"===i.kind){if("array"===t.kind&&(0===t.N&&"value"===t.itemType.kind||!yi(i.itemType,t.itemType))&&("number"!=typeof i.N||i.N===t.N))return null}else{if(i.kind===t.kind)return null;if("value"===i.kind)for(const s of ei)if(!yi(s,t))return null}return`Expected ${rn(i)} but found ${rn(t)} instead.`}function Jn(i,t){return t.some(s=>s.kind===i.kind)}function vn(i,t){return t.some(s=>"null"===s?null===i:"array"===s?Array.isArray(i):"object"===s?i&&!Array.isArray(i)&&"object"==typeof i:s===typeof i)}var jr,Li={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function ui(i){return(i=Math.round(i))<0?0:i>255?255:i}function Ei(i){return ui("%"===i[i.length-1]?parseFloat(i)/100*255:parseInt(i))}function ne(i){return(t="%"===i[i.length-1]?parseFloat(i)/100:parseFloat(i))<0?0:t>1?1:t;var t}function k(i,t,s){return s<0?s+=1:s>1&&(s-=1),6*s<1?i+(t-i)*s*6:2*s<1?t:3*s<2?i+(t-i)*(2/3-s)*6:i}try{jr={}.parseCSSColor=function(i){var t,s=i.replace(/ /g,"").toLowerCase();if(s in Li)return Li[s].slice();if("#"===s[0])return 4===s.length?(t=parseInt(s.substr(1),16))>=0&&t<=4095?[(3840&t)>>4|(3840&t)>>8,240&t|(240&t)>>4,15&t|(15&t)<<4,1]:null:7===s.length&&(t=parseInt(s.substr(1),16))>=0&&t<=16777215?[(16711680&t)>>16,(65280&t)>>8,255&t,1]:null;var u=s.indexOf("("),d=s.indexOf(")");if(-1!==u&&d+1===s.length){var y=s.substr(0,u),_=s.substr(u+1,d-(u+1)).split(","),b=1;switch(y){case"rgba":if(4!==_.length)return null;b=ne(_.pop());case"rgb":return 3!==_.length?null:[Ei(_[0]),Ei(_[1]),Ei(_[2]),b];case"hsla":if(4!==_.length)return null;b=ne(_.pop());case"hsl":if(3!==_.length)return null;var C=(parseFloat(_[0])%360+360)%360/360,P=ne(_[1]),V=ne(_[2]),$=V<=.5?V*(P+1):V+P-V*P,Z=2*V-$;return[ui(255*k(Z,$,C+1/3)),ui(255*k(Z,$,C)),ui(255*k(Z,$,C-1/3)),b];default:return null}}return null}}catch{}class B{constructor(t,s,u,d=1){this.r=t,this.g=s,this.b=u,this.a=d}static parse(t){if(!t)return;if(t instanceof B)return t;if("string"!=typeof t)return;const s=jr(t);return s?new B(s[0]/255*s[3],s[1]/255*s[3],s[2]/255*s[3],s[3]):void 0}toString(){const[t,s,u,d]=this.toArray();return`rgba(${Math.round(t)},${Math.round(s)},${Math.round(u)},${d})`}toArray(){const{r:t,g:s,b:u,a:d}=this;return 0===d?[0,0,0,0]:[255*t/d,255*s/d,255*u/d,d]}}B.black=new B(0,0,0,1),B.white=new B(1,1,1,1),B.transparent=new B(0,0,0,0),B.red=new B(1,0,0,1);class Q{constructor(t,s,u){this.sensitivity=t?s?"variant":"case":s?"accent":"base",this.locale=u,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,s){return this.collator.compare(t,s)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class H{constructor(t,s,u,d,y){this.text=t,this.image=s,this.scale=u,this.fontStack=d,this.textColor=y}}class U{constructor(t){this.sections=t}static fromString(t){return new U([new H(t,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(t=>0!==t.text.length||t.image&&0!==t.image.name.length)}static factory(t){return t instanceof U?t:U.fromString(t)}toString(){return 0===this.sections.length?"":this.sections.map(t=>t.text).join("")}serialize(){const t=["format"];for(const s of this.sections){if(s.image){t.push(["image",s.image.name]);continue}t.push(s.text);const u={};s.fontStack&&(u["text-font"]=["literal",s.fontStack.split(",")]),s.scale&&(u["font-scale"]=s.scale),s.textColor&&(u["text-color"]=["rgba"].concat(s.textColor.toArray())),t.push(u)}return t}}class G{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new G({name:t,available:!1}):null}serialize(){return["image",this.name]}}function Y(i,t,s,u){return"number"==typeof i&&i>=0&&i<=255&&"number"==typeof t&&t>=0&&t<=255&&"number"==typeof s&&s>=0&&s<=255?void 0===u||"number"==typeof u&&u>=0&&u<=1?null:`Invalid rgba value [${[i,t,s,u].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof u?[i,t,s,u]:[i,t,s]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function te(i){if(null===i||"string"==typeof i||"boolean"==typeof i||"number"==typeof i||i instanceof B||i instanceof Q||i instanceof U||i instanceof G)return!0;if(Array.isArray(i)){for(const t of i)if(!te(t))return!1;return!0}if("object"==typeof i){for(const t in i)if(!te(i[t]))return!1;return!0}return!1}function le(i){if(null===i)return mt;if("string"==typeof i)return hn;if("boolean"==typeof i)return _t;if("number"==typeof i)return Qe;if(i instanceof B)return Or;if(i instanceof Q)return gr;if(i instanceof U)return ki;if(i instanceof G)return gi;if(Array.isArray(i)){const t=i.length;let s;for(const u of i){const d=le(u);if(s){if(s===d)continue;s=nn;break}s=d}return Yn(s||nn,t)}return Tn}function Ce(i){const t=typeof i;return null===i?"":"string"===t||"number"===t||"boolean"===t?String(i):i instanceof B||i instanceof U||i instanceof G?i.toString():JSON.stringify(i)}class Be{constructor(t,s){this.type=t,this.value=s}static parse(t,s){if(2!==t.length)return s.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!te(t[1]))return s.error("invalid value");const u=t[1];let d=le(u);const y=s.expectedType;return"array"!==d.kind||0!==d.N||!y||"array"!==y.kind||"number"==typeof y.N&&0!==y.N||(d=y),new Be(d,u)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof B?["rgba"].concat(this.value.toArray()):this.value instanceof U?this.value.serialize():this.value}}class Pe{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}}const tt={string:hn,number:Qe,boolean:_t,object:Tn};class st{constructor(t,s){this.type=t,this.args=s}static parse(t,s){if(t.length<2)return s.error("Expected at least one argument.");let u,d=1;const y=t[0];if("array"===y){let b,C;if(t.length>2){const P=t[1];if("string"!=typeof P||!(P in tt)||"object"===P)return s.error('The item type argument of "array" must be one of string, number, boolean',1);b=tt[P],d++}else b=nn;if(t.length>3){if(null!==t[2]&&("number"!=typeof t[2]||t[2]<0||t[2]!==Math.floor(t[2])))return s.error('The length argument to "array" must be a positive integer literal',2);C=t[2],d++}u=Yn(b,C)}else u=tt[y];const _=[];for(;d<t.length;d++){const b=s.parse(t[d],d,nn);if(!b)return null;_.push(b)}return new st(u,_)}evaluate(t){for(let s=0;s<this.args.length;s++){const u=this.args[s].evaluate(t);if(!yi(this.type,le(u)))return u;if(s===this.args.length-1)throw new Pe(`Expected value to be of type ${rn(this.type)}, but found ${rn(le(u))} instead.`)}return null}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){const t=this.type,s=[t.kind];if("array"===t.kind){const u=t.itemType;if("string"===u.kind||"number"===u.kind||"boolean"===u.kind){s.push(u.kind);const d=t.N;("number"==typeof d||this.args.length>1)&&s.push(d)}}return s.concat(this.args.map(u=>u.serialize()))}}class ct{constructor(t){this.type=ki,this.sections=t}static parse(t,s){if(t.length<2)return s.error("Expected at least one argument.");const u=t[1];if(!Array.isArray(u)&&"object"==typeof u)return s.error("First argument must be an image or text section.");const d=[];let y=!1;for(let _=1;_<=t.length-1;++_){const b=t[_];if(y&&"object"==typeof b&&!Array.isArray(b)){y=!1;let C=null;if(b["font-scale"]&&(C=s.parse(b["font-scale"],1,Qe),!C))return null;let P=null;if(b["text-font"]&&(P=s.parse(b["text-font"],1,Yn(hn)),!P))return null;let V=null;if(b["text-color"]&&(V=s.parse(b["text-color"],1,Or),!V))return null;const $=d[d.length-1];$.scale=C,$.font=P,$.textColor=V}else{const C=s.parse(t[_],1,nn);if(!C)return null;const P=C.type.kind;if("string"!==P&&"value"!==P&&"null"!==P&&"resolvedImage"!==P)return s.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");y=!0,d.push({content:C,scale:null,font:null,textColor:null})}}return new ct(d)}evaluate(t){return new U(this.sections.map(s=>{const u=s.content.evaluate(t);return le(u)===gi?new H("",u,null,null,null):new H(Ce(u),null,s.scale?s.scale.evaluate(t):null,s.font?s.font.evaluate(t).join(","):null,s.textColor?s.textColor.evaluate(t):null)}))}eachChild(t){for(const s of this.sections)t(s.content),s.scale&&t(s.scale),s.font&&t(s.font),s.textColor&&t(s.textColor)}outputDefined(){return!1}serialize(){const t=["format"];for(const s of this.sections){t.push(s.content.serialize());const u={};s.scale&&(u["font-scale"]=s.scale.serialize()),s.font&&(u["text-font"]=s.font.serialize()),s.textColor&&(u["text-color"]=s.textColor.serialize()),t.push(u)}return t}}class Mt{constructor(t){this.type=gi,this.input=t}static parse(t,s){if(2!==t.length)return s.error("Expected two arguments.");const u=s.parse(t[1],1,hn);return u?new Mt(u):s.error("No image name provided.")}evaluate(t){const s=this.input.evaluate(t),u=G.fromString(s);return u&&t.availableImages&&(u.available=t.availableImages.indexOf(s)>-1),u}eachChild(t){t(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const sn={"to-boolean":_t,"to-color":Or,"to-number":Qe,"to-string":hn};class We{constructor(t,s){this.type=t,this.args=s}static parse(t,s){if(t.length<2)return s.error("Expected at least one argument.");const u=t[0];if(("to-boolean"===u||"to-string"===u)&&2!==t.length)return s.error("Expected one argument.");const d=sn[u],y=[];for(let _=1;_<t.length;_++){const b=s.parse(t[_],_,nn);if(!b)return null;y.push(b)}return new We(d,y)}evaluate(t){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(t));if("color"===this.type.kind){let s,u;for(const d of this.args){if(s=d.evaluate(t),u=null,s instanceof B)return s;if("string"==typeof s){const y=t.parseColor(s);if(y)return y}else if(Array.isArray(s)&&(u=s.length<3||s.length>4?`Invalid rbga value ${JSON.stringify(s)}: expected an array containing either three or four numeric values.`:Y(s[0],s[1],s[2],s[3]),!u))return new B(s[0]/255,s[1]/255,s[2]/255,s[3])}throw new Pe(u||`Could not parse color from value '${"string"==typeof s?s:String(JSON.stringify(s))}'`)}if("number"===this.type.kind){let s=null;for(const u of this.args){if(s=u.evaluate(t),null===s)return 0;const d=Number(s);if(!isNaN(d))return d}throw new Pe(`Could not convert ${JSON.stringify(s)} to number.`)}return"formatted"===this.type.kind?U.fromString(Ce(this.args[0].evaluate(t))):"resolvedImage"===this.type.kind?G.fromString(Ce(this.args[0].evaluate(t))):Ce(this.args[0].evaluate(t))}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){if("formatted"===this.type.kind)return new ct([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new Mt(this.args[0]).serialize();const t=[`to-${this.type.kind}`];return this.eachChild(s=>{t.push(s.serialize())}),t}}const dt=["Unknown","Point","LineString","Polygon"];class St{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?dt[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(t){let s=this._parseColorCache[t];return s||(s=this._parseColorCache[t]=B.parse(t)),s}}class Ut{constructor(t,s,u,d){this.name=t,this.type=s,this._evaluate=u,this.args=d}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(t=>t.serialize()))}static parse(t,s){const u=t[0],d=Ut.definitions[u];if(!d)return s.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0);const y=Array.isArray(d)?d[0]:d.type,_=Array.isArray(d)?[[d[1],d[2]]]:d.overloads,b=_.filter(([P])=>!Array.isArray(P)||P.length===t.length-1);let C=null;for(const[P,V]of b){C=new So(s.registry,s.path,null,s.scope);const $=[];let Z=!1;for(let J=1;J<t.length;J++){const ee=t[J],de=Array.isArray(P)?P[J-1]:P.type,he=C.parse(ee,1+$.length,de);if(!he){Z=!0;break}$.push(he)}if(!Z)if(Array.isArray(P)&&P.length!==$.length)C.error(`Expected ${P.length} arguments, but found ${$.length} instead.`);else{for(let J=0;J<$.length;J++){const ee=Array.isArray(P)?P[J]:P.type,de=$[J];C.concat(J+1).checkSubtype(ee,de.type)}if(0===C.errors.length)return new Ut(u,y,V,$)}}if(1===b.length)s.errors.push(...C.errors);else{const P=(b.length?b:_).map(([$])=>{return Z=$,Array.isArray(Z)?`(${Z.map(rn).join(", ")})`:`(${rn(Z.type)}...)`;var Z}).join(" | "),V=[];for(let $=1;$<t.length;$++){const Z=s.parse(t[$],1+V.length);if(!Z)return null;V.push(rn(Z.type))}s.error(`Expected arguments of type ${P}, but found (${V.join(", ")}) instead.`)}return null}static register(t,s){Ut.definitions=s;for(const u in s)t[u]=Ut}}class Qn{constructor(t,s,u){this.type=gr,this.locale=u,this.caseSensitive=t,this.diacriticSensitive=s}static parse(t,s){if(2!==t.length)return s.error("Expected one argument.");const u=t[1];if("object"!=typeof u||Array.isArray(u))return s.error("Collator options argument must be an object.");const d=s.parse(void 0!==u["case-sensitive"]&&u["case-sensitive"],1,_t);if(!d)return null;const y=s.parse(void 0!==u["diacritic-sensitive"]&&u["diacritic-sensitive"],1,_t);if(!y)return null;let _=null;return u.locale&&(_=s.parse(u.locale,1,hn),!_)?null:new Qn(d,y,_)}evaluate(t){return new Q(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}serialize(){const t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]}}const En=8192;function rr(i,t){i[0]=Math.min(i[0],t[0]),i[1]=Math.min(i[1],t[1]),i[2]=Math.max(i[2],t[0]),i[3]=Math.max(i[3],t[1])}function bn(i,t){return!(i[0]<=t[0]||i[2]>=t[2]||i[1]<=t[1]||i[3]>=t[3])}function io(i,t){const s=(180+i[0])/360,u=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,d=Math.pow(2,t.z);return[Math.round(s*d*En),Math.round(u*d*En)]}function Zi(i,t,s){const u=i[0]-t[0],d=i[1]-t[1],y=i[0]-s[0],_=i[1]-s[1];return u*_-y*d==0&&u*y<=0&&d*_<=0}function Ot(i,t){let s=!1;for(let _=0,b=t.length;_<b;_++){const C=t[_];for(let P=0,V=C.length;P<V-1;P++){if(Zi(i,C[P],C[P+1]))return!1;(d=C[P])[1]>(u=i)[1]!=(y=C[P+1])[1]>u[1]&&u[0]<(y[0]-d[0])*(u[1]-d[1])/(y[1]-d[1])+d[0]&&(s=!s)}}var u,d,y;return s}function Bo(i,t){for(let s=0;s<t.length;s++)if(Ot(i,t[s]))return!0;return!1}function Ri(i,t,s,u){const d=u[0]-s[0],y=u[1]-s[1],_=(i[0]-s[0])*y-d*(i[1]-s[1]),b=(t[0]-s[0])*y-d*(t[1]-s[1]);return _>0&&b<0||_<0&&b>0}function Ma(i,t,s){for(const P of s)for(let V=0;V<P.length-1;++V)if((b=[(_=P[V+1])[0]-(y=P[V])[0],_[1]-y[1]])[0]*(C=[(d=t)[0]-(u=i)[0],d[1]-u[1]])[1]-b[1]*C[0]!=0&&Ri(u,d,y,_)&&Ri(y,_,u,d))return!0;var u,d,y,_,b,C;return!1}function _i(i,t){for(let s=0;s<i.length;++s)if(!Ot(i[s],t))return!1;for(let s=0;s<i.length-1;++s)if(Ma(i[s],i[s+1],t))return!1;return!0}function zr(i,t){for(let s=0;s<t.length;s++)if(_i(i,t[s]))return!0;return!1}function Wi(i,t,s){const u=[];for(let d=0;d<i.length;d++){const y=[];for(let _=0;_<i[d].length;_++){const b=io(i[d][_],s);rr(t,b),y.push(b)}u.push(y)}return u}function vi(i,t,s){const u=[];for(let d=0;d<i.length;d++){const y=Wi(i[d],t,s);u.push(y)}return u}function Hr(i,t,s,u){if(i[0]<s[0]||i[0]>s[2]){const d=.5*u;let y=i[0]-s[0]>d?-u:s[0]-i[0]>d?u:0;0===y&&(y=i[0]-s[2]>d?-u:s[2]-i[0]>d?u:0),i[0]+=y}rr(t,i)}function Io(i,t,s,u){const d=Math.pow(2,u.z)*En,y=[u.x*En,u.y*En],_=[];for(const b of i)for(const C of b){const P=[C.x+y[0],C.y+y[1]];Hr(P,t,s,d),_.push(P)}return _}function _s(i,t,s,u){const d=Math.pow(2,u.z)*En,y=[u.x*En,u.y*En],_=[];for(const C of i){const P=[];for(const V of C){const $=[V.x+y[0],V.y+y[1]];rr(t,$),P.push($)}_.push(P)}if(t[2]-t[0]<=d/2){(b=t)[0]=b[1]=1/0,b[2]=b[3]=-1/0;for(const C of _)for(const P of C)Hr(P,t,s,d)}var b;return _}class Pn{constructor(t,s){this.type=_t,this.geojson=t,this.geometries=s}static parse(t,s){if(2!==t.length)return s.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(te(t[1])){const u=t[1];if("FeatureCollection"===u.type)for(let d=0;d<u.features.length;++d){const y=u.features[d].geometry.type;if("Polygon"===y||"MultiPolygon"===y)return new Pn(u,u.features[d].geometry)}else if("Feature"===u.type){const d=u.geometry.type;if("Polygon"===d||"MultiPolygon"===d)return new Pn(u,u.geometry)}else if("Polygon"===u.type||"MultiPolygon"===u.type)return new Pn(u,u)}return s.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(null!=t.geometry()&&null!=t.canonicalID()){if("Point"===t.geometryType())return function(s,u){const d=[1/0,1/0,-1/0,-1/0],y=[1/0,1/0,-1/0,-1/0],_=s.canonicalID();if("Polygon"===u.type){const b=Wi(u.coordinates,y,_),C=Io(s.geometry(),d,y,_);if(!bn(d,y))return!1;for(const P of C)if(!Ot(P,b))return!1}if("MultiPolygon"===u.type){const b=vi(u.coordinates,y,_),C=Io(s.geometry(),d,y,_);if(!bn(d,y))return!1;for(const P of C)if(!Bo(P,b))return!1}return!0}(t,this.geometries);if("LineString"===t.geometryType())return function(s,u){const d=[1/0,1/0,-1/0,-1/0],y=[1/0,1/0,-1/0,-1/0],_=s.canonicalID();if("Polygon"===u.type){const b=Wi(u.coordinates,y,_),C=_s(s.geometry(),d,y,_);if(!bn(d,y))return!1;for(const P of C)if(!_i(P,b))return!1}if("MultiPolygon"===u.type){const b=vi(u.coordinates,y,_),C=_s(s.geometry(),d,y,_);if(!bn(d,y))return!1;for(const P of C)if(!zr(P,b))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}function co(i){if(i instanceof Ut&&("get"===i.name&&1===i.args.length||"feature-state"===i.name||"has"===i.name&&1===i.args.length||"properties"===i.name||"geometry-type"===i.name||"id"===i.name||/^filter-/.test(i.name))||i instanceof Pn)return!1;let t=!0;return i.eachChild(s=>{t&&!co(s)&&(t=!1)}),t}function ho(i){if(i instanceof Ut&&"feature-state"===i.name)return!1;let t=!0;return i.eachChild(s=>{t&&!ho(s)&&(t=!1)}),t}function Yi(i,t){if(i instanceof Ut&&t.indexOf(i.name)>=0)return!1;let s=!0;return i.eachChild(u=>{s&&!Yi(u,t)&&(s=!1)}),s}class po{constructor(t,s){this.type=s.type,this.name=t,this.boundExpression=s}static parse(t,s){if(2!==t.length||"string"!=typeof t[1])return s.error("'var' expression requires exactly one string literal argument.");const u=t[1];return s.scope.has(u)?new po(u,s.scope.get(u)):s.error(`Unknown variable "${u}". Make sure "${u}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class So{constructor(t,s=[],u,d=new Wn,y=[]){this.registry=t,this.path=s,this.key=s.map(_=>`[${_}]`).join(""),this.scope=d,this.errors=y,this.expectedType=u}parse(t,s,u,d,y={}){return s?this.concat(s,u,d)._parse(t,y):this._parse(t,y)}_parse(t,s){function u(d,y,_){return"assert"===_?new st(y,[d]):"coerce"===_?new We(y,[d]):d}if(null!==t&&"string"!=typeof t&&"boolean"!=typeof t&&"number"!=typeof t||(t=["literal",t]),Array.isArray(t)){if(0===t.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const d=t[0];if("string"!=typeof d)return this.error(`Expression name must be a string, but found ${typeof d} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const y=this.registry[d];if(y){let _=y.parse(t,this);if(!_)return null;if(this.expectedType){const b=this.expectedType,C=_.type;if("string"!==b.kind&&"number"!==b.kind&&"boolean"!==b.kind&&"object"!==b.kind&&"array"!==b.kind||"value"!==C.kind)if("color"!==b.kind&&"formatted"!==b.kind&&"resolvedImage"!==b.kind||"value"!==C.kind&&"string"!==C.kind){if(this.checkSubtype(b,C))return null}else _=u(_,b,s.typeAnnotation||"coerce");else _=u(_,b,s.typeAnnotation||"assert")}if(!(_ instanceof Be)&&"resolvedImage"!==_.type.kind&&kr(_)){const b=new St;try{_=new Be(_.type,_.evaluate(b))}catch(C){return this.error(C.message),null}}return _}return this.error(`Unknown expression "${d}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===t?"'undefined' value invalid. Use null instead.":"object"==typeof t?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,s,u){const d="number"==typeof t?this.path.concat(t):this.path,y=u?this.scope.concat(u):this.scope;return new So(this.registry,d,s||null,y,this.errors)}error(t,...s){const u=`${this.key}${s.map(d=>`[${d}]`).join("")}`;this.errors.push(new lr(u,t))}checkSubtype(t,s){const u=yi(t,s);return u&&this.error(u),u}}function kr(i){if(i instanceof po)return kr(i.boundExpression);if(i instanceof Ut&&"error"===i.name||i instanceof Qn||i instanceof Pn)return!1;const t=i instanceof We||i instanceof st;let s=!0;return i.eachChild(u=>{s=t?s&&kr(u):s&&u instanceof Be}),!!s&&co(i)&&Yi(i,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Mi(i,t){const s=i.length-1;let u,d,y=0,_=s,b=0;for(;y<=_;)if(b=Math.floor((y+_)/2),u=i[b],d=i[b+1],u<=t){if(b===s||t<d)return b;y=b+1}else{if(!(u>t))throw new Pe("Input is not a number.");_=b-1}return 0}class Ir{constructor(t,s,u){this.type=t,this.input=s,this.labels=[],this.outputs=[];for(const[d,y]of u)this.labels.push(d),this.outputs.push(y)}static parse(t,s){if(t.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return s.error("Expected an even number of arguments.");const u=s.parse(t[1],1,Qe);if(!u)return null;const d=[];let y=null;s.expectedType&&"value"!==s.expectedType.kind&&(y=s.expectedType);for(let _=1;_<t.length;_+=2){const b=1===_?-1/0:t[_],C=t[_+1],P=_,V=_+1;if("number"!=typeof b)return s.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',P);if(d.length&&d[d.length-1][0]>=b)return s.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',P);const $=s.parse(C,V,y);if(!$)return null;y=y||$.type,d.push([b,$])}return new Ir(y,u,d)}evaluate(t){const s=this.labels,u=this.outputs;if(1===s.length)return u[0].evaluate(t);const d=this.input.evaluate(t);if(d<=s[0])return u[0].evaluate(t);const y=s.length;return d>=s[y-1]?u[y-1].evaluate(t):u[Mi(s,d)].evaluate(t)}eachChild(t){t(this.input);for(const s of this.outputs)t(s)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}serialize(){const t=["step",this.input.serialize()];for(let s=0;s<this.labels.length;s++)s>0&&t.push(this.labels[s]),t.push(this.outputs[s].serialize());return t}}function Sr(i,t,s){return i*(1-s)+t*s}var Nr=Object.freeze({__proto__:null,number:Sr,color:function(i,t,s){return new B(Sr(i.r,t.r,s),Sr(i.g,t.g,s),Sr(i.b,t.b,s),Sr(i.a,t.a,s))},array:function(i,t,s){return i.map((u,d)=>Sr(u,t[d],s))}});const Ao=4/29,fo=6/29,ti=3*fo*fo,Ws=Math.PI/180,Ja=180/Math.PI;function vs(i){return i>.008856451679035631?Math.pow(i,1/3):i/ti+Ao}function ns(i){return i>fo?i*i*i:ti*(i-Ao)}function Ys(i){return 255*(i<=.0031308?12.92*i:1.055*Math.pow(i,1/2.4)-.055)}function Ia(i){return(i/=255)<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function Ks(i){const t=Ia(i.r),s=Ia(i.g),u=Ia(i.b),d=vs((.4124564*t+.3575761*s+.1804375*u)/.95047),y=vs((.2126729*t+.7151522*s+.072175*u)/1);return{l:116*y-16,a:500*(d-y),b:200*(y-vs((.0193339*t+.119192*s+.9503041*u)/1.08883)),alpha:i.a}}function Nn(i){let t=(i.l+16)/116,s=isNaN(i.a)?t:t+i.a/500,u=isNaN(i.b)?t:t-i.b/200;return t=1*ns(t),s=.95047*ns(s),u=1.08883*ns(u),new B(Ys(3.2404542*s-1.5371385*t-.4985314*u),Ys(-.969266*s+1.8760108*t+.041556*u),Ys(.0556434*s-.2040259*t+1.0572252*u),i.alpha)}function Xs(i,t,s){const u=t-i;return i+s*(u>180||u<-180?u-360*Math.round(u/360):u)}const rs={forward:Ks,reverse:Nn,interpolate:function(i,t,s){return{l:Sr(i.l,t.l,s),a:Sr(i.a,t.a,s),b:Sr(i.b,t.b,s),alpha:Sr(i.alpha,t.alpha,s)}}},Vo={forward:function(i){const{l:t,a:s,b:u}=Ks(i),d=Math.atan2(u,s)*Ja;return{h:d<0?d+360:d,c:Math.sqrt(s*s+u*u),l:t,alpha:i.a}},reverse:function(i){const t=i.h*Ws,s=i.c;return Nn({l:i.l,a:Math.cos(t)*s,b:Math.sin(t)*s,alpha:i.alpha})},interpolate:function(i,t,s){return{h:Xs(i.h,t.h,s),c:Sr(i.c,t.c,s),l:Sr(i.l,t.l,s),alpha:Sr(i.alpha,t.alpha,s)}}};var Js=Object.freeze({__proto__:null,lab:rs,hcl:Vo});class ni{constructor(t,s,u,d,y){this.type=t,this.operator=s,this.interpolation=u,this.input=d,this.labels=[],this.outputs=[];for(const[_,b]of y)this.labels.push(_),this.outputs.push(b)}static interpolationFactor(t,s,u,d){let y=0;if("exponential"===t.name)y=Uo(s,t.base,u,d);else if("linear"===t.name)y=Uo(s,1,u,d);else if("cubic-bezier"===t.name){const _=t.controlPoints;y=new it(_[0],_[1],_[2],_[3]).solve(Uo(s,1,u,d))}return y}static parse(t,s){let[u,d,y,..._]=t;if(!Array.isArray(d)||0===d.length)return s.error("Expected an interpolation type expression.",1);if("linear"===d[0])d={name:"linear"};else if("exponential"===d[0]){const P=d[1];if("number"!=typeof P)return s.error("Exponential interpolation requires a numeric base.",1,1);d={name:"exponential",base:P}}else{if("cubic-bezier"!==d[0])return s.error(`Unknown interpolation type ${String(d[0])}`,1,0);{const P=d.slice(1);if(4!==P.length||P.some(V=>"number"!=typeof V||V<0||V>1))return s.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);d={name:"cubic-bezier",controlPoints:P}}}if(t.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return s.error("Expected an even number of arguments.");if(y=s.parse(y,2,Qe),!y)return null;const b=[];let C=null;"interpolate-hcl"===u||"interpolate-lab"===u?C=Or:s.expectedType&&"value"!==s.expectedType.kind&&(C=s.expectedType);for(let P=0;P<_.length;P+=2){const V=_[P],$=_[P+1],Z=P+3,J=P+4;if("number"!=typeof V)return s.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',Z);if(b.length&&b[b.length-1][0]>=V)return s.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',Z);const ee=s.parse($,J,C);if(!ee)return null;C=C||ee.type,b.push([V,ee])}return"number"===C.kind||"color"===C.kind||"array"===C.kind&&"number"===C.itemType.kind&&"number"==typeof C.N?new ni(C,u,d,y,b):s.error(`Type ${rn(C)} is not interpolatable.`)}evaluate(t){const s=this.labels,u=this.outputs;if(1===s.length)return u[0].evaluate(t);const d=this.input.evaluate(t);if(d<=s[0])return u[0].evaluate(t);const y=s.length;if(d>=s[y-1])return u[y-1].evaluate(t);const _=Mi(s,d),b=ni.interpolationFactor(this.interpolation,d,s[_],s[_+1]),C=u[_].evaluate(t),P=u[_+1].evaluate(t);return"interpolate"===this.operator?Nr[this.type.kind.toLowerCase()](C,P,b):"interpolate-hcl"===this.operator?Vo.reverse(Vo.interpolate(Vo.forward(C),Vo.forward(P),b)):rs.reverse(rs.interpolate(rs.forward(C),rs.forward(P),b))}eachChild(t){t(this.input);for(const s of this.outputs)t(s)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}serialize(){let t;t="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const s=[this.operator,t,this.input.serialize()];for(let u=0;u<this.labels.length;u++)s.push(this.labels[u],this.outputs[u].serialize());return s}}function Uo(i,t,s,u){const d=u-s,y=i-s;return 0===d?0:1===t?y/d:(Math.pow(t,y)-1)/(Math.pow(t,d)-1)}class xs{constructor(t,s){this.type=t,this.args=s}static parse(t,s){if(t.length<2)return s.error("Expectected at least one argument.");let u=null;const d=s.expectedType;d&&"value"!==d.kind&&(u=d);const y=[];for(const b of t.slice(1)){const C=s.parse(b,1+y.length,u,void 0,{typeAnnotation:"omit"});if(!C)return null;u=u||C.type,y.push(C)}const _=d&&y.some(b=>yi(d,b.type));return new xs(_?nn:u,y)}evaluate(t){let s,u=null,d=0;for(const y of this.args)if(d++,u=y.evaluate(t),u&&u instanceof G&&!u.available&&(s||(s=u.name),u=null,d===this.args.length&&(u=s)),null!==u)break;return u}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){const t=["coalesce"];return this.eachChild(s=>{t.push(s.serialize())}),t}}class is{constructor(t,s){this.type=s.type,this.bindings=[].concat(t),this.result=s}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const s of this.bindings)t(s[1]);t(this.result)}static parse(t,s){if(t.length<4)return s.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const u=[];for(let y=1;y<t.length-1;y+=2){const _=t[y];if("string"!=typeof _)return s.error(`Expected string, but found ${typeof _} instead.`,y);if(/[^a-zA-Z0-9_]/.test(_))return s.error("Variable names must contain only alphanumeric characters or '_'.",y);const b=s.parse(t[y+1],y+1);if(!b)return null;u.push([_,b])}const d=s.parse(t[t.length-1],t.length-1,s.expectedType,u);return d?new is(u,d):null}outputDefined(){return this.result.outputDefined()}serialize(){const t=["let"];for(const[s,u]of this.bindings)t.push(s,u.serialize());return t.push(this.result.serialize()),t}}class Qs{constructor(t,s,u){this.type=t,this.index=s,this.input=u}static parse(t,s){if(3!==t.length)return s.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const u=s.parse(t[1],1,Qe),d=s.parse(t[2],2,Yn(s.expectedType||nn));return u&&d?new Qs(d.type.itemType,u,d):null}evaluate(t){const s=this.index.evaluate(t),u=this.input.evaluate(t);if(s<0)throw new Pe(`Array index out of bounds: ${s} < 0.`);if(s>=u.length)throw new Pe(`Array index out of bounds: ${s} > ${u.length-1}.`);if(s!==Math.floor(s))throw new Pe(`Array index must be an integer, but found ${s} instead.`);return u[s]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class jo{constructor(t,s){this.type=_t,this.needle=t,this.haystack=s}static parse(t,s){if(3!==t.length)return s.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const u=s.parse(t[1],1,nn),d=s.parse(t[2],2,nn);return u&&d?Jn(u.type,[_t,hn,Qe,mt,nn])?new jo(u,d):s.error(`Expected first argument to be of type boolean, string, number or null, but found ${rn(u.type)} instead`):null}evaluate(t){const s=this.needle.evaluate(t),u=this.haystack.evaluate(t);if(!u)return!1;if(!vn(s,["boolean","string","number","null"]))throw new Pe(`Expected first argument to be of type boolean, string, number or null, but found ${rn(le(s))} instead.`);if(!vn(u,["string","array"]))throw new Pe(`Expected second argument to be of type array or string, but found ${rn(le(u))} instead.`);return u.indexOf(s)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class $o{constructor(t,s,u){this.type=Qe,this.needle=t,this.haystack=s,this.fromIndex=u}static parse(t,s){if(t.length<=2||t.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const u=s.parse(t[1],1,nn),d=s.parse(t[2],2,nn);if(!u||!d)return null;if(!Jn(u.type,[_t,hn,Qe,mt,nn]))return s.error(`Expected first argument to be of type boolean, string, number or null, but found ${rn(u.type)} instead`);if(4===t.length){const y=s.parse(t[3],3,Qe);return y?new $o(u,d,y):null}return new $o(u,d)}evaluate(t){const s=this.needle.evaluate(t),u=this.haystack.evaluate(t);if(!vn(s,["boolean","string","number","null"]))throw new Pe(`Expected first argument to be of type boolean, string, number or null, but found ${rn(le(s))} instead.`);if(!vn(u,["string","array"]))throw new Pe(`Expected second argument to be of type array or string, but found ${rn(le(u))} instead.`);if(this.fromIndex){const d=this.fromIndex.evaluate(t);return u.indexOf(s,d)}return u.indexOf(s)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const t=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),t]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class mo{constructor(t,s,u,d,y,_){this.inputType=t,this.type=s,this.input=u,this.cases=d,this.outputs=y,this.otherwise=_}static parse(t,s){if(t.length<5)return s.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return s.error("Expected an even number of arguments.");let u,d;s.expectedType&&"value"!==s.expectedType.kind&&(d=s.expectedType);const y={},_=[];for(let P=2;P<t.length-1;P+=2){let V=t[P];const $=t[P+1];Array.isArray(V)||(V=[V]);const Z=s.concat(P);if(0===V.length)return Z.error("Expected at least one branch label.");for(const ee of V){if("number"!=typeof ee&&"string"!=typeof ee)return Z.error("Branch labels must be numbers or strings.");if("number"==typeof ee&&Math.abs(ee)>Number.MAX_SAFE_INTEGER)return Z.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof ee&&Math.floor(ee)!==ee)return Z.error("Numeric branch labels must be integer values.");if(u){if(Z.checkSubtype(u,le(ee)))return null}else u=le(ee);if(void 0!==y[String(ee)])return Z.error("Branch labels must be unique.");y[String(ee)]=_.length}const J=s.parse($,P,d);if(!J)return null;d=d||J.type,_.push(J)}const b=s.parse(t[1],1,nn);if(!b)return null;const C=s.parse(t[t.length-1],t.length-1,d);return C?"value"!==b.type.kind&&s.concat(1).checkSubtype(u,b.type)?null:new mo(u,d,b,y,_,C):null}evaluate(t){const s=this.input.evaluate(t);return(le(s)===this.inputType&&this.outputs[this.cases[s]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}serialize(){const t=["match",this.input.serialize()],s=Object.keys(this.cases).sort(),u=[],d={};for(const _ of s){const b=d[this.cases[_]];void 0===b?(d[this.cases[_]]=u.length,u.push([this.cases[_],[_]])):u[b][1].push(_)}const y=_=>"number"===this.inputType.kind?Number(_):_;for(const[_,b]of u)t.push(1===b.length?y(b[0]):b.map(y)),t.push(this.outputs[_].serialize());return t.push(this.otherwise.serialize()),t}}class bs{constructor(t,s,u){this.type=t,this.branches=s,this.otherwise=u}static parse(t,s){if(t.length<4)return s.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return s.error("Expected an odd number of arguments.");let u;s.expectedType&&"value"!==s.expectedType.kind&&(u=s.expectedType);const d=[];for(let _=1;_<t.length-1;_+=2){const b=s.parse(t[_],_,_t);if(!b)return null;const C=s.parse(t[_+1],_+1,u);if(!C)return null;d.push([b,C]),u=u||C.type}const y=s.parse(t[t.length-1],t.length-1,u);return y?new bs(u,d,y):null}evaluate(t){for(const[s,u]of this.branches)if(s.evaluate(t))return u.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[s,u]of this.branches)t(s),t(u);t(this.otherwise)}outputDefined(){return this.branches.every(([t,s])=>s.outputDefined())&&this.otherwise.outputDefined()}serialize(){const t=["case"];return this.eachChild(s=>{t.push(s.serialize())}),t}}class ea{constructor(t,s,u,d){this.type=t,this.input=s,this.beginIndex=u,this.endIndex=d}static parse(t,s){if(t.length<=2||t.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const u=s.parse(t[1],1,nn),d=s.parse(t[2],2,Qe);if(!u||!d)return null;if(!Jn(u.type,[Yn(nn),hn,nn]))return s.error(`Expected first argument to be of type array or string, but found ${rn(u.type)} instead`);if(4===t.length){const y=s.parse(t[3],3,Qe);return y?new ea(u.type,u,d,y):null}return new ea(u.type,u,d)}evaluate(t){const s=this.input.evaluate(t),u=this.beginIndex.evaluate(t);if(!vn(s,["string","array"]))throw new Pe(`Expected first argument to be of type array or string, but found ${rn(le(s))} instead.`);if(this.endIndex){const d=this.endIndex.evaluate(t);return s.slice(u,d)}return s.slice(u)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const t=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),t]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function Sa(i,t){return"=="===i||"!="===i?"boolean"===t.kind||"string"===t.kind||"number"===t.kind||"null"===t.kind||"value"===t.kind:"string"===t.kind||"number"===t.kind||"value"===t.kind}function go(i,t,s,u){return 0===u.compare(t,s)}function To(i,t,s){const u="=="!==i&&"!="!==i;return class Mv{constructor(y,_,b){this.type=_t,this.lhs=y,this.rhs=_,this.collator=b,this.hasUntypedArgument="value"===y.type.kind||"value"===_.type.kind}static parse(y,_){if(3!==y.length&&4!==y.length)return _.error("Expected two or three arguments.");const b=y[0];let C=_.parse(y[1],1,nn);if(!C)return null;if(!Sa(b,C.type))return _.concat(1).error(`"${b}" comparisons are not supported for type '${rn(C.type)}'.`);let P=_.parse(y[2],2,nn);if(!P)return null;if(!Sa(b,P.type))return _.concat(2).error(`"${b}" comparisons are not supported for type '${rn(P.type)}'.`);if(C.type.kind!==P.type.kind&&"value"!==C.type.kind&&"value"!==P.type.kind)return _.error(`Cannot compare types '${rn(C.type)}' and '${rn(P.type)}'.`);u&&("value"===C.type.kind&&"value"!==P.type.kind?C=new st(P.type,[C]):"value"!==C.type.kind&&"value"===P.type.kind&&(P=new st(C.type,[P])));let V=null;if(4===y.length){if("string"!==C.type.kind&&"string"!==P.type.kind&&"value"!==C.type.kind&&"value"!==P.type.kind)return _.error("Cannot use collator to compare non-string types.");if(V=_.parse(y[3],3,gr),!V)return null}return new Mv(C,P,V)}evaluate(y){const _=this.lhs.evaluate(y),b=this.rhs.evaluate(y);if(u&&this.hasUntypedArgument){const C=le(_),P=le(b);if(C.kind!==P.kind||"string"!==C.kind&&"number"!==C.kind)throw new Pe(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${C.kind}, ${P.kind}) instead.`)}if(this.collator&&!u&&this.hasUntypedArgument){const C=le(_),P=le(b);if("string"!==C.kind||"string"!==P.kind)return t(y,_,b)}return this.collator?s(y,_,b,this.collator.evaluate(y)):t(y,_,b)}eachChild(y){y(this.lhs),y(this.rhs),this.collator&&y(this.collator)}outputDefined(){return!0}serialize(){const y=[i];return this.eachChild(_=>{y.push(_.serialize())}),y}}}const ta=To("==",function(i,t,s){return t===s},go),ws=To("!=",function(i,t,s){return t!==s},function(i,t,s,u){return!go(0,t,s,u)}),Qa=To("<",function(i,t,s){return t<s},function(i,t,s,u){return u.compare(t,s)<0}),na=To(">",function(i,t,s){return t>s},function(i,t,s,u){return u.compare(t,s)>0}),Ds=To("<=",function(i,t,s){return t<=s},function(i,t,s,u){return u.compare(t,s)<=0}),Aa=To(">=",function(i,t,s){return t>=s},function(i,t,s,u){return u.compare(t,s)>=0});class ra{constructor(t,s,u,d,y){this.type=hn,this.number=t,this.locale=s,this.currency=u,this.minFractionDigits=d,this.maxFractionDigits=y}static parse(t,s){if(3!==t.length)return s.error("Expected two arguments.");const u=s.parse(t[1],1,Qe);if(!u)return null;const d=t[2];if("object"!=typeof d||Array.isArray(d))return s.error("NumberFormat options argument must be an object.");let y=null;if(d.locale&&(y=s.parse(d.locale,1,hn),!y))return null;let _=null;if(d.currency&&(_=s.parse(d.currency,1,hn),!_))return null;let b=null;if(d["min-fraction-digits"]&&(b=s.parse(d["min-fraction-digits"],1,Qe),!b))return null;let C=null;return d["max-fraction-digits"]&&(C=s.parse(d["max-fraction-digits"],1,Qe),!C)?null:new ra(u,y,_,b,C)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]}}class L{constructor(t){this.type=Qe,this.input=t}static parse(t,s){if(2!==t.length)return s.error(`Expected 1 argument, but found ${t.length-1} instead.`);const u=s.parse(t[1],1);return u?"array"!==u.type.kind&&"string"!==u.type.kind&&"value"!==u.type.kind?s.error(`Expected argument of type string or array, but found ${rn(u.type)} instead.`):new L(u):null}evaluate(t){const s=this.input.evaluate(t);if("string"==typeof s||Array.isArray(s))return s.length;throw new Pe(`Expected value to be of type string or array, but found ${rn(le(s))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}serialize(){const t=["length"];return this.eachChild(s=>{t.push(s.serialize())}),t}}const K={"==":ta,"!=":ws,">":na,"<":Qa,">=":Aa,"<=":Ds,array:st,at:Qs,boolean:st,case:bs,coalesce:xs,collator:Qn,format:ct,image:Mt,in:jo,"index-of":$o,interpolate:ni,"interpolate-hcl":ni,"interpolate-lab":ni,length:L,let:is,literal:Be,match:mo,number:st,"number-format":ra,object:st,slice:ea,step:Ir,string:st,"to-boolean":We,"to-color":We,"to-number":We,"to-string":We,var:po,within:Pn};function R(i,[t,s,u,d]){t=t.evaluate(i),s=s.evaluate(i),u=u.evaluate(i);const y=d?d.evaluate(i):1,_=Y(t,s,u,y);if(_)throw new Pe(_);return new B(t/255*y,s/255*y,u/255*y,y)}function oe(i,t){return i in t}function ve(i,t){const s=t[i];return void 0===s?null:s}function Ue(i){return{type:i}}function ot(i){return{result:"success",value:i}}function Bt(i){return{result:"error",value:i}}function Bn(i){return"data-driven"===i["property-type"]||"cross-faded-data-driven"===i["property-type"]}function ir(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function Kn(i){return!!i.expression&&i.expression.interpolated}function gt(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":null===i?"null":typeof i}function xn(i){return"object"==typeof i&&null!==i&&!Array.isArray(i)}function Jt(i){return i}function Ar(i,t){const s="color"===t.type,u=i.stops&&"object"==typeof i.stops[0][0],d=u||!(u||void 0!==i.property),y=i.type||(Kn(t)?"exponential":"interval");if(s&&((i=ht({},i)).stops&&(i.stops=i.stops.map(P=>[P[0],B.parse(P[1])])),i.default=B.parse(i.default?i.default:t.default)),i.colorSpace&&"rgb"!==i.colorSpace&&!Js[i.colorSpace])throw new Error(`Unknown color space: ${i.colorSpace}`);let _,b,C;if("exponential"===y)_=bi;else if("interval"===y)_=Po;else if("categorical"===y){_=$n,b=Object.create(null);for(const P of i.stops)b[P[0]]=P[1];C=typeof i.stops[0][0]}else{if("identity"!==y)throw new Error(`Unknown function type "${y}"`);_=ci}if(u){const P={},V=[];for(let J=0;J<i.stops.length;J++){const ee=i.stops[J],de=ee[0].zoom;void 0===P[de]&&(P[de]={zoom:de,type:i.type,property:i.property,default:i.default,stops:[]},V.push(de)),P[de].stops.push([ee[0].value,ee[1]])}const $=[];for(const J of V)$.push([P[J].zoom,Ar(P[J],t)]);const Z={name:"linear"};return{kind:"composite",interpolationType:Z,interpolationFactor:ni.interpolationFactor.bind(void 0,Z),zoomStops:$.map(J=>J[0]),evaluate:({zoom:J},ee)=>bi({stops:$,base:i.base},t,J).evaluate(J,ee)}}if(d){const P="exponential"===y?{name:"exponential",base:void 0!==i.base?i.base:1}:null;return{kind:"camera",interpolationType:P,interpolationFactor:ni.interpolationFactor.bind(void 0,P),zoomStops:i.stops.map(V=>V[0]),evaluate:({zoom:V})=>_(i,t,V,b,C)}}return{kind:"source",evaluate(P,V){const $=V&&V.properties?V.properties[i.property]:void 0;return void 0===$?cn(i.default,t.default):_(i,t,$,b,C)}}}function cn(i,t,s){return void 0!==i?i:void 0!==t?t:void 0!==s?s:void 0}function $n(i,t,s,u,d){return cn(typeof s===d?u[s]:void 0,i.default,t.default)}function Po(i,t,s){if("number"!==gt(s))return cn(i.default,t.default);const u=i.stops.length;if(1===u||s<=i.stops[0][0])return i.stops[0][1];if(s>=i.stops[u-1][0])return i.stops[u-1][1];const d=Mi(i.stops.map(y=>y[0]),s);return i.stops[d][1]}function bi(i,t,s){const u=void 0!==i.base?i.base:1;if("number"!==gt(s))return cn(i.default,t.default);const d=i.stops.length;if(1===d||s<=i.stops[0][0])return i.stops[0][1];if(s>=i.stops[d-1][0])return i.stops[d-1][1];const y=Mi(i.stops.map(V=>V[0]),s),_=function(V,$,Z,J){const ee=J-Z,de=V-Z;return 0===ee?0:1===$?de/ee:(Math.pow($,de)-1)/(Math.pow($,ee)-1)}(s,u,i.stops[y][0],i.stops[y+1][0]),b=i.stops[y][1],C=i.stops[y+1][1];let P=Nr[t.type]||Jt;if(i.colorSpace&&"rgb"!==i.colorSpace){const V=Js[i.colorSpace];P=($,Z)=>V.reverse(V.interpolate(V.forward($),V.forward(Z),_))}return"function"==typeof b.evaluate?{evaluate(...V){const $=b.evaluate.apply(void 0,V),Z=C.evaluate.apply(void 0,V);if(void 0!==$&&void 0!==Z)return P($,Z,_)}}:P(b,C,_)}function ci(i,t,s){return"color"===t.type?s=B.parse(s):"formatted"===t.type?s=U.fromString(s.toString()):"resolvedImage"===t.type?s=G.fromString(s.toString()):gt(s)===t.type||"enum"===t.type&&t.values[s]||(s=void 0),cn(s,i.default,t.default)}Ut.register(K,{error:[{kind:"error"},[hn],(i,[t])=>{throw new Pe(t.evaluate(i))}],typeof:[hn,[nn],(i,[t])=>rn(le(t.evaluate(i)))],"to-rgba":[Yn(Qe,4),[Or],(i,[t])=>t.evaluate(i).toArray()],rgb:[Or,[Qe,Qe,Qe],R],rgba:[Or,[Qe,Qe,Qe,Qe],R],has:{type:_t,overloads:[[[hn],(i,[t])=>oe(t.evaluate(i),i.properties())],[[hn,Tn],(i,[t,s])=>oe(t.evaluate(i),s.evaluate(i))]]},get:{type:nn,overloads:[[[hn],(i,[t])=>ve(t.evaluate(i),i.properties())],[[hn,Tn],(i,[t,s])=>ve(t.evaluate(i),s.evaluate(i))]]},"feature-state":[nn,[hn],(i,[t])=>ve(t.evaluate(i),i.featureState||{})],properties:[Tn,[],i=>i.properties()],"geometry-type":[hn,[],i=>i.geometryType()],id:[nn,[],i=>i.id()],zoom:[Qe,[],i=>i.globals.zoom],"heatmap-density":[Qe,[],i=>i.globals.heatmapDensity||0],"line-progress":[Qe,[],i=>i.globals.lineProgress||0],accumulated:[nn,[],i=>void 0===i.globals.accumulated?null:i.globals.accumulated],"+":[Qe,Ue(Qe),(i,t)=>{let s=0;for(const u of t)s+=u.evaluate(i);return s}],"*":[Qe,Ue(Qe),(i,t)=>{let s=1;for(const u of t)s*=u.evaluate(i);return s}],"-":{type:Qe,overloads:[[[Qe,Qe],(i,[t,s])=>t.evaluate(i)-s.evaluate(i)],[[Qe],(i,[t])=>-t.evaluate(i)]]},"/":[Qe,[Qe,Qe],(i,[t,s])=>t.evaluate(i)/s.evaluate(i)],"%":[Qe,[Qe,Qe],(i,[t,s])=>t.evaluate(i)%s.evaluate(i)],ln2:[Qe,[],()=>Math.LN2],pi:[Qe,[],()=>Math.PI],e:[Qe,[],()=>Math.E],"^":[Qe,[Qe,Qe],(i,[t,s])=>Math.pow(t.evaluate(i),s.evaluate(i))],sqrt:[Qe,[Qe],(i,[t])=>Math.sqrt(t.evaluate(i))],log10:[Qe,[Qe],(i,[t])=>Math.log(t.evaluate(i))/Math.LN10],ln:[Qe,[Qe],(i,[t])=>Math.log(t.evaluate(i))],log2:[Qe,[Qe],(i,[t])=>Math.log(t.evaluate(i))/Math.LN2],sin:[Qe,[Qe],(i,[t])=>Math.sin(t.evaluate(i))],cos:[Qe,[Qe],(i,[t])=>Math.cos(t.evaluate(i))],tan:[Qe,[Qe],(i,[t])=>Math.tan(t.evaluate(i))],asin:[Qe,[Qe],(i,[t])=>Math.asin(t.evaluate(i))],acos:[Qe,[Qe],(i,[t])=>Math.acos(t.evaluate(i))],atan:[Qe,[Qe],(i,[t])=>Math.atan(t.evaluate(i))],min:[Qe,Ue(Qe),(i,t)=>Math.min(...t.map(s=>s.evaluate(i)))],max:[Qe,Ue(Qe),(i,t)=>Math.max(...t.map(s=>s.evaluate(i)))],abs:[Qe,[Qe],(i,[t])=>Math.abs(t.evaluate(i))],round:[Qe,[Qe],(i,[t])=>{const s=t.evaluate(i);return s<0?-Math.round(-s):Math.round(s)}],floor:[Qe,[Qe],(i,[t])=>Math.floor(t.evaluate(i))],ceil:[Qe,[Qe],(i,[t])=>Math.ceil(t.evaluate(i))],"filter-==":[_t,[hn,nn],(i,[t,s])=>i.properties()[t.value]===s.value],"filter-id-==":[_t,[nn],(i,[t])=>i.id()===t.value],"filter-type-==":[_t,[hn],(i,[t])=>i.geometryType()===t.value],"filter-<":[_t,[hn,nn],(i,[t,s])=>{const u=i.properties()[t.value],d=s.value;return typeof u==typeof d&&u<d}],"filter-id-<":[_t,[nn],(i,[t])=>{const s=i.id(),u=t.value;return typeof s==typeof u&&s<u}],"filter->":[_t,[hn,nn],(i,[t,s])=>{const u=i.properties()[t.value],d=s.value;return typeof u==typeof d&&u>d}],"filter-id->":[_t,[nn],(i,[t])=>{const s=i.id(),u=t.value;return typeof s==typeof u&&s>u}],"filter-<=":[_t,[hn,nn],(i,[t,s])=>{const u=i.properties()[t.value],d=s.value;return typeof u==typeof d&&u<=d}],"filter-id-<=":[_t,[nn],(i,[t])=>{const s=i.id(),u=t.value;return typeof s==typeof u&&s<=u}],"filter->=":[_t,[hn,nn],(i,[t,s])=>{const u=i.properties()[t.value],d=s.value;return typeof u==typeof d&&u>=d}],"filter-id->=":[_t,[nn],(i,[t])=>{const s=i.id(),u=t.value;return typeof s==typeof u&&s>=u}],"filter-has":[_t,[nn],(i,[t])=>t.value in i.properties()],"filter-has-id":[_t,[],i=>null!==i.id()&&void 0!==i.id()],"filter-type-in":[_t,[Yn(hn)],(i,[t])=>t.value.indexOf(i.geometryType())>=0],"filter-id-in":[_t,[Yn(nn)],(i,[t])=>t.value.indexOf(i.id())>=0],"filter-in-small":[_t,[hn,Yn(nn)],(i,[t,s])=>s.value.indexOf(i.properties()[t.value])>=0],"filter-in-large":[_t,[hn,Yn(nn)],(i,[t,s])=>function(u,d,y,_){for(;y<=_;){const b=y+_>>1;if(d[b]===u)return!0;d[b]>u?_=b-1:y=b+1}return!1}(i.properties()[t.value],s.value,0,s.value.length-1)],all:{type:_t,overloads:[[[_t,_t],(i,[t,s])=>t.evaluate(i)&&s.evaluate(i)],[Ue(_t),(i,t)=>{for(const s of t)if(!s.evaluate(i))return!1;return!0}]]},any:{type:_t,overloads:[[[_t,_t],(i,[t,s])=>t.evaluate(i)||s.evaluate(i)],[Ue(_t),(i,t)=>{for(const s of t)if(s.evaluate(i))return!0;return!1}]]},"!":[_t,[_t],(i,[t])=>!t.evaluate(i)],"is-supported-script":[_t,[hn],(i,[t])=>{const s=i.globals&&i.globals.isSupportedScript;return!s||s(t.evaluate(i))}],upcase:[hn,[hn],(i,[t])=>t.evaluate(i).toUpperCase()],downcase:[hn,[hn],(i,[t])=>t.evaluate(i).toLowerCase()],concat:[hn,Ue(nn),(i,t)=>t.map(s=>Ce(s.evaluate(i))).join("")],"resolved-locale":[hn,[gr],(i,[t])=>t.evaluate(i).resolvedLocale()]});class Fo{constructor(t,s){var u;this.expression=t,this._warningHistory={},this._evaluator=new St,this._defaultValue=s?"color"===(u=s).type&&xn(u.default)?new B(0,0,0,0):"color"===u.type?B.parse(u.default)||null:void 0===u.default?null:u.default:null,this._enumValues=s&&"enum"===s.type?s.values:null}evaluateWithoutErrorHandling(t,s,u,d,y,_){return this._evaluator.globals=t,this._evaluator.feature=s,this._evaluator.featureState=u,this._evaluator.canonical=d,this._evaluator.availableImages=y||null,this._evaluator.formattedSection=_,this.expression.evaluate(this._evaluator)}evaluate(t,s,u,d,y,_){this._evaluator.globals=t,this._evaluator.feature=s||null,this._evaluator.featureState=u||null,this._evaluator.canonical=d,this._evaluator.availableImages=y||null,this._evaluator.formattedSection=_||null;try{const b=this.expression.evaluate(this._evaluator);if(null==b||"number"==typeof b&&b!=b)return this._defaultValue;if(this._enumValues&&!(b in this._enumValues))throw new Pe(`Expected value to be one of ${Object.keys(this._enumValues).map(C=>JSON.stringify(C)).join(", ")}, but found ${JSON.stringify(b)} instead.`);return b}catch(b){return this._warningHistory[b.message]||(this._warningHistory[b.message]=!0,typeof console<"u"&&console.warn(b.message)),this._defaultValue}}}function ko(i){return Array.isArray(i)&&i.length>0&&"string"==typeof i[0]&&i[0]in K}function Lo(i,t){const s=new So(K,[],t?function(d){const y={color:Or,string:hn,number:Qe,enum:hn,boolean:_t,formatted:ki,resolvedImage:gi};return"array"===d.type?Yn(y[d.value]||nn,d.length):y[d.type]}(t):void 0),u=s.parse(i,void 0,void 0,void 0,t&&"string"===t.type?{typeAnnotation:"coerce"}:void 0);return u?ot(new Fo(u,t)):Bt(s.errors)}class hi{constructor(t,s){this.kind=t,this._styleExpression=s,this.isStateDependent="constant"!==t&&!ho(s.expression)}evaluateWithoutErrorHandling(t,s,u,d,y,_){return this._styleExpression.evaluateWithoutErrorHandling(t,s,u,d,y,_)}evaluate(t,s,u,d,y,_){return this._styleExpression.evaluate(t,s,u,d,y,_)}}class Cs{constructor(t,s,u,d){this.kind=t,this.zoomStops=u,this._styleExpression=s,this.isStateDependent="camera"!==t&&!ho(s.expression),this.interpolationType=d}evaluateWithoutErrorHandling(t,s,u,d,y,_){return this._styleExpression.evaluateWithoutErrorHandling(t,s,u,d,y,_)}evaluate(t,s,u,d,y,_){return this._styleExpression.evaluate(t,s,u,d,y,_)}interpolationFactor(t,s,u){return this.interpolationType?ni.interpolationFactor(this.interpolationType,t,s,u):0}}function Es(i,t){const s=Lo(i,t);if("error"===s.result)return s;const u=s.value.expression,d=co(u);if(!d&&!Bn(t))return Bt([new lr("","data expressions not supported")]);const y=Yi(u,["zoom"]);if(!y&&!ir(t))return Bt([new lr("","zoom expressions not supported")]);const _=Ki(u);return _||y?_ instanceof lr?Bt([_]):_ instanceof ni&&!Kn(t)?Bt([new lr("",'"interpolate" expressions cannot be used with this property')]):ot(_?new Cs(d?"camera":"composite",s.value,_.labels,_ instanceof ni?_.interpolation:void 0):new hi(d?"constant":"source",s.value)):Bt([new lr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Ms{constructor(t,s){this._parameters=t,this._specification=s,ht(this,Ar(this._parameters,this._specification))}static deserialize(t){return new Ms(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function Ki(i){let t=null;if(i instanceof is)t=Ki(i.result);else if(i instanceof xs){for(const s of i.args)if(t=Ki(s),t)break}else(i instanceof Ir||i instanceof ni)&&i.input instanceof Ut&&"zoom"===i.input.name&&(t=i);return t instanceof lr||i.eachChild(s=>{const u=Ki(s);u instanceof lr?t=u:!t&&u?t=new lr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&u&&t!==u&&(t=new lr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}function Xi(i){const t=i.key,s=i.value,u=i.valueSpec||{},d=i.objectElementValidators||{},y=i.style,_=i.styleSpec;let b=[];const C=gt(s);if("object"!==C)return[new Te(t,s,`object expected, ${C} found`)];for(const P in s){const V=P.split(".")[0],$=u[V]||u["*"];let Z;if(d[V])Z=d[V];else if(u[V])Z=Ii;else if(d["*"])Z=d["*"];else{if(!u["*"]){b.push(new Te(t,s[P],`unknown property "${P}"`));continue}Z=Ii}b=b.concat(Z({key:(t&&`${t}.`)+P,value:s[P],valueSpec:$,style:y,styleSpec:_,object:s,objectKey:P},s))}for(const P in u)d[P]||u[P].required&&void 0===u[P].default&&void 0===s[P]&&b.push(new Te(t,s,`missing required property "${P}"`));return b}function Ta(i){const t=i.value,s=i.valueSpec,u=i.style,d=i.styleSpec,y=i.key,_=i.arrayElementValidator||Ii;if("array"!==gt(t))return[new Te(y,t,`array expected, ${gt(t)} found`)];if(s.length&&t.length!==s.length)return[new Te(y,t,`array length ${s.length} expected, length ${t.length} found`)];if(s["min-length"]&&t.length<s["min-length"])return[new Te(y,t,`array length at least ${s["min-length"]} expected, length ${t.length} found`)];let b={type:s.value,values:s.values};d.$version<7&&(b.function=s.function),"object"===gt(s.value)&&(b=s.value);let C=[];for(let P=0;P<t.length;P++)C=C.concat(_({array:t,arrayIndex:P,value:t[P],valueSpec:b,style:u,styleSpec:d,key:`${y}[${P}]`}));return C}function gn(i){const t=i.key,s=i.value,u=i.valueSpec;let d=gt(s);return"number"===d&&s!=s&&(d="NaN"),"number"!==d?[new Te(t,s,`number expected, ${d} found`)]:"minimum"in u&&s<u.minimum?[new Te(t,s,`${s} is less than the minimum value ${u.minimum}`)]:"maximum"in u&&s>u.maximum?[new Te(t,s,`${s} is greater than the maximum value ${u.maximum}`)]:[]}function el(i){const t=i.valueSpec,s=ut(i.value.type);let u,d,y,_={};const b="categorical"!==s&&void 0===i.value.property,C=!b,P="array"===gt(i.value.stops)&&"array"===gt(i.value.stops[0])&&"object"===gt(i.value.stops[0][0]),V=Xi({key:i.key,value:i.value,valueSpec:i.styleSpec.function,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function(J){if("identity"===s)return[new Te(J.key,J.value,'identity function may not have a "stops" property')];let ee=[];const de=J.value;return ee=ee.concat(Ta({key:J.key,value:de,valueSpec:J.valueSpec,style:J.style,styleSpec:J.styleSpec,arrayElementValidator:$})),"array"===gt(de)&&0===de.length&&ee.push(new Te(J.key,de,"array must have at least one stop")),ee},default:function(J){return Ii({key:J.key,value:J.value,valueSpec:t,style:J.style,styleSpec:J.styleSpec})}}});return"identity"===s&&b&&V.push(new Te(i.key,i.value,'missing required property "property"')),"identity"===s||i.value.stops||V.push(new Te(i.key,i.value,'missing required property "stops"')),"exponential"===s&&i.valueSpec.expression&&!Kn(i.valueSpec)&&V.push(new Te(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(C&&!Bn(i.valueSpec)?V.push(new Te(i.key,i.value,"property functions not supported")):b&&!ir(i.valueSpec)&&V.push(new Te(i.key,i.value,"zoom functions not supported"))),"categorical"!==s&&!P||void 0!==i.value.property||V.push(new Te(i.key,i.value,'"property" property is required')),V;function $(J){let ee=[];const de=J.value,he=J.key;if("array"!==gt(de))return[new Te(he,de,`array expected, ${gt(de)} found`)];if(2!==de.length)return[new Te(he,de,`array length 2 expected, length ${de.length} found`)];if(P){if("object"!==gt(de[0]))return[new Te(he,de,`object expected, ${gt(de[0])} found`)];if(void 0===de[0].zoom)return[new Te(he,de,"object stop key must have zoom")];if(void 0===de[0].value)return[new Te(he,de,"object stop key must have value")];if(y&&y>ut(de[0].zoom))return[new Te(he,de[0].zoom,"stop zoom values must appear in ascending order")];ut(de[0].zoom)!==y&&(y=ut(de[0].zoom),d=void 0,_={}),ee=ee.concat(Xi({key:`${he}[0]`,value:de[0],valueSpec:{zoom:{}},style:J.style,styleSpec:J.styleSpec,objectElementValidators:{zoom:gn,value:Z}}))}else ee=ee.concat(Z({key:`${he}[0]`,value:de[0],valueSpec:{},style:J.style,styleSpec:J.styleSpec},de));return ko(Dr(de[1]))?ee.concat([new Te(`${he}[1]`,de[1],"expressions are not allowed in function stops.")]):ee.concat(Ii({key:`${he}[1]`,value:de[1],valueSpec:t,style:J.style,styleSpec:J.styleSpec}))}function Z(J,ee){const de=gt(J.value),he=ut(J.value),be=null!==J.value?J.value:ee;if(u){if(de!==u)return[new Te(J.key,be,`${de} stop domain type must match previous stop domain type ${u}`)]}else u=de;if("number"!==de&&"string"!==de&&"boolean"!==de)return[new Te(J.key,be,"stop domain value must be a number, string, or boolean")];if("number"!==de&&"categorical"!==s){let Le=`number expected, ${de} found`;return Bn(t)&&void 0===s&&(Le+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Te(J.key,be,Le)]}return"categorical"!==s||"number"!==de||isFinite(he)&&Math.floor(he)===he?"categorical"!==s&&"number"===de&&void 0!==d&&he<d?[new Te(J.key,be,"stop domain values must appear in ascending order")]:(d=he,"categorical"===s&&he in _?[new Te(J.key,be,"stop domain values must be unique")]:(_[he]=!0,[])):[new Te(J.key,be,`integer expected, found ${he}`)]}}function ia(i){const t=("property"===i.expressionContext?Es:Lo)(Dr(i.value),i.valueSpec);if("error"===t.result)return t.value.map(u=>new Te(`${i.key}${u.key}`,i.value,u.message));const s=t.value.expression||t.value._styleExpression.expression;if("property"===i.expressionContext&&"text-font"===i.propertyKey&&!s.outputDefined())return[new Te(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===i.expressionContext&&"layout"===i.propertyType&&!ho(s))return[new Te(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===i.expressionContext&&!ho(s))return[new Te(i.key,i.value,'"feature-state" data expressions are not supported with filters.')];if(i.expressionContext&&0===i.expressionContext.indexOf("cluster")){if(!Yi(s,["zoom","feature-state"]))return[new Te(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===i.expressionContext&&!co(s))return[new Te(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Pa(i){const t=i.key,s=i.value,u=i.valueSpec,d=[];return Array.isArray(u.values)?-1===u.values.indexOf(ut(s))&&d.push(new Te(t,s,`expected one of [${u.values.join(", ")}], ${JSON.stringify(s)} found`)):-1===Object.keys(u.values).indexOf(ut(s))&&d.push(new Te(t,s,`expected one of [${Object.keys(u.values).join(", ")}], ${JSON.stringify(s)} found`)),d}function tl(i){if(!0===i||!1===i)return!0;if(!Array.isArray(i)||0===i.length)return!1;switch(i[0]){case"has":return i.length>=2&&"$id"!==i[1]&&"$type"!==i[1];case"in":return i.length>=3&&("string"!=typeof i[1]||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==i.length||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const t of i.slice(1))if(!tl(t)&&"boolean"!=typeof t)return!1;return!0;default:return!0}}const Cl={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function F(i){if(null==i)return{filter:()=>!0,needGeometry:!1};tl(i)||(i=j(i));const t=Lo(i,Cl);if("error"===t.result)throw new Error(t.value.map(s=>`${s.key}: ${s.message}`).join(", "));return{filter:(s,u,d)=>t.value.evaluate(s,u,{},d),needGeometry:I(i)}}function A(i,t){return i<t?-1:i>t?1:0}function I(i){if(!Array.isArray(i))return!1;if("within"===i[0])return!0;for(let t=1;t<i.length;t++)if(I(i[t]))return!0;return!1}function j(i){if(!i)return!0;const t=i[0];return i.length<=1?"any"!==t:"=="===t?Ie(i[1],i[2],"=="):"!="===t?zn(Ie(i[1],i[2],"==")):"<"===t||">"===t||"<="===t||">="===t?Ie(i[1],i[2],t):"any"===t?(s=i.slice(1),["any"].concat(s.map(j))):"all"===t?["all"].concat(i.slice(1).map(j)):"none"===t?["all"].concat(i.slice(1).map(j).map(zn)):"in"===t?Ht(i[1],i.slice(2)):"!in"===t?zn(Ht(i[1],i.slice(2))):"has"===t?ur(i[1]):"!has"===t?zn(ur(i[1])):"within"!==t||i;var s}function Ie(i,t,s){switch(i){case"$type":return[`filter-type-${s}`,t];case"$id":return[`filter-id-${s}`,t];default:return[`filter-${s}`,i,t]}}function Ht(i,t){if(0===t.length)return!1;switch(i){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(s=>typeof s!=typeof t[0])?["filter-in-large",i,["literal",t.sort(A)]]:["filter-in-small",i,["literal",t]]}}function ur(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function zn(i){return["!",i]}function Oi(i){return tl(Dr(i.value))?ia(ht({},i,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Ji(i)}function Ji(i){const t=i.value,s=i.key;if("array"!==gt(t))return[new Te(s,t,`array expected, ${gt(t)} found`)];const u=i.styleSpec;let d,y=[];if(t.length<1)return[new Te(s,t,"filter array must have at least 1 element")];switch(y=y.concat(Pa({key:`${s}[0]`,value:t[0],valueSpec:u.filter_operator,style:i.style,styleSpec:i.styleSpec})),ut(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&"$type"===ut(t[1])&&y.push(new Te(s,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":3!==t.length&&y.push(new Te(s,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(d=gt(t[1]),"string"!==d&&y.push(new Te(`${s}[1]`,t[1],`string expected, ${d} found`)));for(let _=2;_<t.length;_++)d=gt(t[_]),"$type"===ut(t[1])?y=y.concat(Pa({key:`${s}[${_}]`,value:t[_],valueSpec:u.geometry_type,style:i.style,styleSpec:i.styleSpec})):"string"!==d&&"number"!==d&&"boolean"!==d&&y.push(new Te(`${s}[${_}]`,t[_],`string, number, or boolean expected, ${d} found`));break;case"any":case"all":case"none":for(let _=1;_<t.length;_++)y=y.concat(Ji({key:`${s}[${_}]`,value:t[_],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":d=gt(t[1]),2!==t.length?y.push(new Te(s,t,`filter array for "${t[0]}" operator must have 2 elements`)):"string"!==d&&y.push(new Te(`${s}[1]`,t[1],`string expected, ${d} found`));break;case"within":d=gt(t[1]),2!==t.length?y.push(new Te(s,t,`filter array for "${t[0]}" operator must have 2 elements`)):"object"!==d&&y.push(new Te(`${s}[1]`,t[1],`object expected, ${d} found`))}return y}function qr(i,t){const s=i.key,u=i.style,d=i.styleSpec,y=i.value,_=i.objectKey,b=d[`${t}_${i.layerType}`];if(!b)return[];const C=_.match(/^(.*)-transition$/);if("paint"===t&&C&&b[C[1]]&&b[C[1]].transition)return Ii({key:s,value:y,valueSpec:d.transition,style:u,styleSpec:d});const P=i.valueSpec||b[_];if(!P)return[new Te(s,y,`unknown property "${_}"`)];let V;if("string"===gt(y)&&Bn(P)&&!P.tokens&&(V=/^{([^}]+)}$/.exec(y)))return[new Te(s,y,`"${_}" does not support interpolation syntax\nUse an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(V[1])} }\`.`)];const $=[];return"symbol"===i.layerType&&("text-field"===_&&u&&!u.glyphs&&$.push(new Te(s,y,'use of "text-field" requires a style "glyphs" property')),"text-font"===_&&xn(Dr(y))&&"identity"===ut(y.type)&&$.push(new Te(s,y,'"text-font" does not support identity functions'))),$.concat(Ii({key:i.key,value:y,valueSpec:P,style:u,styleSpec:d,expressionContext:"property",propertyType:t,propertyKey:_}))}function os(i){return qr(i,"paint")}function oa(i){return qr(i,"layout")}function Ic(i){let t=[];const s=i.value,u=i.key,d=i.style,y=i.styleSpec;s.type||s.ref||t.push(new Te(u,s,'either "type" or "ref" is required'));let _=ut(s.type);const b=ut(s.ref);if(s.id){const C=ut(s.id);for(let P=0;P<i.arrayIndex;P++){const V=d.layers[P];ut(V.id)===C&&t.push(new Te(u,s.id,`duplicate layer id "${s.id}", previously used at line ${V.id.__line__}`))}}if("ref"in s){let C;["type","source","source-layer","filter","layout"].forEach(P=>{P in s&&t.push(new Te(u,s[P],`"${P}" is prohibited for ref layers`))}),d.layers.forEach(P=>{ut(P.id)===b&&(C=P)}),C?C.ref?t.push(new Te(u,s.ref,"ref cannot reference another ref layer")):_=ut(C.type):t.push(new Te(u,s.ref,`ref layer "${b}" not found`))}else if("background"!==_)if(s.source){const C=d.sources&&d.sources[s.source],P=C&&ut(C.type);C?"vector"===P&&"raster"===_?t.push(new Te(u,s.source,`layer "${s.id}" requires a raster source`)):"raster"===P&&"raster"!==_?t.push(new Te(u,s.source,`layer "${s.id}" requires a vector source`)):"vector"!==P||s["source-layer"]?"raster-dem"===P&&"hillshade"!==_?t.push(new Te(u,s.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==_||!s.paint||!s.paint["line-gradient"]||"geojson"===P&&C.lineMetrics||t.push(new Te(u,s,`layer "${s.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new Te(u,s,`layer "${s.id}" must specify a "source-layer"`)):t.push(new Te(u,s.source,`source "${s.source}" not found`))}else t.push(new Te(u,s,'missing required property "source"'));return t=t.concat(Xi({key:u,value:s,valueSpec:y.layer,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Ii({key:`${u}.type`,value:s.type,valueSpec:y.layer.type,style:i.style,styleSpec:i.styleSpec,object:s,objectKey:"type"}),filter:Oi,layout:C=>Xi({layer:s,key:C.key,value:C.value,style:C.style,styleSpec:C.styleSpec,objectElementValidators:{"*":P=>oa(ht({layerType:_},P))}}),paint:C=>Xi({layer:s,key:C.key,value:C.value,style:C.style,styleSpec:C.styleSpec,objectElementValidators:{"*":P=>os(ht({layerType:_},P))}})}})),t}function sa(i){const t=i.value,s=i.key,u=gt(t);return"string"!==u?[new Te(s,t,`string expected, ${u} found`)]:[]}const Sc={promoteId:function({key:i,value:t}){if("string"===gt(t))return sa({key:i,value:t});{const s=[];for(const u in t)s.push(...sa({key:`${i}.${u}`,value:t[u]}));return s}}};function ss(i){const t=i.value,s=i.key,u=i.styleSpec,d=i.style;if(!t.type)return[new Te(s,t,'"type" is required')];const y=ut(t.type);let _;switch(y){case"vector":case"raster":case"raster-dem":return _=Xi({key:s,value:t,valueSpec:u[`source_${y.replace("-","_")}`],style:i.style,styleSpec:u,objectElementValidators:Sc}),_;case"geojson":if(_=Xi({key:s,value:t,valueSpec:u.source_geojson,style:d,styleSpec:u,objectElementValidators:Sc}),t.cluster)for(const b in t.clusterProperties){const[C,P]=t.clusterProperties[b],V="string"==typeof C?[C,["accumulated"],["get",b]]:C;_.push(...ia({key:`${s}.${b}.map`,value:P,expressionContext:"cluster-map"})),_.push(...ia({key:`${s}.${b}.reduce`,value:V,expressionContext:"cluster-reduce"}))}return _;case"video":return Xi({key:s,value:t,valueSpec:u.source_video,style:d,styleSpec:u});case"image":return Xi({key:s,value:t,valueSpec:u.source_image,style:d,styleSpec:u});case"canvas":return[new Te(s,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Pa({key:`${s}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:d,styleSpec:u})}}function Zr(i){const t=i.value,s=i.styleSpec,u=s.light,d=i.style;let y=[];const _=gt(t);if(void 0===t)return y;if("object"!==_)return y=y.concat([new Te("light",t,`object expected, ${_} found`)]),y;for(const b in t){const C=b.match(/^(.*)-transition$/);y=y.concat(C&&u[C[1]]&&u[C[1]].transition?Ii({key:b,value:t[b],valueSpec:s.transition,style:d,styleSpec:s}):u[b]?Ii({key:b,value:t[b],valueSpec:u[b],style:d,styleSpec:s}):[new Te(b,t[b],`unknown property "${b}"`)])}return y}const Br={"*":()=>[],array:Ta,boolean:function(i){const t=i.value,s=i.key,u=gt(t);return"boolean"!==u?[new Te(s,t,`boolean expected, ${u} found`)]:[]},number:gn,color:function(i){const t=i.key,s=i.value,u=gt(s);return"string"!==u?[new Te(t,s,`color expected, ${u} found`)]:null===jr(s)?[new Te(t,s,`color expected, "${s}" found`)]:[]},constants:Nt,enum:Pa,filter:Oi,function:el,layer:Ic,object:Xi,source:ss,light:Zr,string:sa,formatted:function(i){return 0===sa(i).length?[]:ia(i)},resolvedImage:function(i){return 0===sa(i).length?[]:ia(i)}};function Ii(i){const t=i.value,s=i.valueSpec,u=i.styleSpec;return s.expression&&xn(ut(t))?el(i):s.expression&&ko(Dr(t))?ia(i):s.type&&Br[s.type]?Br[s.type](i):Xi(ht({},i,{valueSpec:s.type?u[s.type]:s}))}function aa(i){const t=i.value,s=i.key,u=sa(i);return u.length||(-1===t.indexOf("{fontstack}")&&u.push(new Te(s,t,'"glyphs" url must include a "{fontstack}" token')),-1===t.indexOf("{range}")&&u.push(new Te(s,t,'"glyphs" url must include a "{range}" token'))),u}function Si(i,t=pe){let s=[];return s=s.concat(Ii({key:"",value:i,valueSpec:t.$root,styleSpec:t,style:i,objectElementValidators:{glyphs:aa,"*":()=>[]}})),i.constants&&(s=s.concat(Nt({key:"constants",value:i.constants,style:i,styleSpec:t}))),yu(s)}function yu(i){return[].concat(i).sort((t,s)=>t.line-s.line)}function Is(i){return function(...t){return yu(i.apply(this,t))}}Si.source=Is(ss),Si.light=Is(Zr),Si.layer=Is(Ic),Si.filter=Is(Oi),Si.paintProperty=Is(os),Si.layoutProperty=Is(oa);const Ss=Si,Ac=Ss.light,Fa=Ss.paintProperty,El=Ss.layoutProperty;function Ml(i,t){let s=!1;if(t&&t.length)for(const u of t)i.fire(new T(new Error(u.message))),s=!0;return s}class Go{constructor(t,s,u){const d=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;const _=new Int32Array(this.arrayBuffer);t=_[0],this.d=(s=_[1])+2*(u=_[2]);for(let C=0;C<this.d*this.d;C++){const P=_[3+C],V=_[3+C+1];d.push(P===V?null:_.subarray(P,V))}const b=_[3+d.length+1];this.keys=_.subarray(_[3+d.length],b),this.bboxes=_.subarray(b),this.insert=this._insertReadonly}else{this.d=s+2*u;for(let _=0;_<this.d*this.d;_++)d.push([]);this.keys=[],this.bboxes=[]}this.n=s,this.extent=t,this.padding=u,this.scale=s/t,this.uid=0;const y=u/s*t;this.min=-y,this.max=t+y}insert(t,s,u,d,y){this._forEachCell(s,u,d,y,this._insertCell,this.uid++,void 0,void 0),this.keys.push(t),this.bboxes.push(s),this.bboxes.push(u),this.bboxes.push(d),this.bboxes.push(y)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(t,s,u,d,y,_){this.cells[y].push(_)}query(t,s,u,d,y){const _=this.min,b=this.max;if(t<=_&&s<=_&&b<=u&&b<=d&&!y)return Array.prototype.slice.call(this.keys);{const C=[];return this._forEachCell(t,s,u,d,this._queryCell,C,{},y),C}}_queryCell(t,s,u,d,y,_,b,C){const P=this.cells[y];if(null!==P){const V=this.keys,$=this.bboxes;for(let Z=0;Z<P.length;Z++){const J=P[Z];if(void 0===b[J]){const ee=4*J;(C?C($[ee+0],$[ee+1],$[ee+2],$[ee+3]):t<=$[ee+2]&&s<=$[ee+3]&&u>=$[ee+0]&&d>=$[ee+1])?(b[J]=!0,_.push(V[J])):b[J]=!1}}}}_forEachCell(t,s,u,d,y,_,b,C){const P=this._convertToCellCoord(t),V=this._convertToCellCoord(s),$=this._convertToCellCoord(u),Z=this._convertToCellCoord(d);for(let J=P;J<=$;J++)for(let ee=V;ee<=Z;ee++){const de=this.d*ee+J;if((!C||C(this._convertFromCellCoord(J),this._convertFromCellCoord(ee),this._convertFromCellCoord(J+1),this._convertFromCellCoord(ee+1)))&&y.call(this,t,s,u,d,de,_,b,C))return}}_convertFromCellCoord(t){return(t-this.padding)/this.scale}_convertToCellCoord(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const t=this.cells,s=3+this.cells.length+1+1;let u=0;for(let _=0;_<this.cells.length;_++)u+=this.cells[_].length;const d=new Int32Array(s+u+this.keys.length+this.bboxes.length);d[0]=this.extent,d[1]=this.n,d[2]=this.padding;let y=s;for(let _=0;_<t.length;_++){const b=t[_];d[3+_]=y,d.set(b,y),y+=b.length}return d[3+t.length]=y,d.set(this.keys,y),y+=this.keys.length,d[3+t.length+1]=y,d.set(this.bboxes,y),y+=this.bboxes.length,d.buffer}static serialize(t,s){const u=t.toArrayBuffer();return s&&s.push(u),{buffer:u}}static deserialize(t){return new Go(t.buffer)}}const la={};function Pt(i,t,s={}){Object.defineProperty(t,"_classRegistryKey",{value:i,writeable:!1}),la[i]={klass:t,omit:s.omit||[],shallow:s.shallow||[]}}Pt("Object",Object),Pt("TransferableGridIndex",Go),Pt("Color",B),Pt("Error",Error),Pt("AJAXError",mr),Pt("ResolvedImage",G),Pt("StylePropertyFunction",Ms),Pt("StyleExpression",Fo,{omit:["_evaluator"]}),Pt("ZoomDependentExpression",Cs),Pt("ZoomConstantExpression",hi),Pt("CompoundExpression",Ut,{omit:["_evaluate"]});for(const i in K)K[i]._classRegistryKey||Pt(`Expression_${i}`,K[i]);function ua(i){return i&&typeof ArrayBuffer<"u"&&(i instanceof ArrayBuffer||i.constructor&&"ArrayBuffer"===i.constructor.name)}function ca(i,t){if(null==i||"boolean"==typeof i||"number"==typeof i||"string"==typeof i||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob)return i;if(ua(i)||en(i))return t&&t.push(i),i;if(ArrayBuffer.isView(i)){const s=i;return t&&t.push(s.buffer),s}if(i instanceof ImageData)return t&&t.push(i.data.buffer),i;if(Array.isArray(i)){const s=[];for(const u of i)s.push(ca(u,t));return s}if("object"==typeof i){const s=i.constructor,u=s._classRegistryKey;if(!u)throw new Error("can't serialize object of unregistered class");const d=s.serialize?s.serialize(i,t):{};if(!s.serialize){for(const y in i){if(!i.hasOwnProperty(y)||la[u].omit.indexOf(y)>=0)continue;const _=i[y];d[y]=la[u].shallow.indexOf(y)>=0?_:ca(_,t)}i instanceof Error&&(d.message=i.message)}if(d.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==u&&(d.$name=u),d}throw new Error("can't serialize object of type "+typeof i)}function as(i){if(null==i||"boolean"==typeof i||"number"==typeof i||"string"==typeof i||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob||ua(i)||en(i)||ArrayBuffer.isView(i)||i instanceof ImageData)return i;if(Array.isArray(i))return i.map(as);if("object"==typeof i){const t=i.$name||"Object";if(!la[t])throw new Error(`can't deserialize unregistered class ${t}`);const{klass:s}=la[t];if(!s)throw new Error(`can't deserialize unregistered class ${t}`);if(s.deserialize)return s.deserialize(i);const u=Object.create(s.prototype);for(const d of Object.keys(i)){if("$name"===d)continue;const y=i[d];u[d]=la[t].shallow.indexOf(d)>=0?y:as(y)}return u}throw new Error("can't deserialize object of type "+typeof i)}class ha{constructor(){this.first=!0}update(t,s){const u=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=u,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=u,!0):(this.lastFloorZoom>u?(this.lastIntegerZoom=u+1,this.lastIntegerZoomTime=s):this.lastFloorZoom<u&&(this.lastIntegerZoom=u,this.lastIntegerZoomTime=s),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=u,!0))}}const yt={"Latin-1 Supplement":i=>i>=128&&i<=255,Arabic:i=>i>=1536&&i<=1791,"Arabic Supplement":i=>i>=1872&&i<=1919,"Arabic Extended-A":i=>i>=2208&&i<=2303,"Hangul Jamo":i=>i>=4352&&i<=4607,"Unified Canadian Aboriginal Syllabics":i=>i>=5120&&i<=5759,Khmer:i=>i>=6016&&i<=6143,"Unified Canadian Aboriginal Syllabics Extended":i=>i>=6320&&i<=6399,"General Punctuation":i=>i>=8192&&i<=8303,"Letterlike Symbols":i=>i>=8448&&i<=8527,"Number Forms":i=>i>=8528&&i<=8591,"Miscellaneous Technical":i=>i>=8960&&i<=9215,"Control Pictures":i=>i>=9216&&i<=9279,"Optical Character Recognition":i=>i>=9280&&i<=9311,"Enclosed Alphanumerics":i=>i>=9312&&i<=9471,"Geometric Shapes":i=>i>=9632&&i<=9727,"Miscellaneous Symbols":i=>i>=9728&&i<=9983,"Miscellaneous Symbols and Arrows":i=>i>=11008&&i<=11263,"CJK Radicals Supplement":i=>i>=11904&&i<=12031,"Kangxi Radicals":i=>i>=12032&&i<=12255,"Ideographic Description Characters":i=>i>=12272&&i<=12287,"CJK Symbols and Punctuation":i=>i>=12288&&i<=12351,Hiragana:i=>i>=12352&&i<=12447,Katakana:i=>i>=12448&&i<=12543,Bopomofo:i=>i>=12544&&i<=12591,"Hangul Compatibility Jamo":i=>i>=12592&&i<=12687,Kanbun:i=>i>=12688&&i<=12703,"Bopomofo Extended":i=>i>=12704&&i<=12735,"CJK Strokes":i=>i>=12736&&i<=12783,"Katakana Phonetic Extensions":i=>i>=12784&&i<=12799,"Enclosed CJK Letters and Months":i=>i>=12800&&i<=13055,"CJK Compatibility":i=>i>=13056&&i<=13311,"CJK Unified Ideographs Extension A":i=>i>=13312&&i<=19903,"Yijing Hexagram Symbols":i=>i>=19904&&i<=19967,"CJK Unified Ideographs":i=>i>=19968&&i<=40959,"Yi Syllables":i=>i>=40960&&i<=42127,"Yi Radicals":i=>i>=42128&&i<=42191,"Hangul Jamo Extended-A":i=>i>=43360&&i<=43391,"Hangul Syllables":i=>i>=44032&&i<=55215,"Hangul Jamo Extended-B":i=>i>=55216&&i<=55295,"Private Use Area":i=>i>=57344&&i<=63743,"CJK Compatibility Ideographs":i=>i>=63744&&i<=64255,"Arabic Presentation Forms-A":i=>i>=64336&&i<=65023,"Vertical Forms":i=>i>=65040&&i<=65055,"CJK Compatibility Forms":i=>i>=65072&&i<=65103,"Small Form Variants":i=>i>=65104&&i<=65135,"Arabic Presentation Forms-B":i=>i>=65136&&i<=65279,"Halfwidth and Fullwidth Forms":i=>i>=65280&&i<=65519};function da(i){for(const t of i)if(Wr(t.charCodeAt(0)))return!0;return!1}function _u(i){for(const t of i)if(!Tc(t.charCodeAt(0)))return!1;return!0}function Tc(i){return!(yt.Arabic(i)||yt["Arabic Supplement"](i)||yt["Arabic Extended-A"](i)||yt["Arabic Presentation Forms-A"](i)||yt["Arabic Presentation Forms-B"](i))}function Wr(i){return!(746!==i&&747!==i&&(i<4352||!(yt["Bopomofo Extended"](i)||yt.Bopomofo(i)||yt["CJK Compatibility Forms"](i)&&!(i>=65097&&i<=65103)||yt["CJK Compatibility Ideographs"](i)||yt["CJK Compatibility"](i)||yt["CJK Radicals Supplement"](i)||yt["CJK Strokes"](i)||!(!yt["CJK Symbols and Punctuation"](i)||i>=12296&&i<=12305||i>=12308&&i<=12319||12336===i)||yt["CJK Unified Ideographs Extension A"](i)||yt["CJK Unified Ideographs"](i)||yt["Enclosed CJK Letters and Months"](i)||yt["Hangul Compatibility Jamo"](i)||yt["Hangul Jamo Extended-A"](i)||yt["Hangul Jamo Extended-B"](i)||yt["Hangul Jamo"](i)||yt["Hangul Syllables"](i)||yt.Hiragana(i)||yt["Ideographic Description Characters"](i)||yt.Kanbun(i)||yt["Kangxi Radicals"](i)||yt["Katakana Phonetic Extensions"](i)||yt.Katakana(i)&&12540!==i||!(!yt["Halfwidth and Fullwidth Forms"](i)||65288===i||65289===i||65293===i||i>=65306&&i<=65310||65339===i||65341===i||65343===i||i>=65371&&i<=65503||65507===i||i>=65512&&i<=65519)||!(!yt["Small Form Variants"](i)||i>=65112&&i<=65118||i>=65123&&i<=65126)||yt["Unified Canadian Aboriginal Syllabics"](i)||yt["Unified Canadian Aboriginal Syllabics Extended"](i)||yt["Vertical Forms"](i)||yt["Yijing Hexagram Symbols"](i)||yt["Yi Syllables"](i)||yt["Yi Radicals"](i))))}function Ho(i){return!(Wr(i)||(t=i,yt["Latin-1 Supplement"](t)&&(167===t||169===t||174===t||177===t||188===t||189===t||190===t||215===t||247===t)||yt["General Punctuation"](t)&&(8214===t||8224===t||8225===t||8240===t||8241===t||8251===t||8252===t||8258===t||8263===t||8264===t||8265===t||8273===t)||yt["Letterlike Symbols"](t)||yt["Number Forms"](t)||yt["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||9003===t||t>=9085&&t<=9114||t>=9150&&t<=9165||9167===t||t>=9169&&t<=9179||t>=9186&&t<=9215)||yt["Control Pictures"](t)&&9251!==t||yt["Optical Character Recognition"](t)||yt["Enclosed Alphanumerics"](t)||yt["Geometric Shapes"](t)||yt["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||yt["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||yt["CJK Symbols and Punctuation"](t)||yt.Katakana(t)||yt["Private Use Area"](t)||yt["CJK Compatibility Forms"](t)||yt["Small Form Variants"](t)||yt["Halfwidth and Fullwidth Forms"](t)||8734===t||8756===t||8757===t||t>=9984&&t<=10087||t>=10102&&t<=10131||65532===t||65533===t));var t}function Tr(i){return i>=1424&&i<=2303||yt["Arabic Presentation Forms-A"](i)||yt["Arabic Presentation Forms-B"](i)}function Pc(i,t){return!(!t&&Tr(i)||i>=2304&&i<=3583||i>=3840&&i<=4255||yt.Khmer(i))}function Fc(i){for(const t of i)if(Tr(t.charCodeAt(0)))return!0;return!1}const nl="deferred",Il="loading",Sl="loaded";let Al=null,di="unavailable",yo=null;const ka=function(i){i&&"string"==typeof i&&i.indexOf("NetworkError")>-1&&(di="error"),Al&&Al(i)};function La(){As.fire(new Ke("pluginStateChange",{pluginStatus:di,pluginURL:yo}))}const As=new ae,Tl=function(){return di},_o=function(){if(di!==nl||!yo)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");di=Il,La(),yo&&Qr({url:yo},i=>{i?ka(i):(di=Sl,La())})},wi={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>di===Sl||null!=wi.applyArabicShaping,isLoading:()=>di===Il,setState(i){di=i.pluginStatus,yo=i.pluginURL},isParsed:()=>null!=wi.applyArabicShaping&&null!=wi.processBidirectionalText&&null!=wi.processStyledBidirectionalText,getPluginURL:()=>yo};class yr{constructor(t,s){this.zoom=t,s?(this.now=s.now,this.fadeDuration=s.fadeDuration,this.zoomHistory=s.zoomHistory,this.transition=s.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new ha,this.transition={})}isSupportedScript(t){return function(s,u){for(const d of s)if(!Pc(d.charCodeAt(0),u))return!1;return!0}(t,wi.isLoaded())}crossFadingFactor(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const t=this.zoom,s=t-Math.floor(t),u=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:s+(1-s)*u}:{fromScale:.5,toScale:1,t:1-(1-u)*s}}}class rl{constructor(t,s){this.property=t,this.value=s,this.expression=function(u,d){if(xn(u))return new Ms(u,d);if(ko(u)){const y=Es(u,d);if("error"===y.result)throw new Error(y.value.map(_=>`${_.key}: ${_.message}`).join(", "));return y.value}{let y=u;return"string"==typeof u&&"color"===d.type&&(y=B.parse(u)),{kind:"constant",evaluate:()=>y}}}(void 0===s?t.specification.default:s,t.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(t,s,u){return this.property.possiblyEvaluate(this,t,s,u)}}class ls{constructor(t){this.property=t,this.value=new rl(t,void 0)}transitioned(t,s){return new vu(this.property,this.value,s,Ze({},t.transition,this.transition),t.now)}untransitioned(){return new vu(this.property,this.value,null,{},0)}}class Ra{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}getValue(t){return Gt(this._values[t].value.value)}setValue(t,s){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new ls(this._values[t].property)),this._values[t].value=new rl(this._values[t].property,null===s?void 0:Gt(s))}getTransition(t){return Gt(this._values[t].transition)}setTransition(t,s){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new ls(this._values[t].property)),this._values[t].transition=Gt(s)||void 0}serialize(){const t={};for(const s of Object.keys(this._values)){const u=this.getValue(s);void 0!==u&&(t[s]=u);const d=this.getTransition(s);void 0!==d&&(t[`${s}-transition`]=d)}return t}transitioned(t,s){const u=new xu(this._properties);for(const d of Object.keys(this._values))u._values[d]=this._values[d].transitioned(t,s._values[d]);return u}untransitioned(){const t=new xu(this._properties);for(const s of Object.keys(this._values))t._values[s]=this._values[s].untransitioned();return t}}class vu{constructor(t,s,u,d,y){this.property=t,this.value=s,this.begin=y+d.delay||0,this.end=this.begin+d.duration||0,t.specification.transition&&(d.delay||d.duration)&&(this.prior=u)}possiblyEvaluate(t,s,u){const d=t.now||0,y=this.value.possiblyEvaluate(t,s,u),_=this.prior;if(_){if(d>this.end)return this.prior=null,y;if(this.value.isDataDriven())return this.prior=null,y;if(d<this.begin)return _.possiblyEvaluate(t,s,u);{const b=(d-this.begin)/(this.end-this.begin);return this.property.interpolate(_.possiblyEvaluate(t,s,u),y,function(C){if(C<=0)return 0;if(C>=1)return 1;const P=C*C,V=P*C;return 4*(C<.5?V:3*(C-P)+V-.75)}(b))}}return y}}class xu{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,s,u){const d=new Ts(this._properties);for(const y of Object.keys(this._values))d._values[y]=this._values[y].possiblyEvaluate(t,s,u);return d}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class Ph{constructor(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)}getValue(t){return Gt(this._values[t].value)}setValue(t,s){this._values[t]=new rl(this._values[t].property,null===s?void 0:Gt(s))}serialize(){const t={};for(const s of Object.keys(this._values)){const u=this.getValue(s);void 0!==u&&(t[s]=u)}return t}possiblyEvaluate(t,s,u){const d=new Ts(this._properties);for(const y of Object.keys(this._values))d._values[y]=this._values[y].possiblyEvaluate(t,s,u);return d}}class qo{constructor(t,s,u){this.property=t,this.value=s,this.parameters=u}isConstant(){return"constant"===this.value.kind}constantOr(t){return"constant"===this.value.kind?this.value.value:t}evaluate(t,s,u,d){return this.property.evaluate(this.value,this.parameters,t,s,u,d)}}class Ts{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class zt{constructor(t){this.specification=t}possiblyEvaluate(t,s){return t.expression.evaluate(s)}interpolate(t,s,u){const d=Nr[this.specification.type];return d?d(t,s,u):t}}class Kt{constructor(t,s){this.specification=t,this.overrides=s}possiblyEvaluate(t,s,u,d){return new qo(this,"constant"===t.expression.kind||"camera"===t.expression.kind?{kind:"constant",value:t.expression.evaluate(s,null,{},u,d)}:t.expression,s)}interpolate(t,s,u){if("constant"!==t.value.kind||"constant"!==s.value.kind)return t;if(void 0===t.value.value||void 0===s.value.value)return new qo(this,{kind:"constant",value:void 0},t.parameters);const d=Nr[this.specification.type];return d?new qo(this,{kind:"constant",value:d(t.value.value,s.value.value,u)},t.parameters):t}evaluate(t,s,u,d,y,_){return"constant"===t.kind?t.value:t.evaluate(s,u,d,y,_)}}class us extends Kt{possiblyEvaluate(t,s,u,d){if(void 0===t.value)return new qo(this,{kind:"constant",value:void 0},s);if("constant"===t.expression.kind){const y=t.expression.evaluate(s,null,{},u,d),_="resolvedImage"===t.property.specification.type&&"string"!=typeof y?y.name:y,b=this._calculate(_,_,_,s);return new qo(this,{kind:"constant",value:b},s)}if("camera"===t.expression.kind){const y=this._calculate(t.expression.evaluate({zoom:s.zoom-1}),t.expression.evaluate({zoom:s.zoom}),t.expression.evaluate({zoom:s.zoom+1}),s);return new qo(this,{kind:"constant",value:y},s)}return new qo(this,t.expression,s)}evaluate(t,s,u,d,y,_){if("source"===t.kind){const b=t.evaluate(s,u,d,y,_);return this._calculate(b,b,b,s)}return"composite"===t.kind?this._calculate(t.evaluate({zoom:Math.floor(s.zoom)-1},u,d),t.evaluate({zoom:Math.floor(s.zoom)},u,d),t.evaluate({zoom:Math.floor(s.zoom)+1},u,d),s):t.value}_calculate(t,s,u,d){return d.zoom>d.zoomHistory.lastIntegerZoom?{from:t,to:s}:{from:u,to:s}}interpolate(t){return t}}class pa{constructor(t){this.specification=t}possiblyEvaluate(t,s,u,d){if(void 0!==t.value){if("constant"===t.expression.kind){const y=t.expression.evaluate(s,null,{},u,d);return this._calculate(y,y,y,s)}return this._calculate(t.expression.evaluate(new yr(Math.floor(s.zoom-1),s)),t.expression.evaluate(new yr(Math.floor(s.zoom),s)),t.expression.evaluate(new yr(Math.floor(s.zoom+1),s)),s)}}_calculate(t,s,u,d){return d.zoom>d.zoomHistory.lastIntegerZoom?{from:t,to:s}:{from:u,to:s}}interpolate(t){return t}}class il{constructor(t){this.specification=t}possiblyEvaluate(t,s,u,d){return!!t.expression.evaluate(s,null,{},u,d)}interpolate(){return!1}}class Cr{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const s in t){const u=t[s];u.specification.overridable&&this.overridableProperties.push(s);const d=this.defaultPropertyValues[s]=new rl(u,void 0),y=this.defaultTransitionablePropertyValues[s]=new ls(u);this.defaultTransitioningPropertyValues[s]=y.untransitioned(),this.defaultPossiblyEvaluatedValues[s]=d.possiblyEvaluate({})}}}Pt("DataDrivenProperty",Kt),Pt("DataConstantProperty",zt),Pt("CrossFadedDataDrivenProperty",us),Pt("CrossFadedProperty",pa),Pt("ColorRampProperty",il);const Ps="-transition";class Yr extends ae{constructor(t,s){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1},"custom"!==t.type&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,"background"!==t.type&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),s.layout&&(this._unevaluatedLayout=new Ph(s.layout)),s.paint)){this._transitionablePaint=new Ra(s.paint);for(const u in t.paint)this.setPaintProperty(u,t.paint[u],{validate:!1});for(const u in t.layout)this.setLayoutProperty(u,t.layout[u],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Ts(s.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(t){return"visibility"===t?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,s,u={}){null!=s&&this._validate(El,`layers.${this.id}.layout.${t}`,t,s,u)||("visibility"!==t?this._unevaluatedLayout.setValue(t,s):this.visibility=s)}getPaintProperty(t){return t.endsWith(Ps)?this._transitionablePaint.getTransition(t.slice(0,-Ps.length)):this._transitionablePaint.getValue(t)}setPaintProperty(t,s,u={}){if(null!=s&&this._validate(Fa,`layers.${this.id}.paint.${t}`,t,s,u))return!1;if(t.endsWith(Ps))return this._transitionablePaint.setTransition(t.slice(0,-Ps.length),s||void 0),!1;{const d=this._transitionablePaint._values[t],y="cross-faded-data-driven"===d.property.specification["property-type"],_=d.value.isDataDriven(),b=d.value;this._transitionablePaint.setValue(t,s),this._handleSpecialPaintPropertyUpdate(t);const C=this._transitionablePaint._values[t].value;return C.isDataDriven()||_||y||this._handleOverridablePaintPropertyUpdate(t,b,C)}}_handleSpecialPaintPropertyUpdate(t){}_handleOverridablePaintPropertyUpdate(t,s,u){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||"none"===this.visibility}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,s){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,s)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,s)}serialize(){const t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),Un(t,(s,u)=>!(void 0===s||"layout"===u&&!Object.keys(s).length||"paint"===u&&!Object.keys(s).length))}_validate(t,s,u,d,y={}){return(!y||!1!==y.validate)&&Ml(this,t.call(Ss,{key:s,layerType:this.type,objectKey:u,value:d,styleSpec:pe,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const t in this.paint._values){const s=this.paint.get(t);if(s instanceof qo&&Bn(s.property.specification)&&("source"===s.value.kind||"composite"===s.value.kind)&&s.value.isStateDependent)return!0}return!1}}const Pl={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class cs{constructor(t,s){this._structArray=t,this._pos1=s*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class _r{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,s){return t._trim(),s&&(t.isTransferred=!0,s.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const s=Object.create(this.prototype);return s.arrayBuffer=t.arrayBuffer,s.length=t.length,s.capacity=t.arrayBuffer.byteLength/s.bytesPerElement,s._refreshViews(),s}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const s=this.uint8;this._refreshViews(),s&&this.uint8.set(s)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function $r(i,t=1){let s=0,u=0;return{members:i.map(d=>{const y=Pl[d.type].BYTES_PER_ELEMENT,_=s=Fl(s,Math.max(t,y)),b=d.components||1;return u=Math.max(u,y),s+=y*b,{name:d.name,type:d.type,components:b,offset:_}}),size:Fl(s,Math.max(u,t)),alignment:t}}function Fl(i,t){return Math.ceil(i/t)*t}class fa extends _r{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s){const u=this.length;return this.resize(u+1),this.emplace(u,t,s)}emplace(t,s,u){const d=2*t;return this.int16[d+0]=s,this.int16[d+1]=u,t}}fa.prototype.bytesPerElement=4,Pt("StructArrayLayout2i4",fa);class zi extends _r{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,u,d){const y=this.length;return this.resize(y+1),this.emplace(y,t,s,u,d)}emplace(t,s,u,d,y){const _=4*t;return this.int16[_+0]=s,this.int16[_+1]=u,this.int16[_+2]=d,this.int16[_+3]=y,t}}zi.prototype.bytesPerElement=8,Pt("StructArrayLayout4i8",zi);class p extends _r{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,u,d,y,_){const b=this.length;return this.resize(b+1),this.emplace(b,t,s,u,d,y,_)}emplace(t,s,u,d,y,_,b){const C=6*t;return this.int16[C+0]=s,this.int16[C+1]=u,this.int16[C+2]=d,this.int16[C+3]=y,this.int16[C+4]=_,this.int16[C+5]=b,t}}p.prototype.bytesPerElement=12,Pt("StructArrayLayout2i4i12",p);class r extends _r{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,u,d,y,_){const b=this.length;return this.resize(b+1),this.emplace(b,t,s,u,d,y,_)}emplace(t,s,u,d,y,_,b){const C=4*t,P=8*t;return this.int16[C+0]=s,this.int16[C+1]=u,this.uint8[P+4]=d,this.uint8[P+5]=y,this.uint8[P+6]=_,this.uint8[P+7]=b,t}}r.prototype.bytesPerElement=8,Pt("StructArrayLayout2i4ub8",r);class a extends _r{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s){const u=this.length;return this.resize(u+1),this.emplace(u,t,s)}emplace(t,s,u){const d=2*t;return this.float32[d+0]=s,this.float32[d+1]=u,t}}a.prototype.bytesPerElement=8,Pt("StructArrayLayout2f8",a);class h extends _r{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s,u,d,y,_,b,C,P,V){const $=this.length;return this.resize($+1),this.emplace($,t,s,u,d,y,_,b,C,P,V)}emplace(t,s,u,d,y,_,b,C,P,V,$){const Z=10*t;return this.uint16[Z+0]=s,this.uint16[Z+1]=u,this.uint16[Z+2]=d,this.uint16[Z+3]=y,this.uint16[Z+4]=_,this.uint16[Z+5]=b,this.uint16[Z+6]=C,this.uint16[Z+7]=P,this.uint16[Z+8]=V,this.uint16[Z+9]=$,t}}h.prototype.bytesPerElement=20,Pt("StructArrayLayout10ui20",h);class g extends _r{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s,u,d,y,_,b,C,P,V,$,Z){const J=this.length;return this.resize(J+1),this.emplace(J,t,s,u,d,y,_,b,C,P,V,$,Z)}emplace(t,s,u,d,y,_,b,C,P,V,$,Z,J){const ee=12*t;return this.int16[ee+0]=s,this.int16[ee+1]=u,this.int16[ee+2]=d,this.int16[ee+3]=y,this.uint16[ee+4]=_,this.uint16[ee+5]=b,this.uint16[ee+6]=C,this.uint16[ee+7]=P,this.int16[ee+8]=V,this.int16[ee+9]=$,this.int16[ee+10]=Z,this.int16[ee+11]=J,t}}g.prototype.bytesPerElement=24,Pt("StructArrayLayout4i4ui4i24",g);class v extends _r{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,u){const d=this.length;return this.resize(d+1),this.emplace(d,t,s,u)}emplace(t,s,u,d){const y=3*t;return this.float32[y+0]=s,this.float32[y+1]=u,this.float32[y+2]=d,t}}v.prototype.bytesPerElement=12,Pt("StructArrayLayout3f12",v);class D extends _r{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const s=this.length;return this.resize(s+1),this.emplace(s,t)}emplace(t,s){return this.uint32[1*t+0]=s,t}}D.prototype.bytesPerElement=4,Pt("StructArrayLayout1ul4",D);class M extends _r{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s,u,d,y,_,b,C,P){const V=this.length;return this.resize(V+1),this.emplace(V,t,s,u,d,y,_,b,C,P)}emplace(t,s,u,d,y,_,b,C,P,V){const $=10*t,Z=5*t;return this.int16[$+0]=s,this.int16[$+1]=u,this.int16[$+2]=d,this.int16[$+3]=y,this.int16[$+4]=_,this.int16[$+5]=b,this.uint32[Z+3]=C,this.uint16[$+8]=P,this.uint16[$+9]=V,t}}M.prototype.bytesPerElement=20,Pt("StructArrayLayout6i1ul2ui20",M);class S extends _r{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,u,d,y,_){const b=this.length;return this.resize(b+1),this.emplace(b,t,s,u,d,y,_)}emplace(t,s,u,d,y,_,b){const C=6*t;return this.int16[C+0]=s,this.int16[C+1]=u,this.int16[C+2]=d,this.int16[C+3]=y,this.int16[C+4]=_,this.int16[C+5]=b,t}}S.prototype.bytesPerElement=12,Pt("StructArrayLayout2i2i2i12",S);class z extends _r{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,u,d,y){const _=this.length;return this.resize(_+1),this.emplace(_,t,s,u,d,y)}emplace(t,s,u,d,y,_){const b=4*t,C=8*t;return this.float32[b+0]=s,this.float32[b+1]=u,this.float32[b+2]=d,this.int16[C+6]=y,this.int16[C+7]=_,t}}z.prototype.bytesPerElement=16,Pt("StructArrayLayout2f1f2i16",z);class q extends _r{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,u,d){const y=this.length;return this.resize(y+1),this.emplace(y,t,s,u,d)}emplace(t,s,u,d,y){const _=12*t,b=3*t;return this.uint8[_+0]=s,this.uint8[_+1]=u,this.float32[b+1]=d,this.float32[b+2]=y,t}}q.prototype.bytesPerElement=12,Pt("StructArrayLayout2ub2f12",q);class X extends _r{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s,u){const d=this.length;return this.resize(d+1),this.emplace(d,t,s,u)}emplace(t,s,u,d){const y=3*t;return this.uint16[y+0]=s,this.uint16[y+1]=u,this.uint16[y+2]=d,t}}X.prototype.bytesPerElement=6,Pt("StructArrayLayout3ui6",X);class re extends _r{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,u,d,y,_,b,C,P,V,$,Z,J,ee,de,he,be){const Le=this.length;return this.resize(Le+1),this.emplace(Le,t,s,u,d,y,_,b,C,P,V,$,Z,J,ee,de,he,be)}emplace(t,s,u,d,y,_,b,C,P,V,$,Z,J,ee,de,he,be,Le){const Fe=24*t,Ve=12*t,Ye=48*t;return this.int16[Fe+0]=s,this.int16[Fe+1]=u,this.uint16[Fe+2]=d,this.uint16[Fe+3]=y,this.uint32[Ve+2]=_,this.uint32[Ve+3]=b,this.uint32[Ve+4]=C,this.uint16[Fe+10]=P,this.uint16[Fe+11]=V,this.uint16[Fe+12]=$,this.float32[Ve+7]=Z,this.float32[Ve+8]=J,this.uint8[Ye+36]=ee,this.uint8[Ye+37]=de,this.uint8[Ye+38]=he,this.uint32[Ve+10]=be,this.int16[Fe+22]=Le,t}}re.prototype.bytesPerElement=48,Pt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",re);class ue extends _r{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,u,d,y,_,b,C,P,V,$,Z,J,ee,de,he,be,Le,Fe,Ve,Ye,He,Tt,$t,ft,wt,lt,Ft){const Dt=this.length;return this.resize(Dt+1),this.emplace(Dt,t,s,u,d,y,_,b,C,P,V,$,Z,J,ee,de,he,be,Le,Fe,Ve,Ye,He,Tt,$t,ft,wt,lt,Ft)}emplace(t,s,u,d,y,_,b,C,P,V,$,Z,J,ee,de,he,be,Le,Fe,Ve,Ye,He,Tt,$t,ft,wt,lt,Ft,Dt){const rt=34*t,qt=17*t;return this.int16[rt+0]=s,this.int16[rt+1]=u,this.int16[rt+2]=d,this.int16[rt+3]=y,this.int16[rt+4]=_,this.int16[rt+5]=b,this.int16[rt+6]=C,this.int16[rt+7]=P,this.uint16[rt+8]=V,this.uint16[rt+9]=$,this.uint16[rt+10]=Z,this.uint16[rt+11]=J,this.uint16[rt+12]=ee,this.uint16[rt+13]=de,this.uint16[rt+14]=he,this.uint16[rt+15]=be,this.uint16[rt+16]=Le,this.uint16[rt+17]=Fe,this.uint16[rt+18]=Ve,this.uint16[rt+19]=Ye,this.uint16[rt+20]=He,this.uint16[rt+21]=Tt,this.uint16[rt+22]=$t,this.uint32[qt+12]=ft,this.float32[qt+13]=wt,this.float32[qt+14]=lt,this.float32[qt+15]=Ft,this.float32[qt+16]=Dt,t}}ue.prototype.bytesPerElement=68,Pt("StructArrayLayout8i15ui1ul4f68",ue);class ie extends _r{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const s=this.length;return this.resize(s+1),this.emplace(s,t)}emplace(t,s){return this.float32[1*t+0]=s,t}}ie.prototype.bytesPerElement=4,Pt("StructArrayLayout1f4",ie);class ce extends _r{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,u){const d=this.length;return this.resize(d+1),this.emplace(d,t,s,u)}emplace(t,s,u,d){const y=3*t;return this.int16[y+0]=s,this.int16[y+1]=u,this.int16[y+2]=d,t}}ce.prototype.bytesPerElement=6,Pt("StructArrayLayout3i6",ce);class ye extends _r{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s,u){const d=this.length;return this.resize(d+1),this.emplace(d,t,s,u)}emplace(t,s,u,d){const y=4*t;return this.uint32[2*t+0]=s,this.uint16[y+2]=u,this.uint16[y+3]=d,t}}ye.prototype.bytesPerElement=8,Pt("StructArrayLayout1ul2ui8",ye);class ge extends _r{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s){const u=this.length;return this.resize(u+1),this.emplace(u,t,s)}emplace(t,s,u){const d=2*t;return this.uint16[d+0]=s,this.uint16[d+1]=u,t}}ge.prototype.bytesPerElement=4,Pt("StructArrayLayout2ui4",ge);class Me extends _r{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const s=this.length;return this.resize(s+1),this.emplace(s,t)}emplace(t,s){return this.uint16[1*t+0]=s,t}}Me.prototype.bytesPerElement=2,Pt("StructArrayLayout1ui2",Me);class xe extends _r{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,u,d){const y=this.length;return this.resize(y+1),this.emplace(y,t,s,u,d)}emplace(t,s,u,d,y){const _=4*t;return this.float32[_+0]=s,this.float32[_+1]=u,this.float32[_+2]=d,this.float32[_+3]=y,t}}xe.prototype.bytesPerElement=16,Pt("StructArrayLayout4f16",xe);class $e extends cs{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new _e(this.anchorPointX,this.anchorPointY)}}$e.prototype.size=20;class Oe extends M{get(t){return new $e(this,t)}}Pt("CollisionBoxArray",Oe);class Ne extends cs{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(t){this._structArray.uint8[this._pos1+37]=t}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(t){this._structArray.uint8[this._pos1+38]=t}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(t){this._structArray.uint32[this._pos4+10]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}Ne.prototype.size=48;class Je extends re{get(t){return new Ne(this,t)}}Pt("PlacedSymbolArray",Je);class at extends cs{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(t){this._structArray.uint32[this._pos4+12]=t}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get textOffset0(){return this._structArray.float32[this._pos4+14]}get textOffset1(){return this._structArray.float32[this._pos4+15]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+16]}}at.prototype.size=68;class je extends ue{get(t){return new at(this,t)}}Pt("SymbolInstanceArray",je);class At extends ie{getoffsetX(t){return this.float32[1*t+0]}}Pt("GlyphOffsetArray",At);class vt extends ce{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}}Pt("SymbolLineVertexArray",vt);class an extends cs{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}an.prototype.size=8;class Mn extends ye{get(t){return new an(this,t)}}Pt("FeatureIndexArray",Mn);class In extends fa{}class Ln extends fa{}class pn extends p{}class _n extends r{}class Gn extends a{}class cr extends h{}class Di extends g{}class oo extends v{}class vo extends D{}class xo extends S{}class so extends q{}class Qi extends X{}class Zo extends ge{}const vr=$r([{name:"a_pos",components:2,type:"Int16"}],4),{members:Ai}=vr;class Rn{constructor(t=[]){this.segments=t}prepareSegment(t,s,u,d){let y=this.segments[this.segments.length-1];return t>Rn.MAX_VERTEX_ARRAY_LENGTH&&wn(`Max vertices per segment is ${Rn.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!y||y.vertexLength+t>Rn.MAX_VERTEX_ARRAY_LENGTH||y.sortKey!==d)&&(y={vertexOffset:s.length,primitiveOffset:u.length,vertexLength:0,primitiveLength:0},void 0!==d&&(y.sortKey=d),this.segments.push(y)),y}get(){return this.segments}destroy(){for(const t of this.segments)for(const s in t.vaos)t.vaos[s].destroy()}static simpleSegment(t,s,u,d){return new Rn([{vertexOffset:t,primitiveOffset:s,vertexLength:u,primitiveLength:d,vaos:{},sortKey:0}])}}function er(i,t){return 256*(i=Ee(Math.floor(i),0,255))+Ee(Math.floor(t),0,255)}Rn.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Pt("SegmentVector",Rn);const Gr=$r([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var dr={exports:{}},eo=function(i,t){var s,u,d,y,_,b,C,P;for(u=i.length-(s=3&i.length),d=t,_=3432918353,b=461845907,P=0;P<u;)C=255&i.charCodeAt(P)|(255&i.charCodeAt(++P))<<8|(255&i.charCodeAt(++P))<<16|(255&i.charCodeAt(++P))<<24,++P,d=27492+(65535&(y=5*(65535&(d=(d^=C=(65535&(C=(C=(65535&C)*_+(((C>>>16)*_&65535)<<16)&4294967295)<<15|C>>>17))*b+(((C>>>16)*b&65535)<<16)&4294967295)<<13|d>>>19))+((5*(d>>>16)&65535)<<16)&4294967295))+((58964+(y>>>16)&65535)<<16);switch(C=0,s){case 3:C^=(255&i.charCodeAt(P+2))<<16;case 2:C^=(255&i.charCodeAt(P+1))<<8;case 1:d^=C=(65535&(C=(C=(65535&(C^=255&i.charCodeAt(P)))*_+(((C>>>16)*_&65535)<<16)&4294967295)<<15|C>>>17))*b+(((C>>>16)*b&65535)<<16)&4294967295}return d^=i.length,d=2246822507*(65535&(d^=d>>>16))+((2246822507*(d>>>16)&65535)<<16)&4294967295,d=3266489909*(65535&(d^=d>>>13))+((3266489909*(d>>>16)&65535)<<16)&4294967295,(d^=d>>>16)>>>0},ds=function(i,t){for(var s,u=i.length,d=t^u,y=0;u>=4;)s=1540483477*(65535&(s=255&i.charCodeAt(y)|(255&i.charCodeAt(++y))<<8|(255&i.charCodeAt(++y))<<16|(255&i.charCodeAt(++y))<<24))+((1540483477*(s>>>16)&65535)<<16),d=1540483477*(65535&d)+((1540483477*(d>>>16)&65535)<<16)^(s=1540483477*(65535&(s^=s>>>24))+((1540483477*(s>>>16)&65535)<<16)),u-=4,++y;switch(u){case 3:d^=(255&i.charCodeAt(y+2))<<16;case 2:d^=(255&i.charCodeAt(y+1))<<8;case 1:d=1540483477*(65535&(d^=255&i.charCodeAt(y)))+((1540483477*(d>>>16)&65535)<<16)}return d=1540483477*(65535&(d^=d>>>13))+((1540483477*(d>>>16)&65535)<<16),(d^=d>>>15)>>>0};dr.exports=eo,dr.exports.murmur3=eo,dr.exports.murmur2=ds;var ol=dr.exports;class sl{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,s,u,d){this.ids.push(bu(t)),this.positions.push(s,u,d)}getPositions(t){const s=bu(t);let u=0,d=this.ids.length-1;for(;u<d;){const _=u+d>>1;this.ids[_]>=s?d=_:u=_+1}const y=[];for(;this.ids[u]===s;)y.push({index:this.positions[3*u],start:this.positions[3*u+1],end:this.positions[3*u+2]}),u++;return y}static serialize(t,s){const u=new Float64Array(t.ids),d=new Uint32Array(t.positions);return ma(u,d,0,u.length-1),s&&s.push(u.buffer,d.buffer),{ids:u,positions:d}}static deserialize(t){const s=new sl;return s.ids=t.ids,s.positions=t.positions,s.indexed=!0,s}}function bu(i){const t=+i;return!isNaN(t)&&t<=Number.MAX_SAFE_INTEGER?t:ol(String(i))}function ma(i,t,s,u){for(;s<u;){const d=i[s+u>>1];let y=s-1,_=u+1;for(;;){do{y++}while(i[y]<d);do{_--}while(i[_]>d);if(y>=_)break;kl(i,y,_),kl(t,3*y,3*_),kl(t,3*y+1,3*_+1),kl(t,3*y+2,3*_+2)}_-s<u-_?(ma(i,t,s,_),s=_+1):(ma(i,t,_+1,u),u=_)}}function kl(i,t,s){const u=i[t];i[t]=i[s],i[s]=u}Pt("FeaturePositionMap",sl);class bo{constructor(t,s){this.gl=t.gl,this.location=s}}class ri extends bo{constructor(t,s){super(t,s),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))}}class wu extends bo{constructor(t,s){super(t,s),this.current=[0,0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))}}class Oa extends bo{constructor(t,s){super(t,s),this.current=B.transparent}set(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))}}const Mm=new Float32Array(16);function Du(i){return[er(255*i.r,255*i.g),er(255*i.b,255*i.a)]}class Ll{constructor(t,s,u){this.value=t,this.uniformNames=s.map(d=>`u_${d}`),this.type=u}setUniform(t,s,u){t.set(u.constantOr(this.value))}getBinding(t,s,u){return"color"===this.type?new Oa(t,s):new ri(t,s)}}class al{constructor(t,s){this.uniformNames=s.map(u=>`u_${u}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(t,s){this.pixelRatioFrom=s.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=s.tlbr,this.patternTo=t.tlbr}setUniform(t,s,u,d){const y="u_pattern_to"===d?this.patternTo:"u_pattern_from"===d?this.patternFrom:"u_pixel_ratio_to"===d?this.pixelRatioTo:"u_pixel_ratio_from"===d?this.pixelRatioFrom:null;y&&t.set(y)}getBinding(t,s,u){return"u_pattern"===u.substr(0,9)?new wu(t,s):new ri(t,s)}}class Fs{constructor(t,s,u,d){this.expression=t,this.type=u,this.maxValue=0,this.paintVertexAttributes=s.map(y=>({name:`a_${y}`,type:"Float32",components:"color"===u?2:1,offset:0})),this.paintVertexArray=new d}populatePaintArray(t,s,u,d,y){const _=this.paintVertexArray.length,b=this.expression.evaluate(new yr(0),s,{},d,[],y);this.paintVertexArray.resize(t),this._setPaintValue(_,t,b)}updatePaintArray(t,s,u,d){const y=this.expression.evaluate({zoom:0},u,d);this._setPaintValue(t,s,y)}_setPaintValue(t,s,u){if("color"===this.type){const d=Du(u);for(let y=t;y<s;y++)this.paintVertexArray.emplace(y,d[0],d[1])}else{for(let d=t;d<s;d++)this.paintVertexArray.emplace(d,u);this.maxValue=Math.max(this.maxValue,Math.abs(u))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Wo{constructor(t,s,u,d,y,_){this.expression=t,this.uniformNames=s.map(b=>`u_${b}_t`),this.type=u,this.useIntegerZoom=d,this.zoom=y,this.maxValue=0,this.paintVertexAttributes=s.map(b=>({name:`a_${b}`,type:"Float32",components:"color"===u?4:2,offset:0})),this.paintVertexArray=new _}populatePaintArray(t,s,u,d,y){const _=this.expression.evaluate(new yr(this.zoom),s,{},d,[],y),b=this.expression.evaluate(new yr(this.zoom+1),s,{},d,[],y),C=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(C,t,_,b)}updatePaintArray(t,s,u,d){const y=this.expression.evaluate({zoom:this.zoom},u,d),_=this.expression.evaluate({zoom:this.zoom+1},u,d);this._setPaintValue(t,s,y,_)}_setPaintValue(t,s,u,d){if("color"===this.type){const y=Du(u),_=Du(d);for(let b=t;b<s;b++)this.paintVertexArray.emplace(b,y[0],y[1],_[0],_[1])}else{for(let y=t;y<s;y++)this.paintVertexArray.emplace(y,u,d);this.maxValue=Math.max(this.maxValue,Math.abs(u),Math.abs(d))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,s){const u=this.useIntegerZoom?Math.floor(s.zoom):s.zoom,d=Ee(this.expression.interpolationFactor(u,this.zoom,this.zoom+1),0,1);t.set(d)}getBinding(t,s,u){return new ri(t,s)}}class ga{constructor(t,s,u,d,y,_){this.expression=t,this.type=s,this.useIntegerZoom=u,this.zoom=d,this.layerId=_,this.zoomInPaintVertexArray=new y,this.zoomOutPaintVertexArray=new y}populatePaintArray(t,s,u){const d=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(d,t,s.patterns&&s.patterns[this.layerId],u)}updatePaintArray(t,s,u,d,y){this._setPaintValues(t,s,u.patterns&&u.patterns[this.layerId],y)}_setPaintValues(t,s,u,d){if(!d||!u)return;const{min:y,mid:_,max:b}=u,C=d[y],P=d[_],V=d[b];if(C&&P&&V)for(let $=t;$<s;$++)this.zoomInPaintVertexArray.emplace($,P.tl[0],P.tl[1],P.br[0],P.br[1],C.tl[0],C.tl[1],C.br[0],C.br[1],P.pixelRatio,C.pixelRatio),this.zoomOutPaintVertexArray.emplace($,P.tl[0],P.tl[1],P.br[0],P.br[1],V.tl[0],V.tl[1],V.br[0],V.br[1],P.pixelRatio,V.pixelRatio)}upload(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,Gr.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,Gr.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Fh{constructor(t,s,u){this.binders={},this._buffers=[];const d=[];for(const y in t.paint._values){if(!u(y))continue;const _=t.paint.get(y);if(!(_ instanceof qo&&Bn(_.property.specification)))continue;const b=Cu(y,t.type),C=_.value,P=_.property.specification.type,V=_.property.useIntegerZoom,$=_.property.specification["property-type"],Z="cross-faded"===$||"cross-faded-data-driven"===$;if("constant"===C.kind)this.binders[y]=Z?new al(C.value,b):new Ll(C.value,b,P),d.push(`/u_${y}`);else if("source"===C.kind||Z){const J=up(y,P,"source");this.binders[y]=Z?new ga(C,P,V,s,J,t.id):new Fs(C,b,P,J),d.push(`/a_${y}`)}else{const J=up(y,P,"composite");this.binders[y]=new Wo(C,b,P,V,s,J),d.push(`/z_${y}`)}}this.cacheKey=d.sort().join("")}getMaxValue(t){const s=this.binders[t];return s instanceof Fs||s instanceof Wo?s.maxValue:0}populatePaintArrays(t,s,u,d,y){for(const _ in this.binders){const b=this.binders[_];(b instanceof Fs||b instanceof Wo||b instanceof ga)&&b.populatePaintArray(t,s,u,d,y)}}setConstantPatternPositions(t,s){for(const u in this.binders){const d=this.binders[u];d instanceof al&&d.setConstantPatternPositions(t,s)}}updatePaintArrays(t,s,u,d,y){let _=!1;for(const b in t){const C=s.getPositions(b);for(const P of C){const V=u.feature(P.index);for(const $ in this.binders){const Z=this.binders[$];if((Z instanceof Fs||Z instanceof Wo||Z instanceof ga)&&!0===Z.expression.isStateDependent){const J=d.paint.get($);Z.expression=J.value,Z.updatePaintArray(P.start,P.end,V,t[b],y),_=!0}}}}return _}defines(){const t=[];for(const s in this.binders){const u=this.binders[s];(u instanceof Ll||u instanceof al)&&t.push(...u.uniformNames.map(d=>`#define HAS_UNIFORM_${d}`))}return t}getBinderAttributes(){const t=[];for(const s in this.binders){const u=this.binders[s];if(u instanceof Fs||u instanceof Wo)for(let d=0;d<u.paintVertexAttributes.length;d++)t.push(u.paintVertexAttributes[d].name);else if(u instanceof ga)for(let d=0;d<Gr.members.length;d++)t.push(Gr.members[d].name)}return t}getBinderUniforms(){const t=[];for(const s in this.binders){const u=this.binders[s];if(u instanceof Ll||u instanceof al||u instanceof Wo)for(const d of u.uniformNames)t.push(d)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t,s){const u=[];for(const d in this.binders){const y=this.binders[d];if(y instanceof Ll||y instanceof al||y instanceof Wo)for(const _ of y.uniformNames)if(s[_]){const b=y.getBinding(t,s[_],_);u.push({name:_,property:d,binding:b})}}return u}setUniforms(t,s,u,d){for(const{name:y,property:_,binding:b}of s)this.binders[_].setUniform(b,d,u.get(_),y)}updatePaintBuffers(t){this._buffers=[];for(const s in this.binders){const u=this.binders[s];if(t&&u instanceof ga){const d=2===t.fromScale?u.zoomInPaintVertexBuffer:u.zoomOutPaintVertexBuffer;d&&this._buffers.push(d)}else(u instanceof Fs||u instanceof Wo)&&u.paintVertexBuffer&&this._buffers.push(u.paintVertexBuffer)}}upload(t){for(const s in this.binders){const u=this.binders[s];(u instanceof Fs||u instanceof Wo||u instanceof ga)&&u.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const s=this.binders[t];(s instanceof Fs||s instanceof Wo||s instanceof ga)&&s.destroy()}}}class ks{constructor(t,s,u=(()=>!0)){this.programConfigurations={};for(const d of t)this.programConfigurations[d.id]=new Fh(d,s,u);this.needsUpload=!1,this._featureMap=new sl,this._bufferOffset=0}populatePaintArrays(t,s,u,d,y,_){for(const b in this.programConfigurations)this.programConfigurations[b].populatePaintArrays(t,s,d,y,_);void 0!==s.id&&this._featureMap.add(s.id,u,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,s,u,d){for(const y of u)this.needsUpload=this.programConfigurations[y.id].updatePaintArrays(t,this._featureMap,s,y,d)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const s in this.programConfigurations)this.programConfigurations[s].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}function Cu(i,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[i]||[i.replace(`${t}-`,"").replace(/-/g,"_")]}function up(i,t,s){const d={"line-pattern":{source:cr,composite:cr},"fill-pattern":{source:cr,composite:cr},"fill-extrusion-pattern":{source:cr,composite:cr}}[i];return d&&d[s]||{color:{source:a,composite:xe},number:{source:ie,composite:a}}[t][s]}Pt("ConstantBinder",Ll),Pt("CrossFadedConstantBinder",al),Pt("SourceExpressionBinder",Fs),Pt("CrossFadedCompositeBinder",ga),Pt("CompositeExpressionBinder",Wo),Pt("ProgramConfiguration",Fh,{omit:["_buffers"]}),Pt("ProgramConfigurationSet",ks);var Pr=8192;const Rl=Math.pow(2,14)-1,Ol=-Rl-1;function za(i){const t=Pr/i.extent,s=i.loadGeometry();for(let u=0;u<s.length;u++){const d=s[u];for(let y=0;y<d.length;y++){const _=d[y],b=Math.round(_.x*t),C=Math.round(_.y*t);_.x=Ee(b,Ol,Rl),_.y=Ee(C,Ol,Rl),(b<_.x||b>_.x+1||C<_.y||C>_.y+1)&&wn("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return s}function Na(i,t){return{type:i.type,id:i.id,properties:i.properties,geometry:t?za(i):[]}}function Eu(i,t,s,u,d){i.emplaceBack(2*t+(u+1)/2,2*s+(d+1)/2)}class Mu{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(s=>s.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new In,this.indexArray=new Qi,this.segments=new Rn,this.programConfigurations=new ks(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(t,s,u){const d=this.layers[0],y=[];let _=null,b=!1;"circle"===d.type&&(_=d.layout.get("circle-sort-key"),b=!_.isConstant());for(const{feature:C,id:P,index:V,sourceLayerIndex:$}of t){const Z=this.layers[0]._featureFilter.needGeometry,J=Na(C,Z);if(!this.layers[0]._featureFilter.filter(new yr(this.zoom),J,u))continue;const ee=b?_.evaluate(J,{},u):void 0,de={id:P,properties:C.properties,type:C.type,sourceLayerIndex:$,index:V,geometry:Z?J.geometry:za(C),patterns:{},sortKey:ee};y.push(de)}b&&y.sort((C,P)=>C.sortKey-P.sortKey);for(const C of y){const{geometry:P,index:V,sourceLayerIndex:$}=C,Z=t[V].feature;this.addFeature(C,P,V,u),s.featureIndex.insert(Z,P,V,$,this.index)}}update(t,s,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,s,this.stateDependentLayers,u)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Ai),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,s,u,d){for(const y of s)for(const _ of y){const b=_.x,C=_.y;if(b<0||b>=Pr||C<0||C>=Pr)continue;const P=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),V=P.vertexLength;Eu(this.layoutVertexArray,b,C,-1,-1),Eu(this.layoutVertexArray,b,C,1,-1),Eu(this.layoutVertexArray,b,C,1,1),Eu(this.layoutVertexArray,b,C,-1,1),this.indexArray.emplaceBack(V,V+1,V+2),this.indexArray.emplaceBack(V,V+3,V+2),P.vertexLength+=4,P.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,u,{},d)}}function ll(i,t){for(let s=0;s<i.length;s++)if(cl(t,i[s]))return!0;for(let s=0;s<t.length;s++)if(cl(i,t[s]))return!0;return!!Su(i,t)}function Iu(i,t,s){return!!cl(i,t)||!!zl(t,i,s)}function kh(i,t){if(1===i.length)return Lh(t,i[0]);for(let s=0;s<t.length;s++){const u=t[s];for(let d=0;d<u.length;d++)if(cl(i,u[d]))return!0}for(let s=0;s<i.length;s++)if(Lh(t,i[s]))return!0;for(let s=0;s<t.length;s++)if(Su(i,t[s]))return!0;return!1}function Kr(i,t,s){if(i.length>1){if(Su(i,t))return!0;for(let u=0;u<t.length;u++)if(zl(t[u],i,s))return!0}for(let u=0;u<i.length;u++)if(zl(i[u],t,s))return!0;return!1}function Su(i,t){if(0===i.length||0===t.length)return!1;for(let s=0;s<i.length-1;s++){const u=i[s],d=i[s+1];for(let y=0;y<t.length-1;y++)if(cp(u,d,t[y],t[y+1]))return!0}return!1}function cp(i,t,s,u){return Dn(i,s,u)!==Dn(t,s,u)&&Dn(i,t,s)!==Dn(i,t,u)}function zl(i,t,s){const u=s*s;if(1===t.length)return i.distSqr(t[0])<u;for(let d=1;d<t.length;d++)if(ul(i,t[d-1],t[d])<u)return!0;return!1}function ul(i,t,s){const u=t.distSqr(s);if(0===u)return i.distSqr(t);const d=((i.x-t.x)*(s.x-t.x)+(i.y-t.y)*(s.y-t.y))/u;return i.distSqr(d<0?t:d>1?s:s.sub(t)._mult(d)._add(t))}function Lh(i,t){let s,u,d,y=!1;for(let _=0;_<i.length;_++){s=i[_];for(let b=0,C=s.length-1;b<s.length;C=b++)u=s[b],d=s[C],u.y>t.y!=d.y>t.y&&t.x<(d.x-u.x)*(t.y-u.y)/(d.y-u.y)+u.x&&(y=!y)}return y}function cl(i,t){let s=!1;for(let u=0,d=i.length-1;u<i.length;d=u++){const y=i[u],_=i[d];y.y>t.y!=_.y>t.y&&t.x<(_.x-y.x)*(t.y-y.y)/(_.y-y.y)+y.x&&(s=!s)}return s}function hp(i,t,s){const u=s[0],d=s[2];if(i.x<u.x&&t.x<u.x||i.x>d.x&&t.x>d.x||i.y<u.y&&t.y<u.y||i.y>d.y&&t.y>d.y)return!1;const y=Dn(i,t,s[0]);return y!==Dn(i,t,s[1])||y!==Dn(i,t,s[2])||y!==Dn(i,t,s[3])}function Ba(i,t,s){const u=t.paint.get(i).value;return"constant"===u.kind?u.value:s.programConfigurations.get(t.id).getMaxValue(i)}function Va(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function Nl(i,t,s,u,d){if(!t[0]&&!t[1])return i;const y=_e.convert(t)._mult(d);"viewport"===s&&y._rotate(-u);const _=[];for(let b=0;b<i.length;b++)_.push(i[b].sub(y));return _}Pt("CircleBucket",Mu,{omit:["layers"]});const Au=new Cr({"circle-sort-key":new Kt(pe.layout_circle["circle-sort-key"])});var dp={paint:new Cr({"circle-radius":new Kt(pe.paint_circle["circle-radius"]),"circle-color":new Kt(pe.paint_circle["circle-color"]),"circle-blur":new Kt(pe.paint_circle["circle-blur"]),"circle-opacity":new Kt(pe.paint_circle["circle-opacity"]),"circle-translate":new zt(pe.paint_circle["circle-translate"]),"circle-translate-anchor":new zt(pe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new zt(pe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new zt(pe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Kt(pe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Kt(pe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Kt(pe.paint_circle["circle-stroke-opacity"])}),layout:Au},Ua=typeof Float32Array<"u"?Float32Array:Array;function ja(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function Bl(i,t,s){var u=t[0],d=t[1],y=t[2],_=t[3],b=t[4],C=t[5],P=t[6],V=t[7],$=t[8],Z=t[9],J=t[10],ee=t[11],de=t[12],he=t[13],be=t[14],Le=t[15],Fe=s[0],Ve=s[1],Ye=s[2],He=s[3];return i[0]=Fe*u+Ve*b+Ye*$+He*de,i[1]=Fe*d+Ve*C+Ye*Z+He*he,i[2]=Fe*y+Ve*P+Ye*J+He*be,i[3]=Fe*_+Ve*V+Ye*ee+He*Le,i[4]=(Fe=s[4])*u+(Ve=s[5])*b+(Ye=s[6])*$+(He=s[7])*de,i[5]=Fe*d+Ve*C+Ye*Z+He*he,i[6]=Fe*y+Ve*P+Ye*J+He*be,i[7]=Fe*_+Ve*V+Ye*ee+He*Le,i[8]=(Fe=s[8])*u+(Ve=s[9])*b+(Ye=s[10])*$+(He=s[11])*de,i[9]=Fe*d+Ve*C+Ye*Z+He*he,i[10]=Fe*y+Ve*P+Ye*J+He*be,i[11]=Fe*_+Ve*V+Ye*ee+He*Le,i[12]=(Fe=s[12])*u+(Ve=s[13])*b+(Ye=s[14])*$+(He=s[15])*de,i[13]=Fe*d+Ve*C+Ye*Z+He*he,i[14]=Fe*y+Ve*P+Ye*J+He*be,i[15]=Fe*_+Ve*V+Ye*ee+He*Le,i}Math.hypot||(Math.hypot=function(){for(var i=0,t=arguments.length;t--;)i+=arguments[t]*arguments[t];return Math.sqrt(i)});var hl,pp=Bl;function Tu(i,t,s){var u=t[0],d=t[1],y=t[2],_=t[3];return i[0]=s[0]*u+s[4]*d+s[8]*y+s[12]*_,i[1]=s[1]*u+s[5]*d+s[9]*y+s[13]*_,i[2]=s[2]*u+s[6]*d+s[10]*y+s[14]*_,i[3]=s[3]*u+s[7]*d+s[11]*y+s[15]*_,i}function $a(i,t){const s=Tu([],[i.x,i.y,0,1],t);return new _e(s[0]/s[3],s[1]/s[3])}hl=new Ua(4),Ua!=Float32Array&&(hl[0]=0,hl[1]=0,hl[2]=0,hl[3]=0);class dl extends Mu{}Pt("HeatmapBucket",dl,{omit:["layers"]});var fp={paint:new Cr({"heatmap-radius":new Kt(pe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Kt(pe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new zt(pe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new il(pe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new zt(pe.paint_heatmap["heatmap-opacity"])})};function Rh(i,{width:t,height:s},u,d){if(d){if(d instanceof Uint8ClampedArray)d=new Uint8Array(d.buffer);else if(d.length!==t*s*u)throw new RangeError(`mismatched image size. expected: ${d.length} but got: ${t*s*u}`)}else d=new Uint8Array(t*s*u);return i.width=t,i.height=s,i.data=d,i}function kc(i,{width:t,height:s},u){if(t===i.width&&s===i.height)return;const d=Rh({},{width:t,height:s},u);Lc(i,d,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,t),height:Math.min(i.height,s)},u),i.width=t,i.height=s,i.data=d.data}function Lc(i,t,s,u,d,y){if(0===d.width||0===d.height)return t;if(d.width>i.width||d.height>i.height||s.x>i.width-d.width||s.y>i.height-d.height)throw new RangeError("out of range source coordinates for image copy");if(d.width>t.width||d.height>t.height||u.x>t.width-d.width||u.y>t.height-d.height)throw new RangeError("out of range destination coordinates for image copy");const _=i.data,b=t.data;for(let C=0;C<d.height;C++){const P=((s.y+C)*i.width+s.x)*y,V=((u.y+C)*t.width+u.x)*y;for(let $=0;$<d.width*y;$++)b[V+$]=_[P+$]}return t}class Pu{constructor(t,s){Rh(this,t,1,s)}resize(t){kc(this,t,1)}clone(){return new Pu({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,s,u,d,y){Lc(t,s,u,d,y,1)}}class wo{constructor(t,s){Rh(this,t,4,s)}resize(t){kc(this,t,4)}replace(t,s){s?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new wo({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,s,u,d,y){Lc(t,s,u,d,y,4)}}function Oh(i){const t={},s=i.resolution||256,u=i.clips?i.clips.length:1,d=i.image||new wo({width:s,height:u}),y=(_,b,C)=>{t[i.evaluationKey]=C;const P=i.expression.evaluate(t);d.data[_+b+0]=Math.floor(255*P.r/P.a),d.data[_+b+1]=Math.floor(255*P.g/P.a),d.data[_+b+2]=Math.floor(255*P.b/P.a),d.data[_+b+3]=Math.floor(255*P.a)};if(i.clips)for(let _=0,b=0;_<u;++_,b+=4*s)for(let C=0,P=0;C<s;C++,P+=4){const V=C/(s-1),{start:$,end:Z}=i.clips[_];y(b,P,$*(1-V)+Z*V)}else for(let _=0,b=0;_<s;_++,b+=4)y(0,b,_/(s-1));return d}Pt("AlphaImage",Pu),Pt("RGBAImage",wo);var mp={paint:new Cr({"hillshade-illumination-direction":new zt(pe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new zt(pe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new zt(pe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new zt(pe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new zt(pe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new zt(pe.paint_hillshade["hillshade-accent-color"])})};const Fu=$r([{name:"a_pos",components:2,type:"Int16"}],4),{members:zh}=Fu;var Rc={exports:{}};function Vl(i,t,s){s=s||2;var u,d,y,_,b,C,P,V=t&&t.length,$=V?t[0]*s:i.length,Z=gp(i,0,$,s,!0),J=[];if(!Z||Z.next===Z.prev)return J;if(V&&(Z=function(de,he,be,Le){var Fe,Ve,Ye,He=[];for(Fe=0,Ve=he.length;Fe<Ve;Fe++)(Ye=gp(de,he[Fe]*Le,Fe<Ve-1?he[Fe+1]*Le:de.length,Le,!1))===Ye.next&&(Ye.steiner=!0),He.push(Nh(Ye));for(He.sort(_p),Fe=0;Fe<He.length;Fe++)be=Ls(be=Im(He[Fe],be),be.next);return be}(i,t,Z,s)),i.length>80*s){u=y=i[0],d=_=i[1];for(var ee=s;ee<$;ee+=s)(b=i[ee])<u&&(u=b),(C=i[ee+1])<d&&(d=C),b>y&&(y=b),C>_&&(_=C);P=0!==(P=Math.max(y-u,_-d))?1/P:0}return ku(Z,J,s,u,d,P),J}function gp(i,t,s,u,d){var y,_;if(d===jh(i,t,s,u)>0)for(y=t;y<s;y+=u)_=fl(y,i[y],i[y+1],_);else for(y=s-u;y>=t;y-=u)_=fl(y,i[y],i[y+1],_);return _&&Ou(_,_.next)&&($l(_),_=_.next),_}function Ls(i,t){if(!i)return i;t||(t=i);var s,u=i;do{if(s=!1,u.steiner||!Ou(u,u.next)&&0!==Lr(u.prev,u,u.next))u=u.next;else{if($l(u),(u=t=u.prev)===u.next)break;s=!0}}while(s||u!==t);return t}function ku(i,t,s,u,d,y,_){if(i){!_&&y&&function(V,$,Z,J){var ee=V;do{null===ee.z&&(ee.z=Ul(ee.x,ee.y,$,Z,J)),ee.prevZ=ee.prev,ee.nextZ=ee.next,ee=ee.next}while(ee!==V);ee.prevZ.nextZ=null,ee.prevZ=null,function(de){var he,be,Le,Fe,Ve,Ye,He,Tt,$t=1;do{for(be=de,de=null,Ve=null,Ye=0;be;){for(Ye++,Le=be,He=0,he=0;he<$t&&(He++,Le=Le.nextZ);he++);for(Tt=$t;He>0||Tt>0&&Le;)0!==He&&(0===Tt||!Le||be.z<=Le.z)?(Fe=be,be=be.nextZ,He--):(Fe=Le,Le=Le.nextZ,Tt--),Ve?Ve.nextZ=Fe:de=Fe,Fe.prevZ=Ve,Ve=Fe;be=Le}Ve.nextZ=null,$t*=2}while(Ye>1)}(ee)}(i,u,d,y);for(var b,C,P=i;i.prev!==i.next;)if(b=i.prev,C=i.next,y?Oc(i,u,d,y):Lu(i))t.push(b.i/s),t.push(i.i/s),t.push(C.i/s),$l(i),i=C.next,P=C.next;else if((i=C)===P){_?1===_?ku(i=pl(Ls(i),t,s),t,s,u,d,y,2):2===_&&yp(i,t,s,u,d,y):ku(Ls(i),t,s,u,d,y,1);break}}}function Lu(i){var t=i.prev,s=i,u=i.next;if(Lr(t,s,u)>=0)return!1;for(var d=i.next.next;d!==i.prev;){if(Ga(t.x,t.y,s.x,s.y,u.x,u.y,d.x,d.y)&&Lr(d.prev,d,d.next)>=0)return!1;d=d.next}return!0}function Oc(i,t,s,u){var d=i.prev,y=i,_=i.next;if(Lr(d,y,_)>=0)return!1;for(var b=d.x>y.x?d.x>_.x?d.x:_.x:y.x>_.x?y.x:_.x,C=d.y>y.y?d.y>_.y?d.y:_.y:y.y>_.y?y.y:_.y,P=Ul(d.x<y.x?d.x<_.x?d.x:_.x:y.x<_.x?y.x:_.x,d.y<y.y?d.y<_.y?d.y:_.y:y.y<_.y?y.y:_.y,t,s,u),V=Ul(b,C,t,s,u),$=i.prevZ,Z=i.nextZ;$&&$.z>=P&&Z&&Z.z<=V;){if($!==i.prev&&$!==i.next&&Ga(d.x,d.y,y.x,y.y,_.x,_.y,$.x,$.y)&&Lr($.prev,$,$.next)>=0||($=$.prevZ,Z!==i.prev&&Z!==i.next&&Ga(d.x,d.y,y.x,y.y,_.x,_.y,Z.x,Z.y)&&Lr(Z.prev,Z,Z.next)>=0))return!1;Z=Z.nextZ}for(;$&&$.z>=P;){if($!==i.prev&&$!==i.next&&Ga(d.x,d.y,y.x,y.y,_.x,_.y,$.x,$.y)&&Lr($.prev,$,$.next)>=0)return!1;$=$.prevZ}for(;Z&&Z.z<=V;){if(Z!==i.prev&&Z!==i.next&&Ga(d.x,d.y,y.x,y.y,_.x,_.y,Z.x,Z.y)&&Lr(Z.prev,Z,Z.next)>=0)return!1;Z=Z.nextZ}return!0}function pl(i,t,s){var u=i;do{var d=u.prev,y=u.next.next;!Ou(d,y)&&Vh(d,u,u.next,y)&&jl(d,y)&&jl(y,d)&&(t.push(d.i/s),t.push(u.i/s),t.push(y.i/s),$l(u),$l(u.next),u=i=y),u=u.next}while(u!==i);return Ls(u)}function yp(i,t,s,u,d,y){var _=i;do{for(var b=_.next.next;b!==_.prev;){if(_.i!==b.i&&Bh(_,b)){var C=Rs(_,b);return _=Ls(_,_.next),C=Ls(C,C.next),ku(_,t,s,u,d,y),void ku(C,t,s,u,d,y)}b=b.next}_=_.next}while(_!==i)}function _p(i,t){return i.x-t.x}function Im(i,t){var s=function(y,_){var b,C=_,P=y.x,V=y.y,$=-1/0;do{if(V<=C.y&&V>=C.next.y&&C.next.y!==C.y){var Z=C.x+(V-C.y)*(C.next.x-C.x)/(C.next.y-C.y);if(Z<=P&&Z>$){if($=Z,Z===P){if(V===C.y)return C;if(V===C.next.y)return C.next}b=C.x<C.next.x?C:C.next}}C=C.next}while(C!==_);if(!b)return null;if(P===$)return b;var J,ee=b,de=b.x,he=b.y,be=1/0;C=b;do{P>=C.x&&C.x>=de&&P!==C.x&&Ga(V<he?P:$,V,de,he,V<he?$:P,V,C.x,C.y)&&(J=Math.abs(V-C.y)/(P-C.x),jl(C,y)&&(J<be||J===be&&(C.x>b.x||C.x===b.x&&Ru(b,C)))&&(b=C,be=J)),C=C.next}while(C!==ee);return b}(i,t);if(!s)return t;var u=Rs(s,i),d=Ls(s,s.next);return Ls(u,u.next),t===s?d:t}function Ru(i,t){return Lr(i.prev,i,t.prev)<0&&Lr(t.next,i,i.next)<0}function Ul(i,t,s,u,d){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=32767*(i-s)*d)|i<<8))|i<<4))|i<<2))|i<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-u)*d)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Nh(i){var t=i,s=i;do{(t.x<s.x||t.x===s.x&&t.y<s.y)&&(s=t),t=t.next}while(t!==i);return s}function Ga(i,t,s,u,d,y,_,b){return(d-_)*(t-b)-(i-_)*(y-b)>=0&&(i-_)*(u-b)-(s-_)*(t-b)>=0&&(s-_)*(y-b)-(d-_)*(u-b)>=0}function Bh(i,t){return i.next.i!==t.i&&i.prev.i!==t.i&&!function(s,u){var d=s;do{if(d.i!==s.i&&d.next.i!==s.i&&d.i!==u.i&&d.next.i!==u.i&&Vh(d,d.next,s,u))return!0;d=d.next}while(d!==s);return!1}(i,t)&&(jl(i,t)&&jl(t,i)&&function(s,u){var d=s,y=!1,_=(s.x+u.x)/2,b=(s.y+u.y)/2;do{d.y>b!=d.next.y>b&&d.next.y!==d.y&&_<(d.next.x-d.x)*(b-d.y)/(d.next.y-d.y)+d.x&&(y=!y),d=d.next}while(d!==s);return y}(i,t)&&(Lr(i.prev,i,t.prev)||Lr(i,t.prev,t))||Ou(i,t)&&Lr(i.prev,i,i.next)>0&&Lr(t.prev,t,t.next)>0)}function Lr(i,t,s){return(t.y-i.y)*(s.x-t.x)-(t.x-i.x)*(s.y-t.y)}function Ou(i,t){return i.x===t.x&&i.y===t.y}function Vh(i,t,s,u){var d=Nu(Lr(i,t,s)),y=Nu(Lr(i,t,u)),_=Nu(Lr(s,u,i)),b=Nu(Lr(s,u,t));return d!==y&&_!==b||!(0!==d||!zu(i,s,t))||!(0!==y||!zu(i,u,t))||!(0!==_||!zu(s,i,u))||!(0!==b||!zu(s,t,u))}function zu(i,t,s){return t.x<=Math.max(i.x,s.x)&&t.x>=Math.min(i.x,s.x)&&t.y<=Math.max(i.y,s.y)&&t.y>=Math.min(i.y,s.y)}function Nu(i){return i>0?1:i<0?-1:0}function jl(i,t){return Lr(i.prev,i,i.next)<0?Lr(i,t,i.next)>=0&&Lr(i,i.prev,t)>=0:Lr(i,t,i.prev)<0||Lr(i,i.next,t)<0}function Rs(i,t){var s=new Uh(i.i,i.x,i.y),u=new Uh(t.i,t.x,t.y),d=i.next,y=t.prev;return i.next=t,t.prev=i,s.next=d,d.prev=s,u.next=s,s.prev=u,y.next=u,u.prev=y,u}function fl(i,t,s,u){var d=new Uh(i,t,s);return u?(d.next=u.next,d.prev=u,u.next.prev=d,u.next=d):(d.prev=d,d.next=d),d}function $l(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function Uh(i,t,s){this.i=i,this.x=t,this.y=s,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function jh(i,t,s,u){for(var d=0,y=t,_=s-u;y<s;y+=u)d+=(i[_]-i[y])*(i[y+1]+i[_+1]),_=y;return d}Rc.exports=Vl,Rc.exports.default=Vl,Vl.deviation=function(i,t,s,u){var d=t&&t.length,y=Math.abs(jh(i,0,d?t[0]*s:i.length,s));if(d)for(var _=0,b=t.length;_<b;_++)y-=Math.abs(jh(i,t[_]*s,_<b-1?t[_+1]*s:i.length,s));var C=0;for(_=0;_<u.length;_+=3){var P=u[_]*s,V=u[_+1]*s,$=u[_+2]*s;C+=Math.abs((i[P]-i[$])*(i[V+1]-i[P+1])-(i[P]-i[V])*(i[$+1]-i[P+1]))}return 0===y&&0===C?0:Math.abs((C-y)/y)},Vl.flatten=function(i){for(var t=i[0][0].length,s={vertices:[],holes:[],dimensions:t},u=0,d=0;d<i.length;d++){for(var y=0;y<i[d].length;y++)for(var _=0;_<t;_++)s.vertices.push(i[d][y][_]);d>0&&s.holes.push(u+=i[d-1].length)}return s};var vp=Rc.exports;function Sm(i,t,s,u,d){xp(i,t,s||0,u||i.length-1,d||bp)}function xp(i,t,s,u,d){for(;u>s;){if(u-s>600){var y=u-s+1,_=t-s+1,b=Math.log(y),C=.5*Math.exp(2*b/3),P=.5*Math.sqrt(b*C*(y-C)/y)*(_-y/2<0?-1:1);xp(i,t,Math.max(s,Math.floor(t-_*C/y+P)),Math.min(u,Math.floor(t+(y-_)*C/y+P)),d)}var V=i[t],$=s,Z=u;for(ml(i,s,t),d(i[u],V)>0&&ml(i,s,u);$<Z;){for(ml(i,$,Z),$++,Z--;d(i[$],V)<0;)$++;for(;d(i[Z],V)>0;)Z--}0===d(i[s],V)?ml(i,s,Z):ml(i,++Z,u),Z<=t&&(s=Z+1),t<=Z&&(u=Z-1)}}function ml(i,t,s){var u=i[t];i[t]=i[s],i[s]=u}function bp(i,t){return i<t?-1:i>t?1:0}function zc(i,t){const s=i.length;if(s<=1)return[i];const u=[];let d,y;for(let _=0;_<s;_++){const b=Fn(i[_]);0!==b&&(i[_].area=Math.abs(b),void 0===y&&(y=b<0),y===b<0?(d&&u.push(d),d=[i[_]]):d.push(i[_]))}if(d&&u.push(d),t>1)for(let _=0;_<u.length;_++)u[_].length<=t||(Sm(u[_],t,1,u[_].length-1,wp),u[_]=u[_].slice(0,t));return u}function wp(i,t){return t.area-i.area}function Nc(i,t,s){const u=s.patternDependencies;let d=!1;for(const y of t){const _=y.paint.get(`${i}-pattern`);_.isConstant()||(d=!0);const b=_.constantOr(null);b&&(d=!0,u[b.to]=!0,u[b.from]=!0)}return d}function $h(i,t,s,u,d){const y=d.patternDependencies;for(const _ of t){const b=_.paint.get(`${i}-pattern`).value;if("constant"!==b.kind){let C=b.evaluate({zoom:u-1},s,{},d.availableImages),P=b.evaluate({zoom:u},s,{},d.availableImages),V=b.evaluate({zoom:u+1},s,{},d.availableImages);C=C&&C.name?C.name:C,P=P&&P.name?P.name:P,V=V&&V.name?V.name:V,y[C]=!0,y[P]=!0,y[V]=!0,s.patterns[_.id]={min:C,mid:P,max:V}}}return s}class Bc{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(s=>s.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Ln,this.indexArray=new Qi,this.indexArray2=new Zo,this.programConfigurations=new ks(t.layers,t.zoom),this.segments=new Rn,this.segments2=new Rn,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(t,s,u){this.hasPattern=Nc("fill",this.layers,s);const d=this.layers[0].layout.get("fill-sort-key"),y=!d.isConstant(),_=[];for(const{feature:b,id:C,index:P,sourceLayerIndex:V}of t){const $=this.layers[0]._featureFilter.needGeometry,Z=Na(b,$);if(!this.layers[0]._featureFilter.filter(new yr(this.zoom),Z,u))continue;const J=y?d.evaluate(Z,{},u,s.availableImages):void 0,ee={id:C,properties:b.properties,type:b.type,sourceLayerIndex:V,index:P,geometry:$?Z.geometry:za(b),patterns:{},sortKey:J};_.push(ee)}y&&_.sort((b,C)=>b.sortKey-C.sortKey);for(const b of _){const{geometry:C,index:P,sourceLayerIndex:V}=b;if(this.hasPattern){const $=$h("fill",this.layers,b,this.zoom,s);this.patternFeatures.push($)}else this.addFeature(b,C,P,u,{});s.featureIndex.insert(t[P].feature,C,P,V,this.index)}}update(t,s,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,s,this.stateDependentLayers,u)}addFeatures(t,s,u){for(const d of this.patternFeatures)this.addFeature(d,d.geometry,d.index,s,u)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,zh),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,s,u,d,y){for(const _ of zc(s,500)){let b=0;for(const J of _)b+=J.length;const C=this.segments.prepareSegment(b,this.layoutVertexArray,this.indexArray),P=C.vertexLength,V=[],$=[];for(const J of _){if(0===J.length)continue;J!==_[0]&&$.push(V.length/2);const ee=this.segments2.prepareSegment(J.length,this.layoutVertexArray,this.indexArray2),de=ee.vertexLength;this.layoutVertexArray.emplaceBack(J[0].x,J[0].y),this.indexArray2.emplaceBack(de+J.length-1,de),V.push(J[0].x),V.push(J[0].y);for(let he=1;he<J.length;he++)this.layoutVertexArray.emplaceBack(J[he].x,J[he].y),this.indexArray2.emplaceBack(de+he-1,de+he),V.push(J[he].x),V.push(J[he].y);ee.vertexLength+=J.length,ee.primitiveLength+=J.length}const Z=vp(V,$);for(let J=0;J<Z.length;J+=3)this.indexArray.emplaceBack(P+Z[J],P+Z[J+1],P+Z[J+2]);C.vertexLength+=b,C.primitiveLength+=Z.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,u,y,d)}}Pt("FillBucket",Bc,{omit:["layers","patternFeatures"]});const Bu=new Cr({"fill-sort-key":new Kt(pe.layout_fill["fill-sort-key"])});var Gh={paint:new Cr({"fill-antialias":new zt(pe.paint_fill["fill-antialias"]),"fill-opacity":new Kt(pe.paint_fill["fill-opacity"]),"fill-color":new Kt(pe.paint_fill["fill-color"]),"fill-outline-color":new Kt(pe.paint_fill["fill-outline-color"]),"fill-translate":new zt(pe.paint_fill["fill-translate"]),"fill-translate-anchor":new zt(pe.paint_fill["fill-translate-anchor"]),"fill-pattern":new us(pe.paint_fill["fill-pattern"])}),layout:Bu};const ps=$r([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),{members:Gl}=ps;var Os={},Hh=_e,Vc=Hl;function Hl(i,t,s,u,d){this.properties={},this.extent=s,this.type=0,this._pbf=i,this._geometry=-1,this._keys=u,this._values=d,i.readFields(Am,this,t)}function Am(i,t,s){1==i?t.id=s.readVarint():2==i?function(u,d){for(var y=u.readVarint()+u.pos;u.pos<y;){var _=d._keys[u.readVarint()],b=d._values[u.readVarint()];d.properties[_]=b}}(s,t):3==i?t.type=s.readVarint():4==i&&(t._geometry=s.pos)}function Tm(i){for(var t,s,u=0,d=0,y=i.length,_=y-1;d<y;_=d++)u+=((s=i[_]).x-(t=i[d]).x)*(t.y+s.y);return u}Hl.types=["Unknown","Point","LineString","Polygon"],Hl.prototype.loadGeometry=function(){var i=this._pbf;i.pos=this._geometry;for(var t,s=i.readVarint()+i.pos,u=1,d=0,y=0,_=0,b=[];i.pos<s;){if(d<=0){var C=i.readVarint();u=7&C,d=C>>3}if(d--,1===u||2===u)y+=i.readSVarint(),_+=i.readSVarint(),1===u&&(t&&b.push(t),t=[]),t.push(new Hh(y,_));else{if(7!==u)throw new Error("unknown command "+u);t&&t.push(t[0].clone())}}return t&&b.push(t),b},Hl.prototype.bbox=function(){var i=this._pbf;i.pos=this._geometry;for(var t=i.readVarint()+i.pos,s=1,u=0,d=0,y=0,_=1/0,b=-1/0,C=1/0,P=-1/0;i.pos<t;){if(u<=0){var V=i.readVarint();s=7&V,u=V>>3}if(u--,1===s||2===s)(d+=i.readSVarint())<_&&(_=d),d>b&&(b=d),(y+=i.readSVarint())<C&&(C=y),y>P&&(P=y);else if(7!==s)throw new Error("unknown command "+s)}return[_,C,b,P]},Hl.prototype.toGeoJSON=function(i,t,s){var u,d,y=this.extent*Math.pow(2,s),_=this.extent*i,b=this.extent*t,C=this.loadGeometry(),P=Hl.types[this.type];function V(J){for(var ee=0;ee<J.length;ee++){var de=J[ee];J[ee]=[360*(de.x+_)/y-180,360/Math.PI*Math.atan(Math.exp((180-360*(de.y+b)/y)*Math.PI/180))-90]}}switch(this.type){case 1:var $=[];for(u=0;u<C.length;u++)$[u]=C[u][0];V(C=$);break;case 2:for(u=0;u<C.length;u++)V(C[u]);break;case 3:for(C=function(J){var ee=J.length;if(ee<=1)return[J];for(var de,he,be=[],Le=0;Le<ee;Le++){var Fe=Tm(J[Le]);0!==Fe&&(void 0===he&&(he=Fe<0),he===Fe<0?(de&&be.push(de),de=[J[Le]]):de.push(J[Le]))}return de&&be.push(de),be}(C),u=0;u<C.length;u++)for(d=0;d<C[u].length;d++)V(C[u][d])}1===C.length?C=C[0]:P="Multi"+P;var Z={type:"Feature",geometry:{type:P,coordinates:C},properties:this.properties};return"id"in this&&(Z.id=this.id),Z};var Uc=Vc,Vu=Uu;function Uu(i,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(Pm,this,t),this.length=this._features.length}function Pm(i,t,s){15===i?t.version=s.readVarint():1===i?t.name=s.readString():5===i?t.extent=s.readVarint():2===i?t._features.push(s.pos):3===i?t._keys.push(s.readString()):4===i&&t._values.push(function(u){for(var d=null,y=u.readVarint()+u.pos;u.pos<y;){var _=u.readVarint()>>3;d=1===_?u.readString():2===_?u.readFloat():3===_?u.readDouble():4===_?u.readVarint64():5===_?u.readVarint():6===_?u.readSVarint():7===_?u.readBoolean():null}return d}(s))}Uu.prototype.feature=function(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];var t=this._pbf.readVarint()+this._pbf.pos;return new Uc(this._pbf,t,this.extent,this._keys,this._values)};var Fm=Vu;function qh(i,t,s){if(3===i){var u=new Fm(s,s.readVarint()+s.pos);u.length&&(t[u.name]=u)}}Os.VectorTile=function(i,t){this.layers=i.readFields(qh,{},t)},Os.VectorTileFeature=Vc,Os.VectorTileLayer=Vu;const Dp=Os.VectorTileFeature.types,jc=Math.pow(2,13);function ql(i,t,s,u,d,y,_,b){i.emplaceBack(t,s,2*Math.floor(u*jc)+_,d*jc*2,y*jc*2,Math.round(b))}class $c{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(s=>s.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new pn,this.indexArray=new Qi,this.programConfigurations=new ks(t.layers,t.zoom),this.segments=new Rn,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(t,s,u){this.features=[],this.hasPattern=Nc("fill-extrusion",this.layers,s);for(const{feature:d,id:y,index:_,sourceLayerIndex:b}of t){const C=this.layers[0]._featureFilter.needGeometry,P=Na(d,C);if(!this.layers[0]._featureFilter.filter(new yr(this.zoom),P,u))continue;const V={id:y,sourceLayerIndex:b,index:_,geometry:C?P.geometry:za(d),properties:d.properties,type:d.type,patterns:{}};this.hasPattern?this.features.push($h("fill-extrusion",this.layers,V,this.zoom,s)):this.addFeature(V,V.geometry,_,u,{}),s.featureIndex.insert(d,V.geometry,_,b,this.index,!0)}}addFeatures(t,s,u){for(const d of this.features){const{geometry:y}=d;this.addFeature(d,y,d.index,s,u)}}update(t,s,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,s,this.stateDependentLayers,u)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Gl),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,s,u,d,y){for(const _ of zc(s,500)){let b=0;for(const J of _)b+=J.length;let C=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const J of _){if(0===J.length||((i=J).every(t=>t.x<0)||i.every(t=>t.x>Pr)||i.every(t=>t.y<0)||i.every(t=>t.y>Pr)))continue;let ee=0;for(let de=0;de<J.length;de++){const he=J[de];if(de>=1){const be=J[de-1];if(!Zh(he,be)){C.vertexLength+4>Rn.MAX_VERTEX_ARRAY_LENGTH&&(C=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const Le=he.sub(be)._perp()._unit(),Fe=be.dist(he);ee+Fe>32768&&(ee=0),ql(this.layoutVertexArray,he.x,he.y,Le.x,Le.y,0,0,ee),ql(this.layoutVertexArray,he.x,he.y,Le.x,Le.y,0,1,ee),ee+=Fe,ql(this.layoutVertexArray,be.x,be.y,Le.x,Le.y,0,0,ee),ql(this.layoutVertexArray,be.x,be.y,Le.x,Le.y,0,1,ee);const Ve=C.vertexLength;this.indexArray.emplaceBack(Ve,Ve+2,Ve+1),this.indexArray.emplaceBack(Ve+1,Ve+2,Ve+3),C.vertexLength+=4,C.primitiveLength+=2}}}}if(C.vertexLength+b>Rn.MAX_VERTEX_ARRAY_LENGTH&&(C=this.segments.prepareSegment(b,this.layoutVertexArray,this.indexArray)),"Polygon"!==Dp[t.type])continue;const P=[],V=[],$=C.vertexLength;for(const J of _)if(0!==J.length){J!==_[0]&&V.push(P.length/2);for(let ee=0;ee<J.length;ee++){const de=J[ee];ql(this.layoutVertexArray,de.x,de.y,0,0,1,1,0),P.push(de.x),P.push(de.y)}}const Z=vp(P,V);for(let J=0;J<Z.length;J+=3)this.indexArray.emplaceBack($+Z[J],$+Z[J+2],$+Z[J+1]);C.primitiveLength+=Z.length/3,C.vertexLength+=b}var i;this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,u,y,d)}}function Zh(i,t){return i.x===t.x&&(i.x<0||i.x>Pr)||i.y===t.y&&(i.y<0||i.y>Pr)}Pt("FillExtrusionBucket",$c,{omit:["layers","features"]});var Cp={paint:new Cr({"fill-extrusion-opacity":new zt(pe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Kt(pe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new zt(pe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new zt(pe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new us(pe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Kt(pe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Kt(pe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new zt(pe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function Ha(i,t){return i.x*t.x+i.y*t.y}function Wh(i,t){if(1===i.length){let s=0;const u=t[s++];let d;for(;!d||u.equals(d);)if(d=t[s++],!d)return 1/0;for(;s<t.length;s++){const y=t[s],_=i[0],b=d.sub(u),C=y.sub(u),P=_.sub(u),V=Ha(b,b),$=Ha(b,C),Z=Ha(C,C),J=Ha(P,b),ee=Ha(P,C),de=V*Z-$*$,he=(Z*J-$*ee)/de,be=(V*ee-$*J)/de,Le=u.z*(1-he-be)+d.z*he+y.z*be;if(isFinite(Le))return Le}return 1/0}{let s=1/0;for(const u of t)s=Math.min(s,u.z);return s}}const ii=$r([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Ep}=ii,Mp=$r([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:Yh}=Mp,Kh=Os.VectorTileFeature.types,Ip=Math.cos(Math.PI/180*37.5),Xh=Math.pow(2,14)/.5;class Gc{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(s=>s.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(s=>{this.gradients[s.id]={}}),this.layoutVertexArray=new _n,this.layoutVertexArray2=new Gn,this.indexArray=new Qi,this.programConfigurations=new ks(t.layers,t.zoom),this.segments=new Rn,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(t,s,u){this.hasPattern=Nc("line",this.layers,s);const d=this.layers[0].layout.get("line-sort-key"),y=!d.isConstant(),_=[];for(const{feature:b,id:C,index:P,sourceLayerIndex:V}of t){const $=this.layers[0]._featureFilter.needGeometry,Z=Na(b,$);if(!this.layers[0]._featureFilter.filter(new yr(this.zoom),Z,u))continue;const J=y?d.evaluate(Z,{},u):void 0,ee={id:C,properties:b.properties,type:b.type,sourceLayerIndex:V,index:P,geometry:$?Z.geometry:za(b),patterns:{},sortKey:J};_.push(ee)}y&&_.sort((b,C)=>b.sortKey-C.sortKey);for(const b of _){const{geometry:C,index:P,sourceLayerIndex:V}=b;if(this.hasPattern){const $=$h("line",this.layers,b,this.zoom,s);this.patternFeatures.push($)}else this.addFeature(b,C,P,u,{});s.featureIndex.insert(t[P].feature,C,P,V,this.index)}}update(t,s,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,s,this.stateDependentLayers,u)}addFeatures(t,s,u){for(const d of this.patternFeatures)this.addFeature(d,d.geometry,d.index,s,u)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,Yh)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Ep),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,s,u,d,y){const _=this.layers[0].layout,b=_.get("line-join").evaluate(t,{}),C=_.get("line-cap"),P=_.get("line-miter-limit"),V=_.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const $ of s)this.addLine($,t,b,C,P,V);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,u,y,d)}addLine(t,s,u,d,y,_){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let be=0;be<t.length-1;be++)this.totalDistance+=t[be].dist(t[be+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const b="Polygon"===Kh[s.type];let C=t.length;for(;C>=2&&t[C-1].equals(t[C-2]);)C--;let P=0;for(;P<C-1&&t[P].equals(t[P+1]);)P++;if(C<(b?3:2))return;"bevel"===u&&(y=1.05);const V=this.overscaling<=16?122880/(512*this.overscaling):0,$=this.segments.prepareSegment(10*C,this.layoutVertexArray,this.indexArray);let Z,J,ee,de,he;this.e1=this.e2=-1,b&&(Z=t[C-2],he=t[P].sub(Z)._unit()._perp());for(let be=P;be<C;be++){if(ee=be===C-1?b?t[P+1]:void 0:t[be+1],ee&&t[be].equals(ee))continue;he&&(de=he),Z&&(J=Z),Z=t[be],he=ee?ee.sub(Z)._unit()._perp():de,de=de||he;let Le=de.add(he);0===Le.x&&0===Le.y||Le._unit();const Fe=de.x*he.x+de.y*he.y,Ve=Le.x*he.x+Le.y*he.y,Ye=0!==Ve?1/Ve:1/0,He=2*Math.sqrt(2-2*Ve),Tt=Ve<Ip&&J&&ee,$t=de.x*he.y-de.y*he.x>0;if(Tt&&be>P){const lt=Z.dist(J);if(lt>2*V){const Ft=Z.sub(Z.sub(J)._mult(V/lt)._round());this.updateDistance(J,Ft),this.addCurrentVertex(Ft,de,0,0,$),J=Ft}}const ft=J&&ee;let wt=ft?u:b?"butt":d;if(ft&&"round"===wt&&(Ye<_?wt="miter":Ye<=2&&(wt="fakeround")),"miter"===wt&&Ye>y&&(wt="bevel"),"bevel"===wt&&(Ye>2&&(wt="flipbevel"),Ye<y&&(wt="miter")),J&&this.updateDistance(J,Z),"miter"===wt)Le._mult(Ye),this.addCurrentVertex(Z,Le,0,0,$);else if("flipbevel"===wt){if(Ye>100)Le=he.mult(-1);else{const lt=Ye*de.add(he).mag()/de.sub(he).mag();Le._perp()._mult(lt*($t?-1:1))}this.addCurrentVertex(Z,Le,0,0,$),this.addCurrentVertex(Z,Le.mult(-1),0,0,$)}else if("bevel"===wt||"fakeround"===wt){const lt=-Math.sqrt(Ye*Ye-1),Ft=$t?lt:0,Dt=$t?0:lt;if(J&&this.addCurrentVertex(Z,de,Ft,Dt,$),"fakeround"===wt){const rt=Math.round(180*He/Math.PI/20);for(let qt=1;qt<rt;qt++){let Zt=qt/rt;if(.5!==Zt){const Xn=Zt-.5;Zt+=Zt*Xn*(Zt-1)*((1.0904+Fe*(Fe*(3.55645-1.43519*Fe)-3.2452))*Xn*Xn+(.848013+Fe*(.215638*Fe-1.06021)))}const On=he.sub(de)._mult(Zt)._add(de)._unit()._mult($t?-1:1);this.addHalfVertex(Z,On.x,On.y,!1,$t,0,$)}}ee&&this.addCurrentVertex(Z,he,-Ft,-Dt,$)}else if("butt"===wt)this.addCurrentVertex(Z,Le,0,0,$);else if("square"===wt){const lt=J?1:-1;this.addCurrentVertex(Z,Le,lt,lt,$)}else"round"===wt&&(J&&(this.addCurrentVertex(Z,de,0,0,$),this.addCurrentVertex(Z,de,1,1,$,!0)),ee&&(this.addCurrentVertex(Z,he,-1,-1,$,!0),this.addCurrentVertex(Z,he,0,0,$)));if(Tt&&be<C-1){const lt=Z.dist(ee);if(lt>2*V){const Ft=Z.add(ee.sub(Z)._mult(V/lt)._round());this.updateDistance(Z,Ft),this.addCurrentVertex(Ft,he,0,0,$),Z=Ft}}}}addCurrentVertex(t,s,u,d,y,_=!1){const b=s.y*d-s.x,C=-s.y-s.x*d;this.addHalfVertex(t,s.x+s.y*u,s.y-s.x*u,_,!1,u,y),this.addHalfVertex(t,b,C,_,!0,-d,y),this.distance>Xh/2&&0===this.totalDistance&&(this.distance=0,this.addCurrentVertex(t,s,u,d,y,_))}addHalfVertex({x:t,y:s},u,d,y,_,b,C){const P=.5*(this.lineClips?this.scaledDistance*(Xh-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t<<1)+(y?1:0),(s<<1)+(_?1:0),Math.round(63*u)+128,Math.round(63*d)+128,1+(0===b?0:b<0?-1:1)|(63&P)<<2,P>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const V=C.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,V),C.primitiveLength++),_?this.e2=V:this.e1=V}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(t,s){this.distance+=t.dist(s),this.updateScaledDistance()}}Pt("LineBucket",Gc,{omit:["layers","patternFeatures"]});const Sp=new Cr({"line-cap":new zt(pe.layout_line["line-cap"]),"line-join":new Kt(pe.layout_line["line-join"]),"line-miter-limit":new zt(pe.layout_line["line-miter-limit"]),"line-round-limit":new zt(pe.layout_line["line-round-limit"]),"line-sort-key":new Kt(pe.layout_line["line-sort-key"])});var Jh={paint:new Cr({"line-opacity":new Kt(pe.paint_line["line-opacity"]),"line-color":new Kt(pe.paint_line["line-color"]),"line-translate":new zt(pe.paint_line["line-translate"]),"line-translate-anchor":new zt(pe.paint_line["line-translate-anchor"]),"line-width":new Kt(pe.paint_line["line-width"]),"line-gap-width":new Kt(pe.paint_line["line-gap-width"]),"line-offset":new Kt(pe.paint_line["line-offset"]),"line-blur":new Kt(pe.paint_line["line-blur"]),"line-dasharray":new pa(pe.paint_line["line-dasharray"]),"line-pattern":new us(pe.paint_line["line-pattern"]),"line-gradient":new il(pe.paint_line["line-gradient"])}),layout:Sp};const Ap=new class extends Kt{possiblyEvaluate(i,t){return t=new yr(Math.floor(t.zoom),{now:t.now,fadeDuration:t.fadeDuration,zoomHistory:t.zoomHistory,transition:t.transition}),super.possiblyEvaluate(i,t)}evaluate(i,t,s,u){return t=Ze({},t,{zoom:Math.floor(t.zoom)}),super.evaluate(i,t,s,u)}}(Jh.paint.properties["line-width"].specification);function Tp(i,t){return t>0?t+2*i:i}Ap.useIntegerZoom=!0;const Zl=$r([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Hc=$r([{name:"a_projected_pos",components:3,type:"Float32"}],4);$r([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Pp=$r([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);$r([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const $u=$r([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Wl=$r([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Fp(i,t,s){return i.sections.forEach(u=>{u.text=function(d,y,_){const b=y.layout.get("text-transform").evaluate(_,{});return"uppercase"===b?d=d.toLocaleUpperCase():"lowercase"===b&&(d=d.toLocaleLowerCase()),wi.applyArabicShaping&&(d=wi.applyArabicShaping(d)),d}(u.text,t,s)}),i}$r([{name:"triangle",components:3,type:"Uint16"}]),$r([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),$r([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),$r([{type:"Float32",name:"offsetX"}]),$r([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);const Yl={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42"};var Gu=or,Qh=function(i,t,s,u,d){var y,_,b=8*d-u-1,C=(1<<b)-1,P=C>>1,V=-7,$=s?d-1:0,Z=s?-1:1,J=i[t+$];for($+=Z,y=J&(1<<-V)-1,J>>=-V,V+=b;V>0;y=256*y+i[t+$],$+=Z,V-=8);for(_=y&(1<<-V)-1,y>>=-V,V+=u;V>0;_=256*_+i[t+$],$+=Z,V-=8);if(0===y)y=1-P;else{if(y===C)return _?NaN:1/0*(J?-1:1);_+=Math.pow(2,u),y-=P}return(J?-1:1)*_*Math.pow(2,y-u)},ed=function(i,t,s,u,d,y){var _,b,C,P=8*y-d-1,V=(1<<P)-1,$=V>>1,Z=23===d?Math.pow(2,-24)-Math.pow(2,-77):0,J=u?0:y-1,ee=u?1:-1,de=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(b=isNaN(t)?1:0,_=V):(_=Math.floor(Math.log(t)/Math.LN2),t*(C=Math.pow(2,-_))<1&&(_--,C*=2),(t+=_+$>=1?Z/C:Z*Math.pow(2,1-$))*C>=2&&(_++,C/=2),_+$>=V?(b=0,_=V):_+$>=1?(b=(t*C-1)*Math.pow(2,d),_+=$):(b=t*Math.pow(2,$-1)*Math.pow(2,d),_=0));d>=8;i[s+J]=255&b,J+=ee,b/=256,d-=8);for(_=_<<d|b,P+=d;P>0;i[s+J]=255&_,J+=ee,_/=256,P-=8);i[s+J-ee]|=128*de};function or(i){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(i)?i:new Uint8Array(i||0),this.pos=0,this.type=0,this.length=this.buf.length}or.Varint=0,or.Fixed64=1,or.Bytes=2,or.Fixed32=5;var ya,Kl=4294967296,td=1/Kl,nd=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function zs(i){return i.type===or.Bytes?i.readVarint()+i.pos:i.pos+1}function rd(i,t,s){var u=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));s.realloc(u);for(var d=s.pos-1;d>=i;d--)s.buf[d+u]=s.buf[d]}function kp(i,t){for(var s=0;s<i.length;s++)t.writeVarint(i[s])}function to(i,t){for(var s=0;s<i.length;s++)t.writeSVarint(i[s])}function qc(i,t){for(var s=0;s<i.length;s++)t.writeFloat(i[s])}function id(i,t){for(var s=0;s<i.length;s++)t.writeDouble(i[s])}function Zc(i,t){for(var s=0;s<i.length;s++)t.writeBoolean(i[s])}function Ni(i,t){for(var s=0;s<i.length;s++)t.writeFixed32(i[s])}function Xl(i,t){for(var s=0;s<i.length;s++)t.writeSFixed32(i[s])}function Wc(i,t){for(var s=0;s<i.length;s++)t.writeFixed64(i[s])}function Lp(i,t){for(var s=0;s<i.length;s++)t.writeSFixed64(i[s])}function Hu(i,t){return(i[t]|i[t+1]<<8|i[t+2]<<16)+16777216*i[t+3]}function Za(i,t,s){i[s]=t,i[s+1]=t>>>8,i[s+2]=t>>>16,i[s+3]=t>>>24}function od(i,t){return(i[t]|i[t+1]<<8|i[t+2]<<16)+(i[t+3]<<24)}function sd(i,t,s){1===i&&s.readMessage(Rp,t)}function Rp(i,t,s){if(3===i){const{id:u,bitmap:d,width:y,height:_,left:b,top:C,advance:P}=s.readMessage(ad,{});t.push({id:u,bitmap:new Pu({width:y+6,height:_+6},d),metrics:{width:y,height:_,left:b,top:C,advance:P}})}}function ad(i,t,s){1===i?t.id=s.readVarint():2===i?t.bitmap=s.readBytes():3===i?t.width=s.readVarint():4===i?t.height=s.readVarint():5===i?t.left=s.readSVarint():6===i?t.top=s.readSVarint():7===i&&(t.advance=s.readVarint())}function ld(i){let t=0,s=0;for(const _ of i)t+=_.w*_.h,s=Math.max(s,_.w);i.sort((_,b)=>b.h-_.h);const u=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),s),h:1/0}];let d=0,y=0;for(const _ of i)for(let b=u.length-1;b>=0;b--){const C=u[b];if(!(_.w>C.w||_.h>C.h)){if(_.x=C.x,_.y=C.y,y=Math.max(y,_.y+_.h),d=Math.max(d,_.x+_.w),_.w===C.w&&_.h===C.h){const P=u.pop();b<u.length&&(u[b]=P)}else _.h===C.h?(C.x+=_.w,C.w-=_.w):_.w===C.w?(C.y+=_.h,C.h-=_.h):(u.push({x:C.x+_.w,y:C.y,w:C.w-_.w,h:_.h}),C.y+=_.h,C.h-=_.h);break}}return{w:d,h:y,fill:t/(d*y)||0}}or.prototype={destroy:function(){this.buf=null},readFields:function(i,t,s){for(s=s||this.length;this.pos<s;){var u=this.readVarint(),d=u>>3,y=this.pos;this.type=7&u,i(d,t,this),this.pos===y&&this.skip(u)}return t},readMessage:function(i,t){return this.readFields(i,t,this.readVarint()+this.pos)},readFixed32:function(){var i=Hu(this.buf,this.pos);return this.pos+=4,i},readSFixed32:function(){var i=od(this.buf,this.pos);return this.pos+=4,i},readFixed64:function(){var i=Hu(this.buf,this.pos)+Hu(this.buf,this.pos+4)*Kl;return this.pos+=8,i},readSFixed64:function(){var i=Hu(this.buf,this.pos)+od(this.buf,this.pos+4)*Kl;return this.pos+=8,i},readFloat:function(){var i=Qh(this.buf,this.pos,!0,23,4);return this.pos+=4,i},readDouble:function(){var i=Qh(this.buf,this.pos,!0,52,8);return this.pos+=8,i},readVarint:function(i){var t,s,u=this.buf;return t=127&(s=u[this.pos++]),s<128?t:(t|=(127&(s=u[this.pos++]))<<7,s<128?t:(t|=(127&(s=u[this.pos++]))<<14,s<128?t:(t|=(127&(s=u[this.pos++]))<<21,s<128?t:function(d,y,_){var b,C,P=_.buf;if(b=(112&(C=P[_.pos++]))>>4,C<128||(b|=(127&(C=P[_.pos++]))<<3,C<128)||(b|=(127&(C=P[_.pos++]))<<10,C<128)||(b|=(127&(C=P[_.pos++]))<<17,C<128)||(b|=(127&(C=P[_.pos++]))<<24,C<128)||(b|=(1&(C=P[_.pos++]))<<31,C<128))return function qa(i,t,s){return s?4294967296*t+(i>>>0):4294967296*(t>>>0)+(i>>>0)}(d,b,y);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(s=u[this.pos]))<<28,i,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var i=this.readVarint();return i%2==1?(i+1)/-2:i/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var i=this.readVarint()+this.pos,t=this.pos;return this.pos=i,i-t>=12&&nd?nd.decode(this.buf.subarray(t,i)):function(s,u,d){for(var y="",_=u;_<d;){var b,C,P,V=s[_],$=null,Z=V>239?4:V>223?3:V>191?2:1;if(_+Z>d)break;1===Z?V<128&&($=V):2===Z?128==(192&(b=s[_+1]))&&($=(31&V)<<6|63&b)<=127&&($=null):3===Z?(C=s[_+2],128==(192&(b=s[_+1]))&&128==(192&C)&&(($=(15&V)<<12|(63&b)<<6|63&C)<=2047||$>=55296&&$<=57343)&&($=null)):4===Z&&(C=s[_+2],P=s[_+3],128==(192&(b=s[_+1]))&&128==(192&C)&&128==(192&P)&&(($=(15&V)<<18|(63&b)<<12|(63&C)<<6|63&P)<=65535||$>=1114112)&&($=null)),null===$?($=65533,Z=1):$>65535&&($-=65536,y+=String.fromCharCode($>>>10&1023|55296),$=56320|1023&$),y+=String.fromCharCode($),_+=Z}return y}(this.buf,t,i)},readBytes:function(){var i=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,i);return this.pos=i,t},readPackedVarint:function(i,t){if(this.type!==or.Bytes)return i.push(this.readVarint(t));var s=zs(this);for(i=i||[];this.pos<s;)i.push(this.readVarint(t));return i},readPackedSVarint:function(i){if(this.type!==or.Bytes)return i.push(this.readSVarint());var t=zs(this);for(i=i||[];this.pos<t;)i.push(this.readSVarint());return i},readPackedBoolean:function(i){if(this.type!==or.Bytes)return i.push(this.readBoolean());var t=zs(this);for(i=i||[];this.pos<t;)i.push(this.readBoolean());return i},readPackedFloat:function(i){if(this.type!==or.Bytes)return i.push(this.readFloat());var t=zs(this);for(i=i||[];this.pos<t;)i.push(this.readFloat());return i},readPackedDouble:function(i){if(this.type!==or.Bytes)return i.push(this.readDouble());var t=zs(this);for(i=i||[];this.pos<t;)i.push(this.readDouble());return i},readPackedFixed32:function(i){if(this.type!==or.Bytes)return i.push(this.readFixed32());var t=zs(this);for(i=i||[];this.pos<t;)i.push(this.readFixed32());return i},readPackedSFixed32:function(i){if(this.type!==or.Bytes)return i.push(this.readSFixed32());var t=zs(this);for(i=i||[];this.pos<t;)i.push(this.readSFixed32());return i},readPackedFixed64:function(i){if(this.type!==or.Bytes)return i.push(this.readFixed64());var t=zs(this);for(i=i||[];this.pos<t;)i.push(this.readFixed64());return i},readPackedSFixed64:function(i){if(this.type!==or.Bytes)return i.push(this.readSFixed64());var t=zs(this);for(i=i||[];this.pos<t;)i.push(this.readSFixed64());return i},skip:function(i){var t=7&i;if(t===or.Varint)for(;this.buf[this.pos++]>127;);else if(t===or.Bytes)this.pos=this.readVarint()+this.pos;else if(t===or.Fixed32)this.pos+=4;else{if(t!==or.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(i,t){this.writeVarint(i<<3|t)},realloc:function(i){for(var t=this.length||16;t<this.pos+i;)t*=2;if(t!==this.length){var s=new Uint8Array(t);s.set(this.buf),this.buf=s,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(i){this.realloc(4),Za(this.buf,i,this.pos),this.pos+=4},writeSFixed32:function(i){this.realloc(4),Za(this.buf,i,this.pos),this.pos+=4},writeFixed64:function(i){this.realloc(8),Za(this.buf,-1&i,this.pos),Za(this.buf,Math.floor(i*td),this.pos+4),this.pos+=8},writeSFixed64:function(i){this.realloc(8),Za(this.buf,-1&i,this.pos),Za(this.buf,Math.floor(i*td),this.pos+4),this.pos+=8},writeVarint:function(i){(i=+i||0)>268435455||i<0?function(t,s){var u,d,y,b;if(t>=0?(u=t%4294967296|0,d=t/4294967296|0):(d=~(-t/4294967296),4294967295^(u=~(-t%4294967296))?u=u+1|0:(u=0,d=d+1|0)),t>=0x10000000000000000||t<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");s.realloc(10),y=u,(b=s).buf[b.pos++]=127&y|128,y>>>=7,b.buf[b.pos++]=127&y|128,y>>>=7,b.buf[b.pos++]=127&y|128,y>>>=7,b.buf[b.pos++]=127&y|128,b.buf[b.pos]=127&(y>>>=7),function(y,_){var b=(7&y)<<4;_.buf[_.pos++]|=b|((y>>>=3)?128:0),y&&(_.buf[_.pos++]=127&y|((y>>>=7)?128:0),y&&(_.buf[_.pos++]=127&y|((y>>>=7)?128:0),y&&(_.buf[_.pos++]=127&y|((y>>>=7)?128:0),y&&(_.buf[_.pos++]=127&y|((y>>>=7)?128:0),y&&(_.buf[_.pos++]=127&y)))))}(d,s)}(i,this):(this.realloc(4),this.buf[this.pos++]=127&i|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=i>>>7&127))))},writeSVarint:function(i){this.writeVarint(i<0?2*-i-1:2*i)},writeBoolean:function(i){this.writeVarint(Boolean(i))},writeString:function(i){i=String(i),this.realloc(4*i.length),this.pos++;var t=this.pos;this.pos=function(u,d,y){for(var _,b,C=0;C<d.length;C++){if((_=d.charCodeAt(C))>55295&&_<57344){if(!b){_>56319||C+1===d.length?(u[y++]=239,u[y++]=191,u[y++]=189):b=_;continue}if(_<56320){u[y++]=239,u[y++]=191,u[y++]=189,b=_;continue}_=b-55296<<10|_-56320|65536,b=null}else b&&(u[y++]=239,u[y++]=191,u[y++]=189,b=null);_<128?u[y++]=_:(_<2048?u[y++]=_>>6|192:(_<65536?u[y++]=_>>12|224:(u[y++]=_>>18|240,u[y++]=_>>12&63|128),u[y++]=_>>6&63|128),u[y++]=63&_|128)}return y}(this.buf,i,this.pos);var s=this.pos-t;s>=128&&rd(t,s,this),this.pos=t-1,this.writeVarint(s),this.pos+=s},writeFloat:function(i){this.realloc(4),ed(this.buf,i,this.pos,!0,23,4),this.pos+=4},writeDouble:function(i){this.realloc(8),ed(this.buf,i,this.pos,!0,52,8),this.pos+=8},writeBytes:function(i){var t=i.length;this.writeVarint(t),this.realloc(t);for(var s=0;s<t;s++)this.buf[this.pos++]=i[s]},writeRawMessage:function(i,t){this.pos++;var s=this.pos;i(t,this);var u=this.pos-s;u>=128&&rd(s,u,this),this.pos=s-1,this.writeVarint(u),this.pos+=u},writeMessage:function(i,t,s){this.writeTag(i,or.Bytes),this.writeRawMessage(t,s)},writePackedVarint:function(i,t){t.length&&this.writeMessage(i,kp,t)},writePackedSVarint:function(i,t){t.length&&this.writeMessage(i,to,t)},writePackedBoolean:function(i,t){t.length&&this.writeMessage(i,Zc,t)},writePackedFloat:function(i,t){t.length&&this.writeMessage(i,qc,t)},writePackedDouble:function(i,t){t.length&&this.writeMessage(i,id,t)},writePackedFixed32:function(i,t){t.length&&this.writeMessage(i,Ni,t)},writePackedSFixed32:function(i,t){t.length&&this.writeMessage(i,Xl,t)},writePackedFixed64:function(i,t){t.length&&this.writeMessage(i,Wc,t)},writePackedSFixed64:function(i,t){t.length&&this.writeMessage(i,Lp,t)},writeBytesField:function(i,t){this.writeTag(i,or.Bytes),this.writeBytes(t)},writeFixed32Field:function(i,t){this.writeTag(i,or.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(i,t){this.writeTag(i,or.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(i,t){this.writeTag(i,or.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(i,t){this.writeTag(i,or.Fixed64),this.writeSFixed64(t)},writeVarintField:function(i,t){this.writeTag(i,or.Varint),this.writeVarint(t)},writeSVarintField:function(i,t){this.writeTag(i,or.Varint),this.writeSVarint(t)},writeStringField:function(i,t){this.writeTag(i,or.Bytes),this.writeString(t)},writeFloatField:function(i,t){this.writeTag(i,or.Fixed32),this.writeFloat(t)},writeDoubleField:function(i,t){this.writeTag(i,or.Fixed64),this.writeDouble(t)},writeBooleanField:function(i,t){this.writeVarintField(i,Boolean(t))}};class Yc{constructor(t,{pixelRatio:s,version:u,stretchX:d,stretchY:y,content:_}){this.paddedRect=t,this.pixelRatio=s,this.stretchX=d,this.stretchY=y,this.content=_,this.version=u}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class ud{constructor(t,s){const u={},d={};this.haveRenderCallbacks=[];const y=[];this.addImages(t,u,y),this.addImages(s,d,y);const{w:_,h:b}=ld(y),C=new wo({width:_||1,height:b||1});for(const P in t){const V=t[P],$=u[P].paddedRect;wo.copy(V.data,C,{x:0,y:0},{x:$.x+1,y:$.y+1},V.data)}for(const P in s){const V=s[P],$=d[P].paddedRect,Z=$.x+1,J=$.y+1,ee=V.data.width,de=V.data.height;wo.copy(V.data,C,{x:0,y:0},{x:Z,y:J},V.data),wo.copy(V.data,C,{x:0,y:de-1},{x:Z,y:J-1},{width:ee,height:1}),wo.copy(V.data,C,{x:0,y:0},{x:Z,y:J+de},{width:ee,height:1}),wo.copy(V.data,C,{x:ee-1,y:0},{x:Z-1,y:J},{width:1,height:de}),wo.copy(V.data,C,{x:0,y:0},{x:Z+ee,y:J},{width:1,height:de})}this.image=C,this.iconPositions=u,this.patternPositions=d}addImages(t,s,u){for(const d in t){const y=t[d],_={x:0,y:0,w:y.data.width+2,h:y.data.height+2};u.push(_),s[d]=new Yc(_,y),y.hasRenderCallback&&this.haveRenderCallbacks.push(d)}}patchUpdatedImages(t,s){t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const u in t.updatedImages)this.patchUpdatedImage(this.iconPositions[u],t.getImage(u),s),this.patchUpdatedImage(this.patternPositions[u],t.getImage(u),s)}patchUpdatedImage(t,s,u){if(!t||!s||t.version===s.version)return;t.version=s.version;const[d,y]=t.tl;u.update(s.data,void 0,{x:d,y})}}Pt("ImagePosition",Yc),Pt("ImageAtlas",ud),f.WritingMode=void 0,(ya=f.WritingMode||(f.WritingMode={}))[ya.none=0]="none",ya[ya.horizontal=1]="horizontal",ya[ya.vertical=2]="vertical",ya[ya.horizontalOnly=3]="horizontalOnly";class Jl{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(t,s){const u=new Jl;return u.scale=t||1,u.fontStack=s,u}static forImage(t){const s=new Jl;return s.imageName=t,s}}class gl{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,s){const u=new gl;for(let d=0;d<t.sections.length;d++){const y=t.sections[d];y.image?u.addImageSection(y):u.addTextSection(y,s)}return u}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(){this.text=function(t){let s="";for(let u=0;u<t.length;u++){const d=t.charCodeAt(u+1)||null,y=t.charCodeAt(u-1)||null;s+=d&&Ho(d)&&!Yl[t[u+1]]||y&&Ho(y)&&!Yl[t[u-1]]||!Yl[t[u]]?t[u]:Yl[t[u]]}return s}(this.text)}trim(){let t=0;for(let u=0;u<this.text.length&&Ro[this.text.charCodeAt(u)];u++)t++;let s=this.text.length;for(let u=this.text.length-1;u>=0&&u>=t&&Ro[this.text.charCodeAt(u)];u--)s--;this.text=this.text.substring(t,s),this.sectionIndex=this.sectionIndex.slice(t,s)}substring(t,s){const u=new gl;return u.text=this.text.substring(t,s),u.sectionIndex=this.sectionIndex.slice(t,s),u.sections=this.sections,u}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,s)=>Math.max(t,this.sections[s].scale),0)}addTextSection(t,s){this.text+=t.text,this.sections.push(Jl.forText(t.scale,t.fontStack||s));const u=this.sections.length-1;for(let d=0;d<t.text.length;++d)this.sectionIndex.push(u)}addImageSection(t){const s=t.image?t.image.name:"";if(0===s.length)return void wn("Can't add FormattedSection with an empty image.");const u=this.getNextImageSectionCharCode();u?(this.text+=String.fromCharCode(u),this.sections.push(Jl.forImage(s)),this.sectionIndex.push(this.sections.length-1)):wn("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Ns(i,t,s,u,d,y,_,b,C,P,V,$,Z,J,ee,de){const he=gl.fromFeature(i,d);let be;$===f.WritingMode.vertical&&he.verticalizePunctuation();const{processBidirectionalText:Le,processStyledBidirectionalText:Fe}=wi;if(Le&&1===he.sections.length){be=[];const He=Le(he.toString(),Ql(he,P,y,t,u,J,ee));for(const Tt of He){const $t=new gl;$t.text=Tt,$t.sections=he.sections;for(let ft=0;ft<Tt.length;ft++)$t.sectionIndex.push(0);be.push($t)}}else if(Fe){be=[];const He=Fe(he.text,he.sectionIndex,Ql(he,P,y,t,u,J,ee));for(const Tt of He){const $t=new gl;$t.text=Tt[0],$t.sectionIndex=Tt[1],$t.sections=he.sections,be.push($t)}}else be=function(He,Tt){const $t=[],ft=He.text;let wt=0;for(const lt of Tt)$t.push(He.substring(wt,lt)),wt=lt;return wt<ft.length&&$t.push(He.substring(wt,ft.length)),$t}(he,Ql(he,P,y,t,u,J,ee));const Ve=[],Ye={positionedLines:Ve,text:he.toString(),top:V[1],bottom:V[1],left:V[0],right:V[0],writingMode:$,iconsInText:!1,verticalizable:!1};return function(He,Tt,$t,ft,wt,lt,Ft,Dt,rt,qt,Zt,On){let Xn=0,xr=-17,pr=0,fi=0;const Vr="right"===Dt?1:"left"===Dt?0:.5;let sr=0;for(const Xr of wt){Xr.trim();const Ti=Xr.getMaxScale(),Bi=24*(Ti-1),Vi={positionedGlyphs:[],lineOffset:0};He.positionedLines[sr]=Vi;const Ui=Vi.positionedGlyphs;let lo=0;if(!Xr.length()){xr+=lt,++sr;continue}for(let Fr=0;Fr<Xr.length();Fr++){const Sn=Xr.getSection(Fr),ro=Xr.getSectionIndex(Fr),Jr=Xr.getCharCode(Fr);let Pi=0,Do=null,Ko=null,Xo=null,Us=24;const zo=!(rt===f.WritingMode.horizontal||!Zt&&!Wr(Jr)||Zt&&(Ro[Jr]||(oi=Jr,yt.Arabic(oi)||yt["Arabic Supplement"](oi)||yt["Arabic Extended-A"](oi)||yt["Arabic Presentation Forms-A"](oi)||yt["Arabic Presentation Forms-B"](oi))));if(Sn.imageName){const Co=ft[Sn.imageName];if(!Co)continue;Xo=Sn.imageName,He.iconsInText=He.iconsInText||!0,Ko=Co.paddedRect;const ji=Co.displaySize;Sn.scale=24*Sn.scale/On,Do={width:ji[0],height:ji[1],left:1,top:-3,advance:zo?ji[1]:ji[0]},Pi=Bi+(24-ji[1]*Sn.scale),Us=Do.advance;const js=zo?ji[0]*Sn.scale-24*Ti:ji[1]*Sn.scale-24*Ti;js>0&&js>lo&&(lo=js)}else{const Co=$t[Sn.fontStack],ji=Co&&Co[Jr];if(ji&&ji.rect)Ko=ji.rect,Do=ji.metrics;else{const js=Tt[Sn.fontStack],vl=js&&js[Jr];if(!vl)continue;Do=vl.metrics}Pi=24*(Ti-Sn.scale)}zo?(He.verticalizable=!0,Ui.push({glyph:Jr,imageName:Xo,x:Xn,y:xr+Pi,vertical:zo,scale:Sn.scale,fontStack:Sn.fontStack,sectionIndex:ro,metrics:Do,rect:Ko}),Xn+=Us*Sn.scale+qt):(Ui.push({glyph:Jr,imageName:Xo,x:Xn,y:xr+Pi,vertical:zo,scale:Sn.scale,fontStack:Sn.fontStack,sectionIndex:ro,metrics:Do,rect:Ko}),Xn+=Do.advance*Sn.scale+qt)}0!==Ui.length&&(pr=Math.max(Xn-qt,pr),Vp(Ui,0,Ui.length-1,Vr,lo)),Xn=0;const Mr=lt*Ti+lo;Vi.lineOffset=Math.max(lo,Bi),xr+=Mr,fi=Math.max(Mr,fi),++sr}var oi;const si=xr- -17,{horizontalAlign:mi,verticalAlign:no}=eu(Ft);(function(Xr,Ti,Bi,Vi,Ui,lo,Mr,Fr,Sn){const ro=(Ti-Bi)*Ui;let Jr=0;Jr=lo!==Mr?-Fr*Vi- -17:(-Vi*Sn+.5)*Mr;for(const Pi of Xr)for(const Do of Pi.positionedGlyphs)Do.x+=ro,Do.y+=Jr})(He.positionedLines,Vr,mi,no,pr,fi,lt,si,wt.length),He.top+=-no*si,He.bottom=He.top+si,He.left+=-mi*pr,He.right=He.left+pr}(Ye,t,s,u,be,_,b,C,$,P,Z,de),!function(He){for(const Tt of He)if(0!==Tt.positionedGlyphs.length)return!1;return!0}(Ve)&&Ye}const Ro={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Op={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function zp(i,t,s,u,d,y){if(t.imageName){const _=u[t.imageName];return _?_.displaySize[0]*t.scale*24/y+d:0}{const _=s[t.fontStack],b=_&&_[i];return b?b.metrics.advance*t.scale+d:0}}function Np(i,t,s,u){const d=Math.pow(i-t,2);return u?i<t?d/2:2*d:d+Math.abs(s)*s}function cd(i,t,s){let u=0;return 10===i&&(u-=1e4),s&&(u+=150),40!==i&&65288!==i||(u+=50),41!==t&&65289!==t||(u+=50),u}function Bp(i,t,s,u,d,y){let _=null,b=Np(t,s,d,y);for(const C of u){const P=Np(t-C.x,s,d,y)+C.badness;P<=b&&(_=C,b=P)}return{index:i,x:t,priorBreak:_,badness:b}}function Yo(i){return i?Yo(i.priorBreak).concat(i.index):[]}function Ql(i,t,s,u,d,y,_){if("point"!==y)return[];if(!i)return[];const b=[],C=function(Z,J,ee,de,he,be){let Le=0;for(let Fe=0;Fe<Z.length();Fe++){const Ve=Z.getSection(Fe);Le+=zp(Z.getCharCode(Fe),Ve,de,he,J,be)}return Le/Math.max(1,Math.ceil(Le/ee))}(i,t,s,u,d,_),P=i.text.indexOf("\u200b")>=0;let V=0;for(let Z=0;Z<i.length();Z++){const J=i.getSection(Z),ee=i.getCharCode(Z);if(Ro[ee]||(V+=zp(ee,J,u,d,t,_)),Z<i.length()-1){const de=!(($=ee)<11904||!(yt["Bopomofo Extended"]($)||yt.Bopomofo($)||yt["CJK Compatibility Forms"]($)||yt["CJK Compatibility Ideographs"]($)||yt["CJK Compatibility"]($)||yt["CJK Radicals Supplement"]($)||yt["CJK Strokes"]($)||yt["CJK Symbols and Punctuation"]($)||yt["CJK Unified Ideographs Extension A"]($)||yt["CJK Unified Ideographs"]($)||yt["Enclosed CJK Letters and Months"]($)||yt["Halfwidth and Fullwidth Forms"]($)||yt.Hiragana($)||yt["Ideographic Description Characters"]($)||yt["Kangxi Radicals"]($)||yt["Katakana Phonetic Extensions"]($)||yt.Katakana($)||yt["Vertical Forms"]($)||yt["Yi Radicals"]($)||yt["Yi Syllables"]($)));(Op[ee]||de||J.imageName)&&b.push(Bp(Z+1,V,C,b,cd(ee,i.getCharCode(Z+1),de&&P),!1))}}var $;return Yo(Bp(i.length(),V,C,b,0,!0))}function eu(i){let t=.5,s=.5;switch(i){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":s=1;break;case"top":case"top-right":case"top-left":s=0}return{horizontalAlign:t,verticalAlign:s}}function Vp(i,t,s,u,d){if(!u&&!d)return;const y=i[s],_=(i[s].x+y.metrics.advance*y.scale)*u;for(let b=t;b<=s;b++)i[b].x-=_,i[b].y+=d}function hd(i,t,s){const{horizontalAlign:u,verticalAlign:d}=eu(s),y=t[0]-i.displaySize[0]*u,_=t[1]-i.displaySize[1]*d;return{image:i,top:_,bottom:_+i.displaySize[1],left:y,right:y+i.displaySize[0]}}function yl(i,t,s,u,d,y){const _=i.image;let b;if(_.content){const he=_.content,be=_.pixelRatio||1;b=[he[0]/be,he[1]/be,_.displaySize[0]-he[2]/be,_.displaySize[1]-he[3]/be]}const C=t.left*y,P=t.right*y;let V,$,Z,J;"width"===s||"both"===s?(J=d[0]+C-u[3],$=d[0]+P+u[1]):(J=d[0]+(C+P-_.displaySize[0])/2,$=J+_.displaySize[0]);const ee=t.top*y,de=t.bottom*y;return"height"===s||"both"===s?(V=d[1]+ee-u[0],Z=d[1]+de+u[2]):(V=d[1]+(ee+de-_.displaySize[1])/2,Z=V+_.displaySize[1]),{image:_,top:V,right:$,bottom:Z,left:J,collisionPadding:b}}const fs=128;function Kc(i,t){const{expression:s}=t;if("constant"===s.kind)return{kind:"constant",layoutSize:s.evaluate(new yr(i+1))};if("source"===s.kind)return{kind:"source"};{const{zoomStops:u,interpolationType:d}=s;let y=0;for(;y<u.length&&u[y]<=i;)y++;y=Math.max(0,y-1);let _=y;for(;_<u.length&&u[_]<i+1;)_++;_=Math.min(u.length-1,_);const b=u[y],C=u[_];return"composite"===s.kind?{kind:"composite",minZoom:b,maxZoom:C,interpolationType:d}:{kind:"camera",minZoom:b,maxZoom:C,minSize:s.evaluate(new yr(b)),maxSize:s.evaluate(new yr(C)),interpolationType:d}}}class ms extends _e{constructor(t,s,u,d){super(t,s),this.angle=u,void 0!==d&&(this.segment=d)}clone(){return new ms(this.x,this.y,this.angle,this.segment)}}function Zu(i,t,s,u,d){if(void 0===t.segment)return!0;let y=t,_=t.segment+1,b=0;for(;b>-s/2;){if(_--,_<0)return!1;b-=i[_].dist(y),y=i[_]}b+=i[_].dist(i[_+1]),_++;const C=[];let P=0;for(;b<s/2;){const V=i[_],$=i[_+1];if(!$)return!1;let Z=i[_-1].angleTo(V)-V.angleTo($);for(Z=Math.abs((Z+3*Math.PI)%(2*Math.PI)-Math.PI),C.push({distance:b,angleDelta:Z}),P+=Z;b-C[0].distance>u;)P-=C.shift().angleDelta;if(P>d)return!1;_++,b+=V.dist($)}return!0}function Xc(i){let t=0;for(let s=0;s<i.length-1;s++)t+=i[s].dist(i[s+1]);return t}function Up(i,t,s){return i?.6*t*s:0}function Wa(i,t){return Math.max(i?i.right-i.left:0,t?t.right-t.left:0)}function Jc(i,t,s,u,d,y){const _=Up(s,d,y),b=Wa(s,u)*y;let C=0;const P=Xc(i)/2;for(let V=0;V<i.length-1;V++){const $=i[V],Z=i[V+1],J=$.dist(Z);if(C+J>P){const ee=(P-C)/J,de=Sr($.x,Z.x,ee),he=Sr($.y,Z.y,ee),be=new ms(de,he,Z.angleTo($),V);return be._round(),!_||Zu(i,be,b,_,t)?be:void 0}C+=J}}function dd(i,t,s,u,d,y,_,b,C){const P=Up(u,y,_),V=Wa(u,d),$=V*_,Z=0===i[0].x||i[0].x===C||0===i[0].y||i[0].y===C;return t-$<t/4&&(t=$+t/4),pd(i,Z?t/2*b%t:(V/2+2*y)*_*b%t,t,P,s,$,Z,!1,C)}function pd(i,t,s,u,d,y,_,b,C){const P=y/2,V=Xc(i);let $=0,Z=t-s,J=[];for(let ee=0;ee<i.length-1;ee++){const de=i[ee],he=i[ee+1],be=de.dist(he),Le=he.angleTo(de);for(;Z+s<$+be;){Z+=s;const Fe=(Z-$)/be,Ve=Sr(de.x,he.x,Fe),Ye=Sr(de.y,he.y,Fe);if(Ve>=0&&Ve<C&&Ye>=0&&Ye<C&&Z-P>=0&&Z+P<=V){const He=new ms(Ve,Ye,Le,ee);He._round(),u&&!Zu(i,He,y,u,d)||J.push(He)}}$+=be}return b||J.length||_||(J=pd(i,$/2,s,u,d,y,_,!0,C)),J}function Wu(i,t,s,u,d){const y=[];for(let _=0;_<i.length;_++){const b=i[_];let C;for(let P=0;P<b.length-1;P++){let V=b[P],$=b[P+1];V.x<t&&$.x<t||(V.x<t?V=new _e(t,V.y+(t-V.x)/($.x-V.x)*($.y-V.y))._round():$.x<t&&($=new _e(t,V.y+(t-V.x)/($.x-V.x)*($.y-V.y))._round()),V.y<s&&$.y<s||(V.y<s?V=new _e(V.x+(s-V.y)/($.y-V.y)*($.x-V.x),s)._round():$.y<s&&($=new _e(V.x+(s-V.y)/($.y-V.y)*($.x-V.x),s)._round()),V.x>=u&&$.x>=u||(V.x>=u?V=new _e(u,V.y+(u-V.x)/($.x-V.x)*($.y-V.y))._round():$.x>=u&&($=new _e(u,V.y+(u-V.x)/($.x-V.x)*($.y-V.y))._round()),V.y>=d&&$.y>=d||(V.y>=d?V=new _e(V.x+(d-V.y)/($.y-V.y)*($.x-V.x),d)._round():$.y>=d&&($=new _e(V.x+(d-V.y)/($.y-V.y)*($.x-V.x),d)._round()),C&&V.equals(C[C.length-1])||(C=[V],y.push(C)),C.push($)))))}}return y}function fd(i,t,s,u){const d=[],y=i.image,_=y.pixelRatio,b=y.paddedRect.w-2,C=y.paddedRect.h-2,P=i.right-i.left,V=i.bottom-i.top,$=y.stretchX||[[0,b]],Z=y.stretchY||[[0,C]],J=(lt,Ft)=>lt+Ft[1]-Ft[0],ee=$.reduce(J,0),de=Z.reduce(J,0),he=b-ee,be=C-de;let Le=0,Fe=ee,Ve=0,Ye=de,He=0,Tt=he,$t=0,ft=be;if(y.content&&u){const lt=y.content;Le=Yu($,0,lt[0]),Ve=Yu(Z,0,lt[1]),Fe=Yu($,lt[0],lt[2]),Ye=Yu(Z,lt[1],lt[3]),He=lt[0]-Le,$t=lt[1]-Ve,Tt=lt[2]-lt[0]-Fe,ft=lt[3]-lt[1]-Ye}const wt=(lt,Ft,Dt,rt)=>{const qt=Ku(lt.stretch-Le,Fe,P,i.left),Zt=Xu(lt.fixed-He,Tt,lt.stretch,ee),On=Ku(Ft.stretch-Ve,Ye,V,i.top),Xn=Xu(Ft.fixed-$t,ft,Ft.stretch,de),xr=Ku(Dt.stretch-Le,Fe,P,i.left),pr=Xu(Dt.fixed-He,Tt,Dt.stretch,ee),fi=Ku(rt.stretch-Ve,Ye,V,i.top),Vr=Xu(rt.fixed-$t,ft,rt.stretch,de),sr=new _e(qt,On),oi=new _e(xr,On),si=new _e(xr,fi),mi=new _e(qt,fi),no=new _e(Zt/_,Xn/_),Xr=new _e(pr/_,Vr/_),Ti=t*Math.PI/180;if(Ti){const Ui=Math.sin(Ti),lo=Math.cos(Ti),Mr=[lo,-Ui,Ui,lo];sr._matMult(Mr),oi._matMult(Mr),mi._matMult(Mr),si._matMult(Mr)}const Bi=lt.stretch+lt.fixed,Vi=Ft.stretch+Ft.fixed;return{tl:sr,tr:oi,bl:mi,br:si,tex:{x:y.paddedRect.x+1+Bi,y:y.paddedRect.y+1+Vi,w:Dt.stretch+Dt.fixed-Bi,h:rt.stretch+rt.fixed-Vi},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:no,pixelOffsetBR:Xr,minFontScaleX:Tt/_/P,minFontScaleY:ft/_/V,isSDF:s}};if(u&&(y.stretchX||y.stretchY)){const lt=md($,he,ee),Ft=md(Z,be,de);for(let Dt=0;Dt<lt.length-1;Dt++){const rt=lt[Dt],qt=lt[Dt+1];for(let Zt=0;Zt<Ft.length-1;Zt++)d.push(wt(rt,Ft[Zt],qt,Ft[Zt+1]))}}else d.push(wt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:b+1},{fixed:0,stretch:C+1}));return d}function Yu(i,t,s){let u=0;for(const d of i)u+=Math.max(t,Math.min(s,d[1]))-Math.max(t,Math.min(s,d[0]));return u}function md(i,t,s){const u=[{fixed:-1,stretch:0}];for(const[d,y]of i){const _=u[u.length-1];u.push({fixed:d-_.stretch,stretch:_.stretch}),u.push({fixed:d-_.stretch,stretch:_.stretch+(y-d)})}return u.push({fixed:t+1,stretch:s}),u}function Ku(i,t,s,u){return i/t*s+u}function Xu(i,t,s,u){return i-t*s/u}Pt("Anchor",ms);class Ju{constructor(t,s,u,d,y,_,b,C,P,V){if(this.boxStartIndex=t.length,P){let $=_.top,Z=_.bottom;const J=_.collisionPadding;J&&($-=J[1],Z+=J[3]);let ee=Z-$;ee>0&&(ee=Math.max(10,ee),this.circleDiameter=ee)}else{let $=_.top*b-C,Z=_.bottom*b+C,J=_.left*b-C,ee=_.right*b+C;const de=_.collisionPadding;if(de&&(J-=de[0]*b,$-=de[1]*b,ee+=de[2]*b,Z+=de[3]*b),V){const he=new _e(J,$),be=new _e(ee,$),Le=new _e(J,Z),Fe=new _e(ee,Z),Ve=V*Math.PI/180;he._rotate(Ve),be._rotate(Ve),Le._rotate(Ve),Fe._rotate(Ve),J=Math.min(he.x,be.x,Le.x,Fe.x),ee=Math.max(he.x,be.x,Le.x,Fe.x),$=Math.min(he.y,be.y,Le.y,Fe.y),Z=Math.max(he.y,be.y,Le.y,Fe.y)}t.emplaceBack(s.x,s.y,J,$,ee,Z,u,d,y)}this.boxEndIndex=t.length}}class gd{constructor(t=[],s=Qc){if(this.data=t,this.length=this.data.length,this.compare=s,this.length>0)for(let u=(this.length>>1)-1;u>=0;u--)this._down(u)}push(t){this.data.push(t),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const t=this.data[0],s=this.data.pop();return this.length--,this.length>0&&(this.data[0]=s,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:s,compare:u}=this,d=s[t];for(;t>0;){const y=t-1>>1,_=s[y];if(u(d,_)>=0)break;s[t]=_,t=y}s[t]=d}_down(t){const{data:s,compare:u}=this,d=this.length>>1,y=s[t];for(;t<d;){let _=1+(t<<1),b=s[_];const C=_+1;if(C<this.length&&u(s[C],b)<0&&(_=C,b=s[C]),u(b,y)>=0)break;s[t]=b,t=_}s[t]=y}}function Qc(i,t){return i<t?-1:i>t?1:0}function yd(i,t=1,s=!1){let u=1/0,d=1/0,y=-1/0,_=-1/0;const b=i[0];for(let J=0;J<b.length;J++){const ee=b[J];(!J||ee.x<u)&&(u=ee.x),(!J||ee.y<d)&&(d=ee.y),(!J||ee.x>y)&&(y=ee.x),(!J||ee.y>_)&&(_=ee.y)}const C=Math.min(y-u,_-d);let P=C/2;const V=new gd([],eh);if(0===C)return new _e(u,d);for(let J=u;J<y;J+=C)for(let ee=d;ee<_;ee+=C)V.push(new _l(J+P,ee+P,P,i));let $=function(J){let ee=0,de=0,he=0;const be=J[0];for(let Le=0,Fe=be.length,Ve=Fe-1;Le<Fe;Ve=Le++){const Ye=be[Le],He=be[Ve],Tt=Ye.x*He.y-He.x*Ye.y;de+=(Ye.x+He.x)*Tt,he+=(Ye.y+He.y)*Tt,ee+=3*Tt}return new _l(de/ee,he/ee,0,J)}(i),Z=V.length;for(;V.length;){const J=V.pop();(J.d>$.d||!$.d)&&($=J,s&&console.log("found best %d after %d probes",Math.round(1e4*J.d)/1e4,Z)),J.max-$.d<=t||(P=J.h/2,V.push(new _l(J.p.x-P,J.p.y-P,P,i)),V.push(new _l(J.p.x+P,J.p.y-P,P,i)),V.push(new _l(J.p.x-P,J.p.y+P,P,i)),V.push(new _l(J.p.x+P,J.p.y+P,P,i)),Z+=4)}return s&&(console.log(`num probes: ${Z}`),console.log(`best distance: ${$.d}`)),$.p}function eh(i,t){return t.max-i.max}function _l(i,t,s,u){this.p=new _e(i,t),this.h=s,this.d=function(d,y){let _=!1,b=1/0;for(let C=0;C<y.length;C++){const P=y[C];for(let V=0,$=P.length,Z=$-1;V<$;Z=V++){const J=P[V],ee=P[Z];J.y>d.y!=ee.y>d.y&&d.x<(ee.x-J.x)*(d.y-J.y)/(ee.y-J.y)+J.x&&(_=!_),b=Math.min(b,ul(d,J,ee))}}return(_?1:-1)*Math.sqrt(b)}(this.p,u),this.max=this.d+this.h*Math.SQRT2}const th=Number.POSITIVE_INFINITY;function nh(i,t){return t[1]!==th?function(s,u,d){let y=0,_=0;switch(u=Math.abs(u),d=Math.abs(d),s){case"top-right":case"top-left":case"top":_=d-7;break;case"bottom-right":case"bottom-left":case"bottom":_=7-d}switch(s){case"top-right":case"bottom-right":case"right":y=-u;break;case"top-left":case"bottom-left":case"left":y=u}return[y,_]}(i,t[0],t[1]):function(s,u){let d=0,y=0;u<0&&(u=0);const _=u/Math.sqrt(2);switch(s){case"top-right":case"top-left":y=_-7;break;case"bottom-right":case"bottom-left":y=7-_;break;case"bottom":y=7-u;break;case"top":y=u-7}switch(s){case"top-right":case"bottom-right":d=-_;break;case"top-left":case"bottom-left":d=_;break;case"left":d=u;break;case"right":d=-u}return[d,y]}(i,t[0])}function Qu(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Ya(i,t,s,u,d,y,_,b,C,P,V){let $=y.textMaxSize.evaluate(t,{});void 0===$&&($=_);const Z=i.layers[0].layout,J=Z.get("icon-offset").evaluate(t,{},V),ee=_d(s.horizontal),de=_/24,he=i.tilePixelRatio*de,be=i.tilePixelRatio*$/24,Le=i.tilePixelRatio*b,Fe=i.tilePixelRatio*Z.get("symbol-spacing"),Ve=Z.get("text-padding")*i.tilePixelRatio,Ye=Z.get("icon-padding")*i.tilePixelRatio,He=Z.get("text-max-angle")/180*Math.PI,Tt="viewport"!==Z.get("text-rotation-alignment")&&"point"!==Z.get("symbol-placement"),$t="map"===Z.get("icon-rotation-alignment")&&"point"!==Z.get("symbol-placement"),ft=Z.get("symbol-placement"),wt=Fe/2,lt=Z.get("icon-text-fit");let Ft;u&&"none"!==lt&&(i.allowVerticalPlacement&&s.vertical&&(Ft=yl(u,s.vertical,lt,Z.get("icon-text-fit-padding"),J,de)),ee&&(u=yl(u,ee,lt,Z.get("icon-text-fit-padding"),J,de)));const Dt=(rt,qt)=>{qt.x<0||qt.x>=Pr||qt.y<0||qt.y>=Pr||function(Zt,On,Xn,xr,pr,fi,Vr,sr,oi,si,mi,no,Xr,Ti,Bi,Vi,Ui,lo,Mr,Fr,Sn,ro,Jr,Pi,Do){const Ko=Zt.addToLineVertexArray(On,Xn);let Xo,Us,zo,Co,ji=0,js=0,vl=0,ch=0,uu=-1,Fd=-1;const Jo={};let kd=ol(""),Ld=0,va=0;if(void 0===sr._unevaluatedLayout.getValue("text-radial-offset")?[Ld,va]=sr.layout.get("text-offset").evaluate(Sn,{},Pi).map($i=>24*$i):(Ld=24*sr.layout.get("text-radial-offset").evaluate(Sn,{},Pi),va=th),Zt.allowVerticalPlacement&&xr.vertical){const $i=sr.layout.get("text-rotate").evaluate(Sn,{},Pi)+90;zo=new Ju(oi,On,si,mi,no,xr.vertical,Xr,Ti,Bi,$i),Vr&&(Co=new Ju(oi,On,si,mi,no,Vr,Ui,lo,Bi,$i))}if(pr){const $i=sr.layout.get("icon-rotate").evaluate(Sn,{}),No="none"!==sr.layout.get("icon-text-fit"),xl=fd(pr,$i,Jr,No),cu=Vr?fd(Vr,$i,Jr,No):void 0;Us=new Ju(oi,On,si,mi,no,pr,Ui,lo,!1,$i),ji=4*xl.length;const fh=Zt.iconSizeData;let xa=null;"source"===fh.kind?(xa=[fs*sr.layout.get("icon-size").evaluate(Sn,{})],xa[0]>Bs&&wn(`${Zt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):"composite"===fh.kind&&(xa=[fs*ro.compositeIconSizes[0].evaluate(Sn,{},Pi),fs*ro.compositeIconSizes[1].evaluate(Sn,{},Pi)],(xa[0]>Bs||xa[1]>Bs)&&wn(`${Zt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),Zt.addSymbols(Zt.icon,xl,xa,Fr,Mr,Sn,f.WritingMode.none,On,Ko.lineStartIndex,Ko.lineLength,-1,Pi),uu=Zt.icon.placedSymbolArray.length-1,cu&&(js=4*cu.length,Zt.addSymbols(Zt.icon,cu,xa,Fr,Mr,Sn,f.WritingMode.vertical,On,Ko.lineStartIndex,Ko.lineLength,-1,Pi),Fd=Zt.icon.placedSymbolArray.length-1)}const Rd=Object.keys(xr.horizontal);for(const $i of Rd){const No=xr.horizontal[$i];if(!Xo){kd=ol(No.text);const cu=sr.layout.get("text-rotate").evaluate(Sn,{},Pi);Xo=new Ju(oi,On,si,mi,no,No,Xr,Ti,Bi,cu)}const xl=1===No.positionedLines.length;if(vl+=rh(Zt,On,No,fi,sr,Bi,Sn,Vi,Ko,xr.vertical?f.WritingMode.horizontal:f.WritingMode.horizontalOnly,xl?Rd:[$i],Jo,uu,ro,Pi),xl)break}xr.vertical&&(ch+=rh(Zt,On,xr.vertical,fi,sr,Bi,Sn,Vi,Ko,f.WritingMode.vertical,["vertical"],Jo,Fd,ro,Pi));const Zp=Xo?Xo.boxStartIndex:Zt.collisionBoxArray.length,Wp=Xo?Xo.boxEndIndex:Zt.collisionBoxArray.length,hh=zo?zo.boxStartIndex:Zt.collisionBoxArray.length,km=zo?zo.boxEndIndex:Zt.collisionBoxArray.length,Lm=Us?Us.boxStartIndex:Zt.collisionBoxArray.length,dh=Us?Us.boxEndIndex:Zt.collisionBoxArray.length,Rm=Co?Co.boxStartIndex:Zt.collisionBoxArray.length,Om=Co?Co.boxEndIndex:Zt.collisionBoxArray.length;let gs=-1;const ph=($i,No)=>$i&&$i.circleDiameter?Math.max($i.circleDiameter,No):No;gs=ph(Xo,gs),gs=ph(zo,gs),gs=ph(Us,gs),gs=ph(Co,gs);const Yp=gs>-1?1:0;Yp&&(gs*=Do/24),Zt.glyphOffsetArray.length>=Vs.MAX_GLYPHS&&wn("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==Sn.sortKey&&Zt.addToSortKeyRanges(Zt.symbolInstances.length,Sn.sortKey),Zt.symbolInstances.emplaceBack(On.x,On.y,Jo.right>=0?Jo.right:-1,Jo.center>=0?Jo.center:-1,Jo.left>=0?Jo.left:-1,Jo.vertical||-1,uu,Fd,kd,Zp,Wp,hh,km,Lm,dh,Rm,Om,si,vl,ch,ji,js,Yp,0,Xr,Ld,va,gs)}(i,qt,rt,s,u,d,Ft,i.layers[0],i.collisionBoxArray,t.index,t.sourceLayerIndex,i.index,he,Ve,Tt,C,Le,Ye,$t,J,t,y,P,V,_)};if("line"===ft)for(const rt of Wu(t.geometry,0,0,Pr,Pr)){const qt=dd(rt,Fe,He,s.vertical||ee,u,24,be,i.overscaling,Pr);for(const Zt of qt){const On=ee;On&&vd(i,On.text,wt,Zt)||Dt(rt,Zt)}}else if("line-center"===ft){for(const rt of t.geometry)if(rt.length>1){const qt=Jc(rt,He,s.vertical||ee,u,24,be);qt&&Dt(rt,qt)}}else if("Polygon"===t.type)for(const rt of zc(t.geometry,0)){const qt=yd(rt,16);Dt(rt[0],new ms(qt.x,qt.y,0))}else if("LineString"===t.type)for(const rt of t.geometry)Dt(rt,new ms(rt[0].x,rt[0].y,0));else if("Point"===t.type)for(const rt of t.geometry)for(const qt of rt)Dt([qt],new ms(qt.x,qt.y,0))}const Bs=32640;function rh(i,t,s,u,d,y,_,b,C,P,V,$,Z,J,ee){const de=function(Le,Fe,Ve,Ye,He,Tt,$t,ft){const wt=Ye.layout.get("text-rotate").evaluate(Tt,{})*Math.PI/180,lt=[];for(const Ft of Fe.positionedLines)for(const Dt of Ft.positionedGlyphs){if(!Dt.rect)continue;const rt=Dt.rect||{};let qt=4,Zt=!0,On=1,Xn=0;const xr=(He||ft)&&Dt.vertical,pr=Dt.metrics.advance*Dt.scale/2;if(ft&&Fe.verticalizable){const Mr=24*(Dt.scale-1),Fr=(24-Dt.metrics.width*Dt.scale)/2;Xn=Ft.lineOffset/2-(Dt.imageName?-Fr:Mr)}if(Dt.imageName){const Mr=$t[Dt.imageName];Zt=Mr.sdf,On=Mr.pixelRatio,qt=1/On}const fi=He?[Dt.x+pr,Dt.y]:[0,0];let Vr=He?[0,0]:[Dt.x+pr+Ve[0],Dt.y+Ve[1]-Xn],sr=[0,0];xr&&(sr=Vr,Vr=[0,0]);const oi=(Dt.metrics.left-qt)*Dt.scale-pr+Vr[0],si=(-Dt.metrics.top-qt)*Dt.scale+Vr[1],mi=oi+rt.w*Dt.scale/On,no=si+rt.h*Dt.scale/On,Xr=new _e(oi,si),Ti=new _e(mi,si),Bi=new _e(oi,no),Vi=new _e(mi,no);if(xr){const Mr=new _e(-pr,pr- -17),Fr=-Math.PI/2,Sn=12-pr,ro=new _e(22-Sn,-(Dt.imageName?Sn:0)),Jr=new _e(...sr);Xr._rotateAround(Fr,Mr)._add(ro)._add(Jr),Ti._rotateAround(Fr,Mr)._add(ro)._add(Jr),Bi._rotateAround(Fr,Mr)._add(ro)._add(Jr),Vi._rotateAround(Fr,Mr)._add(ro)._add(Jr)}if(wt){const Mr=Math.sin(wt),Fr=Math.cos(wt),Sn=[Fr,-Mr,Mr,Fr];Xr._matMult(Sn),Ti._matMult(Sn),Bi._matMult(Sn),Vi._matMult(Sn)}const Ui=new _e(0,0),lo=new _e(0,0);lt.push({tl:Xr,tr:Ti,bl:Bi,br:Vi,tex:rt,writingMode:Fe.writingMode,glyphOffset:fi,sectionIndex:Dt.sectionIndex,isSDF:Zt,pixelOffsetTL:Ui,pixelOffsetBR:lo,minFontScaleX:0,minFontScaleY:0})}return lt}(0,s,b,d,y,_,u,i.allowVerticalPlacement),he=i.textSizeData;let be=null;"source"===he.kind?(be=[fs*d.layout.get("text-size").evaluate(_,{})],be[0]>Bs&&wn(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):"composite"===he.kind&&(be=[fs*J.compositeTextSizes[0].evaluate(_,{},ee),fs*J.compositeTextSizes[1].evaluate(_,{},ee)],(be[0]>Bs||be[1]>Bs)&&wn(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),i.addSymbols(i.text,de,be,b,y,_,P,t,C.lineStartIndex,C.lineLength,Z,ee);for(const Le of V)$[Le]=i.text.placedSymbolArray.length-1;return 4*de.length}function _d(i){for(const t in i)return i[t];return null}function vd(i,t,s,u){const d=i.compareText;if(t in d){const y=d[t];for(let _=y.length-1;_>=0;_--)if(u.dist(y[_])<s)return!0}else d[t]=[];return d[t].push(u),!1}const ec=Os.VectorTileFeature.types,jp=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function tu(i,t,s,u,d,y,_,b,C,P,V,$,Z){const J=b?Math.min(Bs,Math.round(b[0])):0,ee=b?Math.min(Bs,Math.round(b[1])):0;i.emplaceBack(t,s,Math.round(32*u),Math.round(32*d),y,_,(J<<1)+(C?1:0),ee,16*P,16*V,256*$,256*Z)}function tc(i,t,s){i.emplaceBack(t.x,t.y,s),i.emplaceBack(t.x,t.y,s),i.emplaceBack(t.x,t.y,s),i.emplaceBack(t.x,t.y,s)}function xd(i){for(const t of i.sections)if(Fc(t.text))return!0;return!1}class nu{constructor(t){this.layoutVertexArray=new Di,this.indexArray=new Qi,this.programConfigurations=t,this.segments=new Rn,this.dynamicLayoutVertexArray=new oo,this.opacityVertexArray=new vo,this.placedSymbolArray=new Je}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(t,s,u,d){this.isEmpty()||(u&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Zl.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,s),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,Hc.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,jp,!0),this.opacityVertexBuffer.itemSize=1),(u||d)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Pt("SymbolBuffers",nu);class nc{constructor(t,s,u){this.layoutVertexArray=new t,this.layoutAttributes=s,this.indexArray=new u,this.segments=new Rn,this.collisionVertexArray=new so}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,Pp.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Pt("CollisionBuffers",nc);class Vs{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(_=>_.id),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=ja([]),this.placementViewportMatrix=ja([]);const s=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Kc(this.zoom,s["text-size"]),this.iconSizeData=Kc(this.zoom,s["icon-size"]);const u=this.layers[0].layout,d=u.get("symbol-sort-key"),y=u.get("symbol-z-order");this.canOverlap="never"!==iu(u,"text-overlap","text-allow-overlap")||"never"!==iu(u,"icon-overlap","icon-allow-overlap")||u.get("text-ignore-placement")||u.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==y&&!d.isConstant(),this.sortFeaturesByY=("viewport-y"===y||"auto"===y&&!this.sortFeaturesByKey)&&this.canOverlap,"point"===u.get("symbol-placement")&&(this.writingModes=u.get("text-writing-mode").map(_=>f.WritingMode[_])),this.stateDependentLayerIds=this.layers.filter(_=>_.isStateDependent()).map(_=>_.id),this.sourceID=t.sourceID}createArrays(){this.text=new nu(new ks(this.layers,this.zoom,t=>/^text/.test(t))),this.icon=new nu(new ks(this.layers,this.zoom,t=>/^icon/.test(t))),this.glyphOffsetArray=new At,this.lineVertexArray=new vt,this.symbolInstances=new je}calculateGlyphDependencies(t,s,u,d,y){for(let _=0;_<t.length;_++)if(s[t.charCodeAt(_)]=!0,(u||d)&&y){const b=Yl[t.charAt(_)];b&&(s[b.charCodeAt(0)]=!0)}}populate(t,s,u){const d=this.layers[0],y=d.layout,_=y.get("text-font"),b=y.get("text-field"),C=y.get("icon-image"),P=("constant"!==b.value.kind||b.value.value instanceof U&&!b.value.value.isEmpty()||b.value.value.toString().length>0)&&("constant"!==_.value.kind||_.value.value.length>0),V="constant"!==C.value.kind||!!C.value.value||Object.keys(C.parameters).length>0,$=y.get("symbol-sort-key");if(this.features=[],!P&&!V)return;const Z=s.iconDependencies,J=s.glyphDependencies,ee=s.availableImages,de=new yr(this.zoom);for(const{feature:he,id:be,index:Le,sourceLayerIndex:Fe}of t){const Ve=d._featureFilter.needGeometry,Ye=Na(he,Ve);if(!d._featureFilter.filter(de,Ye,u))continue;let He,Tt;if(Ve||(Ye.geometry=za(he)),P){const ft=d.getValueAndResolveTokens("text-field",Ye,u,ee),wt=U.factory(ft);xd(wt)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===Tl()||this.hasRTLText&&wi.isParsed())&&(He=Fp(wt,d,Ye))}if(V){const ft=d.getValueAndResolveTokens("icon-image",Ye,u,ee);Tt=ft instanceof G?ft:G.fromString(ft)}if(!He&&!Tt)continue;const $t=this.sortFeaturesByKey?$.evaluate(Ye,{},u):void 0;if(this.features.push({id:be,text:He,icon:Tt,index:Le,sourceLayerIndex:Fe,geometry:Ye.geometry,properties:he.properties,type:ec[he.type],sortKey:$t}),Tt&&(Z[Tt.name]=!0),He){const ft=_.evaluate(Ye,{},u).join(","),wt="viewport"!==y.get("text-rotation-alignment")&&"point"!==y.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(f.WritingMode.vertical)>=0;for(const lt of He.sections)if(lt.image)Z[lt.image.name]=!0;else{const Ft=da(He.toString()),Dt=lt.fontStack||ft,rt=J[Dt]=J[Dt]||{};this.calculateGlyphDependencies(lt.text,rt,wt,this.allowVerticalPlacement,Ft)}}}"line"===y.get("symbol-placement")&&(this.features=function(he){const be={},Le={},Fe=[];let Ve=0;function Ye(ft){Fe.push(he[ft]),Ve++}function He(ft,wt,lt){const Ft=Le[ft];return delete Le[ft],Le[wt]=Ft,Fe[Ft].geometry[0].pop(),Fe[Ft].geometry[0]=Fe[Ft].geometry[0].concat(lt[0]),Ft}function Tt(ft,wt,lt){const Ft=be[wt];return delete be[wt],be[ft]=Ft,Fe[Ft].geometry[0].shift(),Fe[Ft].geometry[0]=lt[0].concat(Fe[Ft].geometry[0]),Ft}function $t(ft,wt,lt){const Ft=lt?wt[0][wt[0].length-1]:wt[0][0];return`${ft}:${Ft.x}:${Ft.y}`}for(let ft=0;ft<he.length;ft++){const wt=he[ft],lt=wt.geometry,Ft=wt.text?wt.text.toString():null;if(!Ft){Ye(ft);continue}const Dt=$t(Ft,lt),rt=$t(Ft,lt,!0);if(Dt in Le&&rt in be&&Le[Dt]!==be[rt]){const qt=Tt(Dt,rt,lt),Zt=He(Dt,rt,Fe[qt].geometry);delete be[Dt],delete Le[rt],Le[$t(Ft,Fe[Zt].geometry,!0)]=Zt,Fe[qt].geometry=null}else Dt in Le?He(Dt,rt,lt):rt in be?Tt(Dt,rt,lt):(Ye(ft),be[Dt]=Ve-1,Le[rt]=Ve-1)}return Fe.filter(ft=>ft.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((he,be)=>he.sortKey-be.sortKey)}update(t,s,u){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,s,this.layers,u),this.icon.programConfigurations.updatePaintArrays(t,s,this.layers,u))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,s){const u=this.lineVertexArray.length;if(void 0!==t.segment){let d=t.dist(s[t.segment+1]),y=t.dist(s[t.segment]);const _={};for(let b=t.segment+1;b<s.length;b++)_[b]={x:s[b].x,y:s[b].y,tileUnitDistanceFromAnchor:d},b<s.length-1&&(d+=s[b+1].dist(s[b]));for(let b=t.segment||0;b>=0;b--)_[b]={x:s[b].x,y:s[b].y,tileUnitDistanceFromAnchor:y},b>0&&(y+=s[b-1].dist(s[b]));for(let b=0;b<s.length;b++){const C=_[b];this.lineVertexArray.emplaceBack(C.x,C.y,C.tileUnitDistanceFromAnchor)}}return{lineStartIndex:u,lineLength:this.lineVertexArray.length-u}}addSymbols(t,s,u,d,y,_,b,C,P,V,$,Z){const J=t.indexArray,ee=t.layoutVertexArray,de=t.segments.prepareSegment(4*s.length,ee,J,this.canOverlap?_.sortKey:void 0),he=this.glyphOffsetArray.length,be=de.vertexLength,Le=this.allowVerticalPlacement&&b===f.WritingMode.vertical?Math.PI/2:0,Fe=_.text&&_.text.sections;for(let Ve=0;Ve<s.length;Ve++){const{tl:Ye,tr:He,bl:Tt,br:$t,tex:ft,pixelOffsetTL:wt,pixelOffsetBR:lt,minFontScaleX:Ft,minFontScaleY:Dt,glyphOffset:rt,isSDF:qt,sectionIndex:Zt}=s[Ve],On=de.vertexLength,Xn=rt[1];tu(ee,C.x,C.y,Ye.x,Xn+Ye.y,ft.x,ft.y,u,qt,wt.x,wt.y,Ft,Dt),tu(ee,C.x,C.y,He.x,Xn+He.y,ft.x+ft.w,ft.y,u,qt,lt.x,wt.y,Ft,Dt),tu(ee,C.x,C.y,Tt.x,Xn+Tt.y,ft.x,ft.y+ft.h,u,qt,wt.x,lt.y,Ft,Dt),tu(ee,C.x,C.y,$t.x,Xn+$t.y,ft.x+ft.w,ft.y+ft.h,u,qt,lt.x,lt.y,Ft,Dt),tc(t.dynamicLayoutVertexArray,C,Le),J.emplaceBack(On,On+1,On+2),J.emplaceBack(On+1,On+2,On+3),de.vertexLength+=4,de.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(rt[0]),Ve!==s.length-1&&Zt===s[Ve+1].sectionIndex||t.programConfigurations.populatePaintArrays(ee.length,_,_.index,{},Z,Fe&&Fe[Zt])}t.placedSymbolArray.emplaceBack(C.x,C.y,he,this.glyphOffsetArray.length-he,be,P,V,C.segment,u?u[0]:0,u?u[1]:0,d[0],d[1],b,0,!1,0,$)}_addCollisionDebugVertex(t,s,u,d,y,_){return s.emplaceBack(0,0),t.emplaceBack(u.x,u.y,d,y,Math.round(_.x),Math.round(_.y))}addCollisionDebugVertices(t,s,u,d,y,_,b){const C=y.segments.prepareSegment(4,y.layoutVertexArray,y.indexArray),P=C.vertexLength,V=y.layoutVertexArray,$=y.collisionVertexArray,Z=b.anchorX,J=b.anchorY;this._addCollisionDebugVertex(V,$,_,Z,J,new _e(t,s)),this._addCollisionDebugVertex(V,$,_,Z,J,new _e(u,s)),this._addCollisionDebugVertex(V,$,_,Z,J,new _e(u,d)),this._addCollisionDebugVertex(V,$,_,Z,J,new _e(t,d)),C.vertexLength+=4;const ee=y.indexArray;ee.emplaceBack(P,P+1),ee.emplaceBack(P+1,P+2),ee.emplaceBack(P+2,P+3),ee.emplaceBack(P+3,P),C.primitiveLength+=4}addDebugCollisionBoxes(t,s,u,d){for(let y=t;y<s;y++){const _=this.collisionBoxArray.get(y);this.addCollisionDebugVertices(_.x1,_.y1,_.x2,_.y2,d?this.textCollisionBox:this.iconCollisionBox,_.anchorPoint,u)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new nc(xo,$u.members,Zo),this.iconCollisionBox=new nc(xo,$u.members,Zo);for(let t=0;t<this.symbolInstances.length;t++){const s=this.symbolInstances.get(t);this.addDebugCollisionBoxes(s.textBoxStartIndex,s.textBoxEndIndex,s,!0),this.addDebugCollisionBoxes(s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s,!0),this.addDebugCollisionBoxes(s.iconBoxStartIndex,s.iconBoxEndIndex,s,!1),this.addDebugCollisionBoxes(s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex,s,!1)}}_deserializeCollisionBoxesForSymbol(t,s,u,d,y,_,b,C,P){const V={};for(let $=s;$<u;$++){const Z=t.get($);V.textBox={x1:Z.x1,y1:Z.y1,x2:Z.x2,y2:Z.y2,anchorPointX:Z.anchorPointX,anchorPointY:Z.anchorPointY},V.textFeatureIndex=Z.featureIndex;break}for(let $=d;$<y;$++){const Z=t.get($);V.verticalTextBox={x1:Z.x1,y1:Z.y1,x2:Z.x2,y2:Z.y2,anchorPointX:Z.anchorPointX,anchorPointY:Z.anchorPointY},V.verticalTextFeatureIndex=Z.featureIndex;break}for(let $=_;$<b;$++){const Z=t.get($);V.iconBox={x1:Z.x1,y1:Z.y1,x2:Z.x2,y2:Z.y2,anchorPointX:Z.anchorPointX,anchorPointY:Z.anchorPointY},V.iconFeatureIndex=Z.featureIndex;break}for(let $=C;$<P;$++){const Z=t.get($);V.verticalIconBox={x1:Z.x1,y1:Z.y1,x2:Z.x2,y2:Z.y2,anchorPointX:Z.anchorPointX,anchorPointY:Z.anchorPointY},V.verticalIconFeatureIndex=Z.featureIndex;break}return V}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let s=0;s<this.symbolInstances.length;s++){const u=this.symbolInstances.get(s);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,u.textBoxStartIndex,u.textBoxEndIndex,u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u.iconBoxStartIndex,u.iconBoxEndIndex,u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,s){const u=t.placedSymbolArray.get(s),d=u.vertexStartIndex+4*u.numGlyphs;for(let y=u.vertexStartIndex;y<d;y+=4)t.indexArray.emplaceBack(y,y+1,y+2),t.indexArray.emplaceBack(y+1,y+2,y+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const s=Math.sin(t),u=Math.cos(t),d=[],y=[],_=[];for(let b=0;b<this.symbolInstances.length;++b){_.push(b);const C=this.symbolInstances.get(b);d.push(0|Math.round(s*C.anchorX+u*C.anchorY)),y.push(C.featureIndex)}return _.sort((b,C)=>d[b]-d[C]||y[C]-y[b]),_}addToSortKeyRanges(t,s){const u=this.sortKeyRanges[this.sortKeyRanges.length-1];u&&u.sortKey===s?u.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:s,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const s of this.symbolInstanceIndexes){const u=this.symbolInstances.get(s);this.featureSortOrder.push(u.featureIndex),[u.rightJustifiedTextSymbolIndex,u.centerJustifiedTextSymbolIndex,u.leftJustifiedTextSymbolIndex].forEach((d,y,_)=>{d>=0&&_.indexOf(d)===y&&this.addIndicesForPlacedSymbol(this.text,d)}),u.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,u.verticalPlacedTextSymbolIndex),u.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,u.placedIconSymbolIndex),u.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,u.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Pt("SymbolBucket",Vs,{omit:["layers","collisionBoxArray","features","compareText"]}),Vs.MAX_GLYPHS=65535,Vs.addDynamicAttributes=tc;const rc=new Cr({"symbol-placement":new zt(pe.layout_symbol["symbol-placement"]),"symbol-spacing":new zt(pe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new zt(pe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Kt(pe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new zt(pe.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new zt(pe.layout_symbol["icon-allow-overlap"]),"icon-overlap":new zt(pe.layout_symbol["icon-overlap"]),"icon-ignore-placement":new zt(pe.layout_symbol["icon-ignore-placement"]),"icon-optional":new zt(pe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new zt(pe.layout_symbol["icon-rotation-alignment"]),"icon-size":new Kt(pe.layout_symbol["icon-size"]),"icon-text-fit":new zt(pe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new zt(pe.layout_symbol["icon-text-fit-padding"]),"icon-image":new Kt(pe.layout_symbol["icon-image"]),"icon-rotate":new Kt(pe.layout_symbol["icon-rotate"]),"icon-padding":new zt(pe.layout_symbol["icon-padding"]),"icon-keep-upright":new zt(pe.layout_symbol["icon-keep-upright"]),"icon-offset":new Kt(pe.layout_symbol["icon-offset"]),"icon-anchor":new Kt(pe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new zt(pe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new zt(pe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new zt(pe.layout_symbol["text-rotation-alignment"]),"text-field":new Kt(pe.layout_symbol["text-field"]),"text-font":new Kt(pe.layout_symbol["text-font"]),"text-size":new Kt(pe.layout_symbol["text-size"]),"text-max-width":new Kt(pe.layout_symbol["text-max-width"]),"text-line-height":new zt(pe.layout_symbol["text-line-height"]),"text-letter-spacing":new Kt(pe.layout_symbol["text-letter-spacing"]),"text-justify":new Kt(pe.layout_symbol["text-justify"]),"text-radial-offset":new Kt(pe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new zt(pe.layout_symbol["text-variable-anchor"]),"text-anchor":new Kt(pe.layout_symbol["text-anchor"]),"text-max-angle":new zt(pe.layout_symbol["text-max-angle"]),"text-writing-mode":new zt(pe.layout_symbol["text-writing-mode"]),"text-rotate":new Kt(pe.layout_symbol["text-rotate"]),"text-padding":new zt(pe.layout_symbol["text-padding"]),"text-keep-upright":new zt(pe.layout_symbol["text-keep-upright"]),"text-transform":new Kt(pe.layout_symbol["text-transform"]),"text-offset":new Kt(pe.layout_symbol["text-offset"]),"text-allow-overlap":new zt(pe.layout_symbol["text-allow-overlap"]),"text-overlap":new zt(pe.layout_symbol["text-overlap"]),"text-ignore-placement":new zt(pe.layout_symbol["text-ignore-placement"]),"text-optional":new zt(pe.layout_symbol["text-optional"])});var ic={paint:new Cr({"icon-opacity":new Kt(pe.paint_symbol["icon-opacity"]),"icon-color":new Kt(pe.paint_symbol["icon-color"]),"icon-halo-color":new Kt(pe.paint_symbol["icon-halo-color"]),"icon-halo-width":new Kt(pe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Kt(pe.paint_symbol["icon-halo-blur"]),"icon-translate":new zt(pe.paint_symbol["icon-translate"]),"icon-translate-anchor":new zt(pe.paint_symbol["icon-translate-anchor"]),"text-opacity":new Kt(pe.paint_symbol["text-opacity"]),"text-color":new Kt(pe.paint_symbol["text-color"],{runtimeType:Or,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new Kt(pe.paint_symbol["text-halo-color"]),"text-halo-width":new Kt(pe.paint_symbol["text-halo-width"]),"text-halo-blur":new Kt(pe.paint_symbol["text-halo-blur"]),"text-translate":new zt(pe.paint_symbol["text-translate"]),"text-translate-anchor":new zt(pe.paint_symbol["text-translate-anchor"])}),layout:rc};class oc{constructor(t){this.type=t.property.overrides?t.property.overrides.runtimeType:mt,this.defaultValue=t}evaluate(t){if(t.formattedSection){const s=this.defaultValue.property.overrides;if(s&&s.hasOverride(t.formattedSection))return s.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Pt("FormatSectionOverride",oc,{omit:["defaultValue"]});class ru extends Yr{constructor(t){super(t,ic)}recalculate(t,s){if(super.recalculate(t,s),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]="map"===this.layout.get("text-rotation-alignment")?"map":"viewport"),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),"point"===this.layout.get("symbol-placement")){const u=this.layout.get("text-writing-mode");if(u){const d=[];for(const y of u)d.indexOf(y)<0&&d.push(y);this.layout._values["text-writing-mode"]=d}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(t,s,u,d){const y=this.layout.get(t).evaluate(s,{},u,d),_=this._unevaluatedLayout._values[t];return _.isDataDriven()||ko(_.value)||!y?y:(b=s.properties,y.replace(/{([^{}]+)}/g,(P,V)=>V in b?String(b[V]):""));var b}createBucket(t){return new Vs(t)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const t of ic.paint.overridableProperties){if(!ru.hasPaintOverride(this.layout,t))continue;const s=this.paint.get(t),u=new oc(s),d=new Fo(u,s.property.specification);let y=null;y="constant"===s.value.kind||"source"===s.value.kind?new hi("source",d):new Cs("composite",d,s.value.zoomStops,s.value._interpolationType),this.paint._values[t]=new qo(s.property,y,s.parameters)}}_handleOverridablePaintPropertyUpdate(t,s,u){return!(!this.layout||s.isDataDriven()||u.isDataDriven())&&ru.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,s){const u=t.get("text-field"),d=ic.paint.properties[s];let y=!1;const _=b=>{for(const C of b)if(d.overrides&&d.overrides.hasOverride(C))return void(y=!0)};if("constant"===u.value.kind&&u.value.value instanceof U)_(u.value.value.sections);else if("source"===u.value.kind){const b=P=>{y||(P instanceof Be&&le(P.value)===ki?_(P.value.sections):P instanceof ct?_(P.sections):P.eachChild(b))},C=u.value;C._styleExpression&&b(C._styleExpression.expression)}return y}}function iu(i,t,s){let u="never";const d=i.get(t);return d?u=d:i.get(s)&&(u="always"),u}var ou={paint:new Cr({"background-color":new zt(pe.paint_background["background-color"]),"background-pattern":new pa(pe.paint_background["background-pattern"]),"background-opacity":new zt(pe.paint_background["background-opacity"])})},$p={paint:new Cr({"raster-opacity":new zt(pe.paint_raster["raster-opacity"]),"raster-hue-rotate":new zt(pe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new zt(pe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new zt(pe.paint_raster["raster-brightness-max"]),"raster-saturation":new zt(pe.paint_raster["raster-saturation"]),"raster-contrast":new zt(pe.paint_raster["raster-contrast"]),"raster-resampling":new zt(pe.paint_raster["raster-resampling"]),"raster-fade-duration":new zt(pe.paint_raster["raster-fade-duration"])})};class bd extends Yr{constructor(t){super(t,{}),this.onAdd=s=>{this.implementation.onAdd&&this.implementation.onAdd(s,s.painter.context.gl)},this.onRemove=s=>{this.implementation.onRemove&&this.implementation.onRemove(s,s.painter.context.gl)},this.implementation=t}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}}const Gp={circle:class extends Yr{constructor(i){super(i,dp)}createBucket(i){return new Mu(i)}queryRadius(i){const t=i;return Ba("circle-radius",this,t)+Ba("circle-stroke-width",this,t)+Va(this.paint.get("circle-translate"))}queryIntersectsFeature(i,t,s,u,d,y,_,b){const C=Nl(i,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),y.angle,_),P=this.paint.get("circle-radius").evaluate(t,s)+this.paint.get("circle-stroke-width").evaluate(t,s),V="map"===this.paint.get("circle-pitch-alignment"),$=V?C:(ee=b,C.map(de=>$a(de,ee))),Z=V?P*_:P;var ee;for(const J of u)for(const ee of J){const de=V?ee:$a(ee,b);let he=Z;const be=Tu([],[ee.x,ee.y,0,1],b);if("viewport"===this.paint.get("circle-pitch-scale")&&"map"===this.paint.get("circle-pitch-alignment")?he*=be[3]/y.cameraToCenterDistance:"map"===this.paint.get("circle-pitch-scale")&&"viewport"===this.paint.get("circle-pitch-alignment")&&(he*=y.cameraToCenterDistance/be[3]),Iu($,de,he))return!0}return!1}},heatmap:class extends Yr{constructor(i){super(i,fp),this._updateColorRamp()}createBucket(i){return new dl(i)}_handleSpecialPaintPropertyUpdate(i){"heatmap-color"===i&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Oh({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}},hillshade:class extends Yr{constructor(i){super(i,mp)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}},fill:class extends Yr{constructor(i){super(i,Gh)}recalculate(i,t){super.recalculate(i,t);const s=this.paint._values["fill-outline-color"];"constant"===s.value.kind&&void 0===s.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(i){return new Bc(i)}queryRadius(){return Va(this.paint.get("fill-translate"))}queryIntersectsFeature(i,t,s,u,d,y,_){return kh(Nl(i,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),y.angle,_),u)}isTileClipped(){return!0}},"fill-extrusion":class extends Yr{constructor(i){super(i,Cp)}createBucket(i){return new $c(i)}queryRadius(){return Va(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(i,t,s,u,d,y,_,b){const C=Nl(i,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),y.angle,_),P=this.paint.get("fill-extrusion-height").evaluate(t,s),V=this.paint.get("fill-extrusion-base").evaluate(t,s),$=function(J,ee,de,he){const be=[];for(const Le of J){const Fe=[Le.x,Le.y,0,1];Tu(Fe,Fe,ee),be.push(new _e(Fe[0]/Fe[3],Fe[1]/Fe[3]))}return be}(C,b),Z=function(J,ee,de,he){const be=[],Le=[],Fe=he[8]*ee,Ve=he[9]*ee,Ye=he[10]*ee,He=he[11]*ee,Tt=he[8]*de,$t=he[9]*de,ft=he[10]*de,wt=he[11]*de;for(const lt of J){const Ft=[],Dt=[];for(const rt of lt){const qt=rt.x,Zt=rt.y,On=he[0]*qt+he[4]*Zt+he[12],Xn=he[1]*qt+he[5]*Zt+he[13],xr=he[2]*qt+he[6]*Zt+he[14],pr=he[3]*qt+he[7]*Zt+he[15],fi=xr+Ye,Vr=pr+He,sr=On+Tt,oi=Xn+$t,si=xr+ft,mi=pr+wt,no=new _e((On+Fe)/Vr,(Xn+Ve)/Vr);no.z=fi/Vr,Ft.push(no);const Xr=new _e(sr/mi,oi/mi);Xr.z=si/mi,Dt.push(Xr)}be.push(Ft),Le.push(Dt)}return[be,Le]}(u,V,P,b);return function(J,ee,de){let he=1/0;kh(de,ee)&&(he=Wh(de,ee[0]));for(let be=0;be<ee.length;be++){const Le=ee[be],Fe=J[be];for(let Ve=0;Ve<Le.length-1;Ve++){const Ye=Le[Ve],He=[Ye,Le[Ve+1],Fe[Ve+1],Fe[Ve],Ye];ll(de,He)&&(he=Math.min(he,Wh(de,He)))}}return he!==1/0&&he}(Z[0],Z[1],$)}},line:class extends Yr{constructor(i){super(i,Jh),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(i){"line-gradient"===i&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof Ir,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER)}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(i,t){super.recalculate(i,t),this.paint._values["line-floorwidth"]=Ap.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,i)}createBucket(i){return new Gc(i)}queryRadius(i){const t=i,s=Tp(Ba("line-width",this,t),Ba("line-gap-width",this,t)),u=Ba("line-offset",this,t);return s/2+Math.abs(u)+Va(this.paint.get("line-translate"))}queryIntersectsFeature(i,t,s,u,d,y,_){const b=Nl(i,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),y.angle,_),C=_/2*Tp(this.paint.get("line-width").evaluate(t,s),this.paint.get("line-gap-width").evaluate(t,s)),P=this.paint.get("line-offset").evaluate(t,s);return P&&(u=function(V,$){const Z=[];for(let J=0;J<V.length;J++){const ee=V[J],de=[];for(let he=0;he<ee.length;he++){const be=ee[he-1],Le=ee[he],Fe=ee[he+1],Ve=0===he?new _e(0,0):Le.sub(be)._unit()._perp(),Ye=he===ee.length-1?new _e(0,0):Fe.sub(Le)._unit()._perp(),He=Ve._add(Ye)._unit(),Tt=He.x*Ye.x+He.y*Ye.y;0!==Tt&&He._mult(1/Tt),de.push(He._mult($)._add(Le))}Z.push(de)}return Z}(u,P*_)),function(V,$,Z){for(let J=0;J<$.length;J++){const ee=$[J];if(V.length>=3)for(let de=0;de<ee.length;de++)if(cl(V,ee[de]))return!0;if(Kr(V,ee,Z))return!0}return!1}(b,u,C)}isTileClipped(){return!0}},symbol:ru,background:class extends Yr{constructor(i){super(i,ou)}},raster:class extends Yr{constructor(i){super(i,$p)}}};class Hp{constructor(t){this._callback=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const ih=6371008.8;class Er{constructor(t,s){if(isNaN(t)||isNaN(s))throw new Error(`Invalid LngLat object: (${t}, ${s})`);if(this.lng=+t,this.lat=+s,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Er(xt(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const s=Math.PI/180,u=this.lat*s,d=t.lat*s,y=Math.sin(u)*Math.sin(d)+Math.cos(u)*Math.cos(d)*Math.cos((t.lng-this.lng)*s);return ih*Math.acos(Math.min(y,1))}toBounds(t=0){const s=360*t/40075017,u=s/Math.cos(Math.PI/180*this.lat);return new _a(new Er(this.lng-u,this.lat-s),new Er(this.lng+u,this.lat+s))}static convert(t){if(t instanceof Er)return t;if(Array.isArray(t)&&(2===t.length||3===t.length))return new Er(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&"object"==typeof t&&null!==t)return new Er(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class _a{constructor(t,s){t&&(s?this.setSouthWest(t).setNorthEast(s):4===t.length?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))}setNorthEast(t){return this._ne=t instanceof Er?new Er(t.lng,t.lat):Er.convert(t),this}setSouthWest(t){return this._sw=t instanceof Er?new Er(t.lng,t.lat):Er.convert(t),this}extend(t){const s=this._sw,u=this._ne;let d,y;if(t instanceof Er)d=t,y=t;else{if(!(t instanceof _a))return Array.isArray(t)?4===t.length||t.every(Array.isArray)?this.extend(_a.convert(t)):this.extend(Er.convert(t)):this;if(d=t._sw,y=t._ne,!d||!y)return this}return s||u?(s.lng=Math.min(d.lng,s.lng),s.lat=Math.min(d.lat,s.lat),u.lng=Math.max(y.lng,u.lng),u.lat=Math.max(y.lat,u.lat)):(this._sw=new Er(d.lng,d.lat),this._ne=new Er(y.lng,y.lat)),this}getCenter(){return new Er((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Er(this.getWest(),this.getNorth())}getSouthEast(){return new Er(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:s,lat:u}=Er.convert(t);let d=this._sw.lng<=s&&s<=this._ne.lng;return this._sw.lng>this._ne.lng&&(d=this._sw.lng>=s&&s>=this._ne.lng),this._sw.lat<=u&&u<=this._ne.lat&&d}static convert(t){return t instanceof _a?t:t&&new _a(t)}}const qp=2*Math.PI*ih;function oh(i){return qp*Math.cos(i*Math.PI/180)}function wd(i){return(180+i)/360}function sh(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function Dd(i,t){return i/oh(t)}function ah(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}class ao{constructor(t,s,u=0){this.x=+t,this.y=+s,this.z=+u}static fromLngLat(t,s=0){const u=Er.convert(t);return new ao(wd(u.lng),sh(u.lat),Dd(s,u.lat))}toLngLat(){return new Er(360*this.x-180,ah(this.y))}toAltitude(){return this.z*oh(ah(this.y))}meterInMercatorCoordinateUnits(){return 1/qp*(t=ah(this.y),1/Math.cos(t*Math.PI/180));var t}}function Cd(i,t,s){var u=2*Math.PI*6378137/256/Math.pow(2,s);return[i*u-2*Math.PI*6378137/2,t*u-2*Math.PI*6378137/2]}class sc{constructor(t,s,u){this.z=t,this.x=s,this.y=u,this.key=su(0,t,t,s,u)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,s,u){const d=(_=this.y,b=this.z,C=Cd(256*(y=this.x),256*(_=Math.pow(2,b)-_-1),b),P=Cd(256*(y+1),256*(_+1),b),C[0]+","+C[1]+","+P[0]+","+P[1]);var y,_,b,C,P;const V=function($,Z,J){let ee,de="";for(let he=$;he>0;he--)ee=1<<he-1,de+=(Z&ee?1:0)+(J&ee?2:0);return de}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===u?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,s>1?"@2x":"").replace(/{quadkey}/g,V).replace(/{bbox-epsg-3857}/g,d)}getTilePoint(t){const s=Math.pow(2,this.z);return new _e((t.x*s-this.x)*Pr,(t.y*s-this.y)*Pr)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Ed{constructor(t,s){this.wrap=t,this.canonical=s,this.key=su(t,s.z,s.z,s.x,s.y)}}class Oo{constructor(t,s,u,d,y){this.overscaledZ=t,this.wrap=s,this.canonical=new sc(u,+d,+y),this.key=su(s,t,u,d,y)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){const s=this.canonical.z-t;return t>this.canonical.z?new Oo(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Oo(t,this.wrap,t,this.canonical.x>>s,this.canonical.y>>s)}calculateScaledKey(t,s){const u=this.canonical.z-t;return t>this.canonical.z?su(this.wrap*+s,t,this.canonical.z,this.canonical.x,this.canonical.y):su(this.wrap*+s,t,t,this.canonical.x>>u,this.canonical.y>>u)}isChildOf(t){if(t.wrap!==this.wrap)return!1;const s=this.canonical.z-t.canonical.z;return 0===t.overscaledZ||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>s&&t.canonical.y===this.canonical.y>>s}children(t){if(this.overscaledZ>=t)return[new Oo(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const s=this.canonical.z+1,u=2*this.canonical.x,d=2*this.canonical.y;return[new Oo(s,this.wrap,s,u,d),new Oo(s,this.wrap,s,u+1,d),new Oo(s,this.wrap,s,u,d+1),new Oo(s,this.wrap,s,u+1,d+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new Oo(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new Oo(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Ed(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(t){return this.canonical.getTilePoint(new ao(t.x-this.wrap,t.y))}}function su(i,t,s,u,d){(i*=2)<0&&(i=-1*i-1);const y=1<<s;return(y*y*i+y*d+u).toString(36)+s.toString(36)+t.toString(36)}Pt("CanonicalTileID",sc),Pt("OverscaledTileID",Oo,{omit:["posMatrix"]});class Md{constructor(t,s,u){if(this.uid=t,s.height!==s.width)throw new RangeError("DEM tiles must be square");if(u&&"mapbox"!==u&&"terrarium"!==u)return void wn(`"${u}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=s.height;const d=this.dim=s.height-2;this.data=new Uint32Array(s.data.buffer),this.encoding=u||"mapbox";for(let y=0;y<d;y++)this.data[this._idx(-1,y)]=this.data[this._idx(0,y)],this.data[this._idx(d,y)]=this.data[this._idx(d-1,y)],this.data[this._idx(y,-1)]=this.data[this._idx(y,0)],this.data[this._idx(y,d)]=this.data[this._idx(y,d-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(d,-1)]=this.data[this._idx(d-1,0)],this.data[this._idx(-1,d)]=this.data[this._idx(0,d-1)],this.data[this._idx(d,d)]=this.data[this._idx(d-1,d-1)]}get(t,s){const u=new Uint8Array(this.data.buffer),d=4*this._idx(t,s);return("terrarium"===this.encoding?this._unpackTerrarium:this._unpackMapbox)(u[d],u[d+1],u[d+2])}getUnpackVector(){return"terrarium"===this.encoding?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]}_idx(t,s){if(t<-1||t>=this.dim+1||s<-1||s>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(s+1)*this.stride+(t+1)}_unpackMapbox(t,s,u){return(256*t*256+256*s+u)/10-1e4}_unpackTerrarium(t,s,u){return 256*t+s+u/256-32768}getPixels(){return new wo({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(t,s,u){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let d=s*this.dim,y=s*this.dim+this.dim,_=u*this.dim,b=u*this.dim+this.dim;switch(s){case-1:d=y-1;break;case 1:y=d+1}switch(u){case-1:_=b-1;break;case 1:b=_+1}const C=-s*this.dim,P=-u*this.dim;for(let V=_;V<b;V++)for(let $=d;$<y;$++)this.data[this._idx($,V)]=t.data[this._idx($+C,V+P)]}}Pt("DEMData",Md);class lh{constructor(t){this._stringToNumber={},this._numberToString=[];for(let s=0;s<t.length;s++){const u=t[s];this._stringToNumber[u]=s,this._numberToString[s]=u}}encode(t){return this._stringToNumber[t]}decode(t){return this._numberToString[t]}}class Id{constructor(t,s,u,d,y){this.type="Feature",this._vectorTileFeature=t,t._z=s,t._x=u,t._y=d,this.properties=t.properties,this.id=y}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={geometry:this.geometry};for(const s in this)"_geometry"!==s&&"_vectorTileFeature"!==s&&(t[s]=this[s]);return t}}class Sd{constructor(t,s){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new Go(Pr,16,0),this.grid3D=new Go(Pr,16,0),this.featureIndexArray=new Mn,this.promoteId=s}insert(t,s,u,d,y,_){const b=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(u,d,y);const C=_?this.grid3D:this.grid;for(let P=0;P<s.length;P++){const V=s[P],$=[1/0,1/0,-1/0,-1/0];for(let Z=0;Z<V.length;Z++){const J=V[Z];$[0]=Math.min($[0],J.x),$[1]=Math.min($[1],J.y),$[2]=Math.max($[2],J.x),$[3]=Math.max($[3],J.y)}$[0]<Pr&&$[1]<Pr&&$[2]>=0&&$[3]>=0&&C.insert(b,$[0],$[1],$[2],$[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Os.VectorTile(new Gu(this.rawTileData)).layers,this.sourceLayerCoder=new lh(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(t,s,u,d){this.loadVTLayers();const y=t.params||{},_=Pr/t.tileSize/t.scale,b=F(y.filter),C=t.queryGeometry,P=t.queryPadding*_,V=Cn(C),$=this.grid.query(V.minX-P,V.minY-P,V.maxX+P,V.maxY+P),Z=Cn(t.cameraQueryGeometry),J=this.grid3D.query(Z.minX-P,Z.minY-P,Z.maxX+P,Z.maxY+P,(he,be,Le,Fe)=>function(Ve,Ye,He,Tt,$t){for(const wt of Ve)if(Ye<=wt.x&&He<=wt.y&&Tt>=wt.x&&$t>=wt.y)return!0;const ft=[new _e(Ye,He),new _e(Ye,$t),new _e(Tt,$t),new _e(Tt,He)];if(Ve.length>2)for(const wt of ft)if(cl(Ve,wt))return!0;for(let wt=0;wt<Ve.length-1;wt++)if(hp(Ve[wt],Ve[wt+1],ft))return!0;return!1}(t.cameraQueryGeometry,he-P,be-P,Le+P,Fe+P));for(const he of J)$.push(he);$.sort(Td);const ee={};let de;for(let he=0;he<$.length;he++){const be=$[he];if(be===de)continue;de=be;const Le=this.featureIndexArray.get(be);let Fe=null;this.loadMatchingFeature(ee,Le.bucketIndex,Le.sourceLayerIndex,Le.featureIndex,b,y.layers,y.availableImages,s,u,d,(Ve,Ye,He)=>(Fe||(Fe=za(Ve)),Ye.queryIntersectsFeature(C,Ve,He,Fe,this.z,t.transform,_,t.pixelPosMatrix)))}return ee}loadMatchingFeature(t,s,u,d,y,_,b,C,P,V,$){const Z=this.bucketLayerIDs[s];if(_&&!function(he,be){for(let Le=0;Le<he.length;Le++)if(be.indexOf(he[Le])>=0)return!0;return!1}(_,Z))return;const J=this.sourceLayerCoder.decode(u),ee=this.vtLayers[J].feature(d);if(y.needGeometry){const he=Na(ee,!0);if(!y.filter(new yr(this.tileID.overscaledZ),he,this.tileID.canonical))return}else if(!y.filter(new yr(this.tileID.overscaledZ),ee))return;const de=this.getId(ee,J);for(let he=0;he<Z.length;he++){const be=Z[he];if(_&&_.indexOf(be)<0)continue;const Le=C[be];if(!Le)continue;let Fe={};de&&V&&(Fe=V.getState(Le.sourceLayer||"_geojsonTileLayer",de));const Ve=Ze({},P[be]);Ve.paint=Ad(Ve.paint,Le.paint,ee,Fe,b),Ve.layout=Ad(Ve.layout,Le.layout,ee,Fe,b);const Ye=!$||$(ee,Le,Fe);if(!Ye)continue;const He=new Id(ee,this.z,this.x,this.y,de);He.layer=Ve;let Tt=t[be];void 0===Tt&&(Tt=t[be]=[]),Tt.push({featureIndex:d,feature:He,intersectionZ:Ye})}}lookupSymbolFeatures(t,s,u,d,y,_,b,C){const P={};this.loadVTLayers();const V=F(y);for(const $ of t)this.loadMatchingFeature(P,u,d,$,V,_,b,C,s);return P}hasLayer(t){for(const s of this.bucketLayerIDs)for(const u of s)if(t===u)return!0;return!1}getId(t,s){let u=t.id;return this.promoteId&&(u=t.properties["string"==typeof this.promoteId?this.promoteId:this.promoteId[s]],"boolean"==typeof u&&(u=Number(u))),u}}function Ad(i,t,s,u,d){return Vt(i,(y,_)=>{const b=t instanceof Ts?t.get(_):null;return b&&b.evaluate?b.evaluate(s,u,d):b})}function Cn(i){let t=1/0,s=1/0,u=-1/0,d=-1/0;for(const y of i)t=Math.min(t,y.x),s=Math.min(s,y.y),u=Math.max(u,y.x),d=Math.max(d,y.y);return{minX:t,minY:s,maxX:u,maxY:d}}function Td(i,t){return t-i}var ac;Pt("FeatureIndex",Sd,{omit:["rawTileData","sourceLayerCoder"]}),f.PerformanceMarkers=void 0,(ac=f.PerformanceMarkers||(f.PerformanceMarkers={})).create="create",ac.load="load",ac.fullLoad="fullLoad";let au=null,lu=[];const uh=1e3/30,Pd={mark(i){performance.mark(i)},frame(i){const t=i;null!=au&&lu.push(t-au),au=t},clearMetrics(){au=null,lu=[],performance.clearMeasures("loadTime"),performance.clearMeasures("fullLoadTime");for(const i in f.PerformanceMarkers)performance.clearMarks(f.PerformanceMarkers[i])},getPerformanceMetrics(){performance.measure("loadTime",f.PerformanceMarkers.create,f.PerformanceMarkers.load),performance.measure("fullLoadTime",f.PerformanceMarkers.create,f.PerformanceMarkers.fullLoad);const i=performance.getEntriesByName("loadTime")[0].duration,t=performance.getEntriesByName("fullLoadTime")[0].duration,s=lu.length,u=1/(lu.reduce((y,_)=>y+_,0)/s/1e3),d=lu.filter(y=>y>uh).reduce((y,_)=>y+(_-uh)/uh,0);return{loadTime:i,fullLoadTime:t,fps:u,percentDroppedFrames:d/(s+d)*100}}};f.AJAXError=mr,f.ARRAY_TYPE=Ua,f.Actor=class{constructor(i,t,s){this.target=i,this.parent=t,this.mapId=s,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},Vn(["receive","process"],this),this.invoker=new Hp(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=pt()?i:window}send(i,t,s,u,d=!1){const y=Math.round(1e18*Math.random()).toString(36).substring(0,10);s&&(this.callbacks[y]=s);const _=tn(this.globalScope)?void 0:[];return this.target.postMessage({id:y,type:i,hasCallback:!!s,targetMapId:u,mustQueue:d,sourceMapId:this.mapId,data:ca(t,_)},_),{cancel:()=>{s&&delete this.callbacks[y],this.target.postMessage({id:y,type:"<cancel>",targetMapId:u,sourceMapId:this.mapId})}}}receive(i){const t=i.data,s=t.id;if(s&&(!t.targetMapId||this.mapId===t.targetMapId))if("<cancel>"===t.type){delete this.tasks[s];const u=this.cancelCallbacks[s];delete this.cancelCallbacks[s],u&&u()}else pt()||t.mustQueue?(this.tasks[s]=t,this.taskQueue.push(s),this.invoker.trigger()):this.processTask(s,t)}process(){if(!this.taskQueue.length)return;const i=this.taskQueue.shift(),t=this.tasks[i];delete this.tasks[i],this.taskQueue.length&&this.invoker.trigger(),t&&this.processTask(i,t)}processTask(i,t){if("<response>"===t.type){const s=this.callbacks[i];delete this.callbacks[i],s&&(t.error?s(as(t.error)):s(null,as(t.data)))}else{let s=!1;const u=tn(this.globalScope)?void 0:[],d=t.hasCallback?(b,C)=>{s=!0,delete this.cancelCallbacks[i],this.target.postMessage({id:i,type:"<response>",sourceMapId:this.mapId,error:b?ca(b):null,data:ca(C,u)},u)}:b=>{s=!0};let y=null;const _=as(t.data);if(this.parent[t.type])y=this.parent[t.type](t.sourceMapId,_,d);else if(this.parent.getWorkerSource){const b=t.type.split(".");y=this.parent.getWorkerSource(t.sourceMapId,b[0],_.source)[b[1]](_,d)}else d(new Error(`Could not find function ${t.type}`));!s&&y&&y.cancel&&(this.cancelCallbacks[i]=y.cancel)}}remove(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)}},f.AlphaImage=Pu,f.CanonicalTileID=sc,f.CollisionBoxArray=Oe,f.CollisionCircleLayoutArray=class extends z{},f.Color=B,f.DEMData=Md,f.DataConstantProperty=zt,f.DictionaryCoder=lh,f.EXTENT=Pr,f.ErrorEvent=T,f.EvaluationParameters=yr,f.Event=Ke,f.Evented=ae,f.FeatureIndex=Sd,f.FillBucket=Bc,f.FillExtrusionBucket=$c,f.GeoJSONFeature=Id,f.ImageAtlas=ud,f.ImagePosition=Yc,f.LineBucket=Gc,f.LineStripIndexArray=class extends Me{},f.LngLat=Er,f.LngLatBounds=_a,f.MercatorCoordinate=ao,f.ONE_EM=24,f.OverscaledTileID=Oo,f.PerformanceUtils=Pd,f.PosArray=class extends fa{},f.Properties=Cr,f.QuadTriangleArray=class extends X{},f.RGBAImage=wo,f.RasterBoundsArray=class extends zi{},f.RequestPerformance=class{constructor(i){this._marks={start:[i.url,"start"].join("#"),end:[i.url,"end"].join("#"),measure:i.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let i=performance.getEntriesByName(this._marks.measure);return 0===i.length&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),i=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),i}},f.ResourceType=Gi,f.SegmentVector=Rn,f.SymbolBucket=Vs,f.Transitionable=Ra,f.TriangleIndexArray=Qi,f.Uniform1f=ri,f.Uniform1i=class extends bo{constructor(i,t){super(i,t),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},f.Uniform2f=class extends bo{constructor(i,t){super(i,t),this.current=[0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1]))}},f.Uniform3f=class extends bo{constructor(i,t){super(i,t),this.current=[0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2]))}},f.Uniform4f=wu,f.UniformColor=Oa,f.UniformMatrix4f=class extends bo{constructor(i,t){super(i,t),this.current=Mm}set(i){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let t=1;t<16;t++)if(i[t]!==this.current[t]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}},f.UnwrappedTileID=Ed,f.ValidationError=Te,f.ZoomHistory=ha,f.addDynamicAttributes=tc,f.asyncAll=function(i,t,s){if(!i.length)return s(null,[]);let u=i.length;const d=new Array(i.length);let y=null;i.forEach((_,b)=>{t(_,(C,P)=>{C&&(y=C),d[b]=P,0==--u&&s(y,d)})})},f.bezier=kt,f.bindAll=Vn,f.cacheEntryPossiblyAdded=function(i){qn++,qn>fr&&(i.getActor().send("enforceCacheSizeLimit",An),qn=0)},f.clamp=Ee,f.clearTileCache=function(i){const t=caches.delete(Re);i&&t.catch(i).then(()=>i())},f.clipLine=Wu,f.clone=function(i){var t=new Ua(16);return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],t},f.clone$1=Gt,f.collisionCircleLayout=Wl,f.config=De,f.create=function(){var i=new Ua(16);return Ua!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},f.createExpression=Lo,f.createFilter=F,f.createLayout=$r,f.createStyleLayer=function(i){return"custom"===i.type?new bd(i):new Gp[i.type](i)},f.dot=function(i,t){return i[0]*t[0]+i[1]*t[1]+i[2]*t[2]+i[3]*t[3]},f.ease=It,f.emitValidationErrors=Ml,f.enforceCacheSizeLimit=function(i){on(),ze&&ze.then(t=>{t.keys().then(s=>{for(let u=0;u<s.length-i;u++)t.delete(s[u])})})},f.evaluateSizeForFeature=function(i,{uSize:t,uSizeT:s},{lowerSize:u,upperSize:d}){return"source"===i.kind?u/fs:"composite"===i.kind?Sr(u/fs,d/fs,s):t},f.evaluateSizeForZoom=function(i,t){let s=0,u=0;if("constant"===i.kind)u=i.layoutSize;else if("source"!==i.kind){const{interpolationType:d,minZoom:y,maxZoom:_}=i,b=d?Ee(ni.interpolationFactor(d,t,y,_),0,1):0;"camera"===i.kind?u=Sr(i.minSize,i.maxSize,b):s=b}return{uSizeT:s,uSize:u}},f.evaluateVariableOffset=nh,f.evented=As,f.exported=me,f.exported$1=kn,f.extend=Ze,f.filterObject=Un,f.getAnchorAlignment=eu,f.getAnchorJustification=Qu,f.getArrayBuffer=Qr,f.getImage=wr,f.getJSON=function(i,t){return Ci(Ze(i,{type:"json"}),t)},f.getOverlapMode=iu,f.getRTLTextPluginStatus=Tl,f.getReferrer=Hi,f.getVideo=function(i,t){const s=window.document.createElement("video");s.muted=!0,s.onloadstart=function(){t(null,s)};for(let u=0;u<i.length;u++){const d=window.document.createElement("source");qi(i[u])||(s.crossOrigin="Anonymous"),d.src=i[u],s.appendChild(d)}return{cancel:()=>{}}},f.identity=ja,f.invert=function(i,t){var s=t[0],u=t[1],d=t[2],y=t[3],_=t[4],b=t[5],C=t[6],P=t[7],V=t[8],$=t[9],Z=t[10],J=t[11],ee=t[12],de=t[13],he=t[14],be=t[15],Le=s*b-u*_,Fe=s*C-d*_,Ve=s*P-y*_,Ye=u*C-d*b,He=u*P-y*b,Tt=d*P-y*C,$t=V*de-$*ee,ft=V*he-Z*ee,wt=V*be-J*ee,lt=$*he-Z*de,Ft=$*be-J*de,Dt=Z*be-J*he,rt=Le*Dt-Fe*Ft+Ve*lt+Ye*wt-He*ft+Tt*$t;return rt?(i[0]=(b*Dt-C*Ft+P*lt)*(rt=1/rt),i[1]=(d*Ft-u*Dt-y*lt)*rt,i[2]=(de*Tt-he*He+be*Ye)*rt,i[3]=(Z*He-$*Tt-J*Ye)*rt,i[4]=(C*wt-_*Dt-P*ft)*rt,i[5]=(s*Dt-d*wt+y*ft)*rt,i[6]=(he*Ve-ee*Tt-be*Fe)*rt,i[7]=(V*Tt-Z*Ve+J*Fe)*rt,i[8]=(_*Ft-b*wt+P*$t)*rt,i[9]=(u*wt-s*Ft-y*$t)*rt,i[10]=(ee*He-de*Ve+be*Le)*rt,i[11]=($*Ve-V*He-J*Le)*rt,i[12]=(b*ft-_*lt-C*$t)*rt,i[13]=(s*lt-u*ft+d*$t)*rt,i[14]=(de*Fe-ee*Ye-he*Le)*rt,i[15]=(V*Ye-$*Fe+Z*Le)*rt,i):null},f.isImageBitmap=en,f.isSafari=tn,f.keysDifference=function(i,t){const s=[];for(const u in i)u in t||s.push(u);return s},f.lazyLoadRTLTextPlugin=function(){wi.isLoading()||wi.isLoaded()||"deferred"!==Tl()||_o()},f.makeRequest=Ci,f.mapObject=Vt,f.mercatorXfromLng=wd,f.mercatorYfromLat=sh,f.mercatorZfromAltitude=Dd,f.mul=pp,f.multiply=Bl,f.nextPowerOfTwo=function(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))},f.number=Sr,f.ortho=function(i,t,s,u,d,y,_){var b=1/(t-s),C=1/(u-d),P=1/(y-_);return i[0]=-2*b,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*C,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*P,i[11]=0,i[12]=(t+s)*b,i[13]=(d+u)*C,i[14]=(_+y)*P,i[15]=1,i},f.parseCacheControl=Ge,f.parseGlyphPBF=function(i){return new Gu(i).readFields(sd,[])},f.pbf=Gu,f.performSymbolLayout=function(i,t,s,u,d,y,_){i.createArrays(),i.tilePixelRatio=Pr/(512*i.overscaling),i.compareText={},i.iconsNeedLinear=!1;const b=i.layers[0].layout,C=i.layers[0]._unevaluatedLayout._values,P={layoutIconSize:C["icon-size"].possiblyEvaluate(new yr(i.zoom+1),_),layoutTextSize:C["text-size"].possiblyEvaluate(new yr(i.zoom+1),_),textMaxSize:C["text-size"].possiblyEvaluate(new yr(18))};if("composite"===i.textSizeData.kind){const{minZoom:ee,maxZoom:de}=i.textSizeData;P.compositeTextSizes=[C["text-size"].possiblyEvaluate(new yr(ee),_),C["text-size"].possiblyEvaluate(new yr(de),_)]}if("composite"===i.iconSizeData.kind){const{minZoom:ee,maxZoom:de}=i.iconSizeData;P.compositeIconSizes=[C["icon-size"].possiblyEvaluate(new yr(ee),_),C["icon-size"].possiblyEvaluate(new yr(de),_)]}const V=24*b.get("text-line-height"),$="viewport"!==b.get("text-rotation-alignment")&&"point"!==b.get("symbol-placement"),Z=b.get("text-keep-upright"),J=b.get("text-size");for(const ee of i.features){const de=b.get("text-font").evaluate(ee,{},_).join(","),he=J.evaluate(ee,{},_),be=P.layoutTextSize.evaluate(ee,{},_),Le=P.layoutIconSize.evaluate(ee,{},_),Fe={horizontal:{},vertical:void 0},Ve=ee.text;let Ye,He=[0,0];if(Ve){const ft=Ve.toString(),wt=24*b.get("text-letter-spacing").evaluate(ee,{},_),lt=_u(ft)?wt:0,Ft=b.get("text-anchor").evaluate(ee,{},_),Dt=b.get("text-variable-anchor");if(!Dt){const Xn=b.get("text-radial-offset").evaluate(ee,{},_);He=Xn?nh(Ft,[24*Xn,th]):b.get("text-offset").evaluate(ee,{},_).map(xr=>24*xr)}let rt=$?"center":b.get("text-justify").evaluate(ee,{},_);const qt=b.get("symbol-placement"),Zt="point"===qt?24*b.get("text-max-width").evaluate(ee,{},_):0,On=()=>{i.allowVerticalPlacement&&da(ft)&&(Fe.vertical=Ns(Ve,t,s,d,de,Zt,V,Ft,"left",lt,He,f.WritingMode.vertical,!0,qt,be,he))};if(!$&&Dt){const Xn="auto"===rt?Dt.map(pr=>Qu(pr)):[rt];let xr=!1;for(let pr=0;pr<Xn.length;pr++){const fi=Xn[pr];if(!Fe.horizontal[fi])if(xr)Fe.horizontal[fi]=Fe.horizontal[0];else{const Vr=Ns(Ve,t,s,d,de,Zt,V,"center",fi,lt,He,f.WritingMode.horizontal,!1,qt,be,he);Vr&&(Fe.horizontal[fi]=Vr,xr=1===Vr.positionedLines.length)}}On()}else{"auto"===rt&&(rt=Qu(Ft));const Xn=Ns(Ve,t,s,d,de,Zt,V,Ft,rt,lt,He,f.WritingMode.horizontal,!1,qt,be,he);Xn&&(Fe.horizontal[rt]=Xn),On(),da(ft)&&$&&Z&&(Fe.vertical=Ns(Ve,t,s,d,de,Zt,V,Ft,rt,lt,He,f.WritingMode.vertical,!1,qt,be,he))}}let Tt=!1;if(ee.icon&&ee.icon.name){const ft=u[ee.icon.name];ft&&(Ye=hd(d[ee.icon.name],b.get("icon-offset").evaluate(ee,{},_),b.get("icon-anchor").evaluate(ee,{},_)),Tt=!!ft.sdf,void 0===i.sdfIcons?i.sdfIcons=Tt:i.sdfIcons!==Tt&&wn("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ft.pixelRatio!==i.pixelRatio||0!==b.get("icon-rotate").constantOr(1))&&(i.iconsNeedLinear=!0))}const $t=_d(Fe.horizontal)||Fe.vertical;i.iconsInText=!!$t&&$t.iconsInText,($t||Ye)&&Ya(i,ee,Fe,Ye,u,P,be,Le,He,Tt,_)}y&&i.generateCollisionDebugBuffers()},f.perspective=function(i,t,s,u,d){var y,_=1/Math.tan(t/2);return i[0]=_/s,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=_,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,null!=d&&d!==1/0?(i[10]=(d+u)*(y=1/(u-d)),i[14]=2*d*u*y):(i[10]=-1,i[14]=-2*u),i},f.pick=function(i,t){const s={};for(let u=0;u<t.length;u++){const d=t[u];d in i&&(s[d]=i[d])}return s},f.plugin=wi,f.pointGeometry=_e,f.polygonIntersectsPolygon=ll,f.potpack=ld,f.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],f.register=Pt,f.registerForPluginStateChange=function(i){return i({pluginStatus:di,pluginURL:yo}),As.on("pluginStateChange",i),i},f.renderColorRamp=Oh,f.rotateX=function(i,t,s){var u=Math.sin(s),d=Math.cos(s),y=t[4],_=t[5],b=t[6],C=t[7],P=t[8],V=t[9],$=t[10],Z=t[11];return t!==i&&(i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i[4]=y*d+P*u,i[5]=_*d+V*u,i[6]=b*d+$*u,i[7]=C*d+Z*u,i[8]=P*d-y*u,i[9]=V*d-_*u,i[10]=$*d-b*u,i[11]=Z*d-C*u,i},f.rotateZ=function(i,t,s){var u=Math.sin(s),d=Math.cos(s),y=t[0],_=t[1],b=t[2],C=t[3],P=t[4],V=t[5],$=t[6],Z=t[7];return t!==i&&(i[8]=t[8],i[9]=t[9],i[10]=t[10],i[11]=t[11],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i[0]=y*d+P*u,i[1]=_*d+V*u,i[2]=b*d+$*u,i[3]=C*d+Z*u,i[4]=P*d-y*u,i[5]=V*d-_*u,i[6]=$*d-b*u,i[7]=Z*d-C*u,i},f.scale=function(i,t,s){var u=s[0],d=s[1],y=s[2];return i[0]=t[0]*u,i[1]=t[1]*u,i[2]=t[2]*u,i[3]=t[3]*u,i[4]=t[4]*d,i[5]=t[5]*d,i[6]=t[6]*d,i[7]=t[7]*d,i[8]=t[8]*y,i[9]=t[9]*y,i[10]=t[10]*y,i[11]=t[11]*y,i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15],i},f.scale$1=function(i,t,s){return i[0]=t[0]*s,i[1]=t[1]*s,i[2]=t[2]*s,i[3]=t[3]*s,i},f.setCacheLimits=function(i,t){An=i,fr=t},f.setRTLTextPlugin=function(i,t,s=!1){if(di===nl||di===Il||di===Sl)throw new Error("setRTLTextPlugin cannot be called multiple times.");yo=me.resolveURL(i),di=nl,Al=t,La(),s||_o()},f.spec=pe,f.sphericalToCartesian=function([i,t,s]){return t+=90,t*=Math.PI/180,s*=Math.PI/180,{x:i*Math.cos(t)*Math.sin(s),y:i*Math.sin(t)*Math.sin(s),z:i*Math.cos(s)}},f.toEvaluationFeature=Na,f.transformMat4=Tu,f.translate=function(i,t,s){var u,d,y,_,b,C,P,V,$,Z,J,ee,de=s[0],he=s[1],be=s[2];return t===i?(i[12]=t[0]*de+t[4]*he+t[8]*be+t[12],i[13]=t[1]*de+t[5]*he+t[9]*be+t[13],i[14]=t[2]*de+t[6]*he+t[10]*be+t[14],i[15]=t[3]*de+t[7]*he+t[11]*be+t[15]):(d=t[1],y=t[2],_=t[3],b=t[4],C=t[5],P=t[6],V=t[7],$=t[8],Z=t[9],J=t[10],ee=t[11],i[0]=u=t[0],i[1]=d,i[2]=y,i[3]=_,i[4]=b,i[5]=C,i[6]=P,i[7]=V,i[8]=$,i[9]=Z,i[10]=J,i[11]=ee,i[12]=u*de+b*he+$*be+t[12],i[13]=d*de+C*he+Z*be+t[13],i[14]=y*de+P*he+J*be+t[14],i[15]=_*de+V*he+ee*be+t[15]),i},f.triggerPluginCompletionEvent=ka,f.unicodeBlockLookup=yt,f.uniqueId=function(){return Wt++},f.validateCustomStyleLayer=function(i){const t=[],s=i.id;return void 0===s&&t.push({message:`layers.${s}: missing required property "id"`}),void 0===i.render&&t.push({message:`layers.${s}: missing required method "render"`}),i.renderingMode&&"2d"!==i.renderingMode&&"3d"!==i.renderingMode&&t.push({message:`layers.${s}: property "renderingMode" must be either "2d" or "3d"`}),t},f.validateLight=Ac,f.validateStyle=Ss,f.vectorTile=Os,f.warnOnce=wn,f.wrap=xt}),Ae(0,function(f){function it(ne){const k=typeof ne;if("number"===k||"boolean"===k||"string"===k||null==ne)return JSON.stringify(ne);if(Array.isArray(ne)){let H="[";for(const U of ne)H+=`${it(U)},`;return`${H}]`}const B=Object.keys(ne).sort();let Q="{";for(let H=0;H<B.length;H++)Q+=`${JSON.stringify(B[H])}:${it(ne[B[H]])},`;return`${Q}}`}function Qt(ne){let k="";for(const B of f.refProperties)k+=`/${it(ne[B])}`;return k}class kt{constructor(k){this.keyCache={},k&&this.replace(k)}replace(k){this._layerConfigs={},this._layers={},this.update(k,[])}update(k,B){for(const H of k){this._layerConfigs[H.id]=H;const U=this._layers[H.id]=f.createStyleLayer(H);U._featureFilter=f.createFilter(U.filter),this.keyCache[H.id]&&delete this.keyCache[H.id]}for(const H of B)delete this.keyCache[H],delete this._layerConfigs[H],delete this._layers[H];this.familiesBySource={};const Q=function(H,U){const G={};for(let te=0;te<H.length;te++){const le=U&&U[H[te].id]||Qt(H[te]);U&&(U[H[te].id]=le);let Ce=G[le];Ce||(Ce=G[le]=[]),Ce.push(H[te])}const Y=[];for(const te in G)Y.push(G[te]);return Y}(Object.values(this._layerConfigs),this.keyCache);for(const H of Q){const U=H.map(Be=>this._layers[Be.id]),G=U[0];if("none"===G.visibility)continue;const Y=G.source||"";let te=this.familiesBySource[Y];te||(te=this.familiesBySource[Y]={});const le=G.sourceLayer||"_geojsonTileLayer";let Ce=te[le];Ce||(Ce=te[le]=[]),Ce.push(U)}}}class It{constructor(k){const B={},Q=[];for(const Y in k){const te=k[Y],le=B[Y]={};for(const Ce in te){const Be=te[+Ce];if(!Be||0===Be.bitmap.width||0===Be.bitmap.height)continue;const Pe={x:0,y:0,w:Be.bitmap.width+2,h:Be.bitmap.height+2};Q.push(Pe),le[Ce]={rect:Pe,metrics:Be.metrics}}}const{w:H,h:U}=f.potpack(Q),G=new f.AlphaImage({width:H||1,height:U||1});for(const Y in k){const te=k[Y];for(const le in te){const Ce=te[+le];if(!Ce||0===Ce.bitmap.width||0===Ce.bitmap.height)continue;const Be=B[Y][le].rect;f.AlphaImage.copy(Ce.bitmap,G,{x:0,y:0},{x:Be.x+1,y:Be.y+1},Ce.bitmap)}}this.image=G,this.positions=B}}f.register("GlyphAtlas",It);class Ee{constructor(k){this.tileID=new f.OverscaledTileID(k.tileID.overscaledZ,k.tileID.wrap,k.tileID.canonical.z,k.tileID.canonical.x,k.tileID.canonical.y),this.uid=k.uid,this.zoom=k.zoom,this.pixelRatio=k.pixelRatio,this.tileSize=k.tileSize,this.source=k.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=k.showCollisionBoxes,this.collectResourceTiming=!!k.collectResourceTiming,this.returnDependencies=!!k.returnDependencies,this.promoteId=k.promoteId}parse(k,B,Q,H,U){this.status="parsing",this.data=k,this.collisionBoxArray=new f.CollisionBoxArray;const G=new f.DictionaryCoder(Object.keys(k.layers).sort()),Y=new f.FeatureIndex(this.tileID,this.promoteId);Y.bucketLayerIDs=[];const te={},le={featureIndex:Y,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:Q},Ce=B.familiesBySource[this.source];for(const dt in Ce){const St=k.layers[dt];if(!St)continue;1===St.version&&f.warnOnce(`Vector tile source "${this.source}" layer "${dt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Ut=G.encode(dt),Qn=[];for(let En=0;En<St.length;En++){const rr=St.feature(En),bn=Y.getId(rr,dt);Qn.push({feature:rr,id:bn,index:En,sourceLayerIndex:Ut})}for(const En of Ce[dt]){const rr=En[0];rr.minzoom&&this.zoom<Math.floor(rr.minzoom)||rr.maxzoom&&this.zoom>=rr.maxzoom||"none"!==rr.visibility&&(xt(En,this.zoom,Q),(te[rr.id]=rr.createBucket({index:Y.bucketLayerIDs.length,layers:En,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Ut,sourceID:this.source})).populate(Qn,le,this.tileID.canonical),Y.bucketLayerIDs.push(En.map(bn=>bn.id)))}}let Be,Pe,tt,st;const ct=f.mapObject(le.glyphDependencies,dt=>Object.keys(dt).map(Number));Object.keys(ct).length?H.send("getGlyphs",{uid:this.uid,stacks:ct},(dt,St)=>{Be||(Be=dt,Pe=St,We.call(this))}):Pe={};const Mt=Object.keys(le.iconDependencies);Mt.length?H.send("getImages",{icons:Mt,source:this.source,tileID:this.tileID,type:"icons"},(dt,St)=>{Be||(Be=dt,tt=St,We.call(this))}):tt={};const sn=Object.keys(le.patternDependencies);function We(){if(Be)return U(Be);if(Pe&&tt&&st){const dt=new It(Pe),St=new f.ImageAtlas(tt,st);for(const Ut in te){const Qn=te[Ut];Qn instanceof f.SymbolBucket?(xt(Qn.layers,this.zoom,Q),f.performSymbolLayout(Qn,Pe,dt.positions,tt,St.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):Qn.hasPattern&&(Qn instanceof f.LineBucket||Qn instanceof f.FillBucket||Qn instanceof f.FillExtrusionBucket)&&(xt(Qn.layers,this.zoom,Q),Qn.addFeatures(le,this.tileID.canonical,St.patternPositions))}this.status="done",U(null,{buckets:Object.values(te).filter(Ut=>!Ut.isEmpty()),featureIndex:Y,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:dt.image,imageAtlas:St,glyphMap:this.returnDependencies?Pe:null,iconMap:this.returnDependencies?tt:null,glyphPositions:this.returnDependencies?dt.positions:null})}}sn.length?H.send("getImages",{icons:sn,source:this.source,tileID:this.tileID,type:"patterns"},(dt,St)=>{Be||(Be=dt,st=St,We.call(this))}):st={},We.call(this)}}function xt(ne,k,B){const Q=new f.EvaluationParameters(k);for(const H of ne)H.recalculate(Q,B)}function Ze(ne,k){const B=f.getArrayBuffer(ne.request,(Q,H,U,G)=>{Q?k(Q):H&&k(null,{vectorTile:new f.vectorTile.VectorTile(new f.pbf(H)),rawData:H,cacheControl:U,expires:G})});return()=>{B.cancel(),k()}}class Wt{constructor(k,B,Q,H){this.actor=k,this.layerIndex=B,this.availableImages=Q,this.loadVectorData=H||Ze,this.loading={},this.loaded={}}loadTile(k,B){const Q=k.uid;this.loading||(this.loading={});const H=!!(k&&k.request&&k.request.collectResourceTiming)&&new f.RequestPerformance(k.request),U=this.loading[Q]=new Ee(k);U.abort=this.loadVectorData(k,(G,Y)=>{if(delete this.loading[Q],G||!Y)return U.status="done",this.loaded[Q]=U,B(G);const te=Y.rawData,le={};Y.expires&&(le.expires=Y.expires),Y.cacheControl&&(le.cacheControl=Y.cacheControl);const Ce={};if(H){const Be=H.finish();Be&&(Ce.resourceTiming=JSON.parse(JSON.stringify(Be)))}U.vectorTile=Y.vectorTile,U.parse(Y.vectorTile,this.layerIndex,this.availableImages,this.actor,(Be,Pe)=>{if(Be||!Pe)return B(Be);B(null,f.extend({rawTileData:te.slice(0)},Pe,le,Ce))}),this.loaded=this.loaded||{},this.loaded[Q]=U})}reloadTile(k,B){const Q=this.loaded,H=k.uid,U=this;if(Q&&Q[H]){const G=Q[H];G.showCollisionBoxes=k.showCollisionBoxes;const Y=(te,le)=>{const Ce=G.reloadCallback;Ce&&(delete G.reloadCallback,G.parse(G.vectorTile,U.layerIndex,this.availableImages,U.actor,Ce)),B(te,le)};"parsing"===G.status?G.reloadCallback=Y:"done"===G.status&&(G.vectorTile?G.parse(G.vectorTile,this.layerIndex,this.availableImages,this.actor,Y):Y())}}abortTile(k,B){const Q=this.loading,H=k.uid;Q&&Q[H]&&Q[H].abort&&(Q[H].abort(),delete Q[H]),B()}removeTile(k,B){const Q=this.loaded,H=k.uid;Q&&Q[H]&&delete Q[H],B()}}class Vn{constructor(){this.loaded={}}loadTile(k,B){const{uid:Q,encoding:H,rawImageData:U}=k,G=f.isImageBitmap(U)?this.getImageData(U):U,Y=new f.DEMData(Q,G,H);this.loaded=this.loaded||{},this.loaded[Q]=Y,B(null,Y)}getImageData(k){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(k.width,k.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=k.width,this.offscreenCanvas.height=k.height,this.offscreenCanvasContext.drawImage(k,0,0,k.width,k.height);const B=this.offscreenCanvasContext.getImageData(-1,-1,k.width+2,k.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new f.RGBAImage({width:B.width,height:B.height},B.data)}removeTile(k){const B=this.loaded,Q=k.uid;B&&B[Q]&&delete B[Q]}}var Vt=function ne(k,B){var Q,H=k&&k.type;if("FeatureCollection"===H)for(Q=0;Q<k.features.length;Q++)ne(k.features[Q],B);else if("GeometryCollection"===H)for(Q=0;Q<k.geometries.length;Q++)ne(k.geometries[Q],B);else if("Feature"===H)ne(k.geometry,B);else if("Polygon"===H)Un(k.coordinates,B);else if("MultiPolygon"===H)for(Q=0;Q<k.coordinates.length;Q++)Un(k.coordinates[Q],B);return k};function Un(ne,k){if(0!==ne.length){Gt(ne[0],k);for(var B=1;B<ne.length;B++)Gt(ne[B],!k)}}function Gt(ne,k){for(var B=0,Q=0,H=0,U=ne.length,G=U-1;H<U;G=H++){var Y=(ne[H][0]-ne[G][0])*(ne[G][1]+ne[H][1]),te=B+Y;Q+=Math.abs(B)>=Math.abs(Y)?B-te+Y:Y-te+B,B=te}B+Q>=0!=!!k&&ne.reverse()}const dn=f.vectorTile.VectorTileFeature.prototype.toGeoJSON;class wn{constructor(k){this._feature=k,this.extent=f.EXTENT,this.type=k.type,this.properties=k.tags,"id"in k&&!isNaN(k.id)&&(this.id=parseInt(k.id,10))}loadGeometry(){if(1===this._feature.type){const k=[];for(const B of this._feature.geometry)k.push([new f.pointGeometry(B[0],B[1])]);return k}{const k=[];for(const B of this._feature.geometry){const Q=[];for(const H of B)Q.push(new f.pointGeometry(H[0],H[1]));k.push(Q)}return k}}toGeoJSON(k,B,Q){return dn.call(this,k,B,Q)}}class Dn{constructor(k){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=f.EXTENT,this.length=k.length,this._features=k}feature(k){return new wn(this._features[k])}}var Fn={exports:{}},pt=f.pointGeometry,Ge=f.vectorTile.VectorTileFeature,Xt=Yt;function Yt(ne,k){this.options=k||{},this.features=ne,this.length=ne.length}function jt(ne,k){this.id="number"==typeof ne.id?ne.id:void 0,this.type=ne.type,this.rawGeometry=1===ne.type?[ne.geometry]:ne.geometry,this.properties=ne.tags,this.extent=k||4096}Yt.prototype.feature=function(ne){return new jt(this.features[ne],this.options.extent)},jt.prototype.loadGeometry=function(){var ne=this.rawGeometry;this.geometry=[];for(var k=0;k<ne.length;k++){for(var B=ne[k],Q=[],H=0;H<B.length;H++)Q.push(new pt(B[H][0],B[H][1]));this.geometry.push(Q)}return this.geometry},jt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var ne=this.geometry,k=1/0,B=-1/0,Q=1/0,H=-1/0,U=0;U<ne.length;U++)for(var G=ne[U],Y=0;Y<G.length;Y++){var te=G[Y];k=Math.min(k,te.x),B=Math.max(B,te.x),Q=Math.min(Q,te.y),H=Math.max(H,te.y)}return[k,Q,B,H]},jt.prototype.toGeoJSON=Ge.prototype.toGeoJSON;var tn=f.pbf,en=Xt;function me(ne){var k=new tn;return function(B,Q){for(var H in B.layers)Q.writeMessage(3,_e,B.layers[H])}(ne,k),k.finish()}function _e(ne,k){var B;k.writeVarintField(15,ne.version||1),k.writeStringField(1,ne.name||""),k.writeVarintField(5,ne.extent||4096);var Q={keys:[],values:[],keycache:{},valuecache:{}};for(B=0;B<ne.length;B++)Q.feature=ne.feature(B),k.writeMessage(2,ke,Q);var H=Q.keys;for(B=0;B<H.length;B++)k.writeStringField(3,H[B]);var U=Q.values;for(B=0;B<U.length;B++)k.writeMessage(4,An,U[B])}function ke(ne,k){var B=ne.feature;void 0!==B.id&&k.writeVarintField(1,B.id),k.writeMessage(2,De,ne),k.writeVarintField(3,B.type),k.writeMessage(4,bt,B)}function De(ne,k){var B=ne.feature,Q=ne.keys,H=ne.values,U=ne.keycache,G=ne.valuecache;for(var Y in B.properties){var te=B.properties[Y],le=U[Y];if(null!==te){void 0===le&&(Q.push(Y),U[Y]=le=Q.length-1),k.writeVarint(le);var Ce=typeof te;"string"!==Ce&&"boolean"!==Ce&&"number"!==Ce&&(te=JSON.stringify(te));var Be=Ce+":"+te,Pe=G[Be];void 0===Pe&&(H.push(te),G[Be]=Pe=H.length-1),k.writeVarint(Pe)}}}function Re(ne,k){return(k<<3)+(7&ne)}function ze(ne){return ne<<1^ne>>31}function bt(ne,k){for(var B=ne.loadGeometry(),Q=ne.type,H=0,U=0,G=B.length,Y=0;Y<G;Y++){var te=B[Y],le=1;1===Q&&(le=te.length),k.writeVarint(Re(1,le));for(var Ce=3===Q?te.length-1:te.length,Be=0;Be<Ce;Be++){1===Be&&1!==Q&&k.writeVarint(Re(2,Ce-1));var Pe=te[Be].x-H,tt=te[Be].y-U;k.writeVarint(ze(Pe)),k.writeVarint(ze(tt)),H+=Pe,U+=tt}3===Q&&k.writeVarint(Re(7,1))}}function An(ne,k){var B=typeof ne;"string"===B?k.writeStringField(1,ne):"boolean"===B?k.writeBooleanField(7,ne):"number"===B&&(ne%1!=0?k.writeDoubleField(3,ne):ne<0?k.writeSVarintField(6,ne):k.writeVarintField(5,ne))}Fn.exports=me,Fn.exports.fromVectorTileJs=me,Fn.exports.fromGeojsonVt=function(ne,k){k=k||{};var B={};for(var Q in ne)B[Q]=new en(ne[Q].features,k),B[Q].name=Q,B[Q].version=k.version,B[Q].extent=k.extent;return me({layers:B})},Fn.exports.GeoJSONWrapper=en;var fr=Fn.exports;function on(ne,k,B,Q,H,U){if(H-Q<=B)return;const G=Q+H>>1;qn(ne,k,G,Q,H,U%2),on(ne,k,B,Q,G-1,U+1),on(ne,k,B,G+1,H,U+1)}function qn(ne,k,B,Q,H,U){for(;H>Q;){if(H-Q>600){const le=H-Q+1,Ce=B-Q+1,Be=Math.log(le),Pe=.5*Math.exp(2*Be/3),tt=.5*Math.sqrt(Be*Pe*(le-Pe)/le)*(Ce-le/2<0?-1:1);qn(ne,k,B,Math.max(Q,Math.floor(B-Ce*Pe/le+tt)),Math.min(H,Math.floor(B+(le-Ce)*Pe/le+tt)),U)}const G=k[2*B+U];let Y=Q,te=H;for(kn(ne,k,Q,B),k[2*H+U]>G&&kn(ne,k,Q,H);Y<te;){for(kn(ne,k,Y,te),Y++,te--;k[2*Y+U]<G;)Y++;for(;k[2*te+U]>G;)te--}k[2*Q+U]===G?kn(ne,k,Q,te):(te++,kn(ne,k,te,H)),te<=B&&(Q=te+1),B<=te&&(H=te-1)}}function kn(ne,k,B,Q){Zn(ne,B,Q),Zn(k,2*B,2*Q),Zn(k,2*B+1,2*Q+1)}function Zn(ne,k,B){const Q=ne[k];ne[k]=ne[B],ne[B]=Q}function hr(ne,k,B,Q){const H=ne-B,U=k-Q;return H*H+U*U}const Rr=ne=>ne[0],ar=ne=>ne[1];class br{constructor(k,B=Rr,Q=ar,H=64,U=Float64Array){this.nodeSize=H,this.points=k;const G=k.length<65536?Uint16Array:Uint32Array,Y=this.ids=new G(k.length),te=this.coords=new U(2*k.length);for(let le=0;le<k.length;le++)Y[le]=le,te[2*le]=B(k[le]),te[2*le+1]=Q(k[le]);on(Y,te,H,0,Y.length-1,0)}range(k,B,Q,H){return function(U,G,Y,te,le,Ce,Be){const Pe=[0,U.length-1,0],tt=[];let st,ct;for(;Pe.length;){const Mt=Pe.pop(),sn=Pe.pop(),We=Pe.pop();if(sn-We<=Be){for(let Ut=We;Ut<=sn;Ut++)st=G[2*Ut],ct=G[2*Ut+1],st>=Y&&st<=le&&ct>=te&&ct<=Ce&&tt.push(U[Ut]);continue}const dt=Math.floor((We+sn)/2);st=G[2*dt],ct=G[2*dt+1],st>=Y&&st<=le&&ct>=te&&ct<=Ce&&tt.push(U[dt]);const St=(Mt+1)%2;(0===Mt?Y<=st:te<=ct)&&(Pe.push(We),Pe.push(dt-1),Pe.push(St)),(0===Mt?le>=st:Ce>=ct)&&(Pe.push(dt+1),Pe.push(sn),Pe.push(St))}return tt}(this.ids,this.coords,k,B,Q,H,this.nodeSize)}within(k,B,Q){return function(H,U,G,Y,te,le){const Ce=[0,H.length-1,0],Be=[],Pe=te*te;for(;Ce.length;){const tt=Ce.pop(),st=Ce.pop(),ct=Ce.pop();if(st-ct<=le){for(let St=ct;St<=st;St++)hr(U[2*St],U[2*St+1],G,Y)<=Pe&&Be.push(H[St]);continue}const Mt=Math.floor((ct+st)/2),sn=U[2*Mt],We=U[2*Mt+1];hr(sn,We,G,Y)<=Pe&&Be.push(H[Mt]);const dt=(tt+1)%2;(0===tt?G-te<=sn:Y-te<=We)&&(Ce.push(ct),Ce.push(Mt-1),Ce.push(dt)),(0===tt?G+te>=sn:Y+te>=We)&&(Ce.push(Mt+1),Ce.push(st),Ce.push(dt))}return Be}(this.ids,this.coords,k,B,Q,this.nodeSize)}}const Gi={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ne=>ne},mr=Math.fround||(Hi=new Float32Array(1),ne=>(Hi[0]=+ne,Hi[0]));var Hi;class Mo{constructor(k){this.options=mn(Object.create(Gi),k),this.trees=new Array(this.options.maxZoom+1)}load(k){const{log:B,minZoom:Q,maxZoom:H,nodeSize:U}=this.options;B&&console.time("total time");const G=`prepare ${k.length} points`;B&&console.time(G),this.points=k;let Y=[];for(let te=0;te<k.length;te++)k[te].geometry&&Y.push(Qr(k[te],te));this.trees[H+1]=new br(Y,Xe,Ke,U,Float32Array),B&&console.timeEnd(G);for(let te=H;te>=Q;te--){const le=+Date.now();Y=this._cluster(Y,te),this.trees[te]=new br(Y,Xe,Ke,U,Float32Array),B&&console.log("z%d: %d clusters in %dms",te,Y.length,+Date.now()-le)}return B&&console.timeEnd("total time"),this}getClusters(k,B){let Q=((k[0]+180)%360+360)%360-180;const H=Math.max(-90,Math.min(90,k[1]));let U=180===k[2]?180:((k[2]+180)%360+360)%360-180;const G=Math.max(-90,Math.min(90,k[3]));if(k[2]-k[0]>=360)Q=-180,U=180;else if(Q>U){const Ce=this.getClusters([Q,H,180,G],B),Be=this.getClusters([-180,H,U,G],B);return Ce.concat(Be)}const Y=this.trees[this._limitZoom(B)],te=Y.range(fn(Q),li(G),fn(U),li(H)),le=[];for(const Ce of te){const Be=Y.points[Ce];le.push(Be.numPoints?qi(Be):this.points[Be.index])}return le}getChildren(k){const B=this._getOriginId(k),Q=this._getOriginZoom(k),H="No cluster with the specified id.",U=this.trees[Q];if(!U)throw new Error(H);const G=U.points[B];if(!G)throw new Error(H);const Y=this.options.radius/(this.options.extent*Math.pow(2,Q-1)),te=U.within(G.x,G.y,Y),le=[];for(const Ce of te){const Be=U.points[Ce];Be.parentId===k&&le.push(Be.numPoints?qi(Be):this.points[Be.index])}if(0===le.length)throw new Error(H);return le}getLeaves(k,B,Q){const H=[];return this._appendLeaves(H,k,B=B||10,Q=Q||0,0),H}getTile(k,B,Q){const H=this.trees[this._limitZoom(k)],U=Math.pow(2,k),{extent:G,radius:Y}=this.options,te=Y/G,le=(Q-te)/U,Ce=(Q+1+te)/U,Be={features:[]};return this._addTileFeatures(H.range((B-te)/U,le,(B+1+te)/U,Ce),H.points,B,Q,U,Be),0===B&&this._addTileFeatures(H.range(1-te/U,le,1,Ce),H.points,U,Q,U,Be),B===U-1&&this._addTileFeatures(H.range(0,le,te/U,Ce),H.points,-1,Q,U,Be),Be.features.length?Be:null}getClusterExpansionZoom(k){let B=this._getOriginZoom(k)-1;for(;B<=this.options.maxZoom;){const Q=this.getChildren(k);if(B++,1!==Q.length)break;k=Q[0].properties.cluster_id}return B}_appendLeaves(k,B,Q,H,U){const G=this.getChildren(B);for(const Y of G){const te=Y.properties;if(te&&te.cluster?U+te.point_count<=H?U+=te.point_count:U=this._appendLeaves(k,te.cluster_id,Q,H,U):U<H?U++:k.push(Y),k.length===Q)break}return U}_addTileFeatures(k,B,Q,H,U,G){for(const Y of k){const te=B[Y],le=te.numPoints;let Ce,Be,Pe;if(le)Ce=tr(te),Be=te.x,Pe=te.y;else{const ct=this.points[te.index];Ce=ct.properties,Be=fn(ct.geometry.coordinates[0]),Pe=li(ct.geometry.coordinates[1])}const tt={type:1,geometry:[[Math.round(this.options.extent*(Be*U-Q)),Math.round(this.options.extent*(Pe*U-H))]],tags:Ce};let st;le?st=te.id:this.options.generateId?st=te.index:this.points[te.index].id&&(st=this.points[te.index].id),void 0!==st&&(tt.id=st),G.features.push(tt)}}_limitZoom(k){return Math.max(this.options.minZoom,Math.min(+k,this.options.maxZoom+1))}_cluster(k,B){const Q=[],{radius:H,extent:U,reduce:G,minPoints:Y}=this.options,te=H/(U*Math.pow(2,B));for(let le=0;le<k.length;le++){const Ce=k[le];if(Ce.zoom<=B)continue;Ce.zoom=B;const Be=this.trees[B+1],Pe=Be.within(Ce.x,Ce.y,te),tt=Ce.numPoints||1;let st=tt;for(const ct of Pe){const Mt=Be.points[ct];Mt.zoom>B&&(st+=Mt.numPoints||1)}if(st>tt&&st>=Y){let ct=Ce.x*tt,Mt=Ce.y*tt,sn=G&&tt>1?this._map(Ce,!0):null;const We=(le<<5)+(B+1)+this.points.length;for(const dt of Pe){const St=Be.points[dt];if(St.zoom<=B)continue;St.zoom=B;const Ut=St.numPoints||1;ct+=St.x*Ut,Mt+=St.y*Ut,St.parentId=We,G&&(sn||(sn=this._map(Ce,!0)),G(sn,this._map(St)))}Ce.parentId=We,Q.push(Ci(ct/st,Mt/st,We,st,sn))}else if(Q.push(Ce),st>1)for(const ct of Pe){const Mt=Be.points[ct];Mt.zoom<=B||(Mt.zoom=B,Q.push(Mt))}}return Q}_getOriginId(k){return k-this.points.length>>5}_getOriginZoom(k){return(k-this.points.length)%32}_map(k,B){if(k.numPoints)return B?mn({},k.properties):k.properties;const Q=this.points[k.index].properties,H=this.options.map(Q);return B&&H===Q?mn({},H):H}}function Ci(ne,k,B,Q,H){return{x:mr(ne),y:mr(k),zoom:1/0,id:B,parentId:-1,numPoints:Q,properties:H}}function Qr(ne,k){const[B,Q]=ne.geometry.coordinates;return{x:mr(fn(B)),y:mr(li(Q)),zoom:1/0,index:k,parentId:-1}}function qi(ne){return{type:"Feature",id:ne.id,properties:tr(ne),geometry:{type:"Point",coordinates:[(k=ne.x,360*(k-.5)),wr(ne.y)]}};var k}function tr(ne){const k=ne.numPoints,B=k>=1e4?`${Math.round(k/1e3)}k`:k>=1e3?Math.round(k/100)/10+"k":k;return mn(mn({},ne.properties),{cluster:!0,cluster_id:ne.id,point_count:k,point_count_abbreviated:B})}function fn(ne){return ne/360+.5}function li(ne){const k=Math.sin(ne*Math.PI/180),B=.5-.25*Math.log((1+k)/(1-k))/Math.PI;return B<0?0:B>1?1:B}function wr(ne){const k=(180-360*ne)*Math.PI/180;return 360*Math.atan(Math.exp(k))/Math.PI-90}function mn(ne,k){for(const B in k)ne[B]=k[B];return ne}function Xe(ne){return ne.x}function Ke(ne){return ne.y}function T(ne,k,B,Q){for(var H,U=Q,G=B-k>>1,Y=B-k,te=ne[k],le=ne[k+1],Ce=ne[B],Be=ne[B+1],Pe=k+3;Pe<B;Pe+=3){var tt=ae(ne[Pe],ne[Pe+1],te,le,Ce,Be);if(tt>U)H=Pe,U=tt;else if(tt===U){var st=Math.abs(Pe-G);st<Y&&(H=Pe,Y=st)}}U>Q&&(H-k>3&&T(ne,k,H,Q),ne[H+2]=U,B-H>3&&T(ne,H,B,Q))}function ae(ne,k,B,Q,H,U){var G=H-B,Y=U-Q;if(0!==G||0!==Y){var te=((ne-B)*G+(k-Q)*Y)/(G*G+Y*Y);te>1?(B=H,Q=U):te>0&&(B+=G*te,Q+=Y*te)}return(G=ne-B)*G+(Y=k-Q)*Y}function pe(ne,k,B,Q){var H={id:void 0===ne?null:ne,type:k,geometry:B,tags:Q,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(U){var G=U.geometry,Y=U.type;if("Point"===Y||"MultiPoint"===Y||"LineString"===Y)Te(U,G);else if("Polygon"===Y||"MultiLineString"===Y)for(var te=0;te<G.length;te++)Te(U,G[te]);else if("MultiPolygon"===Y)for(te=0;te<G.length;te++)for(var le=0;le<G[te].length;le++)Te(U,G[te][le])}(H),H}function Te(ne,k){for(var B=0;B<k.length;B+=3)ne.minX=Math.min(ne.minX,k[B]),ne.minY=Math.min(ne.minY,k[B+1]),ne.maxX=Math.max(ne.maxX,k[B]),ne.maxY=Math.max(ne.maxY,k[B+1])}function Nt(ne,k,B,Q){if(k.geometry){var H=k.geometry.coordinates,U=k.geometry.type,G=Math.pow(B.tolerance/((1<<B.maxZoom)*B.extent),2),Y=[],te=k.id;if(B.promoteId?te=k.properties[B.promoteId]:B.generateId&&(te=Q||0),"Point"===U)ht(H,Y);else if("MultiPoint"===U)for(var le=0;le<H.length;le++)ht(H[le],Y);else if("LineString"===U)ut(H,Y,G,!1);else if("MultiLineString"===U){if(B.lineMetrics){for(le=0;le<H.length;le++)ut(H[le],Y=[],G,!1),ne.push(pe(te,"LineString",Y,k.properties));return}Dr(H,Y,G,!1)}else if("Polygon"===U)Dr(H,Y,G,!0);else{if("MultiPolygon"!==U){if("GeometryCollection"===U){for(le=0;le<k.geometry.geometries.length;le++)Nt(ne,{id:te,geometry:k.geometry.geometries[le],properties:k.properties},B,Q);return}throw new Error("Input data is not a valid GeoJSON object.")}for(le=0;le<H.length;le++){var Ce=[];Dr(H[le],Ce,G,!0),Y.push(Ce)}}ne.push(pe(te,U,Y,k.properties))}}function ht(ne,k){k.push(lr(ne[0])),k.push(Wn(ne[1])),k.push(0)}function ut(ne,k,B,Q){for(var H,U,G=0,Y=0;Y<ne.length;Y++){var te=lr(ne[Y][0]),le=Wn(ne[Y][1]);k.push(te),k.push(le),k.push(0),Y>0&&(G+=Q?(H*le-te*U)/2:Math.sqrt(Math.pow(te-H,2)+Math.pow(le-U,2))),H=te,U=le}var Ce=k.length-3;k[2]=1,T(k,0,Ce,B),k[Ce+2]=1,k.size=Math.abs(G),k.start=0,k.end=k.size}function Dr(ne,k,B,Q){for(var H=0;H<ne.length;H++){var U=[];ut(ne[H],U,B,Q),k.push(U)}}function lr(ne){return ne/360+.5}function Wn(ne){var k=Math.sin(ne*Math.PI/180),B=.5-.25*Math.log((1+k)/(1-k))/Math.PI;return B<0?0:B>1?1:B}function mt(ne,k,B,Q,H,U,G,Y){if(Q/=k,U>=(B/=k)&&G<Q)return ne;if(G<B||U>=Q)return null;for(var te=[],le=0;le<ne.length;le++){var Ce=ne[le],Be=Ce.geometry,Pe=Ce.type,tt=0===H?Ce.minX:Ce.minY,st=0===H?Ce.maxX:Ce.maxY;if(tt>=B&&st<Q)te.push(Ce);else if(!(st<B||tt>=Q)){var ct=[];if("Point"===Pe||"MultiPoint"===Pe)Qe(Be,ct,B,Q,H);else if("LineString"===Pe)hn(Be,ct,B,Q,H,!1,Y.lineMetrics);else if("MultiLineString"===Pe)Or(Be,ct,B,Q,H,!1);else if("Polygon"===Pe)Or(Be,ct,B,Q,H,!0);else if("MultiPolygon"===Pe)for(var Mt=0;Mt<Be.length;Mt++){var sn=[];Or(Be[Mt],sn,B,Q,H,!0),sn.length&&ct.push(sn)}if(ct.length){if(Y.lineMetrics&&"LineString"===Pe){for(Mt=0;Mt<ct.length;Mt++)te.push(pe(Ce.id,Pe,ct[Mt],Ce.tags));continue}"LineString"!==Pe&&"MultiLineString"!==Pe||(1===ct.length?(Pe="LineString",ct=ct[0]):Pe="MultiLineString"),"Point"!==Pe&&"MultiPoint"!==Pe||(Pe=3===ct.length?"Point":"MultiPoint"),te.push(pe(Ce.id,Pe,ct,Ce.tags))}}}return te.length?te:null}function Qe(ne,k,B,Q,H){for(var U=0;U<ne.length;U+=3){var G=ne[U+H];G>=B&&G<=Q&&(k.push(ne[U]),k.push(ne[U+1]),k.push(ne[U+2]))}}function hn(ne,k,B,Q,H,U,G){for(var Y,te,le=_t(ne),Ce=0===H?nn:gr,Be=ne.start,Pe=0;Pe<ne.length-3;Pe+=3){var tt=ne[Pe],st=ne[Pe+1],ct=ne[Pe+2],Mt=ne[Pe+3],sn=ne[Pe+4],We=0===H?tt:st,dt=0===H?Mt:sn,St=!1;G&&(Y=Math.sqrt(Math.pow(tt-Mt,2)+Math.pow(st-sn,2))),We<B?dt>B&&(te=Ce(le,tt,st,Mt,sn,B),G&&(le.start=Be+Y*te)):We>Q?dt<Q&&(te=Ce(le,tt,st,Mt,sn,Q),G&&(le.start=Be+Y*te)):Tn(le,tt,st,ct),dt<B&&We>=B&&(te=Ce(le,tt,st,Mt,sn,B),St=!0),dt>Q&&We<=Q&&(te=Ce(le,tt,st,Mt,sn,Q),St=!0),!U&&St&&(G&&(le.end=Be+Y*te),k.push(le),le=_t(ne)),G&&(Be+=Y)}var Ut=ne.length-3;tt=ne[Ut],st=ne[Ut+1],ct=ne[Ut+2],(We=0===H?tt:st)>=B&&We<=Q&&Tn(le,tt,st,ct),Ut=le.length-3,U&&Ut>=3&&(le[Ut]!==le[0]||le[Ut+1]!==le[1])&&Tn(le,le[0],le[1],le[2]),le.length&&k.push(le)}function _t(ne){var k=[];return k.size=ne.size,k.start=ne.start,k.end=ne.end,k}function Or(ne,k,B,Q,H,U){for(var G=0;G<ne.length;G++)hn(ne[G],k,B,Q,H,U,!1)}function Tn(ne,k,B,Q){ne.push(k),ne.push(B),ne.push(Q)}function nn(ne,k,B,Q,H,U){var G=(U-k)/(Q-k);return ne.push(U),ne.push(B+(H-B)*G),ne.push(1),G}function gr(ne,k,B,Q,H,U){var G=(U-B)/(H-B);return ne.push(k+(Q-k)*G),ne.push(U),ne.push(1),G}function ki(ne,k){for(var B=[],Q=0;Q<ne.length;Q++){var H,U=ne[Q],G=U.type;if("Point"===G||"MultiPoint"===G||"LineString"===G)H=gi(U.geometry,k);else if("MultiLineString"===G||"Polygon"===G){H=[];for(var Y=0;Y<U.geometry.length;Y++)H.push(gi(U.geometry[Y],k))}else if("MultiPolygon"===G)for(H=[],Y=0;Y<U.geometry.length;Y++){for(var te=[],le=0;le<U.geometry[Y].length;le++)te.push(gi(U.geometry[Y][le],k));H.push(te)}B.push(pe(U.id,G,H,U.tags))}return B}function gi(ne,k){var B=[];B.size=ne.size,void 0!==ne.start&&(B.start=ne.start,B.end=ne.end);for(var Q=0;Q<ne.length;Q+=3)B.push(ne[Q]+k,ne[Q+1],ne[Q+2]);return B}function Yn(ne,k){if(ne.transformed)return ne;var B,Q,H,U=1<<ne.z,G=ne.x,Y=ne.y;for(B=0;B<ne.features.length;B++){var te=ne.features[B],le=te.geometry,Ce=te.type;if(te.geometry=[],1===Ce)for(Q=0;Q<le.length;Q+=2)te.geometry.push(rn(le[Q],le[Q+1],k,U,G,Y));else for(Q=0;Q<le.length;Q++){var Be=[];for(H=0;H<le[Q].length;H+=2)Be.push(rn(le[Q][H],le[Q][H+1],k,U,G,Y));te.geometry.push(Be)}}return ne.transformed=!0,ne}function rn(ne,k,B,Q,H,U){return[Math.round(B*(ne*Q-H)),Math.round(B*(k*Q-U))]}function ei(ne,k,B,Q,H){for(var U=k===H.maxZoom?0:H.tolerance/((1<<k)*H.extent),G={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:B,y:Q,z:k,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Y=0;Y<ne.length;Y++){G.numFeatures++,yi(G,ne[Y],U,H);var te=ne[Y].minX,le=ne[Y].minY,Ce=ne[Y].maxX,Be=ne[Y].maxY;te<G.minX&&(G.minX=te),le<G.minY&&(G.minY=le),Ce>G.maxX&&(G.maxX=Ce),Be>G.maxY&&(G.maxY=Be)}return G}function yi(ne,k,B,Q){var H=k.geometry,U=k.type,G=[];if("Point"===U||"MultiPoint"===U)for(var Y=0;Y<H.length;Y+=3)G.push(H[Y]),G.push(H[Y+1]),ne.numPoints++,ne.numSimplified++;else if("LineString"===U)Jn(G,H,ne,B,!1,!1);else if("MultiLineString"===U||"Polygon"===U)for(Y=0;Y<H.length;Y++)Jn(G,H[Y],ne,B,"Polygon"===U,0===Y);else if("MultiPolygon"===U)for(var te=0;te<H.length;te++){var le=H[te];for(Y=0;Y<le.length;Y++)Jn(G,le[Y],ne,B,!0,0===Y)}if(G.length){var Ce=k.tags||null;if("LineString"===U&&Q.lineMetrics){for(var Be in Ce={},k.tags)Ce[Be]=k.tags[Be];Ce.mapbox_clip_start=H.start/H.size,Ce.mapbox_clip_end=H.end/H.size}var Pe={geometry:G,type:"Polygon"===U||"MultiPolygon"===U?3:"LineString"===U||"MultiLineString"===U?2:1,tags:Ce};null!==k.id&&(Pe.id=k.id),ne.features.push(Pe)}}function Jn(ne,k,B,Q,H,U){var G=Q*Q;if(Q>0&&k.size<(H?G:Q))B.numPoints+=k.length/3;else{for(var Y=[],te=0;te<k.length;te+=3)(0===Q||k[te+2]>G)&&(B.numSimplified++,Y.push(k[te]),Y.push(k[te+1])),B.numPoints++;H&&function(le,Ce){for(var Be=0,Pe=0,tt=le.length,st=tt-2;Pe<tt;st=Pe,Pe+=2)Be+=(le[Pe]-le[st])*(le[Pe+1]+le[st+1]);if(Be>0===Ce)for(Pe=0,tt=le.length;Pe<tt/2;Pe+=2){var ct=le[Pe],Mt=le[Pe+1];le[Pe]=le[tt-2-Pe],le[Pe+1]=le[tt-1-Pe],le[tt-2-Pe]=ct,le[tt-1-Pe]=Mt}}(Y,U),ne.push(Y)}}function vn(ne,k){var B=(k=this.options=function(H,U){for(var G in U)H[G]=U[G];return H}(Object.create(this.options),k)).debug;if(B&&console.time("preprocess data"),k.maxZoom<0||k.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(k.promoteId&&k.generateId)throw new Error("promoteId and generateId cannot be used together.");var H,U,G,Y,te,le,Q=function(H,U){var G=[];if("FeatureCollection"===H.type)for(var Y=0;Y<H.features.length;Y++)Nt(G,H.features[Y],U,Y);else Nt(G,"Feature"===H.type?H:{geometry:H},U);return G}(ne,k);this.tiles={},this.tileCoords=[],B&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",k.indexMaxZoom,k.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Y=H=Q,te=mt(H,1,-1-(G=(U=k).buffer/U.extent),G,0,-1,2,U),le=mt(H,1,1-G,2+G,0,-1,2,U),(te||le)&&(Y=mt(H,1,-G,1+G,0,-1,2,U)||[],te&&(Y=ki(te,1).concat(Y)),le&&(Y=Y.concat(ki(le,-1)))),(Q=Y).length&&this.splitTile(Q,0,0,0),B&&(Q.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function jr(ne,k,B){return 32*((1<<ne)*B+k)+ne}function Li(ne,k){const B=ne.tileID.canonical;if(!this._geoJSONIndex)return k(null,null);const Q=this._geoJSONIndex.getTile(B.z,B.x,B.y);if(!Q)return k(null,null);const H=new Dn(Q.features);let U=fr(H);0===U.byteOffset&&U.byteLength===U.buffer.byteLength||(U=new Uint8Array(U)),k(null,{vectorTile:H,rawData:U.buffer})}vn.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},vn.prototype.splitTile=function(ne,k,B,Q,H,U,G){for(var Y=[ne,k,B,Q],te=this.options,le=te.debug;Y.length;){Q=Y.pop(),B=Y.pop(),k=Y.pop(),ne=Y.pop();var Ce=1<<k,Be=jr(k,B,Q),Pe=this.tiles[Be];if(!Pe&&(le>1&&console.time("creation"),Pe=this.tiles[Be]=ei(ne,k,B,Q,te),this.tileCoords.push({z:k,x:B,y:Q}),le)){le>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",k,B,Q,Pe.numFeatures,Pe.numPoints,Pe.numSimplified),console.timeEnd("creation"));var tt="z"+k;this.stats[tt]=(this.stats[tt]||0)+1,this.total++}if(Pe.source=ne,H){if(k===te.maxZoom||k===H)continue;var st=1<<H-k;if(B!==Math.floor(U/st)||Q!==Math.floor(G/st))continue}else if(k===te.indexMaxZoom||Pe.numPoints<=te.indexMaxPoints)continue;if(Pe.source=null,0!==ne.length){le>1&&console.time("clipping");var ct,Mt,sn,We,dt,St,Ut=.5*te.buffer/te.extent,Qn=.5-Ut,En=.5+Ut,rr=1+Ut;ct=Mt=sn=We=null,dt=mt(ne,Ce,B-Ut,B+En,0,Pe.minX,Pe.maxX,te),St=mt(ne,Ce,B+Qn,B+rr,0,Pe.minX,Pe.maxX,te),ne=null,dt&&(ct=mt(dt,Ce,Q-Ut,Q+En,1,Pe.minY,Pe.maxY,te),Mt=mt(dt,Ce,Q+Qn,Q+rr,1,Pe.minY,Pe.maxY,te),dt=null),St&&(sn=mt(St,Ce,Q-Ut,Q+En,1,Pe.minY,Pe.maxY,te),We=mt(St,Ce,Q+Qn,Q+rr,1,Pe.minY,Pe.maxY,te),St=null),le>1&&console.timeEnd("clipping"),Y.push(ct||[],k+1,2*B,2*Q),Y.push(Mt||[],k+1,2*B,2*Q+1),Y.push(sn||[],k+1,2*B+1,2*Q),Y.push(We||[],k+1,2*B+1,2*Q+1)}}},vn.prototype.getTile=function(ne,k,B){var Q=this.options,H=Q.extent,U=Q.debug;if(ne<0||ne>24)return null;var G=1<<ne,Y=jr(ne,k=(k%G+G)%G,B);if(this.tiles[Y])return Yn(this.tiles[Y],H);U>1&&console.log("drilling down to z%d-%d-%d",ne,k,B);for(var te,le=ne,Ce=k,Be=B;!te&&le>0;)le--,Ce=Math.floor(Ce/2),Be=Math.floor(Be/2),te=this.tiles[jr(le,Ce,Be)];return te&&te.source?(U>1&&console.log("found parent tile z%d-%d-%d",le,Ce,Be),U>1&&console.time("drilling down"),this.splitTile(te.source,le,Ce,Be,ne,k,B),U>1&&console.timeEnd("drilling down"),this.tiles[Y]?Yn(this.tiles[Y],H):null):null};class ui extends Wt{constructor(k,B,Q,H){super(k,B,Q,Li),H&&(this.loadGeoJSON=H)}loadData(k,B){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=B,this._pendingLoadDataParams=k,this._state&&"Idle"!==this._state?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())}_loadData(){if(!this._pendingCallback||!this._pendingLoadDataParams)return;const k=this._pendingCallback,B=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;const Q=!!(B&&B.request&&B.request.collectResourceTiming)&&new f.RequestPerformance(B.request);this.loadGeoJSON(B,(H,U)=>{if(H||!U)return k(H);if("object"!=typeof U)return k(new Error(`Input data given to '${B.source}' is not a valid GeoJSON object.`));{Vt(U,!0);try{if(B.filter){const Y=f.createExpression(B.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===Y.result)throw new Error(Y.value.map(le=>`${le.key}: ${le.message}`).join(", "));const te=U.features.filter(le=>Y.value.evaluate({zoom:0},le));U={type:"FeatureCollection",features:te}}this._geoJSONIndex=B.cluster?new Mo(function({superclusterOptions:Y,clusterProperties:te}){if(!te||!Y)return Y;const le={},Ce={},Be={accumulated:null,zoom:0},Pe={properties:null},tt=Object.keys(te);for(const st of tt){const[ct,Mt]=te[st],sn=f.createExpression(Mt),We=f.createExpression("string"==typeof ct?[ct,["accumulated"],["get",st]]:ct);le[st]=sn.value,Ce[st]=We.value}return Y.map=st=>{Pe.properties=st;const ct={};for(const Mt of tt)ct[Mt]=le[Mt].evaluate(Be,Pe);return ct},Y.reduce=(st,ct)=>{Pe.properties=ct;for(const Mt of tt)Be.accumulated=st[Mt],st[Mt]=Ce[Mt].evaluate(Be,Pe)},Y}(B)).load(U.features):new vn(Y=U,B.geojsonVtOptions)}catch(Y){return k(Y)}this.loaded={};const G={};if(Q){const Y=Q.finish();Y&&(G.resourceTiming={},G.resourceTiming[B.source]=JSON.parse(JSON.stringify(Y)))}k(null,G)}var Y})}coalesce(){"Coalescing"===this._state?this._state="Idle":"NeedsLoadData"===this._state&&(this._state="Coalescing",this._loadData())}reloadTile(k,B){const Q=this.loaded;return Q&&Q[k.uid]?super.reloadTile(k,B):this.loadTile(k,B)}loadGeoJSON(k,B){if(k.request)f.getJSON(k.request,B);else{if("string"!=typeof k.data)return B(new Error(`Input data given to '${k.source}' is not a valid GeoJSON object.`));try{return B(null,JSON.parse(k.data))}catch{return B(new Error(`Input data given to '${k.source}' is not a valid GeoJSON object.`))}}}removeSource(k,B){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),B()}getClusterExpansionZoom(k,B){try{B(null,this._geoJSONIndex.getClusterExpansionZoom(k.clusterId))}catch(Q){B(Q)}}getClusterChildren(k,B){try{B(null,this._geoJSONIndex.getChildren(k.clusterId))}catch(Q){B(Q)}}getClusterLeaves(k,B){try{B(null,this._geoJSONIndex.getLeaves(k.clusterId,k.limit,k.offset))}catch(Q){B(Q)}}}class Ei{constructor(k){this.self=k,this.actor=new f.Actor(k,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:Wt,geojson:ui},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(B,Q)=>{if(this.workerSourceTypes[B])throw new Error(`Worker source with name "${B}" already registered.`);this.workerSourceTypes[B]=Q},this.self.registerRTLTextPlugin=B=>{if(f.plugin.isParsed())throw new Error("RTL text plugin already registered.");f.plugin.applyArabicShaping=B.applyArabicShaping,f.plugin.processBidirectionalText=B.processBidirectionalText,f.plugin.processStyledBidirectionalText=B.processStyledBidirectionalText}}setReferrer(k,B){this.referrer=B}setImages(k,B,Q){this.availableImages[k]=B;for(const H in this.workerSources[k]){const U=this.workerSources[k][H];for(const G in U)U[G].availableImages=B}Q()}setLayers(k,B,Q){this.getLayerIndex(k).replace(B),Q()}updateLayers(k,B,Q){this.getLayerIndex(k).update(B.layers,B.removedIds),Q()}loadTile(k,B,Q){this.getWorkerSource(k,B.type,B.source).loadTile(B,Q)}loadDEMTile(k,B,Q){this.getDEMWorkerSource(k,B.source).loadTile(B,Q)}reloadTile(k,B,Q){this.getWorkerSource(k,B.type,B.source).reloadTile(B,Q)}abortTile(k,B,Q){this.getWorkerSource(k,B.type,B.source).abortTile(B,Q)}removeTile(k,B,Q){this.getWorkerSource(k,B.type,B.source).removeTile(B,Q)}removeDEMTile(k,B){this.getDEMWorkerSource(k,B.source).removeTile(B)}removeSource(k,B,Q){if(!this.workerSources[k]||!this.workerSources[k][B.type]||!this.workerSources[k][B.type][B.source])return;const H=this.workerSources[k][B.type][B.source];delete this.workerSources[k][B.type][B.source],void 0!==H.removeSource?H.removeSource(B,Q):Q()}loadWorkerSource(k,B,Q){try{this.self.importScripts(B.url),Q()}catch(H){Q(H.toString())}}syncRTLPluginState(k,B,Q){try{f.plugin.setState(B);const H=f.plugin.getPluginURL();if(f.plugin.isLoaded()&&!f.plugin.isParsed()&&null!=H){this.self.importScripts(H);const U=f.plugin.isParsed();Q(U?void 0:new Error(`RTL Text Plugin failed to import scripts from ${H}`),U)}}catch(H){Q(H.toString())}}getAvailableImages(k){let B=this.availableImages[k];return B||(B=[]),B}getLayerIndex(k){let B=this.layerIndexes[k];return B||(B=this.layerIndexes[k]=new kt),B}getWorkerSource(k,B,Q){return this.workerSources[k]||(this.workerSources[k]={}),this.workerSources[k][B]||(this.workerSources[k][B]={}),this.workerSources[k][B][Q]||(this.workerSources[k][B][Q]=new this.workerSourceTypes[B]({send:(U,G,Y)=>{this.actor.send(U,G,Y,k)}},this.getLayerIndex(k),this.getAvailableImages(k))),this.workerSources[k][B][Q]}getDEMWorkerSource(k,B){return this.demWorkerSources[k]||(this.demWorkerSources[k]={}),this.demWorkerSources[k][B]||(this.demWorkerSources[k][B]=new Vn),this.demWorkerSources[k][B]}enforceCacheSizeLimit(k,B){f.enforceCacheSizeLimit(B)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new Ei(self)),Ei}),Ae(0,function(f){var it=Qt;function Qt(p){return r=p,!(typeof window>"u"||typeof document>"u"||!(Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray)||!Function.prototype||!Function.prototype.bind||!(Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions)||!("JSON"in window&&"parse"in JSON&&"stringify"in JSON)||!function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var h,g,v=new Blob([""],{type:"text/javascript"}),D=URL.createObjectURL(v);try{g=new Worker(D),h=!0}catch{h=!1}return g&&g.terminate(),URL.revokeObjectURL(D),h}()||!("Uint8ClampedArray"in window)||!ArrayBuffer.isView||!function(){var h=document.createElement("canvas");h.width=h.height=1;var g=h.getContext("2d");if(!g)return!1;var v=g.getImageData(0,0,1,1);return v&&v.width===h.width}()||(void 0===kt[a=r&&r.failIfMajorPerformanceCaveat]&&(kt[a]=function(h){var g,D,M,S,v=(D=h,M=document.createElement("canvas"),(S=Object.create(Qt.webGLContextAttributes)).failIfMajorPerformanceCaveat=D,M.getContext("webgl",S)||M.getContext("experimental-webgl",S));if(!v)return!1;try{g=v.createShader(v.VERTEX_SHADER)}catch{return!1}return!(!g||v.isContextLost())&&(v.shaderSource(g,"void main() {}"),v.compileShader(g),!0===v.getShaderParameter(g,v.COMPILE_STATUS))}(a)),!kt[a]||document.documentMode));var r,a}var kt={};function It(p,r){if(Array.isArray(p)){if(!Array.isArray(r)||p.length!==r.length)return!1;for(let a=0;a<p.length;a++)if(!It(p[a],r[a]))return!1;return!0}if("object"==typeof p&&null!==p&&null!==r){if("object"!=typeof r||Object.keys(p).length!==Object.keys(r).length)return!1;for(const a in p)if(!It(p[a],r[a]))return!1;return!0}return p===r}Qt.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};class Ee{static testProp(r){if(!Ee.docStyle)return r[0];for(let a=0;a<r.length;a++)if(r[a]in Ee.docStyle)return r[a];return r[0]}static create(r,a,h){const g=window.document.createElement(r);return void 0!==a&&(g.className=a),h&&h.appendChild(g),g}static createNS(r,a){return window.document.createElementNS(r,a)}static disableDrag(){Ee.docStyle&&Ee.selectProp&&(Ee.userSelect=Ee.docStyle[Ee.selectProp],Ee.docStyle[Ee.selectProp]="none")}static enableDrag(){Ee.docStyle&&Ee.selectProp&&(Ee.docStyle[Ee.selectProp]=Ee.userSelect)}static setTransform(r,a){r.style[Ee.transformProp]=a}static addEventListener(r,a,h,g={}){r.addEventListener(a,h,"passive"in g?g:g.capture)}static removeEventListener(r,a,h,g={}){r.removeEventListener(a,h,"passive"in g?g:g.capture)}static suppressClickInternal(r){r.preventDefault(),r.stopPropagation(),window.removeEventListener("click",Ee.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",Ee.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",Ee.suppressClickInternal,!0)},0)}static mousePos(r,a){const h=r.getBoundingClientRect();return new f.pointGeometry(a.clientX-h.left-r.clientLeft,a.clientY-h.top-r.clientTop)}static touchPos(r,a){const h=r.getBoundingClientRect(),g=[];for(let v=0;v<a.length;v++)g.push(new f.pointGeometry(a[v].clientX-h.left-r.clientLeft,a[v].clientY-h.top-r.clientTop));return g}static mouseButton(r){return r.button}static remove(r){r.parentNode&&r.parentNode.removeChild(r)}}Ee.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,Ee.selectProp=Ee.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),Ee.transformProp=Ee.testProp(["transform","WebkitTransform"]);class xt{constructor(r){this._transformRequestFn=r}transformRequest(r,a){return this._transformRequestFn&&this._transformRequestFn(r,a)||{url:r}}normalizeSpriteURL(r,a,h){const g=function(v){const D=v.match(Ze);if(!D)throw new Error(`Unable to parse URL "${v}"`);return{protocol:D[1],authority:D[2],path:D[3]||"/",params:D[4]?D[4].split("&"):[]}}(r);return g.path+=`${a}${h}`,function(v){const D=v.params.length?`?${v.params.join("&")}`:"";return`${v.protocol}://${v.authority}${v.path}${D}`}(g)}setTransformRequest(r){this._transformRequestFn=r}}const Ze=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Wt(p){var r=new f.ARRAY_TYPE(3);return r[0]=p[0],r[1]=p[1],r[2]=p[2],r}var Vn,Vt=function(p,r,a){return p[0]=r[0]-a[0],p[1]=r[1]-a[1],p[2]=r[2]-a[2],p};Vn=new f.ARRAY_TYPE(3),f.ARRAY_TYPE!=Float32Array&&(Vn[0]=0,Vn[1]=0,Vn[2]=0);var p,Un=function(p){var r=p[0],a=p[1];return r*r+a*a};p=new f.ARRAY_TYPE(2),f.ARRAY_TYPE!=Float32Array&&(p[0]=0,p[1]=0);class Gt{constructor(r,a,h,g){this.context=r,this.format=h,this.texture=r.gl.createTexture(),this.update(a,g)}update(r,a,h){const{width:g,height:v}=r,D=!(this.size&&this.size[0]===g&&this.size[1]===v||h),{context:M}=this,{gl:S}=M;if(this.useMipmap=Boolean(a&&a.useMipmap),S.bindTexture(S.TEXTURE_2D,this.texture),M.pixelStoreUnpackFlipY.set(!1),M.pixelStoreUnpack.set(1),M.pixelStoreUnpackPremultiplyAlpha.set(this.format===S.RGBA&&(!a||!1!==a.premultiply)),D)this.size=[g,v],r instanceof HTMLImageElement||r instanceof HTMLCanvasElement||r instanceof HTMLVideoElement||r instanceof ImageData||f.isImageBitmap(r)?S.texImage2D(S.TEXTURE_2D,0,this.format,this.format,S.UNSIGNED_BYTE,r):S.texImage2D(S.TEXTURE_2D,0,this.format,g,v,0,this.format,S.UNSIGNED_BYTE,r.data);else{const{x:z,y:q}=h||{x:0,y:0};r instanceof HTMLImageElement||r instanceof HTMLCanvasElement||r instanceof HTMLVideoElement||r instanceof ImageData||f.isImageBitmap(r)?S.texSubImage2D(S.TEXTURE_2D,0,z,q,S.RGBA,S.UNSIGNED_BYTE,r):S.texSubImage2D(S.TEXTURE_2D,0,z,q,g,v,S.RGBA,S.UNSIGNED_BYTE,r.data)}this.useMipmap&&this.isSizePowerOfTwo()&&S.generateMipmap(S.TEXTURE_2D)}bind(r,a,h){const{context:g}=this,{gl:v}=g;v.bindTexture(v.TEXTURE_2D,this.texture),h!==v.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(h=v.LINEAR),r!==this.filter&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MAG_FILTER,r),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MIN_FILTER,h||r),this.filter=r),a!==this.wrap&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_S,a),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_T,a),this.wrap=a)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:r}=this.context;r.deleteTexture(this.texture),this.texture=null}}function dn(p){const{userImage:r}=p;return!!(r&&r.render&&r.render())&&(p.data.replace(new Uint8Array(r.data.buffer)),!0)}class wn extends f.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new f.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(r){if(this.loaded!==r&&(this.loaded=r,r)){for(const{ids:a,callback:h}of this.requestors)this._notify(a,h);this.requestors=[]}}getImage(r){return this.images[r]}addImage(r,a){this._validate(r,a)&&(this.images[r]=a)}_validate(r,a){let h=!0;return this._validateStretch(a.stretchX,a.data&&a.data.width)||(this.fire(new f.ErrorEvent(new Error(`Image "${r}" has invalid "stretchX" value`))),h=!1),this._validateStretch(a.stretchY,a.data&&a.data.height)||(this.fire(new f.ErrorEvent(new Error(`Image "${r}" has invalid "stretchY" value`))),h=!1),this._validateContent(a.content,a)||(this.fire(new f.ErrorEvent(new Error(`Image "${r}" has invalid "content" value`))),h=!1),h}_validateStretch(r,a){if(!r)return!0;let h=0;for(const g of r){if(g[0]<h||g[1]<g[0]||a<g[1])return!1;h=g[1]}return!0}_validateContent(r,a){return!(r&&(4!==r.length||r[0]<0||a.data.width<r[0]||r[1]<0||a.data.height<r[1]||r[2]<0||a.data.width<r[2]||r[3]<0||a.data.height<r[3]||r[2]<r[0]||r[3]<r[1]))}updateImage(r,a){a.version=this.images[r].version+1,this.images[r]=a,this.updatedImages[r]=!0}removeImage(r){const a=this.images[r];delete this.images[r],delete this.patterns[r],a.userImage&&a.userImage.onRemove&&a.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(r,a){let h=!0;if(!this.isLoaded())for(const g of r)this.images[g]||(h=!1);this.isLoaded()||h?this._notify(r,a):this.requestors.push({ids:r,callback:a})}_notify(r,a){const h={};for(const g of r){this.images[g]||this.fire(new f.Event("styleimagemissing",{id:g}));const v=this.images[g];v?h[g]={data:v.data.clone(),pixelRatio:v.pixelRatio,sdf:v.sdf,version:v.version,stretchX:v.stretchX,stretchY:v.stretchY,content:v.content,hasRenderCallback:Boolean(v.userImage&&v.userImage.render)}:f.warnOnce(`Image "${g}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}a(null,h)}getPixelSize(){const{width:r,height:a}=this.atlasImage;return{width:r,height:a}}getPattern(r){const a=this.patterns[r],h=this.getImage(r);if(!h)return null;if(a&&a.position.version===h.version)return a.position;if(a)a.position.version=h.version;else{const g={w:h.data.width+2,h:h.data.height+2,x:0,y:0},v=new f.ImagePosition(g,h);this.patterns[r]={bin:g,position:v}}return this._updatePatternAtlas(),this.patterns[r].position}bind(r){const a=r.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new Gt(r,this.atlasImage,a.RGBA),this.atlasTexture.bind(a.LINEAR,a.CLAMP_TO_EDGE)}_updatePatternAtlas(){const r=[];for(const v in this.patterns)r.push(this.patterns[v].bin);const{w:a,h}=f.potpack(r),g=this.atlasImage;g.resize({width:a||1,height:h||1});for(const v in this.patterns){const{bin:D}=this.patterns[v],M=D.x+1,S=D.y+1,z=this.images[v].data,q=z.width,X=z.height;f.RGBAImage.copy(z,g,{x:0,y:0},{x:M,y:S},{width:q,height:X}),f.RGBAImage.copy(z,g,{x:0,y:X-1},{x:M,y:S-1},{width:q,height:1}),f.RGBAImage.copy(z,g,{x:0,y:0},{x:M,y:S+X},{width:q,height:1}),f.RGBAImage.copy(z,g,{x:q-1,y:0},{x:M-1,y:S},{width:1,height:X}),f.RGBAImage.copy(z,g,{x:0,y:0},{x:M+q,y:S},{width:1,height:X})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(r){for(const a of r){if(this.callbackDispatchedThisFrame[a])continue;this.callbackDispatchedThisFrame[a]=!0;const h=this.images[a];dn(h)&&this.updateImage(a,h)}}}const Dn=1e20;function Fn(p,r,a,h,g,v,D,M,S){for(let z=r;z<r+h;z++)pt(p,a*v+z,v,g,D,M,S);for(let z=a;z<a+g;z++)pt(p,z*v+r,1,h,D,M,S)}function pt(p,r,a,h,g,v,D){v[0]=0,D[0]=-Dn,D[1]=Dn,g[0]=p[r];for(let M=1,S=0,z=0;M<h;M++){g[M]=p[r+M*a];const q=M*M;do{const X=v[S];z=(g[M]-g[X]+q-X*X)/(M-X)/2}while(z<=D[S]&&--S>-1);S++,v[S]=M,D[S]=z,D[S+1]=Dn}for(let M=0,S=0;M<h;M++){for(;D[S+1]<M;)S++;const z=v[S],q=M-z;p[r+M*a]=g[z]+q*q}}class Ge{constructor(r,a){this.requestManager=r,this.localIdeographFontFamily=a,this.entries={}}setURL(r){this.url=r}getGlyphs(r,a){const h=[];for(const g in r)for(const v of r[g])h.push({stack:g,id:v});f.asyncAll(h,({stack:g,id:v},D)=>{let M=this.entries[g];M||(M=this.entries[g]={glyphs:{},requests:{},ranges:{}});let S=M.glyphs[v];if(void 0!==S)return void D(null,{stack:g,id:v,glyph:S});if(S=this._tinySDF(M,g,v),S)return M.glyphs[v]=S,void D(null,{stack:g,id:v,glyph:S});const z=Math.floor(v/256);if(256*z>65535)return void D(new Error("glyphs > 65535 not supported"));if(M.ranges[z])return void D(null,{stack:g,id:v,glyph:S});let q=M.requests[z];q||(q=M.requests[z]=[],Ge.loadGlyphRange(g,z,this.url,this.requestManager,(X,re)=>{if(re){for(const ue in re)this._doesCharSupportLocalGlyph(+ue)||(M.glyphs[+ue]=re[+ue]);M.ranges[z]=!0}for(const ue of q)ue(X,re);delete M.requests[z]})),q.push((X,re)=>{X?D(X):re&&D(null,{stack:g,id:v,glyph:re[v]||null})})},(g,v)=>{if(g)a(g);else if(v){const D={};for(const{stack:M,id:S,glyph:z}of v)(D[M]||(D[M]={}))[S]=z&&{id:z.id,bitmap:z.bitmap.clone(),metrics:z.metrics};a(null,D)}})}_doesCharSupportLocalGlyph(r){return!!this.localIdeographFontFamily&&(f.unicodeBlockLookup["CJK Unified Ideographs"](r)||f.unicodeBlockLookup["Hangul Syllables"](r)||f.unicodeBlockLookup.Hiragana(r)||f.unicodeBlockLookup.Katakana(r))}_tinySDF(r,a,h){const g=this.localIdeographFontFamily;if(!g||!this._doesCharSupportLocalGlyph(h))return;let v=r.tinySDF;if(!v){let M="400";/bold/i.test(a)?M="900":/medium/i.test(a)?M="500":/light/i.test(a)&&(M="200"),v=r.tinySDF=new Ge.TinySDF({fontSize:24,buffer:3,radius:8,cutoff:.25,fontFamily:g,fontWeight:M})}const D=v.draw(String.fromCharCode(h));return{id:h,bitmap:new f.AlphaImage({width:D.width||30,height:D.height||30},D.data),metrics:{width:D.glyphWidth||24,height:D.glyphHeight||24,left:D.glyphLeft||0,top:D.glyphTop-27||-8,advance:D.glyphAdvance||24}}}}Ge.loadGlyphRange=function(p,r,a,h,g){const v=256*r,D=v+255,M=h.transformRequest(a.replace("{fontstack}",p).replace("{range}",`${v}-${D}`),f.ResourceType.Glyphs);f.getArrayBuffer(M,(S,z)=>{if(S)g(S);else if(z){const q={};for(const X of f.parseGlyphPBF(z))q[X.id]=X;g(null,q)}})},Ge.TinySDF=class{constructor({fontSize:p=24,buffer:r=3,radius:a=8,cutoff:h=.25,fontFamily:g="sans-serif",fontWeight:v="normal",fontStyle:D="normal"}={}){this.buffer=r,this.cutoff=h,this.radius=a;const M=this.size=p+4*r,S=this._createCanvas(M),z=this.ctx=S.getContext("2d",{willReadFrequently:!0});z.font=`${D} ${v} ${p}px ${g}`,z.textBaseline="alphabetic",z.textAlign="left",z.fillStyle="black",this.gridOuter=new Float64Array(M*M),this.gridInner=new Float64Array(M*M),this.f=new Float64Array(M),this.z=new Float64Array(M+1),this.v=new Uint16Array(M)}_createCanvas(p){const r=document.createElement("canvas");return r.width=r.height=p,r}draw(p){const{width:r,actualBoundingBoxAscent:a,actualBoundingBoxDescent:h,actualBoundingBoxLeft:g,actualBoundingBoxRight:v}=this.ctx.measureText(p),D=Math.ceil(a),M=Math.min(this.size-this.buffer,Math.ceil(v-g)),S=Math.min(this.size-this.buffer,D+Math.ceil(h)),z=M+2*this.buffer,q=S+2*this.buffer,X=Math.max(z*q,0),re=new Uint8ClampedArray(X),ue={data:re,width:z,height:q,glyphWidth:M,glyphHeight:S,glyphTop:D,glyphLeft:0,glyphAdvance:r};if(0===M||0===S)return ue;const{ctx:ie,buffer:ce,gridInner:ye,gridOuter:ge}=this;ie.clearRect(ce,ce,M,S),ie.fillText(p,ce,ce+D);const Me=ie.getImageData(ce,ce,M,S);ge.fill(Dn,0,X),ye.fill(0,0,X);for(let xe=0;xe<S;xe++)for(let $e=0;$e<M;$e++){const Oe=Me.data[4*(xe*M+$e)+3]/255;if(0===Oe)continue;const Ne=(xe+ce)*z+$e+ce;if(1===Oe)ge[Ne]=0,ye[Ne]=Dn;else{const Je=.5-Oe;ge[Ne]=Je>0?Je*Je:0,ye[Ne]=Je<0?Je*Je:0}}Fn(ge,0,0,z,q,z,this.f,this.v,this.z),Fn(ye,ce,ce,M,S,z,this.f,this.v,this.z);for(let xe=0;xe<X;xe++){const $e=Math.sqrt(ge[xe])-Math.sqrt(ye[xe]);re[xe]=Math.round(255-255*($e/this.radius+this.cutoff))}return ue}};const Xt=new f.Properties({anchor:new f.DataConstantProperty(f.spec.light.anchor),position:new class{constructor(){this.specification=f.spec.light.position}possiblyEvaluate(p,r){return f.sphericalToCartesian(p.expression.evaluate(r))}interpolate(p,r,a){return{x:f.number(p.x,r.x,a),y:f.number(p.y,r.y,a),z:f.number(p.z,r.z,a)}}},color:new f.DataConstantProperty(f.spec.light.color),intensity:new f.DataConstantProperty(f.spec.light.intensity)}),Yt="-transition";class jt extends f.Evented{constructor(r){super(),this._transitionable=new f.Transitionable(Xt),this.setLight(r),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(r,a={}){if(!this._validate(f.validateLight,r,a))for(const h in r){const g=r[h];h.endsWith(Yt)?this._transitionable.setTransition(h.slice(0,-Yt.length),g):this._transitionable.setValue(h,g)}}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}_validate(r,a,h){return(!h||!1!==h.validate)&&f.emitValidationErrors(this,r.call(f.validateStyle,f.extend({value:a,style:{glyphs:!0,sprite:!0},styleSpec:f.spec})))}}class tn{constructor(r,a){this.width=r,this.height=a,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(r,a){const h=r.join(",")+String(a);return this.dashEntry[h]||(this.dashEntry[h]=this.addDash(r,a)),this.dashEntry[h]}getDashRanges(r,a,h){const g=[];let v=r.length%2==1?-r[r.length-1]*h:0,D=r[0]*h,M=!0;g.push({left:v,right:D,isDash:M,zeroLength:0===r[0]});let S=r[0];for(let z=1;z<r.length;z++){M=!M;const q=r[z];v=S*h,S+=q,D=S*h,g.push({left:v,right:D,isDash:M,zeroLength:0===q})}return g}addRoundDash(r,a,h){const g=a/2;for(let v=-h;v<=h;v++){const D=this.width*(this.nextRow+h+v);let M=0,S=r[M];for(let z=0;z<this.width;z++){z/S.right>1&&(S=r[++M]);const q=Math.abs(z-S.left),X=Math.abs(z-S.right),re=Math.min(q,X);let ue;const ie=v/h*(g+1);if(S.isDash){const ce=g-Math.abs(ie);ue=Math.sqrt(re*re+ce*ce)}else ue=g-Math.sqrt(re*re+ie*ie);this.data[D+z]=Math.max(0,Math.min(255,ue+128))}}}addRegularDash(r){for(let M=r.length-1;M>=0;--M){const S=r[M],z=r[M+1];S.zeroLength?r.splice(M,1):z&&z.isDash===S.isDash&&(z.left=S.left,r.splice(M,1))}const a=r[0],h=r[r.length-1];a.isDash===h.isDash&&(a.left=h.left-this.width,h.right=a.right+this.width);const g=this.width*this.nextRow;let v=0,D=r[v];for(let M=0;M<this.width;M++){M/D.right>1&&(D=r[++v]);const S=Math.abs(M-D.left),z=Math.abs(M-D.right),q=Math.min(S,z);this.data[g+M]=Math.max(0,Math.min(255,(D.isDash?q:-q)+128))}}addDash(r,a){const h=a?7:0,g=2*h+1;if(this.nextRow+g>this.height)return f.warnOnce("LineAtlas out of space"),null;let v=0;for(let M=0;M<r.length;M++)v+=r[M];if(0!==v){const M=this.width/v,S=this.getDashRanges(r,this.width,M);a?this.addRoundDash(S,M,h):this.addRegularDash(S)}const D={y:(this.nextRow+h+.5)/this.height,height:2*h/this.height,width:v};return this.nextRow+=g,this.dirty=!0,D}bind(r){const a=r.gl;this.texture?(a.bindTexture(a.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,a.texSubImage2D(a.TEXTURE_2D,0,0,0,this.width,this.height,a.ALPHA,a.UNSIGNED_BYTE,this.data))):(this.texture=a.createTexture(),a.bindTexture(a.TEXTURE_2D,this.texture),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.REPEAT),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.REPEAT),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),a.texImage2D(a.TEXTURE_2D,0,a.ALPHA,this.width,this.height,0,a.ALPHA,a.UNSIGNED_BYTE,this.data))}}class en{constructor(r,a){this.workerPool=r,this.actors=[],this.currentActor=0,this.id=f.uniqueId();const h=this.workerPool.acquire(this.id);for(let g=0;g<h.length;g++){const v=new en.Actor(h[g],a,this.id);v.name=`Worker ${g}`,this.actors.push(v)}}broadcast(r,a,h){f.asyncAll(this.actors,(g,v)=>{g.send(r,a,v)},h=h||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(r=>{r.remove()}),this.actors=[],this.workerPool.release(this.id)}}function me(p,r,a){const h=function(g,v){if(g)return a(g);if(v){const D=f.pick(f.extend(v,p),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);v.vector_layers&&(D.vectorLayers=v.vector_layers,D.vectorLayerIds=D.vectorLayers.map(M=>M.id)),a(null,D)}};return p.url?f.getJSON(r.transformRequest(p.url,f.ResourceType.Source),h):f.exported.frame(()=>h(null,p))}en.Actor=f.Actor;class _e{constructor(r,a,h){this.bounds=f.LngLatBounds.convert(this.validateBounds(r)),this.minzoom=a||0,this.maxzoom=h||24}validateBounds(r){return Array.isArray(r)&&4===r.length?[Math.max(-180,r[0]),Math.max(-90,r[1]),Math.min(180,r[2]),Math.min(90,r[3])]:[-180,-90,180,90]}contains(r){const a=Math.pow(2,r.z),h=Math.floor(f.mercatorXfromLng(this.bounds.getWest())*a),g=Math.floor(f.mercatorYfromLat(this.bounds.getNorth())*a),v=Math.ceil(f.mercatorXfromLng(this.bounds.getEast())*a),D=Math.ceil(f.mercatorYfromLat(this.bounds.getSouth())*a);return r.x>=h&&r.x<v&&r.y>=g&&r.y<D}}class ke extends f.Evented{constructor(r,a,h,g){if(super(),this.id=r,this.dispatcher=h,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,f.extend(this,f.pick(a,["url","scheme","tileSize","promoteId"])),this._options=f.extend({type:"vector"},a),this._collectResourceTiming=a.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(g)}load(){this._loaded=!1,this.fire(new f.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=me(this._options,this.map._requestManager,(r,a)=>{this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),r?this.fire(new f.ErrorEvent(r)):a&&(f.extend(this,a),a.bounds&&(this.tileBounds=new _e(a.bounds,this.minzoom,this.maxzoom)),this.fire(new f.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new f.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}hasTile(r){return!this.tileBounds||this.tileBounds.contains(r.canonical)}onAdd(r){this.map=r,this.load()}setSourceProperty(r){this._tileJSONRequest&&this._tileJSONRequest.cancel(),r(),this.load()}setTiles(r){return this.setSourceProperty(()=>{this._options.tiles=r}),this}setUrl(r){return this.setSourceProperty(()=>{this.url=r,this._options.url=r}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return f.extend({},this._options)}loadTile(r,a){const h=r.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),g={request:this.map._requestManager.transformRequest(h,f.ResourceType.Tile),uid:r.uid,tileID:r.tileID,zoom:r.tileID.overscaledZ,tileSize:this.tileSize*r.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function v(D,M){return delete r.request,r.aborted?a(null):D&&404!==D.status?a(D):(M&&M.resourceTiming&&(r.resourceTiming=M.resourceTiming),this.map._refreshExpiredTiles&&M&&r.setExpiryData(M),r.loadVectorData(M,this.map.painter),f.cacheEntryPossiblyAdded(this.dispatcher),a(null),void(r.reloadCallback&&(this.loadTile(r,r.reloadCallback),r.reloadCallback=null)))}g.request.collectResourceTiming=this._collectResourceTiming,r.actor&&"expired"!==r.state?"loading"===r.state?r.reloadCallback=a:r.request=r.actor.send("reloadTile",g,v.bind(this)):(r.actor=this.dispatcher.getActor(),r.request=r.actor.send("loadTile",g,v.bind(this)))}abortTile(r){r.request&&(r.request.cancel(),delete r.request),r.actor&&r.actor.send("abortTile",{uid:r.uid,type:this.type,source:this.id},void 0)}unloadTile(r){r.unloadVectorData(),r.actor&&r.actor.send("removeTile",{uid:r.uid,type:this.type,source:this.id},void 0)}hasTransition(){return!1}}class De extends f.Evented{constructor(r,a,h,g){super(),this.id=r,this.dispatcher=h,this.setEventedParent(g),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=f.extend({type:"raster"},a),f.extend(this,f.pick(a,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new f.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=me(this._options,this.map._requestManager,(r,a)=>{this._tileJSONRequest=null,this._loaded=!0,r?this.fire(new f.ErrorEvent(r)):a&&(f.extend(this,a),a.bounds&&(this.tileBounds=new _e(a.bounds,this.minzoom,this.maxzoom)),this.fire(new f.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new f.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(r){this.map=r,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return f.extend({},this._options)}hasTile(r){return!this.tileBounds||this.tileBounds.contains(r.canonical)}loadTile(r,a){const h=r.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);r.request=f.getImage(this.map._requestManager.transformRequest(h,f.ResourceType.Tile),(g,v,D)=>{if(delete r.request,r.aborted)r.state="unloaded",a(null);else if(g)r.state="errored",a(g);else if(v){this.map._refreshExpiredTiles&&r.setExpiryData(D);const M=this.map.painter.context,S=M.gl;r.texture=this.map.painter.getTileTexture(v.width),r.texture?r.texture.update(v,{useMipmap:!0}):(r.texture=new Gt(M,v,S.RGBA,{useMipmap:!0}),r.texture.bind(S.LINEAR,S.CLAMP_TO_EDGE,S.LINEAR_MIPMAP_NEAREST),M.extTextureFilterAnisotropic&&S.texParameterf(S.TEXTURE_2D,M.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,M.extTextureFilterAnisotropicMax)),r.state="loaded",f.cacheEntryPossiblyAdded(this.dispatcher),a(null)}})}abortTile(r,a){r.request&&(r.request.cancel(),delete r.request),a()}unloadTile(r,a){r.texture&&this.map.painter.saveTileTexture(r.texture),a()}hasTransition(){return!1}}let Re;class ze extends De{constructor(r,a,h,g){super(r,a,h,g),this.type="raster-dem",this.maxzoom=22,this._options=f.extend({type:"raster-dem"},a),this.encoding=a.encoding||"mapbox"}serialize(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}}loadTile(r,a){const h=r.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);function g(v,D){v&&(r.state="errored",a(v)),D&&(r.dem=D,r.needsHillshadePrepare=!0,r.state="loaded",a(null))}r.request=f.getImage(this.map._requestManager.transformRequest(h,f.ResourceType.Tile),function(v,D){if(delete r.request,r.aborted)r.state="unloaded",a(null);else if(v)r.state="errored",a(v);else if(D){this.map._refreshExpiredTiles&&r.setExpiryData(D),delete D.cacheControl,delete D.expires;const M=f.isImageBitmap(D)&&(null==Re&&(Re=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof createImageBitmap),Re)?D:f.exported.getImageData(D,1),S={uid:r.uid,coord:r.tileID,source:this.id,rawImageData:M,encoding:this.encoding};r.actor&&"expired"!==r.state||(r.actor=this.dispatcher.getActor(),r.actor.send("loadDEMTile",S,g.bind(this)))}}.bind(this)),r.neighboringTiles=this._getNeighboringTiles(r.tileID)}_getNeighboringTiles(r){const a=r.canonical,h=Math.pow(2,a.z),g=(a.x-1+h)%h,v=0===a.x?r.wrap-1:r.wrap,D=(a.x+1+h)%h,M=a.x+1===h?r.wrap+1:r.wrap,S={};return S[new f.OverscaledTileID(r.overscaledZ,v,a.z,g,a.y).key]={backfilled:!1},S[new f.OverscaledTileID(r.overscaledZ,M,a.z,D,a.y).key]={backfilled:!1},a.y>0&&(S[new f.OverscaledTileID(r.overscaledZ,v,a.z,g,a.y-1).key]={backfilled:!1},S[new f.OverscaledTileID(r.overscaledZ,r.wrap,a.z,a.x,a.y-1).key]={backfilled:!1},S[new f.OverscaledTileID(r.overscaledZ,M,a.z,D,a.y-1).key]={backfilled:!1}),a.y+1<h&&(S[new f.OverscaledTileID(r.overscaledZ,v,a.z,g,a.y+1).key]={backfilled:!1},S[new f.OverscaledTileID(r.overscaledZ,r.wrap,a.z,a.x,a.y+1).key]={backfilled:!1},S[new f.OverscaledTileID(r.overscaledZ,M,a.z,D,a.y+1).key]={backfilled:!1}),S}unloadTile(r){r.demTexture&&this.map.painter.saveTileTexture(r.demTexture),r.fbo&&(r.fbo.destroy(),delete r.fbo),r.dem&&delete r.dem,delete r.neighboringTiles,r.state="unloaded",r.actor&&r.actor.send("removeDEMTile",{uid:r.uid,source:this.id})}}class bt extends f.Evented{constructor(r,a,h,g){super(),this.id=r,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=h.getActor(),this.setEventedParent(g),this._data=a.data,this._options=f.extend({},a),this._collectResourceTiming=a.collectResourceTiming,void 0!==a.maxzoom&&(this.maxzoom=a.maxzoom),a.type&&(this.type=a.type),a.attribution&&(this.attribution=a.attribution),this.promoteId=a.promoteId;const v=f.EXTENT/this.tileSize;this.workerOptions=f.extend({source:this.id,cluster:a.cluster||!1,geojsonVtOptions:{buffer:(void 0!==a.buffer?a.buffer:128)*v,tolerance:(void 0!==a.tolerance?a.tolerance:.375)*v,extent:f.EXTENT,maxZoom:this.maxzoom,lineMetrics:a.lineMetrics||!1,generateId:a.generateId||!1},superclusterOptions:{maxZoom:void 0!==a.clusterMaxZoom?a.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,a.clusterMinPoints||2),extent:f.EXTENT,radius:(a.clusterRadius||50)*v,log:!1,generateId:a.generateId||!1},clusterProperties:a.clusterProperties,filter:a.filter},a.workerOptions)}load(){this._updateWorkerData("metadata")}onAdd(r){this.map=r,this.load()}setData(r){return this._data=r,this._updateWorkerData("content"),this}getClusterExpansionZoom(r,a){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:r,source:this.id},a),this}getClusterChildren(r,a){return this.actor.send("geojson.getClusterChildren",{clusterId:r,source:this.id},a),this}getClusterLeaves(r,a,h,g){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:r,limit:a,offset:h},g),this}_updateWorkerData(r){const a=f.extend({},this.workerOptions),h=this._data;"string"==typeof h?(a.request=this.map._requestManager.transformRequest(f.exported.resolveURL(h),f.ResourceType.Source),a.request.collectResourceTiming=this._collectResourceTiming):a.data=JSON.stringify(h),this._pendingLoads++,this.fire(new f.Event("dataloading",{dataType:"source"})),this.actor.send(`${this.type}.loadData`,a,(g,v)=>{if(this._pendingLoads--,this._removed||v&&v.abandoned)return;let D=null;if(v&&v.resourceTiming&&v.resourceTiming[this.id]&&(D=v.resourceTiming[this.id].slice(0)),this.actor.send(`${this.type}.coalesce`,{source:a.source},null),g)return void this.fire(new f.ErrorEvent(g));const M={dataType:"source",sourceDataType:r};this._collectResourceTiming&&D&&D.length>0&&f.extend(M,{resourceTiming:D}),this.fire(new f.Event("data",M))})}loaded(){return 0===this._pendingLoads}loadTile(r,a){const h=r.actor?"reloadTile":"loadTile";r.actor=this.actor;const g={type:this.type,uid:r.uid,tileID:r.tileID,zoom:r.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};r.request=this.actor.send(h,g,(v,D)=>(delete r.request,r.unloadVectorData(),r.aborted?a(null):v?a(v):(r.loadVectorData(D,this.map.painter,"reloadTile"===h),a(null))))}abortTile(r){r.request&&(r.request.cancel(),delete r.request),r.aborted=!0}unloadTile(r){r.unloadVectorData(),this.actor.send("removeTile",{uid:r.uid,type:this.type,source:this.id})}onRemove(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})}serialize(){return f.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var An=f.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class fr extends f.Evented{constructor(r,a,h,g){super(),this.id=r,this.dispatcher=h,this.coordinates=a.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(g),this.options=a}load(r,a){this._loaded=!1,this.fire(new f.Event("dataloading",{dataType:"source"})),this.url=this.options.url,f.getImage(this.map._requestManager.transformRequest(this.url,f.ResourceType.Image),(h,g)=>{this._loaded=!0,h?this.fire(new f.ErrorEvent(h)):g&&(this.image=g,r&&(this.coordinates=r),a&&a(),this._finishLoading())})}loaded(){return this._loaded}updateImage(r){return this.image&&r.url?(this.options.url=r.url,this.load(r.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new f.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(r){this.map=r,this.load()}setCoordinates(r){this.coordinates=r;const a=r.map(f.MercatorCoordinate.fromLngLat);this.tileID=function(g){let v=1/0,D=1/0,M=-1/0,S=-1/0;for(const re of g)v=Math.min(v,re.x),D=Math.min(D,re.y),M=Math.max(M,re.x),S=Math.max(S,re.y);const z=Math.max(M-v,S-D),q=Math.max(0,Math.floor(-Math.log(z)/Math.LN2)),X=Math.pow(2,q);return new f.CanonicalTileID(q,Math.floor((v+M)/2*X),Math.floor((D+S)/2*X))}(a),this.minzoom=this.maxzoom=this.tileID.z;const h=a.map(g=>this.tileID.getTilePoint(g)._round());return this._boundsArray=new f.RasterBoundsArray,this._boundsArray.emplaceBack(h[0].x,h[0].y,0,0),this._boundsArray.emplaceBack(h[1].x,h[1].y,f.EXTENT,0),this._boundsArray.emplaceBack(h[3].x,h[3].y,0,f.EXTENT),this._boundsArray.emplaceBack(h[2].x,h[2].y,f.EXTENT,f.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new f.Event("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const r=this.map.painter.context,a=r.gl;this.boundsBuffer||(this.boundsBuffer=r.createVertexBuffer(this._boundsArray,An.members)),this.boundsSegments||(this.boundsSegments=f.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new Gt(r,this.image,a.RGBA),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE));for(const h in this.tiles){const g=this.tiles[h];"loaded"!==g.state&&(g.state="loaded",g.texture=this.texture)}}loadTile(r,a){this.tileID&&this.tileID.equals(r.tileID.canonical)?(this.tiles[String(r.tileID.wrap)]=r,r.buckets={},a(null)):(r.state="errored",a(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class on extends fr{constructor(r,a,h,g){super(r,a,h,g),this.roundZoom=!0,this.type="video",this.options=a}load(){this._loaded=!1;const r=this.options;this.urls=[];for(const a of r.urls)this.urls.push(this.map._requestManager.transformRequest(a,f.ResourceType.Source).url);f.getVideo(this.urls,(a,h)=>{this._loaded=!0,a?this.fire(new f.ErrorEvent(a)):h&&(this.video=h,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(r){if(this.video){const a=this.video.seekable;r<a.start(0)||r>a.end(0)?this.fire(new f.ErrorEvent(new f.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${a.start(0)} and ${a.end(0)}-second mark.`))):this.video.currentTime=r}}getVideo(){return this.video}onAdd(r){this.map||(this.map=r,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const r=this.map.painter.context,a=r.gl;this.boundsBuffer||(this.boundsBuffer=r.createVertexBuffer(this._boundsArray,An.members)),this.boundsSegments||(this.boundsSegments=f.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE),a.texSubImage2D(a.TEXTURE_2D,0,0,0,a.RGBA,a.UNSIGNED_BYTE,this.video)):(this.texture=new Gt(r,this.video,a.RGBA),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE));for(const h in this.tiles){const g=this.tiles[h];"loaded"!==g.state&&(g.state="loaded",g.texture=this.texture)}}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class qn extends fr{constructor(r,a,h,g){super(r,a,h,g),a.coordinates?Array.isArray(a.coordinates)&&4===a.coordinates.length&&!a.coordinates.some(v=>!Array.isArray(v)||2!==v.length||v.some(D=>"number"!=typeof D))||this.fire(new f.ErrorEvent(new f.ValidationError(`sources.${r}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new f.ErrorEvent(new f.ValidationError(`sources.${r}`,null,'missing required property "coordinates"'))),a.animate&&"boolean"!=typeof a.animate&&this.fire(new f.ErrorEvent(new f.ValidationError(`sources.${r}`,null,'optional "animate" property must be a boolean value'))),a.canvas?"string"==typeof a.canvas||a.canvas instanceof HTMLCanvasElement||this.fire(new f.ErrorEvent(new f.ValidationError(`sources.${r}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new f.ErrorEvent(new f.ValidationError(`sources.${r}`,null,'missing required property "canvas"'))),this.options=a,this.animate=void 0===a.animate||a.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new f.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(r){this.map=r,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let r=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,r=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,r=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;const a=this.map.painter.context,h=a.gl;this.boundsBuffer||(this.boundsBuffer=a.createVertexBuffer(this._boundsArray,An.members)),this.boundsSegments||(this.boundsSegments=f.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(r||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new Gt(a,this.canvas,h.RGBA,{premultiply:!0});for(const g in this.tiles){const v=this.tiles[g];"loaded"!==v.state&&(v.state="loaded",v.texture=this.texture)}}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const r of[this.canvas.width,this.canvas.height])if(isNaN(r)||r<=0)return!0;return!1}}const kn={vector:ke,raster:De,"raster-dem":ze,geojson:bt,video:on,image:fr,canvas:qn};function Zn(p,r){const a=f.create();return f.translate(a,a,[1,1,0]),f.scale(a,a,[.5*p.width,.5*p.height,1]),f.multiply(a,a,p.calculatePosMatrix(r.toUnwrapped()))}function hr(p,r,a,h,g,v){const D=function(X,re,ue){if(X)for(const ie of X){const ce=re[ie];if(ce&&ce.source===ue&&"fill-extrusion"===ce.type)return!0}else for(const ie in re){const ce=re[ie];if(ce.source===ue&&"fill-extrusion"===ce.type)return!0}return!1}(g&&g.layers,r,p.id),M=v.maxPitchScaleFactor(),S=p.tilesIn(h,M,D);S.sort(Rr);const z=[];for(const X of S)z.push({wrappedTileID:X.tileID.wrapped().key,queryResults:X.tile.queryRenderedFeatures(r,a,p._state,X.queryGeometry,X.cameraQueryGeometry,X.scale,g,v,M,Zn(p.transform,X.tileID))});const q=function(X){const re={},ue={};for(const ie of X){const ce=ie.queryResults,ye=ie.wrappedTileID,ge=ue[ye]=ue[ye]||{};for(const Me in ce){const xe=ce[Me],$e=ge[Me]=ge[Me]||{},Oe=re[Me]=re[Me]||[];for(const Ne of xe)$e[Ne.featureIndex]||($e[Ne.featureIndex]=!0,Oe.push(Ne))}}return re}(z);for(const X in q)q[X].forEach(re=>{const ue=re.feature,ie=p.getFeatureState(ue.layer["source-layer"],ue.id);ue.source=ue.layer.source,ue.layer["source-layer"]&&(ue.sourceLayer=ue.layer["source-layer"]),ue.state=ie});return q}function Rr(p,r){const a=p.tileID,h=r.tileID;return a.overscaledZ-h.overscaledZ||a.canonical.y-h.canonical.y||a.wrap-h.wrap||a.canonical.x-h.canonical.x}class ar{constructor(r,a){this.tileID=r,this.uid=f.uniqueId(),this.uses=0,this.tileSize=a,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(r){const a=r+this.timeAdded;a<f.exported.now()||this.fadeEndTime&&a<this.fadeEndTime||(this.fadeEndTime=a)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}loadVectorData(r,a,h){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",r){r.featureIndex&&(this.latestFeatureIndex=r.featureIndex,r.rawTileData?(this.latestRawTileData=r.rawTileData,this.latestFeatureIndex.rawTileData=r.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=r.collisionBoxArray,this.buckets=function(g,v){const D={};if(!v)return D;for(const M of g){const S=M.layerIds.map(z=>v.getLayer(z)).filter(Boolean);if(0!==S.length){M.layers=S,M.stateDependentLayerIds&&(M.stateDependentLayers=M.stateDependentLayerIds.map(z=>S.filter(q=>q.id===z)[0]));for(const z of S)D[z.id]=M}}return D}(r.buckets,a.style),this.hasSymbolBuckets=!1;for(const g in this.buckets){const v=this.buckets[g];if(v instanceof f.SymbolBucket){if(this.hasSymbolBuckets=!0,!h)break;v.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const g in this.buckets){const v=this.buckets[g];if(v instanceof f.SymbolBucket&&v.hasRTLText){this.hasRTLText=!0,f.lazyLoadRTLTextPlugin();break}}this.queryPadding=0;for(const g in this.buckets){const v=this.buckets[g];this.queryPadding=Math.max(this.queryPadding,a.style.getLayer(g).queryRadius(v))}r.imageAtlas&&(this.imageAtlas=r.imageAtlas),r.glyphAtlasImage&&(this.glyphAtlasImage=r.glyphAtlasImage)}else this.collisionBoxArray=new f.CollisionBoxArray}unloadVectorData(){for(const r in this.buckets)this.buckets[r].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(r){return this.buckets[r.id]}upload(r){for(const h in this.buckets){const g=this.buckets[h];g.uploadPending()&&g.upload(r)}const a=r.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Gt(r,this.imageAtlas.image,a.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Gt(r,this.glyphAtlasImage,a.ALPHA),this.glyphAtlasImage=null)}prepare(r){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(r,this.imageAtlasTexture)}queryRenderedFeatures(r,a,h,g,v,D,M,S,z,q){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:g,cameraQueryGeometry:v,scale:D,tileSize:this.tileSize,pixelPosMatrix:q,transform:S,params:M,queryPadding:this.queryPadding*z},r,a,h):{}}querySourceFeatures(r,a){const h=this.latestFeatureIndex;if(!h||!h.rawTileData)return;const g=h.loadVTLayers(),v=a?a.sourceLayer:"",D=g._geojsonTileLayer||g[v];if(!D)return;const M=f.createFilter(a&&a.filter),{z:S,x:z,y:q}=this.tileID.canonical,X={z:S,x:z,y:q};for(let re=0;re<D.length;re++){const ue=D.feature(re);if(M.needGeometry){const ye=f.toEvaluationFeature(ue,!0);if(!M.filter(new f.EvaluationParameters(this.tileID.overscaledZ),ye,this.tileID.canonical))continue}else if(!M.filter(new f.EvaluationParameters(this.tileID.overscaledZ),ue))continue;const ie=h.getId(ue,v),ce=new f.GeoJSONFeature(ue,S,z,q,ie);ce.tile=X,r.push(ce)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(r){const a=this.expirationTime;if(r.cacheControl){const h=f.parseCacheControl(r.cacheControl);h["max-age"]&&(this.expirationTime=Date.now()+1e3*h["max-age"])}else r.expires&&(this.expirationTime=new Date(r.expires).getTime());if(this.expirationTime){const h=Date.now();let g=!1;if(this.expirationTime>h)g=!1;else if(a)if(this.expirationTime<a)g=!0;else{const v=this.expirationTime-a;v?this.expirationTime=h+Math.max(v,3e4):g=!0}else g=!0;g?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(r,a){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(r).length)return;const h=this.latestFeatureIndex.loadVTLayers();for(const g in this.buckets){if(!a.style.hasLayer(g))continue;const v=this.buckets[g],D=v.layers[0].sourceLayer||"_geojsonTileLayer",M=h[D],S=r[D];if(!M||!S||0===Object.keys(S).length)continue;v.update(S,M,this.imageAtlas&&this.imageAtlas.patternPositions||{});const z=a&&a.style&&a.style.getLayer(g);z&&(this.queryPadding=Math.max(this.queryPadding,z.queryRadius(v)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<f.exported.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(r){this.symbolFadeHoldUntil=f.exported.now()+r}setDependencies(r,a){const h={};for(const g of a)h[g]=!0;this.dependencies[r]=h}hasDependency(r,a){for(const h of r){const g=this.dependencies[h];if(g)for(const v of a)if(g[v])return!0}return!1}}class br{constructor(r,a){this.max=r,this.onRemove=a,this.reset()}reset(){for(const r in this.data)for(const a of this.data[r])a.timeout&&clearTimeout(a.timeout),this.onRemove(a.value);return this.data={},this.order=[],this}add(r,a,h){const g=r.wrapped().key;void 0===this.data[g]&&(this.data[g]=[]);const v={value:a,timeout:void 0};if(void 0!==h&&(v.timeout=setTimeout(()=>{this.remove(r,v)},h)),this.data[g].push(v),this.order.push(g),this.order.length>this.max){const D=this._getAndRemoveByKey(this.order[0]);D&&this.onRemove(D)}return this}has(r){return r.wrapped().key in this.data}getAndRemove(r){return this.has(r)?this._getAndRemoveByKey(r.wrapped().key):null}_getAndRemoveByKey(r){const a=this.data[r].shift();return a.timeout&&clearTimeout(a.timeout),0===this.data[r].length&&delete this.data[r],this.order.splice(this.order.indexOf(r),1),a.value}getByKey(r){const a=this.data[r];return a?a[0].value:null}get(r){return this.has(r)?this.data[r.wrapped().key][0].value:null}remove(r,a){if(!this.has(r))return this;const h=r.wrapped().key,g=void 0===a?0:this.data[h].indexOf(a),v=this.data[h][g];return this.data[h].splice(g,1),v.timeout&&clearTimeout(v.timeout),0===this.data[h].length&&delete this.data[h],this.onRemove(v.value),this.order.splice(this.order.indexOf(h),1),this}setMaxSize(r){for(this.max=r;this.order.length>this.max;){const a=this._getAndRemoveByKey(this.order[0]);a&&this.onRemove(a)}return this}filter(r){const a=[];for(const h in this.data)for(const g of this.data[h])r(g.value)||a.push(g);for(const h of a)this.remove(h.value.tileID,h)}}class Gi{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(r,a,h){const g=String(a);if(this.stateChanges[r]=this.stateChanges[r]||{},this.stateChanges[r][g]=this.stateChanges[r][g]||{},f.extend(this.stateChanges[r][g],h),null===this.deletedStates[r]){this.deletedStates[r]={};for(const v in this.state[r])v!==g&&(this.deletedStates[r][v]=null)}else if(this.deletedStates[r]&&null===this.deletedStates[r][g]){this.deletedStates[r][g]={};for(const v in this.state[r][g])h[v]||(this.deletedStates[r][g][v]=null)}else for(const v in h)this.deletedStates[r]&&this.deletedStates[r][g]&&null===this.deletedStates[r][g][v]&&delete this.deletedStates[r][g][v]}removeFeatureState(r,a,h){if(null===this.deletedStates[r])return;const g=String(a);if(this.deletedStates[r]=this.deletedStates[r]||{},h&&void 0!==a)null!==this.deletedStates[r][g]&&(this.deletedStates[r][g]=this.deletedStates[r][g]||{},this.deletedStates[r][g][h]=null);else if(void 0!==a)if(this.stateChanges[r]&&this.stateChanges[r][g])for(h in this.deletedStates[r][g]={},this.stateChanges[r][g])this.deletedStates[r][g][h]=null;else this.deletedStates[r][g]=null;else this.deletedStates[r]=null}getState(r,a){const h=String(a),g=f.extend({},(this.state[r]||{})[h],(this.stateChanges[r]||{})[h]);if(null===this.deletedStates[r])return{};if(this.deletedStates[r]){const v=this.deletedStates[r][a];if(null===v)return{};for(const D in v)delete g[D]}return g}initializeTileState(r,a){r.setFeatureState(this.state,a)}coalesceChanges(r,a){const h={};for(const g in this.stateChanges){this.state[g]=this.state[g]||{};const v={};for(const D in this.stateChanges[g])this.state[g][D]||(this.state[g][D]={}),f.extend(this.state[g][D],this.stateChanges[g][D]),v[D]=this.state[g][D];h[g]=v}for(const g in this.deletedStates){this.state[g]=this.state[g]||{};const v={};if(null===this.deletedStates[g])for(const D in this.state[g])v[D]={},this.state[g][D]={};else for(const D in this.deletedStates[g]){if(null===this.deletedStates[g][D])this.state[g][D]={};else for(const M of Object.keys(this.deletedStates[g][D]))delete this.state[g][D][M];v[D]=this.state[g][D]}h[g]=h[g]||{},f.extend(h[g],v)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(h).length)for(const g in r)r[g].setFeatureState(h,a)}}class mr extends f.Evented{constructor(r,a,h){super(),this.id=r,this.dispatcher=h,this.on("data",g=>{"source"===g.dataType&&"metadata"===g.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===g.dataType&&"content"===g.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=function(g,v,D,M){const S=new kn[v.type](g,v,D,M);if(S.id!==g)throw new Error(`Expected Source id to be ${g} instead of ${S.id}`);return f.bindAll(["load","abort","unload","serialize","prepare"],S),S}(r,a,h,this),this._tiles={},this._cache=new br(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Gi}onAdd(r){this.map=r,this._maxTileCacheSize=r?r._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(r)}onRemove(r){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(r)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const r in this._tiles){const a=this._tiles[r];if("loaded"!==a.state&&"errored"!==a.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const r=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,r&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(r,a){return this._source.loadTile(r,a)}_unloadTile(r){if(this._source.unloadTile)return this._source.unloadTile(r,()=>{})}_abortTile(r){this._source.abortTile&&this._source.abortTile(r,()=>{}),this._source.fire(new f.Event("dataabort",{tile:r,coord:r.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(r){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const a in this._tiles){const h=this._tiles[a];h.upload(r),h.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(r=>r.tileID).sort(Hi).map(r=>r.key)}getRenderableIds(r){const a=[];for(const h in this._tiles)this._isIdRenderable(h,r)&&a.push(this._tiles[h]);return r?a.sort((h,g)=>{const v=h.tileID,D=g.tileID,M=new f.pointGeometry(v.canonical.x,v.canonical.y)._rotate(this.transform.angle),S=new f.pointGeometry(D.canonical.x,D.canonical.y)._rotate(this.transform.angle);return v.overscaledZ-D.overscaledZ||S.y-M.y||S.x-M.x}).map(h=>h.tileID.key):a.map(h=>h.tileID).sort(Hi).map(h=>h.key)}hasRenderableParent(r){const a=this.findLoadedParent(r,0);return!!a&&this._isIdRenderable(a.tileID.key)}_isIdRenderable(r,a){return this._tiles[r]&&this._tiles[r].hasData()&&!this._coveredTiles[r]&&(a||!this._tiles[r].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const r in this._tiles)"errored"!==this._tiles[r].state&&this._reloadTile(r,"reloading")}}_reloadTile(r,a){const h=this._tiles[r];h&&("loading"!==h.state&&(h.state=a),this._loadTile(h,this._tileLoaded.bind(this,h,r,a)))}_tileLoaded(r,a,h,g){if(g)return r.state="errored",void(404!==g.status?this._source.fire(new f.ErrorEvent(g,{tile:r})):this.update(this.transform));r.timeAdded=f.exported.now(),"expired"===h&&(r.refreshedUponExpiration=!0),this._setTileReloadTimer(a,r),"raster-dem"===this.getSource().type&&r.dem&&this._backfillDEM(r),this._state.initializeTileState(r,this.map?this.map.painter:null),r.aborted||this._source.fire(new f.Event("data",{dataType:"source",tile:r,coord:r.tileID}))}_backfillDEM(r){const a=this.getRenderableIds();for(let g=0;g<a.length;g++){const v=a[g];if(r.neighboringTiles&&r.neighboringTiles[v]){const D=this.getTileByID(v);h(r,D),h(D,r)}}function h(g,v){g.needsHillshadePrepare=!0;let D=v.tileID.canonical.x-g.tileID.canonical.x;const M=v.tileID.canonical.y-g.tileID.canonical.y,S=Math.pow(2,g.tileID.canonical.z),z=v.tileID.key;0===D&&0===M||Math.abs(M)>1||(Math.abs(D)>1&&(1===Math.abs(D+S)?D+=S:1===Math.abs(D-S)&&(D-=S)),v.dem&&g.dem&&(g.dem.backfillBorder(v.dem,D,M),g.neighboringTiles&&g.neighboringTiles[z]&&(g.neighboringTiles[z].backfilled=!0)))}}getTile(r){return this.getTileByID(r.key)}getTileByID(r){return this._tiles[r]}_retainLoadedChildren(r,a,h,g){for(const v in this._tiles){let D=this._tiles[v];if(g[v]||!D.hasData()||D.tileID.overscaledZ<=a||D.tileID.overscaledZ>h)continue;let M=D.tileID;for(;D&&D.tileID.overscaledZ>a+1;){const z=D.tileID.scaledTo(D.tileID.overscaledZ-1);D=this._tiles[z.key],D&&D.hasData()&&(M=z)}let S=M;for(;S.overscaledZ>a;)if(S=S.scaledTo(S.overscaledZ-1),r[S.key]){g[M.key]=M;break}}}findLoadedParent(r,a){if(r.key in this._loadedParentTiles){const h=this._loadedParentTiles[r.key];return h&&h.tileID.overscaledZ>=a?h:null}for(let h=r.overscaledZ-1;h>=a;h--){const g=r.scaledTo(h),v=this._getLoadedTile(g);if(v)return v}}_getLoadedTile(r){const a=this._tiles[r.key];return a&&a.hasData()?a:this._cache.getByKey(r.wrapped().key)}updateCacheSize(r){const a=Math.ceil(r.width/this._source.tileSize)+1,h=Math.ceil(r.height/this._source.tileSize)+1,g=Math.floor(a*h*5),v="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,g):g;this._cache.setMaxSize(v)}handleWrapJump(r){const a=Math.round((r-(void 0===this._prevLng?r:this._prevLng))/360);if(this._prevLng=r,a){const h={};for(const g in this._tiles){const v=this._tiles[g];v.tileID=v.tileID.unwrapTo(v.tileID.wrap+a),h[v.tileID.key]=v}this._tiles=h;for(const g in this._timers)clearTimeout(this._timers[g]),delete this._timers[g];for(const g in this._tiles)this._setTileReloadTimer(g,this._tiles[g])}}update(r){if(this.transform=r,!this._sourceLoaded||this._paused)return;let a;this.updateCacheSize(r),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?a=r.getVisibleUnwrappedCoordinates(this._source.tileID).map(S=>new f.OverscaledTileID(S.canonical.z,S.wrap,S.canonical.z,S.canonical.x,S.canonical.y)):(a=r.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(a=a.filter(S=>this._source.hasTile(S)))):a=[];const h=r.coveringZoomLevel(this._source),g=Math.max(h-mr.maxOverzooming,this._source.minzoom),v=Math.max(h+mr.maxUnderzooming,this._source.minzoom),D=this._updateRetainedTiles(a,h);if(Mo(this._source.type)){const S={},z={},q=Object.keys(D);for(const X of q){const re=D[X],ue=this._tiles[X];if(!ue||ue.fadeEndTime&&ue.fadeEndTime<=f.exported.now())continue;const ie=this.findLoadedParent(re,g);ie&&(this._addTile(ie.tileID),S[ie.tileID.key]=ie.tileID),z[X]=re}this._retainLoadedChildren(z,h,v,D);for(const X in S)D[X]||(this._coveredTiles[X]=!0,D[X]=S[X])}for(const S in D)this._tiles[S].clearFadeHold();const M=f.keysDifference(this._tiles,D);for(const S of M){const z=this._tiles[S];z.hasSymbolBuckets&&!z.holdingForFade()?z.setHoldDuration(this.map._fadeDuration):z.hasSymbolBuckets&&!z.symbolFadeFinished()||this._removeTile(S)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const r in this._tiles)this._tiles[r].holdingForFade()&&this._removeTile(r)}_updateRetainedTiles(r,a){const h={},g={},v=Math.max(a-mr.maxOverzooming,this._source.minzoom),D=Math.max(a+mr.maxUnderzooming,this._source.minzoom),M={};for(const S of r){const z=this._addTile(S);h[S.key]=S,z.hasData()||a<this._source.maxzoom&&(M[S.key]=S)}this._retainLoadedChildren(M,a,D,h);for(const S of r){let z=this._tiles[S.key];if(z.hasData())continue;if(a+1>this._source.maxzoom){const X=S.children(this._source.maxzoom)[0],re=this.getTile(X);if(re&&re.hasData()){h[X.key]=X;continue}}else{const X=S.children(this._source.maxzoom);if(h[X[0].key]&&h[X[1].key]&&h[X[2].key]&&h[X[3].key])continue}let q=z.wasRequested();for(let X=S.overscaledZ-1;X>=v;--X){const re=S.scaledTo(X);if(g[re.key]||(g[re.key]=!0,z=this.getTile(re),!z&&q&&(z=this._addTile(re)),z&&(h[re.key]=re,q=z.wasRequested(),z.hasData())))break}}return h}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const r in this._tiles){const a=[];let h,g=this._tiles[r].tileID;for(;g.overscaledZ>0;){if(g.key in this._loadedParentTiles){h=this._loadedParentTiles[g.key];break}a.push(g.key);const v=g.scaledTo(g.overscaledZ-1);if(h=this._getLoadedTile(v),h)break;g=v}for(const v of a)this._loadedParentTiles[v]=h}}_addTile(r){let a=this._tiles[r.key];if(a)return a;a=this._cache.getAndRemove(r),a&&(this._setTileReloadTimer(r.key,a),a.tileID=r,this._state.initializeTileState(a,this.map?this.map.painter:null),this._cacheTimers[r.key]&&(clearTimeout(this._cacheTimers[r.key]),delete this._cacheTimers[r.key],this._setTileReloadTimer(r.key,a)));const h=a;return a||(a=new ar(r,this._source.tileSize*r.overscaleFactor()),this._loadTile(a,this._tileLoaded.bind(this,a,r.key,a.state))),a.uses++,this._tiles[r.key]=a,h||this._source.fire(new f.Event("dataloading",{tile:a,coord:a.tileID,dataType:"source"})),a}_setTileReloadTimer(r,a){r in this._timers&&(clearTimeout(this._timers[r]),delete this._timers[r]);const h=a.getExpiryTimeout();h&&(this._timers[r]=setTimeout(()=>{this._reloadTile(r,"expired"),delete this._timers[r]},h))}_removeTile(r){const a=this._tiles[r];a&&(a.uses--,delete this._tiles[r],this._timers[r]&&(clearTimeout(this._timers[r]),delete this._timers[r]),a.uses>0||(a.hasData()&&"reloading"!==a.state?this._cache.add(a.tileID,a,a.getExpiryTimeout()):(a.aborted=!0,this._abortTile(a),this._unloadTile(a))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const r in this._tiles)this._removeTile(r);this._cache.reset()}tilesIn(r,a,h){const g=[],v=this.transform;if(!v)return g;const D=h?v.getCameraQueryGeometry(r):r,M=r.map(ie=>v.pointCoordinate(ie)),S=D.map(ie=>v.pointCoordinate(ie)),z=this.getIds();let q=1/0,X=1/0,re=-1/0,ue=-1/0;for(const ie of S)q=Math.min(q,ie.x),X=Math.min(X,ie.y),re=Math.max(re,ie.x),ue=Math.max(ue,ie.y);for(let ie=0;ie<z.length;ie++){const ce=this._tiles[z[ie]];if(ce.holdingForFade())continue;const ye=ce.tileID,ge=Math.pow(2,v.zoom-ce.tileID.overscaledZ),Me=a*ce.queryPadding*f.EXTENT/ce.tileSize/ge,xe=[ye.getTilePoint(new f.MercatorCoordinate(q,X)),ye.getTilePoint(new f.MercatorCoordinate(re,ue))];if(xe[0].x-Me<f.EXTENT&&xe[0].y-Me<f.EXTENT&&xe[1].x+Me>=0&&xe[1].y+Me>=0){const $e=M.map(Ne=>ye.getTilePoint(Ne)),Oe=S.map(Ne=>ye.getTilePoint(Ne));g.push({tile:ce,tileID:ye,queryGeometry:$e,cameraQueryGeometry:Oe,scale:ge})}}return g}getVisibleCoordinates(r){const a=this.getRenderableIds(r).map(h=>this._tiles[h].tileID);for(const h of a)h.posMatrix=this.transform.calculatePosMatrix(h.toUnwrapped());return a}hasTransition(){if(this._source.hasTransition())return!0;if(Mo(this._source.type))for(const r in this._tiles){const a=this._tiles[r];if(void 0!==a.fadeEndTime&&a.fadeEndTime>=f.exported.now())return!0}return!1}setFeatureState(r,a,h){this._state.updateState(r=r||"_geojsonTileLayer",a,h)}removeFeatureState(r,a,h){this._state.removeFeatureState(r=r||"_geojsonTileLayer",a,h)}getFeatureState(r,a){return this._state.getState(r=r||"_geojsonTileLayer",a)}setDependencies(r,a,h){const g=this._tiles[r];g&&g.setDependencies(a,h)}reloadTilesForDependencies(r,a){for(const h in this._tiles)this._tiles[h].hasDependency(r,a)&&this._reloadTile(h,"reloading");this._cache.filter(h=>!h.hasDependency(r,a))}}function Hi(p,r){const a=Math.abs(2*p.wrap)-+(p.wrap<0),h=Math.abs(2*r.wrap)-+(r.wrap<0);return p.overscaledZ-r.overscaledZ||h-a||r.canonical.y-p.canonical.y||r.canonical.x-p.canonical.x}function Mo(p){return"raster"===p||"image"===p||"video"===p}mr.maxOverzooming=10,mr.maxUnderzooming=3;const Ci="mapboxgl_preloaded_worker_pool";class Qr{constructor(){this.active={}}acquire(r){if(!this.workers)for(this.workers=[];this.workers.length<Qr.workerCount;)this.workers.push(new Worker(zi.workerUrl));return this.active[r]=!0,this.workers.slice()}release(r){delete this.active[r],0===this.numActive()&&(this.workers.forEach(a=>{a.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Ci]}numActive(){return Object.keys(this.active).length}}const qi=Math.floor(f.exported.hardwareConcurrency/2);let tr;function fn(){return tr||(tr=new Qr),tr}function li(p,r){const a={};for(const h in p)"ref"!==h&&(a[h]=p[h]);return f.refProperties.forEach(h=>{h in r&&(a[h]=r[h])}),a}function wr(p){p=p.slice();const r=Object.create(null);for(let a=0;a<p.length;a++)r[p[a].id]=p[a];for(let a=0;a<p.length;a++)"ref"in p[a]&&(p[a]=li(p[a],r[p[a].ref]));return p}Qr.workerCount=Math.max(Math.min(qi,6),1);const mn={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function Xe(p,r,a){a.push({command:mn.addSource,args:[p,r[p]]})}function Ke(p,r,a){r.push({command:mn.removeSource,args:[p]}),a[p]=!0}function T(p,r,a,h){Ke(p,a,h),Xe(p,r,a)}function ae(p,r,a){let h;for(h in p[a])if(Object.prototype.hasOwnProperty.call(p[a],h)&&"data"!==h&&!It(p[a][h],r[a][h]))return!1;for(h in r[a])if(Object.prototype.hasOwnProperty.call(r[a],h)&&"data"!==h&&!It(p[a][h],r[a][h]))return!1;return!0}function pe(p,r,a,h,g,v){let D;for(D in r=r||{},p=p||{})Object.prototype.hasOwnProperty.call(p,D)&&(It(p[D],r[D])||a.push({command:v,args:[h,D,r[D],g]}));for(D in r)Object.prototype.hasOwnProperty.call(r,D)&&!Object.prototype.hasOwnProperty.call(p,D)&&(It(p[D],r[D])||a.push({command:v,args:[h,D,r[D],g]}))}function Te(p){return p.id}function Nt(p,r){return p[r.id]=r,p}class ht{constructor(r,a){this.reset(r,a)}reset(r,a){this.points=r||[],this._distances=[0];for(let h=1;h<this.points.length;h++)this._distances[h]=this._distances[h-1]+this.points[h].dist(this.points[h-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(a||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(r){if(1===this.points.length)return this.points[0];r=f.clamp(r,0,1);let a=1,h=this._distances[a];const g=r*this.paddedLength+this.padding;for(;h<g&&a<this._distances.length;)h=this._distances[++a];const v=a-1,D=this._distances[v],M=h-D,S=M>0?(g-D)/M:0;return this.points[v].mult(1-S).add(this.points[a].mult(S))}}function ut(p,r){let a=!0;return"always"===p||"never"!==p&&"never"!==r||(a=!1),a}class Dr{constructor(r,a,h){const g=this.boxCells=[],v=this.circleCells=[];this.xCellCount=Math.ceil(r/h),this.yCellCount=Math.ceil(a/h);for(let D=0;D<this.xCellCount*this.yCellCount;D++)g.push([]),v.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=r,this.height=a,this.xScale=this.xCellCount/r,this.yScale=this.yCellCount/a,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(r,a,h,g,v){this._forEachCell(a,h,g,v,this._insertBoxCell,this.boxUid++),this.boxKeys.push(r),this.bboxes.push(a),this.bboxes.push(h),this.bboxes.push(g),this.bboxes.push(v)}insertCircle(r,a,h,g){this._forEachCell(a-g,h-g,a+g,h+g,this._insertCircleCell,this.circleUid++),this.circleKeys.push(r),this.circles.push(a),this.circles.push(h),this.circles.push(g)}_insertBoxCell(r,a,h,g,v,D){this.boxCells[v].push(D)}_insertCircleCell(r,a,h,g,v,D){this.circleCells[v].push(D)}_query(r,a,h,g,v,D,M){if(h<0||r>this.width||g<0||a>this.height)return[];const S=[];if(r<=0&&a<=0&&this.width<=h&&this.height<=g){if(v)return[{key:null,x1:r,y1:a,x2:h,y2:g}];for(let z=0;z<this.boxKeys.length;z++)S.push({key:this.boxKeys[z],x1:this.bboxes[4*z],y1:this.bboxes[4*z+1],x2:this.bboxes[4*z+2],y2:this.bboxes[4*z+3]});for(let z=0;z<this.circleKeys.length;z++){const q=this.circles[3*z],X=this.circles[3*z+1],re=this.circles[3*z+2];S.push({key:this.circleKeys[z],x1:q-re,y1:X-re,x2:q+re,y2:X+re})}}else this._forEachCell(r,a,h,g,this._queryCell,S,{hitTest:v,overlapMode:D,seenUids:{box:{},circle:{}}},M);return S}query(r,a,h,g){return this._query(r,a,h,g,!1,null)}hitTest(r,a,h,g,v,D){return this._query(r,a,h,g,!0,v,D).length>0}hitTestCircle(r,a,h,g,v){const D=r-h,M=r+h,S=a-h,z=a+h;if(M<0||D>this.width||z<0||S>this.height)return!1;const q=[];return this._forEachCell(D,S,M,z,this._queryCellCircle,q,{hitTest:!0,overlapMode:g,circle:{x:r,y:a,radius:h},seenUids:{box:{},circle:{}}},v),q.length>0}_queryCell(r,a,h,g,v,D,M,S){const{seenUids:z,hitTest:q,overlapMode:X}=M,re=this.boxCells[v];if(null!==re){const ie=this.bboxes;for(const ce of re)if(!z.box[ce]){z.box[ce]=!0;const ye=4*ce,ge=this.boxKeys[ce];if(r<=ie[ye+2]&&a<=ie[ye+3]&&h>=ie[ye+0]&&g>=ie[ye+1]&&(!S||S(ge))&&(!q||!ut(X,ge.overlapMode))&&(D.push({key:ge,x1:ie[ye],y1:ie[ye+1],x2:ie[ye+2],y2:ie[ye+3]}),q))return!0}}const ue=this.circleCells[v];if(null!==ue){const ie=this.circles;for(const ce of ue)if(!z.circle[ce]){z.circle[ce]=!0;const ye=3*ce,ge=this.circleKeys[ce];if(this._circleAndRectCollide(ie[ye],ie[ye+1],ie[ye+2],r,a,h,g)&&(!S||S(ge))&&(!q||!ut(X,ge.overlapMode))){const Me=ie[ye],xe=ie[ye+1],$e=ie[ye+2];if(D.push({key:ge,x1:Me-$e,y1:xe-$e,x2:Me+$e,y2:xe+$e}),q)return!0}}}return!1}_queryCellCircle(r,a,h,g,v,D,M,S){const{circle:z,seenUids:q,overlapMode:X}=M,re=this.boxCells[v];if(null!==re){const ie=this.bboxes;for(const ce of re)if(!q.box[ce]){q.box[ce]=!0;const ye=4*ce,ge=this.boxKeys[ce];if(this._circleAndRectCollide(z.x,z.y,z.radius,ie[ye+0],ie[ye+1],ie[ye+2],ie[ye+3])&&(!S||S(ge))&&!ut(X,ge.overlapMode))return D.push(!0),!0}}const ue=this.circleCells[v];if(null!==ue){const ie=this.circles;for(const ce of ue)if(!q.circle[ce]){q.circle[ce]=!0;const ye=3*ce,ge=this.circleKeys[ce];if(this._circlesCollide(ie[ye],ie[ye+1],ie[ye+2],z.x,z.y,z.radius)&&(!S||S(ge))&&!ut(X,ge.overlapMode))return D.push(!0),!0}}}_forEachCell(r,a,h,g,v,D,M,S){const z=this._convertToXCellCoord(r),q=this._convertToYCellCoord(a),X=this._convertToXCellCoord(h),re=this._convertToYCellCoord(g);for(let ue=z;ue<=X;ue++)for(let ie=q;ie<=re;ie++)if(v.call(this,r,a,h,g,this.xCellCount*ie+ue,D,M,S))return}_convertToXCellCoord(r){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(r*this.xScale)))}_convertToYCellCoord(r){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(r*this.yScale)))}_circlesCollide(r,a,h,g,v,D){const M=g-r,S=v-a,z=h+D;return z*z>M*M+S*S}_circleAndRectCollide(r,a,h,g,v,D,M){const S=(D-g)/2,z=Math.abs(r-(g+S));if(z>S+h)return!1;const q=(M-v)/2,X=Math.abs(a-(v+q));if(X>q+h)return!1;if(z<=S||X<=q)return!0;const re=z-S,ue=X-q;return re*re+ue*ue<=h*h}}function lr(p,r,a,h,g){const v=f.create();return r?(f.scale(v,v,[1/g,1/g,1]),a||f.rotateZ(v,v,h.angle)):f.multiply(v,h.labelPlaneMatrix,p),v}function Wn(p,r,a,h,g){if(r){const v=f.clone(p);return f.scale(v,v,[g,g,1]),a||f.rotateZ(v,v,-h.angle),v}return h.glCoordMatrix}function mt(p,r){const a=[p.x,p.y,0,1];rn(a,a,r);const h=a[3];return{point:new f.pointGeometry(a[0]/h,a[1]/h),signedDistanceFromCamera:h}}function Qe(p,r){return.5+p/r*.5}function hn(p,r){const a=p[0]/p[3],h=p[1]/p[3];return a>=-r[0]&&a<=r[0]&&h>=-r[1]&&h<=r[1]}function _t(p,r,a,h,g,v,D,M,S){const z=h?p.textSizeData:p.iconSizeData,q=f.evaluateSizeForZoom(z,a.transform.zoom),X=[256/a.width*2+1,256/a.height*2+1],re=h?p.text.dynamicLayoutVertexArray:p.icon.dynamicLayoutVertexArray;re.clear();const ue=p.lineVertexArray,ie=h?p.text.placedSymbolArray:p.icon.placedSymbolArray,ce=a.transform.width/a.transform.height;let ye=!1;for(let ge=0;ge<ie.length;ge++){const Me=ie.get(ge);if(Me.hidden||Me.writingMode===f.WritingMode.vertical&&!ye){Yn(Me.numGlyphs,re);continue}ye=!1;const xe=[Me.anchorX,Me.anchorY,0,1];if(f.transformMat4(xe,xe,r),!hn(xe,X)){Yn(Me.numGlyphs,re);continue}const $e=Qe(a.transform.cameraToCenterDistance,xe[3]),Oe=f.evaluateSizeForFeature(z,q,Me),Ne=D?Oe/$e:Oe*$e,Je=new f.pointGeometry(Me.anchorX,Me.anchorY),at=mt(Je,g).point,je={},At=nn(Me,Ne,!1,M,r,g,v,p.glyphOffsetArray,ue,re,at,Je,je,ce,S);ye=At.useVertical,(At.notEnoughRoom||ye||At.needsFlipping&&nn(Me,Ne,!0,M,r,g,v,p.glyphOffsetArray,ue,re,at,Je,je,ce,S).notEnoughRoom)&&Yn(Me.numGlyphs,re)}h?p.text.dynamicLayoutVertexBuffer.updateData(re):p.icon.dynamicLayoutVertexBuffer.updateData(re)}function Or(p,r,a,h,g,v,D,M,S,z,q,X){const re=M.glyphStartIndex+M.numGlyphs,ue=M.lineStartIndex,ie=M.lineStartIndex+M.lineLength,ce=r.getoffsetX(M.glyphStartIndex),ye=r.getoffsetX(re-1),ge=ki(p*ce,a,h,g,v,D,M.segment,ue,ie,S,z,q,X);if(!ge)return null;const Me=ki(p*ye,a,h,g,v,D,M.segment,ue,ie,S,z,q,X);return Me?{first:ge,last:Me}:null}function Tn(p,r,a,h){return p===f.WritingMode.horizontal&&Math.abs(a.y-r.y)>Math.abs(a.x-r.x)*h?{useVertical:!0}:(p===f.WritingMode.vertical?r.y<a.y:r.x>a.x)?{needsFlipping:!0}:null}function nn(p,r,a,h,g,v,D,M,S,z,q,X,re,ue,ie){const ce=r/24,ye=p.lineOffsetX*ce,ge=p.lineOffsetY*ce;let Me;if(p.numGlyphs>1){const xe=p.glyphStartIndex+p.numGlyphs,$e=p.lineStartIndex,Oe=p.lineStartIndex+p.lineLength,Ne=Or(ce,M,ye,ge,a,q,X,p,S,v,re,ie);if(!Ne)return{notEnoughRoom:!0};const Je=mt(Ne.first.point,D).point,at=mt(Ne.last.point,D).point;if(h&&!a){const je=Tn(p.writingMode,Je,at,ue);if(je)return je}Me=[Ne.first];for(let je=p.glyphStartIndex+1;je<xe-1;je++)Me.push(ki(ce*M.getoffsetX(je),ye,ge,a,q,X,p.segment,$e,Oe,S,v,re,ie));Me.push(Ne.last)}else{if(h&&!a){const $e=mt(X,g).point,Oe=p.lineStartIndex+p.segment+1,Ne=new f.pointGeometry(S.getx(Oe),S.gety(Oe)),Je=mt(Ne,g),at=Je.signedDistanceFromCamera>0?Je.point:gr(X,Ne,$e,1,g),je=Tn(p.writingMode,$e,at,ue);if(je)return je}const xe=ki(ce*M.getoffsetX(p.glyphStartIndex),ye,ge,a,q,X,p.segment,p.lineStartIndex,p.lineStartIndex+p.lineLength,S,v,re,ie);if(!xe)return{notEnoughRoom:!0};Me=[xe]}for(const xe of Me)f.addDynamicAttributes(z,xe.point,xe.angle);return{}}function gr(p,r,a,h,g){const v=mt(p.add(p.sub(r)._unit()),g).point,D=a.sub(v);return a.add(D._mult(h/D.mag()))}function ki(p,r,a,h,g,v,D,M,S,z,q,X,re){const ue=h?p-r:p+r;let ie=ue>0?1:-1,ce=0;h&&(ie*=-1,ce=Math.PI),ie<0&&(ce+=Math.PI);let ye=ie>0?M+D:M+D+1,ge=g,Me=g,xe=0,$e=0;const Oe=Math.abs(ue),Ne=[];for(;xe+$e<=Oe;){if(ye+=ie,ye<M||ye>=S)return null;if(Me=ge,Ne.push(ge),ge=X[ye],void 0===ge){const vt=new f.pointGeometry(z.getx(ye),z.gety(ye)),an=mt(vt,q);if(an.signedDistanceFromCamera>0)ge=X[ye]=an.point;else{const Mn=ye-ie;ge=gr(0===xe?v:new f.pointGeometry(z.getx(Mn),z.gety(Mn)),vt,Me,Oe-xe+1,q)}}xe+=$e,$e=Me.dist(ge)}const Je=(Oe-xe)/$e,at=ge.sub(Me),je=at.mult(Je)._add(Me);je._add(at._unit()._perp()._mult(a*ie));const At=ce+Math.atan2(ge.y-Me.y,ge.x-Me.x);return Ne.push(je),{point:je,angle:re?At:0,path:Ne}}const gi=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Yn(p,r){for(let a=0;a<p;a++){const h=r.length;r.resize(h+4),r.float32.set(gi,3*h)}}function rn(p,r,a){const h=r[0],g=r[1];return p[0]=a[0]*h+a[4]*g+a[12],p[1]=a[1]*h+a[5]*g+a[13],p[3]=a[3]*h+a[7]*g+a[15],p}const ei=100;class yi{constructor(r,a=new Dr(r.width+200,r.height+200,25),h=new Dr(r.width+200,r.height+200,25)){this.transform=r,this.grid=a,this.ignoredGrid=h,this.pitchfactor=Math.cos(r._pitch)*r.cameraToCenterDistance,this.screenRightBoundary=r.width+ei,this.screenBottomBoundary=r.height+ei,this.gridRightBoundary=r.width+200,this.gridBottomBoundary=r.height+200}placeCollisionBox(r,a,h,g,v){const D=this.projectAndGetPerspectiveRatio(g,r.anchorPointX,r.anchorPointY),M=h*D.perspectiveRatio,S=r.x1*M+D.point.x,z=r.y1*M+D.point.y,q=r.x2*M+D.point.x,X=r.y2*M+D.point.y;return!this.isInsideGrid(S,z,q,X)||"always"!==a&&this.grid.hitTest(S,z,q,X,a,v)?{box:[],offscreen:!1}:{box:[S,z,q,X],offscreen:this.isOffscreen(S,z,q,X)}}placeCollisionCircles(r,a,h,g,v,D,M,S,z,q,X,re,ue){const ie=[],ce=new f.pointGeometry(a.anchorX,a.anchorY),ye=mt(ce,D),ge=Qe(this.transform.cameraToCenterDistance,ye.signedDistanceFromCamera),Me=(q?v/ge:v*ge)/f.ONE_EM,xe=mt(ce,M).point,$e=Or(Me,g,a.lineOffsetX*Me,a.lineOffsetY*Me,!1,xe,ce,a,h,M,{},!1);let Oe=!1,Ne=!1,Je=!0;if($e){const at=.5*re*ge+ue,je=new f.pointGeometry(-100,-100),At=new f.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),vt=new ht,an=$e.first,Mn=$e.last;let In=[];for(let _n=an.path.length-1;_n>=1;_n--)In.push(an.path[_n]);for(let _n=1;_n<Mn.path.length;_n++)In.push(Mn.path[_n]);const Ln=2.5*at;if(S){const _n=In.map(Gn=>mt(Gn,S));In=_n.some(Gn=>Gn.signedDistanceFromCamera<=0)?[]:_n.map(Gn=>Gn.point)}let pn=[];if(In.length>0){const _n=In[0].clone(),Gn=In[0].clone();for(let cr=1;cr<In.length;cr++)_n.x=Math.min(_n.x,In[cr].x),_n.y=Math.min(_n.y,In[cr].y),Gn.x=Math.max(Gn.x,In[cr].x),Gn.y=Math.max(Gn.y,In[cr].y);pn=_n.x>=je.x&&Gn.x<=At.x&&_n.y>=je.y&&Gn.y<=At.y?[In]:Gn.x<je.x||_n.x>At.x||Gn.y<je.y||_n.y>At.y?[]:f.clipLine([In],je.x,je.y,At.x,At.y)}for(const _n of pn){vt.reset(_n,.25*at);let Gn=0;Gn=vt.length<=.5*at?1:Math.ceil(vt.paddedLength/Ln)+1;for(let cr=0;cr<Gn;cr++){const Di=cr/Math.max(Gn-1,1),oo=vt.lerp(Di),vo=oo.x+ei,xo=oo.y+ei;ie.push(vo,xo,at,0);const so=vo-at,Qi=xo-at,Zo=vo+at,vr=xo+at;if(Je=Je&&this.isOffscreen(so,Qi,Zo,vr),Ne=Ne||this.isInsideGrid(so,Qi,Zo,vr),"always"!==r&&this.grid.hitTestCircle(vo,xo,at,r,X)&&(Oe=!0,!z))return{circles:[],offscreen:!1,collisionDetected:Oe}}}}return{circles:!z&&Oe||!Ne?[]:ie,offscreen:Je,collisionDetected:Oe}}queryRenderedSymbols(r){if(0===r.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const a=[];let h=1/0,g=1/0,v=-1/0,D=-1/0;for(const q of r){const X=new f.pointGeometry(q.x+ei,q.y+ei);h=Math.min(h,X.x),g=Math.min(g,X.y),v=Math.max(v,X.x),D=Math.max(D,X.y),a.push(X)}const M=this.grid.query(h,g,v,D).concat(this.ignoredGrid.query(h,g,v,D)),S={},z={};for(const q of M){const X=q.key;if(void 0===S[X.bucketInstanceId]&&(S[X.bucketInstanceId]={}),S[X.bucketInstanceId][X.featureIndex])continue;const re=[new f.pointGeometry(q.x1,q.y1),new f.pointGeometry(q.x2,q.y1),new f.pointGeometry(q.x2,q.y2),new f.pointGeometry(q.x1,q.y2)];f.polygonIntersectsPolygon(a,re)&&(S[X.bucketInstanceId][X.featureIndex]=!0,void 0===z[X.bucketInstanceId]&&(z[X.bucketInstanceId]=[]),z[X.bucketInstanceId].push(X.featureIndex))}return z}insertCollisionBox(r,a,h,g,v,D){(h?this.ignoredGrid:this.grid).insert({bucketInstanceId:g,featureIndex:v,collisionGroupID:D,overlapMode:a},r[0],r[1],r[2],r[3])}insertCollisionCircles(r,a,h,g,v,D){const M=h?this.ignoredGrid:this.grid,S={bucketInstanceId:g,featureIndex:v,collisionGroupID:D,overlapMode:a};for(let z=0;z<r.length;z+=4)M.insertCircle(S,r[z],r[z+1],r[z+2])}projectAndGetPerspectiveRatio(r,a,h){const g=[a,h,0,1];return rn(g,g,r),{point:new f.pointGeometry((g[0]/g[3]+1)/2*this.transform.width+ei,(-g[1]/g[3]+1)/2*this.transform.height+ei),perspectiveRatio:.5+this.transform.cameraToCenterDistance/g[3]*.5}}isOffscreen(r,a,h,g){return h<ei||r>=this.screenRightBoundary||g<ei||a>this.screenBottomBoundary}isInsideGrid(r,a,h,g){return h>=0&&r<this.gridRightBoundary&&g>=0&&a<this.gridBottomBoundary}getViewportMatrix(){const r=f.identity([]);return f.translate(r,r,[-100,-100,0]),r}}function Jn(p,r,a){return r*(f.EXTENT/(p.tileSize*Math.pow(2,a-p.tileID.overscaledZ)))}class vn{constructor(r,a,h,g){this.opacity=r?Math.max(0,Math.min(1,r.opacity+(r.placed?a:-a))):g&&h?1:0,this.placed=h}isHidden(){return 0===this.opacity&&!this.placed}}class jr{constructor(r,a,h,g,v){this.text=new vn(r?r.text:null,a,h,v),this.icon=new vn(r?r.icon:null,a,g,v)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Li{constructor(r,a,h){this.text=r,this.icon=a,this.skipFade=h}}class ui{constructor(){this.invProjMatrix=f.create(),this.viewportMatrix=f.create(),this.circles=[]}}class Ei{constructor(r,a,h,g,v){this.bucketInstanceId=r,this.featureIndex=a,this.sourceLayerIndex=h,this.bucketIndex=g,this.tileID=v}}class ne{constructor(r){this.crossSourceCollisions=r,this.maxGroupID=0,this.collisionGroups={}}get(r){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[r]){const a=++this.maxGroupID;this.collisionGroups[r]={ID:a,predicate:h=>h.collisionGroupID===a}}return this.collisionGroups[r]}}function k(p,r,a,h,g){const{horizontalAlign:v,verticalAlign:D}=f.getAnchorAlignment(p),M=-(v-.5)*r,S=-(D-.5)*a,z=f.evaluateVariableOffset(p,h);return new f.pointGeometry(M+z[0]*g,S+z[1]*g)}function B(p,r,a,h,g,v){const{x1:D,x2:M,y1:S,y2:z,anchorPointX:q,anchorPointY:X}=p,re=new f.pointGeometry(r,a);return h&&re._rotate(g?v:-v),{x1:D+re.x,y1:S+re.y,x2:M+re.x,y2:z+re.y,anchorPointX:q,anchorPointY:X}}class Q{constructor(r,a,h,g){this.transform=r.clone(),this.collisionIndex=new yi(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=a,this.retainedQueryData={},this.collisionGroups=new ne(h),this.collisionCircleArrays={},this.prevPlacement=g,g&&(g.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(r,a,h,g){const v=h.getBucket(a),D=h.latestFeatureIndex;if(!v||!D||a.id!==v.layerIds[0])return;const M=h.collisionBoxArray,S=v.layers[0].layout,z=Math.pow(2,this.transform.zoom-h.tileID.overscaledZ),q=h.tileSize/f.EXTENT,X=this.transform.calculatePosMatrix(h.tileID.toUnwrapped()),re="map"===S.get("text-pitch-alignment"),ue="map"===S.get("text-rotation-alignment"),ie=Jn(h,1,this.transform.zoom),ce=lr(X,re,ue,this.transform,ie);let ye=null;if(re){const Me=Wn(X,re,ue,this.transform,ie);ye=f.multiply([],this.transform.labelPlaneMatrix,Me)}this.retainedQueryData[v.bucketInstanceId]=new Ei(v.bucketInstanceId,D,v.sourceLayerIndex,v.index,h.tileID);const ge={bucket:v,layout:S,posMatrix:X,textLabelPlaneMatrix:ce,labelToScreenMatrix:ye,scale:z,textPixelRatio:q,holdingForFade:h.holdingForFade(),collisionBoxArray:M,partiallyEvaluatedTextSize:f.evaluateSizeForZoom(v.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(v.sourceID)};if(g)for(const Me of v.sortKeyRanges){const{sortKey:xe,symbolInstanceStart:$e,symbolInstanceEnd:Oe}=Me;r.push({sortKey:xe,symbolInstanceStart:$e,symbolInstanceEnd:Oe,parameters:ge})}else r.push({symbolInstanceStart:0,symbolInstanceEnd:v.symbolInstances.length,parameters:ge})}attemptAnchorPlacement(r,a,h,g,v,D,M,S,z,q,X,re,ue,ie,ce){const ye=[re.textOffset0,re.textOffset1],ge=k(r,h,g,ye,v),Me=this.collisionIndex.placeCollisionBox(B(a,ge.x,ge.y,D,M,this.transform.angle),X,S,z,q.predicate);if((!ce||0!==this.collisionIndex.placeCollisionBox(B(ce,ge.x,ge.y,D,M,this.transform.angle),X,S,z,q.predicate).box.length)&&Me.box.length>0){let xe;return this.prevPlacement&&this.prevPlacement.variableOffsets[re.crossTileID]&&this.prevPlacement.placements[re.crossTileID]&&this.prevPlacement.placements[re.crossTileID].text&&(xe=this.prevPlacement.variableOffsets[re.crossTileID].anchor),this.variableOffsets[re.crossTileID]={textOffset:ye,width:h,height:g,anchor:r,textBoxScale:v,prevAnchor:xe},this.markUsedJustification(ue,r,re,ie),ue.allowVerticalPlacement&&(this.markUsedOrientation(ue,ie,re),this.placedOrientations[re.crossTileID]=ie),{shift:ge,placedGlyphBoxes:Me}}}placeLayerBucketPart(r,a,h){const{bucket:g,layout:v,posMatrix:D,textLabelPlaneMatrix:M,labelToScreenMatrix:S,textPixelRatio:z,holdingForFade:q,collisionBoxArray:X,partiallyEvaluatedTextSize:re,collisionGroup:ue}=r.parameters,ie=v.get("text-optional"),ce=v.get("icon-optional"),ye=f.getOverlapMode(v,"text-overlap","text-allow-overlap"),ge="always"===ye,Me=f.getOverlapMode(v,"icon-overlap","icon-allow-overlap"),xe="always"===Me,$e="map"===v.get("text-rotation-alignment"),Oe="map"===v.get("text-pitch-alignment"),Ne="none"!==v.get("icon-text-fit"),Je="viewport-y"===v.get("symbol-z-order"),at=ge&&(xe||!g.hasIconData()||ce),je=xe&&(ge||!g.hasTextData()||ie);!g.collisionArrays&&X&&g.deserializeCollisionBoxes(X);const At=(vt,an)=>{if(a[vt.crossTileID])return;if(q)return void(this.placements[vt.crossTileID]=new Li(!1,!1,!1));let Mn=!1,In=!1,Ln=!0,pn=null,_n={box:null,offscreen:null},Gn={box:null,offscreen:null},cr=null,Di=null,oo=null,vo=0,xo=0,so=0;an.textFeatureIndex?vo=an.textFeatureIndex:vt.useRuntimeCollisionCircles&&(vo=vt.featureIndex),an.verticalTextFeatureIndex&&(xo=an.verticalTextFeatureIndex);const Qi=an.textBox;if(Qi){const Ai=er=>{let Gr=f.WritingMode.horizontal;if(g.allowVerticalPlacement&&!er&&this.prevPlacement){const dr=this.prevPlacement.placedOrientations[vt.crossTileID];dr&&(this.placedOrientations[vt.crossTileID]=dr,Gr=dr,this.markUsedOrientation(g,Gr,vt))}return Gr},Rn=(er,Gr)=>{if(g.allowVerticalPlacement&&vt.numVerticalGlyphVertices>0&&an.verticalTextBox){for(const dr of g.writingModes)if(dr===f.WritingMode.vertical?(_n=Gr(),Gn=_n):_n=er(),_n&&_n.box&&_n.box.length)break}else _n=er()};if(v.get("text-variable-anchor")){let er=v.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[vt.crossTileID]){const Hn=this.prevPlacement.variableOffsets[vt.crossTileID];er.indexOf(Hn.anchor)>0&&(er=er.filter(hs=>hs!==Hn.anchor),er.unshift(Hn.anchor))}const Gr=(Hn,hs,eo)=>{const ds=Hn.x2-Hn.x1,ol=Hn.y2-Hn.y1,sl=vt.textBoxScale,bu=Ne&&"never"===Me?hs:null;let ma={box:[],offscreen:!1};const kl="never"!==ye?2*er.length:er.length;for(let bo=0;bo<kl;++bo){const ri=this.attemptAnchorPlacement(er[bo%er.length],Hn,ds,ol,sl,$e,Oe,z,D,ue,bo>=er.length?ye:"never",vt,g,eo,bu);if(ri&&(ma=ri.placedGlyphBoxes,ma&&ma.box&&ma.box.length)){Mn=!0,pn=ri.shift;break}}return ma};Rn(()=>Gr(Qi,an.iconBox,f.WritingMode.horizontal),()=>{const Hn=an.verticalTextBox;return g.allowVerticalPlacement&&!(_n&&_n.box&&_n.box.length)&&vt.numVerticalGlyphVertices>0&&Hn?Gr(Hn,an.verticalIconBox,f.WritingMode.vertical):{box:null,offscreen:null}}),_n&&(Mn=_n.box,Ln=_n.offscreen);const dr=Ai(_n&&_n.box);if(!Mn&&this.prevPlacement){const Hn=this.prevPlacement.variableOffsets[vt.crossTileID];Hn&&(this.variableOffsets[vt.crossTileID]=Hn,this.markUsedJustification(g,Hn.anchor,vt,dr))}}else{const er=(Gr,dr)=>{const Hn=this.collisionIndex.placeCollisionBox(Gr,ye,z,D,ue.predicate);return Hn&&Hn.box&&Hn.box.length&&(this.markUsedOrientation(g,dr,vt),this.placedOrientations[vt.crossTileID]=dr),Hn};Rn(()=>er(Qi,f.WritingMode.horizontal),()=>{const Gr=an.verticalTextBox;return g.allowVerticalPlacement&&vt.numVerticalGlyphVertices>0&&Gr?er(Gr,f.WritingMode.vertical):{box:null,offscreen:null}}),Ai(_n&&_n.box&&_n.box.length)}}if(cr=_n,Mn=cr&&cr.box&&cr.box.length>0,Ln=cr&&cr.offscreen,vt.useRuntimeCollisionCircles){const Ai=g.text.placedSymbolArray.get(vt.centerJustifiedTextSymbolIndex),Rn=f.evaluateSizeForFeature(g.textSizeData,re,Ai),er=v.get("text-padding");Di=this.collisionIndex.placeCollisionCircles(ye,Ai,g.lineVertexArray,g.glyphOffsetArray,Rn,D,M,S,h,Oe,ue.predicate,vt.collisionCircleDiameter,er),Mn=ge||Di.circles.length>0&&!Di.collisionDetected,Ln=Ln&&Di.offscreen}if(an.iconFeatureIndex&&(so=an.iconFeatureIndex),an.iconBox){const Ai=Rn=>{const er=Ne&&pn?B(Rn,pn.x,pn.y,$e,Oe,this.transform.angle):Rn;return this.collisionIndex.placeCollisionBox(er,Me,z,D,ue.predicate)};Gn&&Gn.box&&Gn.box.length&&an.verticalIconBox?(oo=Ai(an.verticalIconBox),In=oo.box.length>0):(oo=Ai(an.iconBox),In=oo.box.length>0),Ln=Ln&&oo.offscreen}const Zo=ie||0===vt.numHorizontalGlyphVertices&&0===vt.numVerticalGlyphVertices,vr=ce||0===vt.numIconVertices;if(Zo||vr?vr?Zo||(In=In&&Mn):Mn=In&&Mn:In=Mn=In&&Mn,Mn&&cr&&cr.box&&this.collisionIndex.insertCollisionBox(cr.box,ye,v.get("text-ignore-placement"),g.bucketInstanceId,Gn&&Gn.box&&xo?xo:vo,ue.ID),In&&oo&&this.collisionIndex.insertCollisionBox(oo.box,Me,v.get("icon-ignore-placement"),g.bucketInstanceId,so,ue.ID),Di&&(Mn&&this.collisionIndex.insertCollisionCircles(Di.circles,ye,v.get("text-ignore-placement"),g.bucketInstanceId,vo,ue.ID),h)){const Ai=g.bucketInstanceId;let Rn=this.collisionCircleArrays[Ai];void 0===Rn&&(Rn=this.collisionCircleArrays[Ai]=new ui);for(let er=0;er<Di.circles.length;er+=4)Rn.circles.push(Di.circles[er+0]),Rn.circles.push(Di.circles[er+1]),Rn.circles.push(Di.circles[er+2]),Rn.circles.push(Di.collisionDetected?1:0)}this.placements[vt.crossTileID]=new Li(Mn||at,In||je,Ln||g.justReloaded),a[vt.crossTileID]=!0};if(Je){const vt=g.getSortedSymbolIndexes(this.transform.angle);for(let an=vt.length-1;an>=0;--an){const Mn=vt[an];At(g.symbolInstances.get(Mn),g.collisionArrays[Mn])}}else for(let vt=r.symbolInstanceStart;vt<r.symbolInstanceEnd;vt++)At(g.symbolInstances.get(vt),g.collisionArrays[vt]);if(h&&g.bucketInstanceId in this.collisionCircleArrays){const vt=this.collisionCircleArrays[g.bucketInstanceId];f.invert(vt.invProjMatrix,D),vt.viewportMatrix=this.collisionIndex.getViewportMatrix()}g.justReloaded=!1}markUsedJustification(r,a,h,g){let v;v=g===f.WritingMode.vertical?h.verticalPlacedTextSymbolIndex:{left:h.leftJustifiedTextSymbolIndex,center:h.centerJustifiedTextSymbolIndex,right:h.rightJustifiedTextSymbolIndex}[f.getAnchorJustification(a)];const D=[h.leftJustifiedTextSymbolIndex,h.centerJustifiedTextSymbolIndex,h.rightJustifiedTextSymbolIndex,h.verticalPlacedTextSymbolIndex];for(const M of D)M>=0&&(r.text.placedSymbolArray.get(M).crossTileID=v>=0&&M!==v?0:h.crossTileID)}markUsedOrientation(r,a,h){const g=a===f.WritingMode.horizontal||a===f.WritingMode.horizontalOnly?a:0,v=a===f.WritingMode.vertical?a:0,D=[h.leftJustifiedTextSymbolIndex,h.centerJustifiedTextSymbolIndex,h.rightJustifiedTextSymbolIndex];for(const M of D)r.text.placedSymbolArray.get(M).placedOrientation=g;h.verticalPlacedTextSymbolIndex&&(r.text.placedSymbolArray.get(h.verticalPlacedTextSymbolIndex).placedOrientation=v)}commit(r){this.commitTime=r,this.zoomAtLastRecencyCheck=this.transform.zoom;const a=this.prevPlacement;let h=!1;this.prevZoomAdjustment=a?a.zoomAdjustment(this.transform.zoom):0;const g=a?a.symbolFadeChange(r):1,v=a?a.opacities:{},D=a?a.variableOffsets:{},M=a?a.placedOrientations:{};for(const S in this.placements){const z=this.placements[S],q=v[S];q?(this.opacities[S]=new jr(q,g,z.text,z.icon),h=h||z.text!==q.text.placed||z.icon!==q.icon.placed):(this.opacities[S]=new jr(null,g,z.text,z.icon,z.skipFade),h=h||z.text||z.icon)}for(const S in v){const z=v[S];if(!this.opacities[S]){const q=new jr(z,g,!1,!1);q.isHidden()||(this.opacities[S]=q,h=h||z.text.placed||z.icon.placed)}}for(const S in D)this.variableOffsets[S]||!this.opacities[S]||this.opacities[S].isHidden()||(this.variableOffsets[S]=D[S]);for(const S in M)this.placedOrientations[S]||!this.opacities[S]||this.opacities[S].isHidden()||(this.placedOrientations[S]=M[S]);h?this.lastPlacementChangeTime=r:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=a?a.lastPlacementChangeTime:r)}updateLayerOpacities(r,a){const h={};for(const g of a){const v=g.getBucket(r);v&&g.latestFeatureIndex&&r.id===v.layerIds[0]&&this.updateBucketOpacities(v,h,g.collisionBoxArray)}}updateBucketOpacities(r,a,h){r.hasTextData()&&r.text.opacityVertexArray.clear(),r.hasIconData()&&r.icon.opacityVertexArray.clear(),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexArray.clear(),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexArray.clear();const g=r.layers[0].layout,v=new jr(null,0,!1,!1,!0),D=g.get("text-allow-overlap"),M=g.get("icon-allow-overlap"),S=g.get("text-variable-anchor"),z="map"===g.get("text-rotation-alignment"),q="map"===g.get("text-pitch-alignment"),X="none"!==g.get("icon-text-fit"),re=new jr(null,0,D&&(M||!r.hasIconData()||g.get("icon-optional")),M&&(D||!r.hasTextData()||g.get("text-optional")),!0);!r.collisionArrays&&h&&(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData())&&r.deserializeCollisionBoxes(h);const ue=(ie,ce,ye)=>{for(let ge=0;ge<ce/4;ge++)ie.opacityVertexArray.emplaceBack(ye)};for(let ie=0;ie<r.symbolInstances.length;ie++){const ce=r.symbolInstances.get(ie),{numHorizontalGlyphVertices:ye,numVerticalGlyphVertices:ge,crossTileID:Me}=ce;let xe=this.opacities[Me];a[Me]?xe=v:xe||(xe=re,this.opacities[Me]=xe),a[Me]=!0;const $e=ce.numIconVertices>0,Oe=this.placedOrientations[ce.crossTileID],Ne=Oe===f.WritingMode.vertical,Je=Oe===f.WritingMode.horizontal||Oe===f.WritingMode.horizontalOnly;if(ye>0||ge>0){const at=Pe(xe.text);ue(r.text,ye,Ne?tt:at),ue(r.text,ge,Je?tt:at);const je=xe.text.isHidden();[ce.rightJustifiedTextSymbolIndex,ce.centerJustifiedTextSymbolIndex,ce.leftJustifiedTextSymbolIndex].forEach(an=>{an>=0&&(r.text.placedSymbolArray.get(an).hidden=je||Ne?1:0)}),ce.verticalPlacedTextSymbolIndex>=0&&(r.text.placedSymbolArray.get(ce.verticalPlacedTextSymbolIndex).hidden=je||Je?1:0);const At=this.variableOffsets[ce.crossTileID];At&&this.markUsedJustification(r,At.anchor,ce,Oe);const vt=this.placedOrientations[ce.crossTileID];vt&&(this.markUsedJustification(r,"left",ce,vt),this.markUsedOrientation(r,vt,ce))}if($e){const at=Pe(xe.icon),je=!(X&&ce.verticalPlacedIconSymbolIndex&&Ne);ce.placedIconSymbolIndex>=0&&(ue(r.icon,ce.numIconVertices,je?at:tt),r.icon.placedSymbolArray.get(ce.placedIconSymbolIndex).hidden=xe.icon.isHidden()),ce.verticalPlacedIconSymbolIndex>=0&&(ue(r.icon,ce.numVerticalIconVertices,je?tt:at),r.icon.placedSymbolArray.get(ce.verticalPlacedIconSymbolIndex).hidden=xe.icon.isHidden())}if(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData()){const at=r.collisionArrays[ie];if(at){let je=new f.pointGeometry(0,0);if(at.textBox||at.verticalTextBox){let vt=!0;if(S){const an=this.variableOffsets[Me];an?(je=k(an.anchor,an.width,an.height,an.textOffset,an.textBoxScale),z&&je._rotate(q?this.transform.angle:-this.transform.angle)):vt=!1}at.textBox&&H(r.textCollisionBox.collisionVertexArray,xe.text.placed,!vt||Ne,je.x,je.y),at.verticalTextBox&&H(r.textCollisionBox.collisionVertexArray,xe.text.placed,!vt||Je,je.x,je.y)}const At=Boolean(!Je&&at.verticalIconBox);at.iconBox&&H(r.iconCollisionBox.collisionVertexArray,xe.icon.placed,At,X?je.x:0,X?je.y:0),at.verticalIconBox&&H(r.iconCollisionBox.collisionVertexArray,xe.icon.placed,!At,X?je.x:0,X?je.y:0)}}}if(r.sortFeatures(this.transform.angle),this.retainedQueryData[r.bucketInstanceId]&&(this.retainedQueryData[r.bucketInstanceId].featureSortOrder=r.featureSortOrder),r.hasTextData()&&r.text.opacityVertexBuffer&&r.text.opacityVertexBuffer.updateData(r.text.opacityVertexArray),r.hasIconData()&&r.icon.opacityVertexBuffer&&r.icon.opacityVertexBuffer.updateData(r.icon.opacityVertexArray),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexBuffer&&r.iconCollisionBox.collisionVertexBuffer.updateData(r.iconCollisionBox.collisionVertexArray),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexBuffer&&r.textCollisionBox.collisionVertexBuffer.updateData(r.textCollisionBox.collisionVertexArray),r.bucketInstanceId in this.collisionCircleArrays){const ie=this.collisionCircleArrays[r.bucketInstanceId];r.placementInvProjMatrix=ie.invProjMatrix,r.placementViewportMatrix=ie.viewportMatrix,r.collisionCircleArray=ie.circles,delete this.collisionCircleArrays[r.bucketInstanceId]}}symbolFadeChange(r){return 0===this.fadeDuration?1:(r-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(r){return Math.max(0,(this.transform.zoom-r)/1.5)}hasTransitions(r){return this.stale||r-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(r,a){const h=this.zoomAtLastRecencyCheck===a?1-this.zoomAdjustment(a):1;return this.zoomAtLastRecencyCheck=a,this.commitTime+this.fadeDuration*h>r}setStale(){this.stale=!0}}function H(p,r,a,h,g){p.emplaceBack(r?1:0,a?1:0,h||0,g||0),p.emplaceBack(r?1:0,a?1:0,h||0,g||0),p.emplaceBack(r?1:0,a?1:0,h||0,g||0),p.emplaceBack(r?1:0,a?1:0,h||0,g||0)}const U=Math.pow(2,25),G=Math.pow(2,24),Y=Math.pow(2,17),te=Math.pow(2,16),le=Math.pow(2,9),Ce=Math.pow(2,8),Be=Math.pow(2,1);function Pe(p){if(0===p.opacity&&!p.placed)return 0;if(1===p.opacity&&p.placed)return 4294967295;const r=p.placed?1:0,a=Math.floor(127*p.opacity);return a*U+r*G+a*Y+r*te+a*le+r*Ce+a*Be+r}const tt=0;class st{constructor(r){this._sortAcrossTiles="viewport-y"!==r.layout.get("symbol-z-order")&&!r.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(r,a,h,g,v){const D=this._bucketParts;for(;this._currentTileIndex<r.length;)if(a.getBucketParts(D,g,r[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,v())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,D.sort((M,S)=>M.sortKey-S.sortKey));this._currentPartIndex<D.length;)if(a.placeLayerBucketPart(D[this._currentPartIndex],this._seenCrossTileIDs,h),this._currentPartIndex++,v())return!0;return!1}}class ct{constructor(r,a,h,g,v,D,M){this.placement=new Q(r,v,D,M),this._currentPlacementIndex=a.length-1,this._forceFullPlacement=h,this._showCollisionBoxes=g,this._done=!1}isDone(){return this._done}continuePlacement(r,a,h){const g=f.exported.now(),v=()=>{const D=f.exported.now()-g;return!this._forceFullPlacement&&D>2};for(;this._currentPlacementIndex>=0;){const D=a[r[this._currentPlacementIndex]],M=this.placement.collisionIndex.transform.zoom;if("symbol"===D.type&&(!D.minzoom||D.minzoom<=M)&&(!D.maxzoom||D.maxzoom>M)){if(this._inProgressLayer||(this._inProgressLayer=new st(D)),this._inProgressLayer.continuePlacement(h[D.source],this.placement,this._showCollisionBoxes,D,v))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(r){return this.placement.commit(r),this.placement}}const Mt=512/f.EXTENT/2;class sn{constructor(r,a,h){this.tileID=r,this.indexedSymbolInstances={},this.bucketInstanceId=h;for(let g=0;g<a.length;g++){const v=a.get(g),D=v.key;this.indexedSymbolInstances[D]||(this.indexedSymbolInstances[D]=[]),this.indexedSymbolInstances[D].push({crossTileID:v.crossTileID,coord:this.getScaledCoordinates(v,r)})}}getScaledCoordinates(r,a){const h=Mt/Math.pow(2,a.canonical.z-this.tileID.canonical.z);return{x:Math.floor((a.canonical.x*f.EXTENT+r.anchorX)*h),y:Math.floor((a.canonical.y*f.EXTENT+r.anchorY)*h)}}findMatches(r,a,h){const g=this.tileID.canonical.z<a.canonical.z?1:Math.pow(2,this.tileID.canonical.z-a.canonical.z);for(let v=0;v<r.length;v++){const D=r.get(v);if(D.crossTileID)continue;const M=this.indexedSymbolInstances[D.key];if(!M)continue;const S=this.getScaledCoordinates(D,a);for(const z of M)if(Math.abs(z.coord.x-S.x)<=g&&Math.abs(z.coord.y-S.y)<=g&&!h[z.crossTileID]){h[z.crossTileID]=!0,D.crossTileID=z.crossTileID;break}}}}class We{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class dt{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(r){const a=Math.round((r-this.lng)/360);if(0!==a)for(const h in this.indexes){const g=this.indexes[h],v={};for(const D in g){const M=g[D];M.tileID=M.tileID.unwrapTo(M.tileID.wrap+a),v[M.tileID.key]=M}this.indexes[h]=v}this.lng=r}addBucket(r,a,h){if(this.indexes[r.overscaledZ]&&this.indexes[r.overscaledZ][r.key]){if(this.indexes[r.overscaledZ][r.key].bucketInstanceId===a.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(r.overscaledZ,this.indexes[r.overscaledZ][r.key])}for(let v=0;v<a.symbolInstances.length;v++)a.symbolInstances.get(v).crossTileID=0;this.usedCrossTileIDs[r.overscaledZ]||(this.usedCrossTileIDs[r.overscaledZ]={});const g=this.usedCrossTileIDs[r.overscaledZ];for(const v in this.indexes){const D=this.indexes[v];if(Number(v)>r.overscaledZ)for(const M in D){const S=D[M];S.tileID.isChildOf(r)&&S.findMatches(a.symbolInstances,r,g)}else{const M=D[r.scaledTo(Number(v)).key];M&&M.findMatches(a.symbolInstances,r,g)}}for(let v=0;v<a.symbolInstances.length;v++){const D=a.symbolInstances.get(v);D.crossTileID||(D.crossTileID=h.generate(),g[D.crossTileID]=!0)}return void 0===this.indexes[r.overscaledZ]&&(this.indexes[r.overscaledZ]={}),this.indexes[r.overscaledZ][r.key]=new sn(r,a.symbolInstances,a.bucketInstanceId),!0}removeBucketCrossTileIDs(r,a){for(const h in a.indexedSymbolInstances)for(const g of a.indexedSymbolInstances[h])delete this.usedCrossTileIDs[r][g.crossTileID]}removeStaleBuckets(r){let a=!1;for(const h in this.indexes){const g=this.indexes[h];for(const v in g)r[g[v].bucketInstanceId]||(this.removeBucketCrossTileIDs(h,g[v]),delete g[v],a=!0)}return a}}class St{constructor(){this.layerIndexes={},this.crossTileIDs=new We,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(r,a,h){let g=this.layerIndexes[r.id];void 0===g&&(g=this.layerIndexes[r.id]=new dt);let v=!1;const D={};g.handleWrapJump(h);for(const M of a){const S=M.getBucket(r);S&&r.id===S.layerIds[0]&&(S.bucketInstanceId||(S.bucketInstanceId=++this.maxBucketInstanceId),g.addBucket(M.tileID,S,this.crossTileIDs)&&(v=!0),D[S.bucketInstanceId]=!0)}return g.removeStaleBuckets(D)&&(v=!0),v}pruneUnusedLayers(r){const a={};r.forEach(h=>{a[h]=!0});for(const h in this.layerIndexes)a[h]||delete this.layerIndexes[h]}}const Ut=(p,r)=>f.emitValidationErrors(p,r&&r.filter(a=>"source.canvas"!==a.identifier)),Qn=f.pick(mn,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),En=f.pick(mn,["setCenter","setZoom","setBearing","setPitch"]),rr=function(){const p={},r=f.spec.$version;for(const a in f.spec.$root){const h=f.spec.$root[a];if(h.required){let g=null;g="version"===a?r:"array"===h.type?[]:{},null!=g&&(p[a]=g)}}return p}();class bn extends f.Evented{constructor(r,a={}){super(),this.map=r,this.dispatcher=new en(fn(),this),this.imageManager=new wn,this.imageManager.setEventedParent(this),this.glyphManager=new Ge(r._requestManager,a.localIdeographFontFamily),this.lineAtlas=new tn(256,512),this.crossTileSymbolIndex=new St,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new f.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",f.getReferrer());const h=this;this._rtlTextPluginCallback=bn.registerForPluginStateChange(g=>{h.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:g.pluginStatus,pluginURL:g.pluginURL},(v,D)=>{if(f.triggerPluginCompletionEvent(v),D&&D.every(M=>M))for(const M in h.sourceCaches)h.sourceCaches[M].reload()})}),this.on("data",g=>{if("source"!==g.dataType||"metadata"!==g.sourceDataType)return;const v=this.sourceCaches[g.sourceId];if(!v)return;const D=v.getSource();if(D&&D.vectorLayerIds)for(const M in this._layers){const S=this._layers[M];S.source===D.id&&this._validateLayer(S)}})}loadURL(r,a={}){this.fire(new f.Event("dataloading",{dataType:"style"}));const h="boolean"!=typeof a.validate||a.validate,g=this.map._requestManager.transformRequest(r,f.ResourceType.Style);this._request=f.getJSON(g,(v,D)=>{this._request=null,v?this.fire(new f.ErrorEvent(v)):D&&this._load(D,h)})}loadJSON(r,a={}){this.fire(new f.Event("dataloading",{dataType:"style"})),this._request=f.exported.frame(()=>{this._request=null,this._load(r,!1!==a.validate)})}loadEmpty(){this.fire(new f.Event("dataloading",{dataType:"style"})),this._load(rr,!1)}_load(r,a){if(a&&Ut(this,f.validateStyle(r)))return;this._loaded=!0,this.stylesheet=r;for(const g in r.sources)this.addSource(g,r.sources[g],{validate:!1});r.sprite?this._loadSprite(r.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(r.glyphs);const h=wr(this.stylesheet.layers);this._order=h.map(g=>g.id),this._layers={},this._serializedLayers={};for(let g of h)g=f.createStyleLayer(g),g.setEventedParent(this,{layer:{id:g.id}}),this._layers[g.id]=g,this._serializedLayers[g.id]=g.serialize();this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new jt(this.stylesheet.light),this.fire(new f.Event("data",{dataType:"style"})),this.fire(new f.Event("style.load"))}_loadSprite(r){this._spriteRequest=function(a,h,g,v){let D,M,S;const z=g>1?"@2x":"";let q=f.getJSON(h.transformRequest(h.normalizeSpriteURL(a,z,".json"),f.ResourceType.SpriteJSON),(ue,ie)=>{q=null,S||(S=ue,D=ie,re())}),X=f.getImage(h.transformRequest(h.normalizeSpriteURL(a,z,".png"),f.ResourceType.SpriteImage),(ue,ie)=>{X=null,S||(S=ue,M=ie,re())});function re(){if(S)v(S);else if(D&&M){const ue=f.exported.getImageData(M),ie={};for(const ce in D){const{width:ye,height:ge,x:Me,y:xe,sdf:$e,pixelRatio:Oe,stretchX:Ne,stretchY:Je,content:at}=D[ce],je=new f.RGBAImage({width:ye,height:ge});f.RGBAImage.copy(ue,je,{x:Me,y:xe},{x:0,y:0},{width:ye,height:ge}),ie[ce]={data:je,pixelRatio:Oe,sdf:$e,stretchX:Ne,stretchY:Je,content:at}}v(null,ie)}}return{cancel(){q&&(q.cancel(),q=null),X&&(X.cancel(),X=null)}}}(r,this.map._requestManager,this.map.getPixelRatio(),(a,h)=>{if(this._spriteRequest=null,a)this.fire(new f.ErrorEvent(a));else if(h)for(const g in h)this.imageManager.addImage(g,h[g]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new f.Event("data",{dataType:"style"}))})}_validateLayer(r){const a=this.sourceCaches[r.source];if(!a)return;const h=r.sourceLayer;if(!h)return;const g=a.getSource();("geojson"===g.type||g.vectorLayerIds&&-1===g.vectorLayerIds.indexOf(h))&&this.fire(new f.ErrorEvent(new Error(`Source layer "${h}" does not exist on source "${g.id}" as specified by style layer "${r.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const r in this.sourceCaches)if(!this.sourceCaches[r].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(r){const a=[];for(const h of r){const g=this._layers[h];"custom"!==g.type&&a.push(g.serialize())}return a}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const r in this.sourceCaches)if(this.sourceCaches[r].hasTransition())return!0;for(const r in this._layers)if(this._layers[r].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(r){if(!this._loaded)return;const a=this._changed;if(this._changed){const g=Object.keys(this._updatedLayers),v=Object.keys(this._removedLayers);(g.length||v.length)&&this._updateWorkerLayers(g,v);for(const D in this._updatedSources){const M=this._updatedSources[D];"reload"===M?this._reloadSource(D):"clear"===M&&this._clearSource(D)}this._updateTilesForChangedImages();for(const D in this._updatedPaintProps)this._layers[D].updateTransitions(r);this.light.updateTransitions(r),this._resetUpdates()}const h={};for(const g in this.sourceCaches){const v=this.sourceCaches[g];h[g]=v.used,v.used=!1}for(const g of this._order){const v=this._layers[g];v.recalculate(r,this._availableImages),!v.isHidden(r.zoom)&&v.source&&(this.sourceCaches[v.source].used=!0)}for(const g in h){const v=this.sourceCaches[g];h[g]!==v.used&&v.fire(new f.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:g}))}this.light.recalculate(r),this.z=r.zoom,a&&this.fire(new f.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const r=Object.keys(this._changedImages);if(r.length){for(const a in this.sourceCaches)this.sourceCaches[a].reloadTilesForDependencies(["icons","patterns"],r);this._changedImages={}}}_updateWorkerLayers(r,a){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(r),removedIds:a})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(r){if(this._checkLoaded(),Ut(this,f.validateStyle(r)))return!1;(r=f.clone$1(r)).layers=wr(r.layers);const a=function(g,v){if(!g)return[{command:mn.setStyle,args:[v]}];let D=[];try{if(!It(g.version,v.version))return[{command:mn.setStyle,args:[v]}];It(g.center,v.center)||D.push({command:mn.setCenter,args:[v.center]}),It(g.zoom,v.zoom)||D.push({command:mn.setZoom,args:[v.zoom]}),It(g.bearing,v.bearing)||D.push({command:mn.setBearing,args:[v.bearing]}),It(g.pitch,v.pitch)||D.push({command:mn.setPitch,args:[v.pitch]}),It(g.sprite,v.sprite)||D.push({command:mn.setSprite,args:[v.sprite]}),It(g.glyphs,v.glyphs)||D.push({command:mn.setGlyphs,args:[v.glyphs]}),It(g.transition,v.transition)||D.push({command:mn.setTransition,args:[v.transition]}),It(g.light,v.light)||D.push({command:mn.setLight,args:[v.light]});const M={},S=[];!function(q,X,re,ue){let ie;for(ie in X=X||{},q=q||{})Object.prototype.hasOwnProperty.call(q,ie)&&(Object.prototype.hasOwnProperty.call(X,ie)||Ke(ie,re,ue));for(ie in X)Object.prototype.hasOwnProperty.call(X,ie)&&(Object.prototype.hasOwnProperty.call(q,ie)?It(q[ie],X[ie])||("geojson"===q[ie].type&&"geojson"===X[ie].type&&ae(q,X,ie)?re.push({command:mn.setGeoJSONSourceData,args:[ie,X[ie].data]}):T(ie,X,re,ue)):Xe(ie,X,re))}(g.sources,v.sources,S,M);const z=[];g.layers&&g.layers.forEach(q=>{M[q.source]?D.push({command:mn.removeLayer,args:[q.id]}):z.push(q)}),D=D.concat(S),function(q,X,re){X=X||[];const ue=(q=q||[]).map(Te),ie=X.map(Te),ce=q.reduce(Nt,{}),ye=X.reduce(Nt,{}),ge=ue.slice(),Me=Object.create(null);let xe,$e,Oe,Ne,Je,at,je;for(xe=0,$e=0;xe<ue.length;xe++)Oe=ue[xe],Object.prototype.hasOwnProperty.call(ye,Oe)?$e++:(re.push({command:mn.removeLayer,args:[Oe]}),ge.splice(ge.indexOf(Oe,$e),1));for(xe=0,$e=0;xe<ie.length;xe++)Oe=ie[ie.length-1-xe],ge[ge.length-1-xe]!==Oe&&(Object.prototype.hasOwnProperty.call(ce,Oe)?(re.push({command:mn.removeLayer,args:[Oe]}),ge.splice(ge.lastIndexOf(Oe,ge.length-$e),1)):$e++,at=ge[ge.length-xe],re.push({command:mn.addLayer,args:[ye[Oe],at]}),ge.splice(ge.length-xe,0,Oe),Me[Oe]=!0);for(xe=0;xe<ie.length;xe++)if(Oe=ie[xe],Ne=ce[Oe],Je=ye[Oe],!Me[Oe]&&!It(Ne,Je))if(It(Ne.source,Je.source)&&It(Ne["source-layer"],Je["source-layer"])&&It(Ne.type,Je.type)){for(je in pe(Ne.layout,Je.layout,re,Oe,null,mn.setLayoutProperty),pe(Ne.paint,Je.paint,re,Oe,null,mn.setPaintProperty),It(Ne.filter,Je.filter)||re.push({command:mn.setFilter,args:[Oe,Je.filter]}),It(Ne.minzoom,Je.minzoom)&&It(Ne.maxzoom,Je.maxzoom)||re.push({command:mn.setLayerZoomRange,args:[Oe,Je.minzoom,Je.maxzoom]}),Ne)Object.prototype.hasOwnProperty.call(Ne,je)&&"layout"!==je&&"paint"!==je&&"filter"!==je&&"metadata"!==je&&"minzoom"!==je&&"maxzoom"!==je&&(0===je.indexOf("paint.")?pe(Ne[je],Je[je],re,Oe,je.slice(6),mn.setPaintProperty):It(Ne[je],Je[je])||re.push({command:mn.setLayerProperty,args:[Oe,je,Je[je]]}));for(je in Je)Object.prototype.hasOwnProperty.call(Je,je)&&!Object.prototype.hasOwnProperty.call(Ne,je)&&"layout"!==je&&"paint"!==je&&"filter"!==je&&"metadata"!==je&&"minzoom"!==je&&"maxzoom"!==je&&(0===je.indexOf("paint.")?pe(Ne[je],Je[je],re,Oe,je.slice(6),mn.setPaintProperty):It(Ne[je],Je[je])||re.push({command:mn.setLayerProperty,args:[Oe,je,Je[je]]}))}else re.push({command:mn.removeLayer,args:[Oe]}),at=ge[ge.lastIndexOf(Oe)+1],re.push({command:mn.addLayer,args:[Je,at]})}(z,v.layers,D)}catch(M){console.warn("Unable to compute style diff:",M),D=[{command:mn.setStyle,args:[v]}]}return D}(this.serialize(),r).filter(g=>!(g.command in En));if(0===a.length)return!1;const h=a.filter(g=>!(g.command in Qn));if(h.length>0)throw new Error(`Unimplemented: ${h.map(g=>g.command).join(", ")}.`);return a.forEach(g=>{"setTransition"!==g.command&&this[g.command].apply(this,g.args)}),this.stylesheet=r,!0}addImage(r,a){if(this.getImage(r))return this.fire(new f.ErrorEvent(new Error(`An image named "${r}" already exists.`)));this.imageManager.addImage(r,a),this._afterImageUpdated(r)}updateImage(r,a){this.imageManager.updateImage(r,a)}getImage(r){return this.imageManager.getImage(r)}removeImage(r){if(!this.getImage(r))return this.fire(new f.ErrorEvent(new Error(`An image named "${r}" does not exist.`)));this.imageManager.removeImage(r),this._afterImageUpdated(r)}_afterImageUpdated(r){this._availableImages=this.imageManager.listImages(),this._changedImages[r]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new f.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(r,a,h={}){if(this._checkLoaded(),void 0!==this.sourceCaches[r])throw new Error(`Source "${r}" already exists.`);if(!a.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(a).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(a.type)>=0&&this._validate(f.validateStyle.source,`sources.${r}`,a,null,h))return;this.map&&this.map._collectResourceTiming&&(a.collectResourceTiming=!0);const g=this.sourceCaches[r]=new mr(r,a,this.dispatcher);g.style=this,g.setEventedParent(this,()=>({isSourceLoaded:this.loaded(),source:g.serialize(),sourceId:r})),g.onAdd(this.map),this._changed=!0}removeSource(r){if(this._checkLoaded(),void 0===this.sourceCaches[r])throw new Error("There is no source with this ID");for(const h in this._layers)if(this._layers[h].source===r)return this.fire(new f.ErrorEvent(new Error(`Source "${r}" cannot be removed while layer "${h}" is using it.`)));const a=this.sourceCaches[r];delete this.sourceCaches[r],delete this._updatedSources[r],a.fire(new f.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:r})),a.setEventedParent(null),a.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(r,a){this._checkLoaded(),this.sourceCaches[r].getSource().setData(a),this._changed=!0}getSource(r){return this.sourceCaches[r]&&this.sourceCaches[r].getSource()}addLayer(r,a,h={}){this._checkLoaded();const g=r.id;if(this.getLayer(g))return void this.fire(new f.ErrorEvent(new Error(`Layer "${g}" already exists on this map.`)));let v;if("custom"===r.type){if(Ut(this,f.validateCustomStyleLayer(r)))return;v=f.createStyleLayer(r)}else{if("object"==typeof r.source&&(this.addSource(g,r.source),r=f.clone$1(r),r=f.extend(r,{source:g})),this._validate(f.validateStyle.layer,`layers.${g}`,r,{arrayIndex:-1},h))return;v=f.createStyleLayer(r),this._validateLayer(v),v.setEventedParent(this,{layer:{id:g}}),this._serializedLayers[v.id]=v.serialize()}const D=a?this._order.indexOf(a):this._order.length;if(a&&-1===D)this.fire(new f.ErrorEvent(new Error(`Cannot add layer "${g}" before non-existing layer "${a}".`)));else{if(this._order.splice(D,0,g),this._layerOrderChanged=!0,this._layers[g]=v,this._removedLayers[g]&&v.source&&"custom"!==v.type){const M=this._removedLayers[g];delete this._removedLayers[g],M.type!==v.type?this._updatedSources[v.source]="clear":(this._updatedSources[v.source]="reload",this.sourceCaches[v.source].pause())}this._updateLayer(v),v.onAdd&&v.onAdd(this.map)}}moveLayer(r,a){if(this._checkLoaded(),this._changed=!0,!this._layers[r])return void this.fire(new f.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be moved.`)));if(r===a)return;const h=this._order.indexOf(r);this._order.splice(h,1);const g=a?this._order.indexOf(a):this._order.length;a&&-1===g?this.fire(new f.ErrorEvent(new Error(`Cannot move layer "${r}" before non-existing layer "${a}".`))):(this._order.splice(g,0,r),this._layerOrderChanged=!0)}removeLayer(r){this._checkLoaded();const a=this._layers[r];if(!a)return void this.fire(new f.ErrorEvent(new Error(`Cannot remove non-existing layer "${r}".`)));a.setEventedParent(null);const h=this._order.indexOf(r);this._order.splice(h,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[r]=a,delete this._layers[r],delete this._serializedLayers[r],delete this._updatedLayers[r],delete this._updatedPaintProps[r],a.onRemove&&a.onRemove(this.map)}getLayer(r){return this._layers[r]}hasLayer(r){return r in this._layers}setLayerZoomRange(r,a,h){this._checkLoaded();const g=this.getLayer(r);g?g.minzoom===a&&g.maxzoom===h||(null!=a&&(g.minzoom=a),null!=h&&(g.maxzoom=h),this._updateLayer(g)):this.fire(new f.ErrorEvent(new Error(`Cannot set the zoom range of non-existing layer "${r}".`)))}setFilter(r,a,h={}){this._checkLoaded();const g=this.getLayer(r);if(g){if(!It(g.filter,a))return null==a?(g.filter=void 0,void this._updateLayer(g)):void(this._validate(f.validateStyle.filter,`layers.${g.id}.filter`,a,null,h)||(g.filter=f.clone$1(a),this._updateLayer(g)))}else this.fire(new f.ErrorEvent(new Error(`Cannot filter non-existing layer "${r}".`)))}getFilter(r){return f.clone$1(this.getLayer(r).filter)}setLayoutProperty(r,a,h,g={}){this._checkLoaded();const v=this.getLayer(r);v?It(v.getLayoutProperty(a),h)||(v.setLayoutProperty(a,h,g),this._updateLayer(v)):this.fire(new f.ErrorEvent(new Error(`Cannot style non-existing layer "${r}".`)))}getLayoutProperty(r,a){const h=this.getLayer(r);if(h)return h.getLayoutProperty(a);this.fire(new f.ErrorEvent(new Error(`Cannot get style of non-existing layer "${r}".`)))}setPaintProperty(r,a,h,g={}){this._checkLoaded();const v=this.getLayer(r);v?It(v.getPaintProperty(a),h)||(v.setPaintProperty(a,h,g)&&this._updateLayer(v),this._changed=!0,this._updatedPaintProps[r]=!0):this.fire(new f.ErrorEvent(new Error(`Cannot style non-existing layer "${r}".`)))}getPaintProperty(r,a){return this.getLayer(r).getPaintProperty(a)}setFeatureState(r,a){this._checkLoaded();const h=r.source,g=r.sourceLayer,v=this.sourceCaches[h];if(void 0===v)return void this.fire(new f.ErrorEvent(new Error(`The source '${h}' does not exist in the map's style.`)));const D=v.getSource().type;"geojson"===D&&g?this.fire(new f.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):"vector"!==D||g?(void 0===r.id&&this.fire(new f.ErrorEvent(new Error("The feature id parameter must be provided."))),v.setFeatureState(g,r.id,a)):this.fire(new f.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(r,a){this._checkLoaded();const h=r.source,g=this.sourceCaches[h];if(void 0===g)return void this.fire(new f.ErrorEvent(new Error(`The source '${h}' does not exist in the map's style.`)));const v=g.getSource().type,D="vector"===v?r.sourceLayer:void 0;"vector"!==v||D?a&&"string"!=typeof r.id&&"number"!=typeof r.id?this.fire(new f.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):g.removeFeatureState(D,r.id,a):this.fire(new f.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(r){this._checkLoaded();const a=r.source,h=r.sourceLayer,g=this.sourceCaches[a];if(void 0!==g)return"vector"!==g.getSource().type||h?(void 0===r.id&&this.fire(new f.ErrorEvent(new Error("The feature id parameter must be provided."))),g.getFeatureState(h,r.id)):void this.fire(new f.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new f.ErrorEvent(new Error(`The source '${a}' does not exist in the map's style.`)))}getTransition(){return f.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){return f.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:f.mapObject(this.sourceCaches,r=>r.serialize()),layers:this._serializeLayers(this._order)},r=>void 0!==r)}_updateLayer(r){this._updatedLayers[r.id]=!0,r.source&&!this._updatedSources[r.source]&&"raster"!==this.sourceCaches[r.source].getSource().type&&(this._updatedSources[r.source]="reload",this.sourceCaches[r.source].pause()),this._changed=!0}_flattenAndSortRenderedFeatures(r){const a=D=>"fill-extrusion"===this._layers[D].type,h={},g=[];for(let D=this._order.length-1;D>=0;D--){const M=this._order[D];if(a(M)){h[M]=D;for(const S of r){const z=S[M];if(z)for(const q of z)g.push(q)}}}g.sort((D,M)=>M.intersectionZ-D.intersectionZ);const v=[];for(let D=this._order.length-1;D>=0;D--){const M=this._order[D];if(a(M))for(let S=g.length-1;S>=0;S--){const z=g[S].feature;if(h[z.layer.id]<D)break;v.push(z),g.pop()}else for(const S of r){const z=S[M];if(z)for(const q of z)v.push(q.feature)}}return v}queryRenderedFeatures(r,a,h){a&&a.filter&&this._validate(f.validateStyle.filter,"queryRenderedFeatures.filter",a.filter,null,a);const g={};if(a&&a.layers){if(!Array.isArray(a.layers))return this.fire(new f.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const D of a.layers){const M=this._layers[D];if(!M)return this.fire(new f.ErrorEvent(new Error(`The layer '${D}' does not exist in the map's style and cannot be queried for features.`))),[];g[M.source]=!0}}const v=[];a.availableImages=this._availableImages;for(const D in this.sourceCaches)a.layers&&!g[D]||v.push(hr(this.sourceCaches[D],this._layers,this._serializedLayers,r,a,h));return this.placement&&v.push(function(D,M,S,z,q,X,re){const ue={},ie=X.queryRenderedSymbols(z),ce=[];for(const ye of Object.keys(ie).map(Number))ce.push(re[ye]);ce.sort(Rr);for(const ye of ce){const ge=ye.featureIndex.lookupSymbolFeatures(ie[ye.bucketInstanceId],M,ye.bucketIndex,ye.sourceLayerIndex,q.filter,q.layers,q.availableImages,D);for(const Me in ge){const xe=ue[Me]=ue[Me]||[],$e=ge[Me];$e.sort((Oe,Ne)=>{const Je=ye.featureSortOrder;if(Je){const at=Je.indexOf(Oe.featureIndex);return Je.indexOf(Ne.featureIndex)-at}return Ne.featureIndex-Oe.featureIndex});for(const Oe of $e)xe.push(Oe)}}for(const ye in ue)ue[ye].forEach(ge=>{const Me=ge.feature,xe=S[D[ye].source].getFeatureState(Me.layer["source-layer"],Me.id);Me.source=Me.layer.source,Me.layer["source-layer"]&&(Me.sourceLayer=Me.layer["source-layer"]),Me.state=xe});return ue}(this._layers,this._serializedLayers,this.sourceCaches,r,a,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(v)}querySourceFeatures(r,a){a&&a.filter&&this._validate(f.validateStyle.filter,"querySourceFeatures.filter",a.filter,null,a);const h=this.sourceCaches[r];return h?function(g,v){const D=g.getRenderableIds().map(z=>g.getTileByID(z)),M=[],S={};for(let z=0;z<D.length;z++){const q=D[z],X=q.tileID.canonical.key;S[X]||(S[X]=!0,q.querySourceFeatures(M,v))}return M}(h,a):[]}addSourceType(r,a,h){return bn.getSourceType(r)?h(new Error(`A source type called "${r}" already exists.`)):(bn.setSourceType(r,a),a.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:r,url:a.workerSourceURL},h):h(null,null))}getLight(){return this.light.getLight()}setLight(r,a={}){this._checkLoaded();const h=this.light.getLight();let g=!1;for(const D in r)if(!It(r[D],h[D])){g=!0;break}if(!g)return;const v={now:f.exported.now(),transition:f.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(r,a),this.light.updateTransitions(v)}_validate(r,a,h,g,v={}){return(!v||!1!==v.validate)&&Ut(this,r.call(f.validateStyle,f.extend({key:a,style:this.serialize(),value:h,styleSpec:f.spec},g)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),f.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const r in this._layers)this._layers[r].setEventedParent(null);for(const r in this.sourceCaches){const a=this.sourceCaches[r];a.setEventedParent(null),a.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(r){this.sourceCaches[r].clearTiles()}_reloadSource(r){this.sourceCaches[r].resume(),this.sourceCaches[r].reload()}_updateSources(r){for(const a in this.sourceCaches)this.sourceCaches[a].update(r)}_generateCollisionBoxes(){for(const r in this.sourceCaches)this._reloadSource(r)}_updatePlacement(r,a,h,g,v=!1){let D=!1,M=!1;const S={};for(const z of this._order){const q=this._layers[z];if("symbol"!==q.type)continue;if(!S[q.source]){const re=this.sourceCaches[q.source];S[q.source]=re.getRenderableIds(!0).map(ue=>re.getTileByID(ue)).sort((ue,ie)=>ie.tileID.overscaledZ-ue.tileID.overscaledZ||(ue.tileID.isLessThan(ie.tileID)?-1:1))}const X=this.crossTileSymbolIndex.addLayer(q,S[q.source],r.center.lng);D=D||X}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((v=v||this._layerOrderChanged||0===h)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(f.exported.now(),r.zoom))&&(this.pauseablePlacement=new ct(r,this._order,v,a,h,g,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,S),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(f.exported.now()),M=!0),D&&this.pauseablePlacement.placement.setStale()),M||D)for(const z of this._order){const q=this._layers[z];"symbol"===q.type&&this.placement.updateLayerOpacities(q,S[q.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(f.exported.now())}_releaseSymbolFadeTiles(){for(const r in this.sourceCaches)this.sourceCaches[r].releaseSymbolFadeTiles()}getImages(r,a,h){this.imageManager.getImages(a.icons,h),this._updateTilesForChangedImages();const g=this.sourceCaches[a.source];g&&g.setDependencies(a.tileID.key,a.type,a.icons)}getGlyphs(r,a,h){this.glyphManager.getGlyphs(a.stacks,h)}getResource(r,a,h){return f.makeRequest(a,h)}}bn.getSourceType=function(p){return kn[p]},bn.setSourceType=function(p,r){kn[p]=r},bn.registerForPluginStateChange=f.registerForPluginStateChange;var io=f.createLayout([{name:"a_pos",type:"Int16",components:2}]),Zi={prelude:Ot("#ifdef GL_ES\nprecision mediump float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif","#ifdef GL_ES\nprecision highp float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}"),background:Ot("uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:Ot("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Ot("varying vec3 v_data;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}"),clippingMask:Ot("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Ot("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}"),heatmapTexture:Ot("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Ot("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Ot("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Ot("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,0,1);}"),fill:Ot("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_FragColor=color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);}"),fillOutline:Ot("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}"),fillOutlinePattern:Ot("uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}"),fillPattern:Ot("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}"),fillExtrusion:Ot("varying vec4 v_color;void main() {gl_FragColor=v_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}"),fillExtrusionPattern:Ot("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0\n? a_pos\n: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}"),hillshadePrepare:Ot("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Ot("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;\n#define PI 3.141592653589793\nvoid main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:Ot("uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}"),lineGradient:Ot("uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}"),linePattern:Ot("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\n#define LINE_DISTANCE_SCALE 2.0\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}"),lineSDF:Ot("uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\n#define LINE_DISTANCE_SCALE 2.0\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}"),raster:Ot("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:Ot("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}"),symbolSDF:Ot("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}"),symbolTextAndIcon:Ot("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}")};function Ot(p,r){const a=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,h=r.match(/attribute ([\w]+) ([\w]+)/g),g=p.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),v=r.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),D=v?v.concat(g):g,M={};return{fragmentSource:p=p.replace(a,(S,z,q,X,re)=>(M[re]=!0,"define"===z?`\n#ifndef HAS_UNIFORM_u_${re}\nvarying ${q} ${X} ${re};\n#else\nuniform ${q} ${X} u_${re};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${re}\n    ${q} ${X} ${re} = u_${re};\n#endif\n`)),vertexSource:r=r.replace(a,(S,z,q,X,re)=>{const ue="float"===X?"vec2":"vec4",ie=re.match(/color/)?"color":ue;return M[re]?"define"===z?`\n#ifndef HAS_UNIFORM_u_${re}\nuniform lowp float u_${re}_t;\nattribute ${q} ${ue} a_${re};\nvarying ${q} ${X} ${re};\n#else\nuniform ${q} ${X} u_${re};\n#endif\n`:"vec4"===ie?`\n#ifndef HAS_UNIFORM_u_${re}\n    ${re} = a_${re};\n#else\n    ${q} ${X} ${re} = u_${re};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${re}\n    ${re} = unpack_mix_${ie}(a_${re}, u_${re}_t);\n#else\n    ${q} ${X} ${re} = u_${re};\n#endif\n`:"define"===z?`\n#ifndef HAS_UNIFORM_u_${re}\nuniform lowp float u_${re}_t;\nattribute ${q} ${ue} a_${re};\n#else\nuniform ${q} ${X} u_${re};\n#endif\n`:"vec4"===ie?`\n#ifndef HAS_UNIFORM_u_${re}\n    ${q} ${X} ${re} = a_${re};\n#else\n    ${q} ${X} ${re} = u_${re};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${re}\n    ${q} ${X} ${re} = unpack_mix_${ie}(a_${re}, u_${re}_t);\n#else\n    ${q} ${X} ${re} = u_${re};\n#endif\n`}),staticAttributes:h,staticUniforms:D}}class Bo{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(r,a,h,g,v,D,M,S){this.context=r;let z=this.boundPaintVertexBuffers.length!==g.length;for(let q=0;!z&&q<g.length;q++)this.boundPaintVertexBuffers[q]!==g[q]&&(z=!0);r.extVertexArrayObject&&this.vao&&this.boundProgram===a&&this.boundLayoutVertexBuffer===h&&!z&&this.boundIndexBuffer===v&&this.boundVertexOffset===D&&this.boundDynamicVertexBuffer===M&&this.boundDynamicVertexBuffer2===S?(r.bindVertexArrayOES.set(this.vao),M&&M.bind(),v&&v.dynamicDraw&&v.bind(),S&&S.bind()):this.freshBind(a,h,g,v,D,M,S)}freshBind(r,a,h,g,v,D,M){let S;const z=r.numAttributes,q=this.context,X=q.gl;if(q.extVertexArrayObject)this.vao&&this.destroy(),this.vao=q.extVertexArrayObject.createVertexArrayOES(),q.bindVertexArrayOES.set(this.vao),S=0,this.boundProgram=r,this.boundLayoutVertexBuffer=a,this.boundPaintVertexBuffers=h,this.boundIndexBuffer=g,this.boundVertexOffset=v,this.boundDynamicVertexBuffer=D,this.boundDynamicVertexBuffer2=M;else{S=q.currentNumAttributes||0;for(let re=z;re<S;re++)X.disableVertexAttribArray(re)}a.enableAttributes(X,r);for(const re of h)re.enableAttributes(X,r);D&&D.enableAttributes(X,r),M&&M.enableAttributes(X,r),a.bind(),a.setVertexAttribPointers(X,r,v);for(const re of h)re.bind(),re.setVertexAttribPointers(X,r,v);D&&(D.bind(),D.setVertexAttribPointers(X,r,v)),g&&g.bind(),M&&(M.bind(),M.setVertexAttribPointers(X,r,v)),q.currentNumAttributes=z}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function Ri(p){const r=[];for(let a=0;a<p.length;a++){if(null===p[a])continue;const h=p[a].split(" ");r.push(h.pop())}return r}class Ma{constructor(r,a,h,g,v,D){const M=r.gl;this.program=M.createProgram();const S=Ri(h.staticAttributes),z=g?g.getBinderAttributes():[],q=S.concat(z),X=h.staticUniforms?Ri(h.staticUniforms):[],re=g?g.getBinderUniforms():[],ue=X.concat(re),ie=[];for(const Oe of ue)ie.indexOf(Oe)<0&&ie.push(Oe);const ce=g?g.defines():[];D&&ce.push("#define OVERDRAW_INSPECTOR;");const ye=ce.concat(Zi.prelude.fragmentSource,h.fragmentSource).join("\n"),ge=ce.concat(Zi.prelude.vertexSource,h.vertexSource).join("\n"),Me=M.createShader(M.FRAGMENT_SHADER);if(M.isContextLost())return void(this.failedToCreate=!0);M.shaderSource(Me,ye),M.compileShader(Me),M.attachShader(this.program,Me);const xe=M.createShader(M.VERTEX_SHADER);if(M.isContextLost())return void(this.failedToCreate=!0);M.shaderSource(xe,ge),M.compileShader(xe),M.attachShader(this.program,xe),this.attributes={};const $e={};this.numAttributes=q.length;for(let Oe=0;Oe<this.numAttributes;Oe++)q[Oe]&&(M.bindAttribLocation(this.program,Oe,q[Oe]),this.attributes[q[Oe]]=Oe);M.linkProgram(this.program),M.deleteShader(xe),M.deleteShader(Me);for(let Oe=0;Oe<ie.length;Oe++){const Ne=ie[Oe];if(Ne&&!$e[Ne]){const Je=M.getUniformLocation(this.program,Ne);Je&&($e[Ne]=Je)}}this.fixedUniforms=v(r,$e),this.binderUniforms=g?g.getUniforms(r,$e):[]}draw(r,a,h,g,v,D,M,S,z,q,X,re,ue,ie,ce,ye){const ge=r.gl;if(this.failedToCreate)return;r.program.set(this.program),r.setDepthMode(h),r.setStencilMode(g),r.setColorMode(v),r.setCullFace(D);for(const xe in this.fixedUniforms)this.fixedUniforms[xe].set(M[xe]);ie&&ie.setUniforms(r,this.binderUniforms,re,{zoom:ue});const Me={[ge.LINES]:2,[ge.TRIANGLES]:3,[ge.LINE_STRIP]:1}[a];for(const xe of X.get()){const $e=xe.vaos||(xe.vaos={});($e[S]||($e[S]=new Bo)).bind(r,this,z,ie?ie.getPaintVertexBuffers():[],q,xe.vertexOffset,ce,ye),ge.drawElements(a,xe.primitiveLength*Me,ge.UNSIGNED_SHORT,xe.primitiveOffset*Me*2)}}}function _i(p,r,a){const h=1/Jn(a,1,r.transform.tileZoom),g=Math.pow(2,a.tileID.overscaledZ),v=a.tileSize*Math.pow(2,r.transform.tileZoom)/g,D=v*(a.tileID.canonical.x+a.tileID.wrap*g),M=v*a.tileID.canonical.y;return{u_image:0,u_texsize:a.imageAtlasTexture.size,u_scale:[h,p.fromScale,p.toScale],u_fade:p.t,u_pixel_coord_upper:[D>>16,M>>16],u_pixel_coord_lower:[65535&D,65535&M]}}const zr=(p,r,a,h)=>{const g=r.style.light,v=g.properties.get("position"),D=[v.x,v.y,v.z],M=(z=new f.ARRAY_TYPE(9),f.ARRAY_TYPE!=Float32Array&&(z[1]=0,z[2]=0,z[3]=0,z[5]=0,z[6]=0,z[7]=0),z[0]=1,z[4]=1,z[8]=1,z);var z;"viewport"===g.properties.get("anchor")&&function(z,q){var X=Math.sin(q),re=Math.cos(q);z[0]=re,z[1]=X,z[2]=0,z[3]=-X,z[4]=re,z[5]=0,z[6]=0,z[7]=0,z[8]=1}(M,-r.transform.angle),function(z,q,X){var re=q[0],ue=q[1],ie=q[2];z[0]=re*X[0]+ue*X[3]+ie*X[6],z[1]=re*X[1]+ue*X[4]+ie*X[7],z[2]=re*X[2]+ue*X[5]+ie*X[8]}(D,D,M);const S=g.properties.get("color");return{u_matrix:p,u_lightpos:D,u_lightintensity:g.properties.get("intensity"),u_lightcolor:[S.r,S.g,S.b],u_vertical_gradient:+a,u_opacity:h}},Wi=(p,r,a,h,g,v,D)=>f.extend(zr(p,r,a,h),_i(v,r,D),{u_height_factor:-Math.pow(2,g.overscaledZ)/D.tileSize/8}),vi=p=>({u_matrix:p}),Hr=(p,r,a,h)=>f.extend(vi(p),_i(a,r,h)),Io=(p,r)=>({u_matrix:p,u_world:r}),_s=(p,r,a,h,g)=>f.extend(Hr(p,r,a,h),{u_world:g}),Pn=(p,r,a,h)=>{const g=p.transform;let v,D;if("map"===h.paint.get("circle-pitch-alignment")){const M=Jn(a,1,g.zoom);v=!0,D=[M,M]}else v=!1,D=g.pixelsToGLUnits;return{u_camera_to_center_distance:g.cameraToCenterDistance,u_scale_with_map:+("map"===h.paint.get("circle-pitch-scale")),u_matrix:p.translatePosMatrix(r.posMatrix,a,h.paint.get("circle-translate"),h.paint.get("circle-translate-anchor")),u_pitch_with_map:+v,u_device_pixel_ratio:p.pixelRatio,u_extrude_scale:D}},co=(p,r,a)=>{const h=Jn(a,1,r.zoom),g=Math.pow(2,r.zoom-a.tileID.overscaledZ),v=a.tileID.overscaleFactor();return{u_matrix:p,u_camera_to_center_distance:r.cameraToCenterDistance,u_pixels_to_tile_units:h,u_extrude_scale:[r.pixelsToGLUnits[0]/(h*g),r.pixelsToGLUnits[1]/(h*g)],u_overscale_factor:v}},ho=(p,r,a=1)=>({u_matrix:p,u_color:r,u_overlay:0,u_overlay_scale:a}),Yi=p=>({u_matrix:p}),po=(p,r,a,h)=>({u_matrix:p,u_extrude_scale:Jn(r,1,a),u_intensity:h});function So(p,r){const a=Math.pow(2,r.canonical.z),h=r.canonical.y;return[new f.MercatorCoordinate(0,h/a).toLngLat().lat,new f.MercatorCoordinate(0,(h+1)/a).toLngLat().lat]}const kr=(p,r,a)=>{const h=p.transform;return{u_matrix:xi(p,r,a),u_ratio:1/Jn(r,1,h.zoom),u_device_pixel_ratio:p.pixelRatio,u_units_to_pixels:[1/h.pixelsToGLUnits[0],1/h.pixelsToGLUnits[1]]}},Mi=(p,r,a,h)=>f.extend(kr(p,r,a),{u_image:0,u_image_height:h}),Ir=(p,r,a,h)=>{const g=p.transform,v=Nr(r,g);return{u_matrix:xi(p,r,a),u_texsize:r.imageAtlasTexture.size,u_ratio:1/Jn(r,1,g.zoom),u_device_pixel_ratio:p.pixelRatio,u_image:0,u_scale:[v,h.fromScale,h.toScale],u_fade:h.t,u_units_to_pixels:[1/g.pixelsToGLUnits[0],1/g.pixelsToGLUnits[1]]}},Sr=(p,r,a,h,g)=>{const v=p.lineAtlas,D=Nr(r,p.transform),M="round"===a.layout.get("line-cap"),S=v.getDash(h.from,M),z=v.getDash(h.to,M),q=S.width*g.fromScale,X=z.width*g.toScale;return f.extend(kr(p,r,a),{u_patternscale_a:[D/q,-S.height/2],u_patternscale_b:[D/X,-z.height/2],u_sdfgamma:v.width/(256*Math.min(q,X)*p.pixelRatio)/2,u_image:0,u_tex_y_a:S.y,u_tex_y_b:z.y,u_mix:g.t})};function Nr(p,r){return 1/Jn(p,1,r.tileZoom)}function xi(p,r,a){return p.translatePosMatrix(r.tileID.posMatrix,r,a.paint.get("line-translate"),a.paint.get("line-translate-anchor"))}const ts=(p,r,a,h,g)=>{return{u_matrix:p,u_tl_parent:r,u_scale_parent:a,u_buffer_scale:1,u_fade_t:h.mix,u_opacity:h.opacity*g.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:g.paint.get("raster-brightness-min"),u_brightness_high:g.paint.get("raster-brightness-max"),u_saturation_factor:(D=g.paint.get("raster-saturation"),D>0?1-1/(1.001-D):-D),u_contrast_factor:(v=g.paint.get("raster-contrast"),v>0?1/(1-v):1+v),u_spin_weights:Ao(g.paint.get("raster-hue-rotate"))};var v,D};function Ao(p){p*=Math.PI/180;const r=Math.sin(p),a=Math.cos(p);return[(2*a+1)/3,(-Math.sqrt(3)*r-a+1)/3,(Math.sqrt(3)*r-a+1)/3]}const fo=(p,r,a,h,g,v,D,M,S,z)=>{const q=g.transform;return{u_is_size_zoom_constant:+("constant"===p||"source"===p),u_is_size_feature_constant:+("constant"===p||"camera"===p),u_size_t:r?r.uSizeT:0,u_size:r?r.uSize:0,u_camera_to_center_distance:q.cameraToCenterDistance,u_pitch:q.pitch/360*2*Math.PI,u_rotate_symbol:+a,u_aspect_ratio:q.width/q.height,u_fade_change:g.options.fadeDuration?g.symbolFadeChange:1,u_matrix:v,u_label_plane_matrix:D,u_coord_matrix:M,u_is_text:+S,u_pitch_with_map:+h,u_texsize:z,u_texture:0}},ti=(p,r,a,h,g,v,D,M,S,z,q)=>{const X=g.transform;return f.extend(fo(p,r,a,h,g,v,D,M,S,z),{u_gamma_scale:h?Math.cos(X._pitch)*X.cameraToCenterDistance:1,u_device_pixel_ratio:g.pixelRatio,u_is_halo:+q})},Ws=(p,r,a,h,g,v,D,M,S,z)=>f.extend(ti(p,r,a,h,g,v,D,M,!0,S,!0),{u_texsize_icon:z,u_texture_icon:1}),Ja=(p,r,a)=>({u_matrix:p,u_opacity:r,u_color:a}),vs=(p,r,a,h,g,v)=>f.extend(function(D,M,S,z){const q=S.imageManager.getPattern(D.from.toString()),X=S.imageManager.getPattern(D.to.toString()),{width:re,height:ue}=S.imageManager.getPixelSize(),ie=Math.pow(2,z.tileID.overscaledZ),ce=z.tileSize*Math.pow(2,S.transform.tileZoom)/ie,ye=ce*(z.tileID.canonical.x+z.tileID.wrap*ie),ge=ce*z.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:q.tl,u_pattern_br_a:q.br,u_pattern_tl_b:X.tl,u_pattern_br_b:X.br,u_texsize:[re,ue],u_mix:M.t,u_pattern_size_a:q.displaySize,u_pattern_size_b:X.displaySize,u_scale_a:M.fromScale,u_scale_b:M.toScale,u_tile_units_to_pixels:1/Jn(z,1,S.transform.tileZoom),u_pixel_coord_upper:[ye>>16,ge>>16],u_pixel_coord_lower:[65535&ye,65535&ge]}}(h,v,a,g),{u_matrix:p,u_opacity:r}),ns={fillExtrusion:(p,r)=>({u_matrix:new f.UniformMatrix4f(p,r.u_matrix),u_lightpos:new f.Uniform3f(p,r.u_lightpos),u_lightintensity:new f.Uniform1f(p,r.u_lightintensity),u_lightcolor:new f.Uniform3f(p,r.u_lightcolor),u_vertical_gradient:new f.Uniform1f(p,r.u_vertical_gradient),u_opacity:new f.Uniform1f(p,r.u_opacity)}),fillExtrusionPattern:(p,r)=>({u_matrix:new f.UniformMatrix4f(p,r.u_matrix),u_lightpos:new f.Uniform3f(p,r.u_lightpos),u_lightintensity:new f.Uniform1f(p,r.u_lightintensity),u_lightcolor:new f.Uniform3f(p,r.u_lightcolor),u_vertical_gradient:new f.Uniform1f(p,r.u_vertical_gradient),u_height_factor:new f.Uniform1f(p,r.u_height_factor),u_image:new f.Uniform1i(p,r.u_image),u_texsize:new f.Uniform2f(p,r.u_texsize),u_pixel_coord_upper:new f.Uniform2f(p,r.u_pixel_coord_upper),u_pixel_coord_lower:new f.Uniform2f(p,r.u_pixel_coord_lower),u_scale:new f.Uniform3f(p,r.u_scale),u_fade:new f.Uniform1f(p,r.u_fade),u_opacity:new f.Uniform1f(p,r.u_opacity)}),fill:(p,r)=>({u_matrix:new f.UniformMatrix4f(p,r.u_matrix)}),fillPattern:(p,r)=>({u_matrix:new f.UniformMatrix4f(p,r.u_matrix),u_image:new f.Uniform1i(p,r.u_image),u_texsize:new f.Uniform2f(p,r.u_texsize),u_pixel_coord_upper:new f.Uniform2f(p,r.u_pixel_coord_upper),u_pixel_coord_lower:new f.Uniform2f(p,r.u_pixel_coord_lower),u_scale:new f.Uniform3f(p,r.u_scale),u_fade:new f.Uniform1f(p,r.u_fade)}),fillOutline:(p,r)=>({u_matrix:new f.UniformMatrix4f(p,r.u_matrix),u_world:new f.Uniform2f(p,r.u_world)}),fillOutlinePattern:(p,r)=>({u_matrix:new f.UniformMatrix4f(p,r.u_matrix),u_world:new f.Uniform2f(p,r.u_world),u_image:new f.Uniform1i(p,r.u_image),u_texsize:new f.Uniform2f(p,r.u_texsize),u_pixel_coord_upper:new f.Uniform2f(p,r.u_pixel_coord_upper),u_pixel_coord_lower:new f.Uniform2f(p,r.u_pixel_coord_lower),u_scale:new f.Uniform3f(p,r.u_scale),u_fade:new f.Uniform1f(p,r.u_fade)}),circle:(p,r)=>({u_camera_to_center_distance:new f.Uniform1f(p,r.u_camera_to_center_distance),u_scale_with_map:new f.Uniform1i(p,r.u_scale_with_map),u_pitch_with_map:new f.Uniform1i(p,r.u_pitch_with_map),u_extrude_scale:new f.Uniform2f(p,r.u_extrude_scale),u_device_pixel_ratio:new f.Uniform1f(p,r.u_device_pixel_ratio),u_matrix:new f.UniformMatrix4f(p,r.u_matrix)}),collisionBox:(p,r)=>({u_matrix:new f.UniformMatrix4f(p,r.u_matrix),u_camera_to_center_distance:new f.Uniform1f(p,r.u_camera_to_center_distance),u_pixels_to_tile_units:new f.Uniform1f(p,r.u_pixels_to_tile_units),u_extrude_scale:new f.Uniform2f(p,r.u_extrude_scale),u_overscale_factor:new f.Uniform1f(p,r.u_overscale_factor)}),collisionCircle:(p,r)=>({u_matrix:new f.UniformMatrix4f(p,r.u_matrix),u_inv_matrix:new f.UniformMatrix4f(p,r.u_inv_matrix),u_camera_to_center_distance:new f.Uniform1f(p,r.u_camera_to_center_distance),u_viewport_size:new f.Uniform2f(p,r.u_viewport_size)}),debug:(p,r)=>({u_color:new f.UniformColor(p,r.u_color),u_matrix:new f.UniformMatrix4f(p,r.u_matrix),u_overlay:new f.Uniform1i(p,r.u_overlay),u_overlay_scale:new f.Uniform1f(p,r.u_overlay_scale)}),clippingMask:(p,r)=>({u_matrix:new f.UniformMatrix4f(p,r.u_matrix)}),heatmap:(p,r)=>({u_extrude_scale:new f.Uniform1f(p,r.u_extrude_scale),u_intensity:new f.Uniform1f(p,r.u_intensity),u_matrix:new f.UniformMatrix4f(p,r.u_matrix)}),heatmapTexture:(p,r)=>({u_matrix:new f.UniformMatrix4f(p,r.u_matrix),u_world:new f.Uniform2f(p,r.u_world),u_image:new f.Uniform1i(p,r.u_image),u_color_ramp:new f.Uniform1i(p,r.u_color_ramp),u_opacity:new f.Uniform1f(p,r.u_opacity)}),hillshade:(p,r)=>({u_matrix:new f.UniformMatrix4f(p,r.u_matrix),u_image:new f.Uniform1i(p,r.u_image),u_latrange:new f.Uniform2f(p,r.u_latrange),u_light:new f.Uniform2f(p,r.u_light),u_shadow:new f.UniformColor(p,r.u_shadow),u_highlight:new f.UniformColor(p,r.u_highlight),u_accent:new f.UniformColor(p,r.u_accent)}),hillshadePrepare:(p,r)=>({u_matrix:new f.UniformMatrix4f(p,r.u_matrix),u_image:new f.Uniform1i(p,r.u_image),u_dimension:new f.Uniform2f(p,r.u_dimension),u_zoom:new f.Uniform1f(p,r.u_zoom),u_unpack:new f.Uniform4f(p,r.u_unpack)}),line:(p,r)=>({u_matrix:new f.UniformMatrix4f(p,r.u_matrix),u_ratio:new f.Uniform1f(p,r.u_ratio),u_device_pixel_ratio:new f.Uniform1f(p,r.u_device_pixel_ratio),u_units_to_pixels:new f.Uniform2f(p,r.u_units_to_pixels)}),lineGradient:(p,r)=>({u_matrix:new f.UniformMatrix4f(p,r.u_matrix),u_ratio:new f.Uniform1f(p,r.u_ratio),u_device_pixel_ratio:new f.Uniform1f(p,r.u_device_pixel_ratio),u_units_to_pixels:new f.Uniform2f(p,r.u_units_to_pixels),u_image:new f.Uniform1i(p,r.u_image),u_image_height:new f.Uniform1f(p,r.u_image_height)}),linePattern:(p,r)=>({u_matrix:new f.UniformMatrix4f(p,r.u_matrix),u_texsize:new f.Uniform2f(p,r.u_texsize),u_ratio:new f.Uniform1f(p,r.u_ratio),u_device_pixel_ratio:new f.Uniform1f(p,r.u_device_pixel_ratio),u_image:new f.Uniform1i(p,r.u_image),u_units_to_pixels:new f.Uniform2f(p,r.u_units_to_pixels),u_scale:new f.Uniform3f(p,r.u_scale),u_fade:new f.Uniform1f(p,r.u_fade)}),lineSDF:(p,r)=>({u_matrix:new f.UniformMatrix4f(p,r.u_matrix),u_ratio:new f.Uniform1f(p,r.u_ratio),u_device_pixel_ratio:new f.Uniform1f(p,r.u_device_pixel_ratio),u_units_to_pixels:new f.Uniform2f(p,r.u_units_to_pixels),u_patternscale_a:new f.Uniform2f(p,r.u_patternscale_a),u_patternscale_b:new f.Uniform2f(p,r.u_patternscale_b),u_sdfgamma:new f.Uniform1f(p,r.u_sdfgamma),u_image:new f.Uniform1i(p,r.u_image),u_tex_y_a:new f.Uniform1f(p,r.u_tex_y_a),u_tex_y_b:new f.Uniform1f(p,r.u_tex_y_b),u_mix:new f.Uniform1f(p,r.u_mix)}),raster:(p,r)=>({u_matrix:new f.UniformMatrix4f(p,r.u_matrix),u_tl_parent:new f.Uniform2f(p,r.u_tl_parent),u_scale_parent:new f.Uniform1f(p,r.u_scale_parent),u_buffer_scale:new f.Uniform1f(p,r.u_buffer_scale),u_fade_t:new f.Uniform1f(p,r.u_fade_t),u_opacity:new f.Uniform1f(p,r.u_opacity),u_image0:new f.Uniform1i(p,r.u_image0),u_image1:new f.Uniform1i(p,r.u_image1),u_brightness_low:new f.Uniform1f(p,r.u_brightness_low),u_brightness_high:new f.Uniform1f(p,r.u_brightness_high),u_saturation_factor:new f.Uniform1f(p,r.u_saturation_factor),u_contrast_factor:new f.Uniform1f(p,r.u_contrast_factor),u_spin_weights:new f.Uniform3f(p,r.u_spin_weights)}),symbolIcon:(p,r)=>({u_is_size_zoom_constant:new f.Uniform1i(p,r.u_is_size_zoom_constant),u_is_size_feature_constant:new f.Uniform1i(p,r.u_is_size_feature_constant),u_size_t:new f.Uniform1f(p,r.u_size_t),u_size:new f.Uniform1f(p,r.u_size),u_camera_to_center_distance:new f.Uniform1f(p,r.u_camera_to_center_distance),u_pitch:new f.Uniform1f(p,r.u_pitch),u_rotate_symbol:new f.Uniform1i(p,r.u_rotate_symbol),u_aspect_ratio:new f.Uniform1f(p,r.u_aspect_ratio),u_fade_change:new f.Uniform1f(p,r.u_fade_change),u_matrix:new f.UniformMatrix4f(p,r.u_matrix),u_label_plane_matrix:new f.UniformMatrix4f(p,r.u_label_plane_matrix),u_coord_matrix:new f.UniformMatrix4f(p,r.u_coord_matrix),u_is_text:new f.Uniform1i(p,r.u_is_text),u_pitch_with_map:new f.Uniform1i(p,r.u_pitch_with_map),u_texsize:new f.Uniform2f(p,r.u_texsize),u_texture:new f.Uniform1i(p,r.u_texture)}),symbolSDF:(p,r)=>({u_is_size_zoom_constant:new f.Uniform1i(p,r.u_is_size_zoom_constant),u_is_size_feature_constant:new f.Uniform1i(p,r.u_is_size_feature_constant),u_size_t:new f.Uniform1f(p,r.u_size_t),u_size:new f.Uniform1f(p,r.u_size),u_camera_to_center_distance:new f.Uniform1f(p,r.u_camera_to_center_distance),u_pitch:new f.Uniform1f(p,r.u_pitch),u_rotate_symbol:new f.Uniform1i(p,r.u_rotate_symbol),u_aspect_ratio:new f.Uniform1f(p,r.u_aspect_ratio),u_fade_change:new f.Uniform1f(p,r.u_fade_change),u_matrix:new f.UniformMatrix4f(p,r.u_matrix),u_label_plane_matrix:new f.UniformMatrix4f(p,r.u_label_plane_matrix),u_coord_matrix:new f.UniformMatrix4f(p,r.u_coord_matrix),u_is_text:new f.Uniform1i(p,r.u_is_text),u_pitch_with_map:new f.Uniform1i(p,r.u_pitch_with_map),u_texsize:new f.Uniform2f(p,r.u_texsize),u_texture:new f.Uniform1i(p,r.u_texture),u_gamma_scale:new f.Uniform1f(p,r.u_gamma_scale),u_device_pixel_ratio:new f.Uniform1f(p,r.u_device_pixel_ratio),u_is_halo:new f.Uniform1i(p,r.u_is_halo)}),symbolTextAndIcon:(p,r)=>({u_is_size_zoom_constant:new f.Uniform1i(p,r.u_is_size_zoom_constant),u_is_size_feature_constant:new f.Uniform1i(p,r.u_is_size_feature_constant),u_size_t:new f.Uniform1f(p,r.u_size_t),u_size:new f.Uniform1f(p,r.u_size),u_camera_to_center_distance:new f.Uniform1f(p,r.u_camera_to_center_distance),u_pitch:new f.Uniform1f(p,r.u_pitch),u_rotate_symbol:new f.Uniform1i(p,r.u_rotate_symbol),u_aspect_ratio:new f.Uniform1f(p,r.u_aspect_ratio),u_fade_change:new f.Uniform1f(p,r.u_fade_change),u_matrix:new f.UniformMatrix4f(p,r.u_matrix),u_label_plane_matrix:new f.UniformMatrix4f(p,r.u_label_plane_matrix),u_coord_matrix:new f.UniformMatrix4f(p,r.u_coord_matrix),u_is_text:new f.Uniform1i(p,r.u_is_text),u_pitch_with_map:new f.Uniform1i(p,r.u_pitch_with_map),u_texsize:new f.Uniform2f(p,r.u_texsize),u_texsize_icon:new f.Uniform2f(p,r.u_texsize_icon),u_texture:new f.Uniform1i(p,r.u_texture),u_texture_icon:new f.Uniform1i(p,r.u_texture_icon),u_gamma_scale:new f.Uniform1f(p,r.u_gamma_scale),u_device_pixel_ratio:new f.Uniform1f(p,r.u_device_pixel_ratio),u_is_halo:new f.Uniform1i(p,r.u_is_halo)}),background:(p,r)=>({u_matrix:new f.UniformMatrix4f(p,r.u_matrix),u_opacity:new f.Uniform1f(p,r.u_opacity),u_color:new f.UniformColor(p,r.u_color)}),backgroundPattern:(p,r)=>({u_matrix:new f.UniformMatrix4f(p,r.u_matrix),u_opacity:new f.Uniform1f(p,r.u_opacity),u_image:new f.Uniform1i(p,r.u_image),u_pattern_tl_a:new f.Uniform2f(p,r.u_pattern_tl_a),u_pattern_br_a:new f.Uniform2f(p,r.u_pattern_br_a),u_pattern_tl_b:new f.Uniform2f(p,r.u_pattern_tl_b),u_pattern_br_b:new f.Uniform2f(p,r.u_pattern_br_b),u_texsize:new f.Uniform2f(p,r.u_texsize),u_mix:new f.Uniform1f(p,r.u_mix),u_pattern_size_a:new f.Uniform2f(p,r.u_pattern_size_a),u_pattern_size_b:new f.Uniform2f(p,r.u_pattern_size_b),u_scale_a:new f.Uniform1f(p,r.u_scale_a),u_scale_b:new f.Uniform1f(p,r.u_scale_b),u_pixel_coord_upper:new f.Uniform2f(p,r.u_pixel_coord_upper),u_pixel_coord_lower:new f.Uniform2f(p,r.u_pixel_coord_lower),u_tile_units_to_pixels:new f.Uniform1f(p,r.u_tile_units_to_pixels)})};class Ys{constructor(r,a,h){this.context=r;const g=r.gl;this.buffer=g.createBuffer(),this.dynamicDraw=Boolean(h),this.context.unbindVAO(),r.bindElementBuffer.set(this.buffer),g.bufferData(g.ELEMENT_ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?g.DYNAMIC_DRAW:g.STATIC_DRAW),this.dynamicDraw||delete a.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(r){const a=this.context.gl;this.context.unbindVAO(),this.bind(),a.bufferSubData(a.ELEMENT_ARRAY_BUFFER,0,r.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Ia={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Ks{constructor(r,a,h,g){this.length=a.length,this.attributes=h,this.itemSize=a.bytesPerElement,this.dynamicDraw=g,this.context=r;const v=r.gl;this.buffer=v.createBuffer(),r.bindVertexBuffer.set(this.buffer),v.bufferData(v.ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?v.DYNAMIC_DRAW:v.STATIC_DRAW),this.dynamicDraw||delete a.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(r){const a=this.context.gl;this.bind(),a.bufferSubData(a.ARRAY_BUFFER,0,r.arrayBuffer)}enableAttributes(r,a){for(let h=0;h<this.attributes.length;h++){const g=a.attributes[this.attributes[h].name];void 0!==g&&r.enableVertexAttribArray(g)}}setVertexAttribPointers(r,a,h){for(let g=0;g<this.attributes.length;g++){const v=this.attributes[g],D=a.attributes[v.name];void 0!==D&&r.vertexAttribPointer(D,v.components,r[Ia[v.type]],!1,this.itemSize,v.offset+this.itemSize*(h||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Nn{constructor(r){this.gl=r.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(r){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Xs extends Nn{getDefault(){return f.Color.transparent}set(r){const a=this.current;(r.r!==a.r||r.g!==a.g||r.b!==a.b||r.a!==a.a||this.dirty)&&(this.gl.clearColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class rs extends Nn{getDefault(){return 1}set(r){(r!==this.current||this.dirty)&&(this.gl.clearDepth(r),this.current=r,this.dirty=!1)}}class Vo extends Nn{getDefault(){return 0}set(r){(r!==this.current||this.dirty)&&(this.gl.clearStencil(r),this.current=r,this.dirty=!1)}}class Js extends Nn{getDefault(){return[!0,!0,!0,!0]}set(r){const a=this.current;(r[0]!==a[0]||r[1]!==a[1]||r[2]!==a[2]||r[3]!==a[3]||this.dirty)&&(this.gl.colorMask(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class ni extends Nn{getDefault(){return!0}set(r){(r!==this.current||this.dirty)&&(this.gl.depthMask(r),this.current=r,this.dirty=!1)}}class Uo extends Nn{getDefault(){return 255}set(r){(r!==this.current||this.dirty)&&(this.gl.stencilMask(r),this.current=r,this.dirty=!1)}}class xs extends Nn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(r){const a=this.current;(r.func!==a.func||r.ref!==a.ref||r.mask!==a.mask||this.dirty)&&(this.gl.stencilFunc(r.func,r.ref,r.mask),this.current=r,this.dirty=!1)}}class is extends Nn{getDefault(){const r=this.gl;return[r.KEEP,r.KEEP,r.KEEP]}set(r){const a=this.current;(r[0]!==a[0]||r[1]!==a[1]||r[2]!==a[2]||this.dirty)&&(this.gl.stencilOp(r[0],r[1],r[2]),this.current=r,this.dirty=!1)}}class Qs extends Nn{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const a=this.gl;r?a.enable(a.STENCIL_TEST):a.disable(a.STENCIL_TEST),this.current=r,this.dirty=!1}}class jo extends Nn{getDefault(){return[0,1]}set(r){const a=this.current;(r[0]!==a[0]||r[1]!==a[1]||this.dirty)&&(this.gl.depthRange(r[0],r[1]),this.current=r,this.dirty=!1)}}class $o extends Nn{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const a=this.gl;r?a.enable(a.DEPTH_TEST):a.disable(a.DEPTH_TEST),this.current=r,this.dirty=!1}}class mo extends Nn{getDefault(){return this.gl.LESS}set(r){(r!==this.current||this.dirty)&&(this.gl.depthFunc(r),this.current=r,this.dirty=!1)}}class bs extends Nn{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const a=this.gl;r?a.enable(a.BLEND):a.disable(a.BLEND),this.current=r,this.dirty=!1}}class ea extends Nn{getDefault(){const r=this.gl;return[r.ONE,r.ZERO]}set(r){const a=this.current;(r[0]!==a[0]||r[1]!==a[1]||this.dirty)&&(this.gl.blendFunc(r[0],r[1]),this.current=r,this.dirty=!1)}}class Sa extends Nn{getDefault(){return f.Color.transparent}set(r){const a=this.current;(r.r!==a.r||r.g!==a.g||r.b!==a.b||r.a!==a.a||this.dirty)&&(this.gl.blendColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class go extends Nn{getDefault(){return this.gl.FUNC_ADD}set(r){(r!==this.current||this.dirty)&&(this.gl.blendEquation(r),this.current=r,this.dirty=!1)}}class To extends Nn{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const a=this.gl;r?a.enable(a.CULL_FACE):a.disable(a.CULL_FACE),this.current=r,this.dirty=!1}}class ta extends Nn{getDefault(){return this.gl.BACK}set(r){(r!==this.current||this.dirty)&&(this.gl.cullFace(r),this.current=r,this.dirty=!1)}}class ws extends Nn{getDefault(){return this.gl.CCW}set(r){(r!==this.current||this.dirty)&&(this.gl.frontFace(r),this.current=r,this.dirty=!1)}}class Qa extends Nn{getDefault(){return null}set(r){(r!==this.current||this.dirty)&&(this.gl.useProgram(r),this.current=r,this.dirty=!1)}}class na extends Nn{getDefault(){return this.gl.TEXTURE0}set(r){(r!==this.current||this.dirty)&&(this.gl.activeTexture(r),this.current=r,this.dirty=!1)}}class Ds extends Nn{getDefault(){const r=this.gl;return[0,0,r.drawingBufferWidth,r.drawingBufferHeight]}set(r){const a=this.current;(r[0]!==a[0]||r[1]!==a[1]||r[2]!==a[2]||r[3]!==a[3]||this.dirty)&&(this.gl.viewport(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class Aa extends Nn{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const a=this.gl;a.bindFramebuffer(a.FRAMEBUFFER,r),this.current=r,this.dirty=!1}}class ra extends Nn{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const a=this.gl;a.bindRenderbuffer(a.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class L extends Nn{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const a=this.gl;a.bindTexture(a.TEXTURE_2D,r),this.current=r,this.dirty=!1}}class K extends Nn{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const a=this.gl;a.bindBuffer(a.ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class R extends Nn{getDefault(){return null}set(r){const a=this.gl;a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class oe extends Nn{constructor(r){super(r),this.vao=r.extVertexArrayObject}getDefault(){return null}set(r){this.vao&&(r!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(r),this.current=r,this.dirty=!1)}}class ve extends Nn{getDefault(){return 4}set(r){if(r===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_ALIGNMENT,r),this.current=r,this.dirty=!1}}class Ue extends Nn{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r),this.current=r,this.dirty=!1}}class ot extends Nn{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,r),this.current=r,this.dirty=!1}}class Bt extends Nn{constructor(r,a){super(r),this.context=r,this.parent=a}getDefault(){return null}}class Bn extends Bt{setDirty(){this.dirty=!0}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,r,0),this.current=r,this.dirty=!1}}class ir extends Bt{set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class Kn{constructor(r,a,h,g){this.context=r,this.width=a,this.height=h;const v=this.framebuffer=r.gl.createFramebuffer();this.colorAttachment=new Bn(r,v),g&&(this.depthAttachment=new ir(r,v))}destroy(){const r=this.context.gl,a=this.colorAttachment.get();if(a&&r.deleteTexture(a),this.depthAttachment){const h=this.depthAttachment.get();h&&r.deleteRenderbuffer(h)}r.deleteFramebuffer(this.framebuffer)}}class gt{constructor(r,a,h){this.blendFunction=r,this.blendColor=a,this.mask=h}}gt.Replace=[1,0],gt.disabled=new gt(gt.Replace,f.Color.transparent,[!1,!1,!1,!1]),gt.unblended=new gt(gt.Replace,f.Color.transparent,[!0,!0,!0,!0]),gt.alphaBlended=new gt([1,771],f.Color.transparent,[!0,!0,!0,!0]);class xn{constructor(r){this.gl=r,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new Xs(this),this.clearDepth=new rs(this),this.clearStencil=new Vo(this),this.colorMask=new Js(this),this.depthMask=new ni(this),this.stencilMask=new Uo(this),this.stencilFunc=new xs(this),this.stencilOp=new is(this),this.stencilTest=new Qs(this),this.depthRange=new jo(this),this.depthTest=new $o(this),this.depthFunc=new mo(this),this.blend=new bs(this),this.blendFunc=new ea(this),this.blendColor=new Sa(this),this.blendEquation=new go(this),this.cullFace=new To(this),this.cullFaceSide=new ta(this),this.frontFace=new ws(this),this.program=new Qa(this),this.activeTexture=new na(this),this.viewport=new Ds(this),this.bindFramebuffer=new Aa(this),this.bindRenderbuffer=new ra(this),this.bindTexture=new L(this),this.bindVertexBuffer=new K(this),this.bindElementBuffer=new R(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new oe(this),this.pixelStoreUnpack=new ve(this),this.pixelStoreUnpackPremultiplyAlpha=new Ue(this),this.pixelStoreUnpackFlipY=new ot(this),this.extTextureFilterAnisotropic=r.getExtension("EXT_texture_filter_anisotropic")||r.getExtension("MOZ_EXT_texture_filter_anisotropic")||r.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=r.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=r.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(r.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=r.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=r.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=r.getParameter(r.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(r,a){return new Ys(this,r,a)}createVertexBuffer(r,a,h){return new Ks(this,r,a,h)}createRenderbuffer(r,a,h){const g=this.gl,v=g.createRenderbuffer();return this.bindRenderbuffer.set(v),g.renderbufferStorage(g.RENDERBUFFER,r,a,h),this.bindRenderbuffer.set(null),v}createFramebuffer(r,a,h){return new Kn(this,r,a,h)}clear({color:r,depth:a}){const h=this.gl;let g=0;r&&(g|=h.COLOR_BUFFER_BIT,this.clearColor.set(r),this.colorMask.set([!0,!0,!0,!0])),void 0!==a&&(g|=h.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(a),this.depthMask.set(!0)),h.clear(g)}setCullFace(r){!1===r.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(r.mode),this.frontFace.set(r.frontFace))}setDepthMode(r){r.func!==this.gl.ALWAYS||r.mask?(this.depthTest.set(!0),this.depthFunc.set(r.func),this.depthMask.set(r.mask),this.depthRange.set(r.range)):this.depthTest.set(!1)}setStencilMode(r){r.test.func!==this.gl.ALWAYS||r.mask?(this.stencilTest.set(!0),this.stencilMask.set(r.mask),this.stencilOp.set([r.fail,r.depthFail,r.pass]),this.stencilFunc.set({func:r.test.func,ref:r.ref,mask:r.test.mask})):this.stencilTest.set(!1)}setColorMode(r){It(r.blendFunction,gt.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(r.blendFunction),this.blendColor.set(r.blendColor)),this.colorMask.set(r.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class Jt{constructor(r,a,h){this.func=r,this.mask=a,this.range=h}}Jt.ReadOnly=!1,Jt.ReadWrite=!0,Jt.disabled=new Jt(519,Jt.ReadOnly,[0,1]);class cn{constructor(r,a,h,g,v,D){this.test=r,this.ref=a,this.mask=h,this.fail=g,this.depthFail=v,this.pass=D}}cn.disabled=new cn({func:519,mask:0},0,0,7680,7680,7680);class $n{constructor(r,a,h){this.enable=r,this.mode=a,this.frontFace=h}}let Po;function bi(p,r,a,h,g,v,D){const M=p.context,S=M.gl,z=p.useProgram("collisionBox"),q=[];let X=0,re=0;for(let xe=0;xe<h.length;xe++){const $e=h[xe],Oe=r.getTile($e),Ne=Oe.getBucket(a);if(!Ne)continue;let Je=$e.posMatrix;0===g[0]&&0===g[1]||(Je=p.translatePosMatrix($e.posMatrix,Oe,g,v));const at=D?Ne.textCollisionBox:Ne.iconCollisionBox,je=Ne.collisionCircleArray;if(je.length>0){const At=f.create(),vt=Je;f.mul(At,Ne.placementInvProjMatrix,p.transform.glCoordMatrix),f.mul(At,At,Ne.placementViewportMatrix),q.push({circleArray:je,circleOffset:re,transform:vt,invTransform:At}),X+=je.length/4,re=X}at&&z.draw(M,S.LINES,Jt.disabled,cn.disabled,p.colorModeForRenderPass(),$n.disabled,co(Je,p.transform,Oe),a.id,at.layoutVertexBuffer,at.indexBuffer,at.segments,null,p.transform.zoom,null,null,at.collisionVertexBuffer)}if(!D||!q.length)return;const ue=p.useProgram("collisionCircle"),ie=new f.CollisionCircleLayoutArray;ie.resize(4*X),ie._trim();let ce=0;for(const xe of q)for(let $e=0;$e<xe.circleArray.length/4;$e++){const Oe=4*$e,Ne=xe.circleArray[Oe+0],Je=xe.circleArray[Oe+1],at=xe.circleArray[Oe+2],je=xe.circleArray[Oe+3];ie.emplace(ce++,Ne,Je,at,je,0),ie.emplace(ce++,Ne,Je,at,je,1),ie.emplace(ce++,Ne,Je,at,je,2),ie.emplace(ce++,Ne,Je,at,je,3)}(!Po||Po.length<2*X)&&(Po=function(xe){const $e=2*xe,Oe=new f.QuadTriangleArray;Oe.resize($e),Oe._trim();for(let Ne=0;Ne<$e;Ne++){const Je=6*Ne;Oe.uint16[Je+0]=4*Ne+0,Oe.uint16[Je+1]=4*Ne+1,Oe.uint16[Je+2]=4*Ne+2,Oe.uint16[Je+3]=4*Ne+2,Oe.uint16[Je+4]=4*Ne+3,Oe.uint16[Je+5]=4*Ne+0}return Oe}(X));const ye=M.createIndexBuffer(Po,!0),ge=M.createVertexBuffer(ie,f.collisionCircleLayout.members,!0);for(const xe of q){const $e={u_matrix:xe.transform,u_inv_matrix:xe.invTransform,u_camera_to_center_distance:(Me=p.transform).cameraToCenterDistance,u_viewport_size:[Me.width,Me.height]};ue.draw(M,S.TRIANGLES,Jt.disabled,cn.disabled,p.colorModeForRenderPass(),$n.disabled,$e,a.id,ge,ye,f.SegmentVector.simpleSegment(0,2*xe.circleOffset,xe.circleArray.length,xe.circleArray.length/2),null,p.transform.zoom,null,null,null)}var Me;ge.destroy(),ye.destroy()}$n.disabled=new $n(!1,1029,2305),$n.backCCW=new $n(!0,1029,2305);const ci=f.identity(new Float32Array(16));function Fo(p,r,a,h,g,v){const{horizontalAlign:D,verticalAlign:M}=f.getAnchorAlignment(p),S=-(D-.5)*r,z=-(M-.5)*a,q=f.evaluateVariableOffset(p,h);return new f.pointGeometry((S/g+q[0])*v,(z/g+q[1])*v)}function ko(p,r,a,h,g,v,D,M,S,z){const q=p.text.placedSymbolArray,X=p.text.dynamicLayoutVertexArray,re=p.icon.dynamicLayoutVertexArray,ue={};X.clear();for(let ie=0;ie<q.length;ie++){const ce=q.get(ie),ye=p.allowVerticalPlacement&&!ce.placedOrientation,ge=ce.hidden||!ce.crossTileID||ye?null:h[ce.crossTileID];if(ge){const Me=new f.pointGeometry(ce.anchorX,ce.anchorY),xe=mt(Me,a?D:v),$e=Qe(g.cameraToCenterDistance,xe.signedDistanceFromCamera);let Oe=f.evaluateSizeForFeature(p.textSizeData,S,ce)*$e/f.ONE_EM;a&&(Oe*=p.tilePixelRatio/M);const{width:Ne,height:Je,anchor:at,textOffset:je,textBoxScale:At}=ge,vt=Fo(at,Ne,Je,je,At,Oe),an=a?mt(Me.add(vt),v).point:xe.point.add(r?vt.rotate(-g.angle):vt),Mn=p.allowVerticalPlacement&&ce.placedOrientation===f.WritingMode.vertical?Math.PI/2:0;for(let In=0;In<ce.numGlyphs;In++)f.addDynamicAttributes(X,an,Mn);z&&ce.associatedIconIndex>=0&&(ue[ce.associatedIconIndex]={shiftedAnchor:an,angle:Mn})}else Yn(ce.numGlyphs,X)}if(z){re.clear();const ie=p.icon.placedSymbolArray;for(let ce=0;ce<ie.length;ce++){const ye=ie.get(ce);if(ye.hidden)Yn(ye.numGlyphs,re);else{const ge=ue[ce];if(ge)for(let Me=0;Me<ye.numGlyphs;Me++)f.addDynamicAttributes(re,ge.shiftedAnchor,ge.angle);else Yn(ye.numGlyphs,re)}}p.icon.dynamicLayoutVertexBuffer.updateData(re)}p.text.dynamicLayoutVertexBuffer.updateData(X)}function Lo(p,r,a){return a.iconsInText&&r?"symbolTextAndIcon":p?"symbolSDF":"symbolIcon"}function hi(p,r,a,h,g,v,D,M,S,z,q,X){const re=p.context,ue=re.gl,ie=p.transform,ce="map"===M,ye="map"===S,ge="viewport"!==M&&"point"!==a.layout.get("symbol-placement"),Me=ce&&!ye&&!ge,xe=!a.layout.get("symbol-sort-key").isConstant();let $e=!1;const Oe=p.depthModeForSublayer(0,Jt.ReadOnly),Ne=a.layout.get("text-variable-anchor"),Je=[];for(const at of h){const je=r.getTile(at),At=je.getBucket(a);if(!At)continue;const vt=g?At.text:At.icon;if(!vt||!vt.segments.get().length)continue;const an=vt.programConfigurations.get(a.id),Mn=g||At.sdfIcons,In=g?At.textSizeData:At.iconSizeData,Ln=ye||0!==ie.pitch,pn=p.useProgram(Lo(Mn,g,At),an),_n=f.evaluateSizeForZoom(In,ie.zoom);let Gn,cr,Di,oo,vo=[0,0],xo=null;if(g){if(cr=je.glyphAtlasTexture,Di=ue.LINEAR,Gn=je.glyphAtlasTexture.size,At.iconsInText){vo=je.imageAtlasTexture.size,xo=je.imageAtlasTexture;const eo="composite"===In.kind||"camera"===In.kind;oo=Ln||p.options.rotating||p.options.zooming||eo?ue.LINEAR:ue.NEAREST}}else{const eo=1!==a.layout.get("icon-size").constantOr(0)||At.iconsNeedLinear;cr=je.imageAtlasTexture,Di=Mn||p.options.rotating||p.options.zooming||eo||Ln?ue.LINEAR:ue.NEAREST,Gn=je.imageAtlasTexture.size}const so=Jn(je,1,p.transform.zoom),Qi=lr(at.posMatrix,ye,ce,p.transform,so),Zo=Wn(at.posMatrix,ye,ce,p.transform,so),vr=Ne&&At.hasTextData(),Ai="none"!==a.layout.get("icon-text-fit")&&vr&&At.hasIconData();if(ge){const eo="map"===a.layout.get("text-rotation-alignment");_t(At,at.posMatrix,p,g,Qi,Zo,ye,z,eo)}const Rn=p.translatePosMatrix(at.posMatrix,je,v,D),er=ge||g&&Ne||Ai?ci:Qi,Gr=p.translatePosMatrix(Zo,je,v,D,!0),dr=Mn&&0!==a.paint.get(g?"text-halo-width":"icon-halo-width").constantOr(1);let Hn;Hn=Mn?At.iconsInText?Ws(In.kind,_n,Me,ye,p,Rn,er,Gr,Gn,vo):ti(In.kind,_n,Me,ye,p,Rn,er,Gr,g,Gn,!0):fo(In.kind,_n,Me,ye,p,Rn,er,Gr,g,Gn);const hs={program:pn,buffers:vt,uniformValues:Hn,atlasTexture:cr,atlasTextureIcon:xo,atlasInterpolation:Di,atlasInterpolationIcon:oo,isSDF:Mn,hasHalo:dr};if(xe&&At.canOverlap){$e=!0;const eo=vt.segments.get();for(const ds of eo)Je.push({segments:new f.SegmentVector([ds]),sortKey:ds.sortKey,state:hs})}else Je.push({segments:vt.segments,sortKey:0,state:hs})}$e&&Je.sort((at,je)=>at.sortKey-je.sortKey);for(const at of Je){const je=at.state;if(re.activeTexture.set(ue.TEXTURE0),je.atlasTexture.bind(je.atlasInterpolation,ue.CLAMP_TO_EDGE),je.atlasTextureIcon&&(re.activeTexture.set(ue.TEXTURE1),je.atlasTextureIcon&&je.atlasTextureIcon.bind(je.atlasInterpolationIcon,ue.CLAMP_TO_EDGE)),je.isSDF){const At=je.uniformValues;je.hasHalo&&(At.u_is_halo=1,Cs(je.buffers,at.segments,a,p,je.program,Oe,q,X,At)),At.u_is_halo=0}Cs(je.buffers,at.segments,a,p,je.program,Oe,q,X,je.uniformValues)}}function Cs(p,r,a,h,g,v,D,M,S){const z=h.context;g.draw(z,z.gl.TRIANGLES,v,D,M,$n.disabled,S,a.id,p.layoutVertexBuffer,p.indexBuffer,r,a.paint,h.transform.zoom,p.programConfigurations.get(a.id),p.dynamicLayoutVertexBuffer,p.opacityVertexBuffer)}function Es(p,r,a,h,g,v,D){const M=p.context.gl,S=a.paint.get("fill-pattern"),z=S&&S.constantOr(1),q=a.getCrossfadeParameters();let X,re,ue,ie,ce;D?(re=z&&!a.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",X=M.LINES):(re=z?"fillPattern":"fill",X=M.TRIANGLES);for(const ye of h){const ge=r.getTile(ye);if(z&&!ge.patternsLoaded())continue;const Me=ge.getBucket(a);if(!Me)continue;const xe=Me.programConfigurations.get(a.id),$e=p.useProgram(re,xe);z&&(p.context.activeTexture.set(M.TEXTURE0),ge.imageAtlasTexture.bind(M.LINEAR,M.CLAMP_TO_EDGE),xe.updatePaintBuffers(q));const Oe=S.constantOr(null);if(Oe&&ge.imageAtlas){const Je=ge.imageAtlas,at=Je.patternPositions[Oe.to.toString()],je=Je.patternPositions[Oe.from.toString()];at&&je&&xe.setConstantPatternPositions(at,je)}const Ne=p.translatePosMatrix(ye.posMatrix,ge,a.paint.get("fill-translate"),a.paint.get("fill-translate-anchor"));if(D){ie=Me.indexBuffer2,ce=Me.segments2;const Je=[M.drawingBufferWidth,M.drawingBufferHeight];ue="fillOutlinePattern"===re&&z?_s(Ne,p,q,ge,Je):Io(Ne,Je)}else ie=Me.indexBuffer,ce=Me.segments,ue=z?Hr(Ne,p,q,ge):vi(Ne);$e.draw(p.context,X,g,p.stencilModeForClipping(ye),v,$n.disabled,ue,a.id,Me.layoutVertexBuffer,ie,ce,a.paint,p.transform.zoom,xe)}}function Ms(p,r,a,h,g,v,D){const M=p.context,S=M.gl,z=a.paint.get("fill-extrusion-pattern"),q=z.constantOr(1),X=a.getCrossfadeParameters(),re=a.paint.get("fill-extrusion-opacity");for(const ue of h){const ie=r.getTile(ue),ce=ie.getBucket(a);if(!ce)continue;const ye=ce.programConfigurations.get(a.id),ge=p.useProgram(q?"fillExtrusionPattern":"fillExtrusion",ye);q&&(p.context.activeTexture.set(S.TEXTURE0),ie.imageAtlasTexture.bind(S.LINEAR,S.CLAMP_TO_EDGE),ye.updatePaintBuffers(X));const Me=z.constantOr(null);if(Me&&ie.imageAtlas){const Ne=ie.imageAtlas,Je=Ne.patternPositions[Me.to.toString()],at=Ne.patternPositions[Me.from.toString()];Je&&at&&ye.setConstantPatternPositions(Je,at)}const xe=p.translatePosMatrix(ue.posMatrix,ie,a.paint.get("fill-extrusion-translate"),a.paint.get("fill-extrusion-translate-anchor")),$e=a.paint.get("fill-extrusion-vertical-gradient"),Oe=q?Wi(xe,p,$e,re,ue,X,ie):zr(xe,p,$e,re);ge.draw(M,M.gl.TRIANGLES,g,v,D,$n.backCCW,Oe,a.id,ce.layoutVertexBuffer,ce.indexBuffer,ce.segments,a.paint,p.transform.zoom,ye)}}function Ki(p,r,a,h,g,v){const D=p.context,M=D.gl,S=r.fbo;if(!S)return;const z=p.useProgram("hillshade");D.activeTexture.set(M.TEXTURE0),M.bindTexture(M.TEXTURE_2D,S.colorAttachment.get());const q=((X,re,ue)=>{const ie=ue.paint.get("hillshade-shadow-color"),ce=ue.paint.get("hillshade-highlight-color"),ye=ue.paint.get("hillshade-accent-color");let ge=ue.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===ue.paint.get("hillshade-illumination-anchor")&&(ge-=X.transform.angle);const Me=!X.options.moving;return{u_matrix:X.transform.calculatePosMatrix(re.tileID.toUnwrapped(),Me),u_image:0,u_latrange:So(0,re.tileID),u_light:[ue.paint.get("hillshade-exaggeration"),ge],u_shadow:ie,u_highlight:ce,u_accent:ye}})(p,r,a);z.draw(D,M.TRIANGLES,h,g,v,$n.disabled,q,a.id,p.rasterBoundsBuffer,p.quadTriangleIndexBuffer,p.rasterBoundsSegments)}function Xi(p,r,a,h,g,v){const D=p.context,M=D.gl,S=r.dem;if(S&&S.data){const z=S.dim,q=S.stride,X=S.getPixels();if(D.activeTexture.set(M.TEXTURE1),D.pixelStoreUnpackPremultiplyAlpha.set(!1),r.demTexture=r.demTexture||p.getTileTexture(q),r.demTexture){const ue=r.demTexture;ue.update(X,{premultiply:!1}),ue.bind(M.NEAREST,M.CLAMP_TO_EDGE)}else r.demTexture=new Gt(D,X,M.RGBA,{premultiply:!1}),r.demTexture.bind(M.NEAREST,M.CLAMP_TO_EDGE);D.activeTexture.set(M.TEXTURE0);let re=r.fbo;if(!re){const ue=new Gt(D,{width:z,height:z,data:null},M.RGBA);ue.bind(M.LINEAR,M.CLAMP_TO_EDGE),re=r.fbo=D.createFramebuffer(z,z,!0),re.colorAttachment.set(ue.texture)}D.bindFramebuffer.set(re.framebuffer),D.viewport.set([0,0,z,z]),p.useProgram("hillshadePrepare").draw(D,M.TRIANGLES,h,g,v,$n.disabled,((ue,ie)=>{const ce=ie.stride,ye=f.create();return f.ortho(ye,0,f.EXTENT,-f.EXTENT,0,0,1),f.translate(ye,ye,[0,-f.EXTENT,0]),{u_matrix:ye,u_image:1,u_dimension:[ce,ce],u_zoom:ue.overscaledZ,u_unpack:ie.getUnpackVector()}})(r.tileID,S),a.id,p.rasterBoundsBuffer,p.quadTriangleIndexBuffer,p.rasterBoundsSegments),r.needsHillshadePrepare=!1}}function Ta(p,r,a,h,g){const v=h.paint.get("raster-fade-duration");if(v>0){const D=f.exported.now(),M=(D-p.timeAdded)/v,S=r?(D-r.timeAdded)/v:-1,z=a.getSource(),q=g.coveringZoomLevel({tileSize:z.tileSize,roundZoom:z.roundZoom}),X=!r||Math.abs(r.tileID.overscaledZ-q)>Math.abs(p.tileID.overscaledZ-q),re=X&&p.refreshedUponExpiration?1:f.clamp(X?M:1-S,0,1);return p.refreshedUponExpiration&&M>=1&&(p.refreshedUponExpiration=!1),r?{opacity:1,mix:1-re}:{opacity:re,mix:0}}return{opacity:1,mix:0}}const gn=new f.Color(1,0,0,1),el=new f.Color(0,1,0,1),ia=new f.Color(0,0,1,1),Pa=new f.Color(1,0,1,1),tl=new f.Color(0,1,1,1);function Cl(p,r,a,h){A(p,0,r+a/2,p.transform.width,a,h)}function F(p,r,a,h){A(p,r-a/2,0,a,p.transform.height,h)}function A(p,r,a,h,g,v){const D=p.context,M=D.gl;M.enable(M.SCISSOR_TEST),M.scissor(r*p.pixelRatio,a*p.pixelRatio,h*p.pixelRatio,g*p.pixelRatio),D.clear({color:v}),M.disable(M.SCISSOR_TEST)}function I(p,r,a){const h=p.context,g=h.gl,v=a.posMatrix,D=p.useProgram("debug"),M=Jt.disabled,S=cn.disabled,z=p.colorModeForRenderPass(),q="$debug";h.activeTexture.set(g.TEXTURE0),p.emptyTexture.bind(g.LINEAR,g.CLAMP_TO_EDGE),D.draw(h,g.LINE_STRIP,M,S,z,$n.disabled,ho(v,f.Color.red),q,p.debugBuffer,p.tileBorderIndexBuffer,p.debugSegments);const X=r.getTileByID(a.key).latestRawTileData,re=Math.floor((X&&X.byteLength||0)/1024),ue=r.getTile(a).tileSize,ie=512/Math.min(ue,512)*(a.overscaledZ/p.transform.zoom)*.5;let ce=a.canonical.toString();a.overscaledZ!==a.canonical.z&&(ce+=` => ${a.overscaledZ}`),function(ye,ge){ye.initDebugOverlayCanvas();const Me=ye.debugOverlayCanvas,xe=ye.context.gl,$e=ye.debugOverlayCanvas.getContext("2d");$e.clearRect(0,0,Me.width,Me.height),$e.shadowColor="white",$e.shadowBlur=2,$e.lineWidth=1.5,$e.strokeStyle="white",$e.textBaseline="top",$e.font="bold 36px Open Sans, sans-serif",$e.fillText(ge,5,5),$e.strokeText(ge,5,5),ye.debugOverlayTexture.update(Me),ye.debugOverlayTexture.bind(xe.LINEAR,xe.CLAMP_TO_EDGE)}(p,`${ce} ${re}kb`),D.draw(h,g.TRIANGLES,M,S,gt.alphaBlended,$n.disabled,ho(v,f.Color.transparent,ie),q,p.debugBuffer,p.quadTriangleIndexBuffer,p.debugSegments)}const j={symbol:function(p,r,a,h,g){if("translucent"!==p.renderPass)return;const v=cn.disabled,D=p.colorModeForRenderPass();a.layout.get("text-variable-anchor")&&function(M,S,z,q,X,re,ue){const ie=S.transform,ce="map"===X,ye="map"===re;for(const ge of M){const Me=q.getTile(ge),xe=Me.getBucket(z);if(!xe||!xe.text||!xe.text.segments.get().length)continue;const $e=f.evaluateSizeForZoom(xe.textSizeData,ie.zoom),Oe=Jn(Me,1,S.transform.zoom),Ne=lr(ge.posMatrix,ye,ce,S.transform,Oe),Je="none"!==z.layout.get("icon-text-fit")&&xe.hasIconData();if($e){const at=Math.pow(2,ie.zoom-Me.tileID.overscaledZ);ko(xe,ce,ye,ue,ie,Ne,ge.posMatrix,at,$e,Je)}}}(h,p,a,r,a.layout.get("text-rotation-alignment"),a.layout.get("text-pitch-alignment"),g),0!==a.paint.get("icon-opacity").constantOr(1)&&hi(p,r,a,h,!1,a.paint.get("icon-translate"),a.paint.get("icon-translate-anchor"),a.layout.get("icon-rotation-alignment"),a.layout.get("icon-pitch-alignment"),a.layout.get("icon-keep-upright"),v,D),0!==a.paint.get("text-opacity").constantOr(1)&&hi(p,r,a,h,!0,a.paint.get("text-translate"),a.paint.get("text-translate-anchor"),a.layout.get("text-rotation-alignment"),a.layout.get("text-pitch-alignment"),a.layout.get("text-keep-upright"),v,D),r.map.showCollisionBoxes&&(bi(p,r,a,h,a.paint.get("text-translate"),a.paint.get("text-translate-anchor"),!0),bi(p,r,a,h,a.paint.get("icon-translate"),a.paint.get("icon-translate-anchor"),!1))},circle:function(p,r,a,h){if("translucent"!==p.renderPass)return;const g=a.paint.get("circle-opacity"),v=a.paint.get("circle-stroke-width"),D=a.paint.get("circle-stroke-opacity"),M=!a.layout.get("circle-sort-key").isConstant();if(0===g.constantOr(1)&&(0===v.constantOr(1)||0===D.constantOr(1)))return;const S=p.context,z=S.gl,q=p.depthModeForSublayer(0,Jt.ReadOnly),X=cn.disabled,re=p.colorModeForRenderPass(),ue=[];for(let ie=0;ie<h.length;ie++){const ce=h[ie],ye=r.getTile(ce),ge=ye.getBucket(a);if(!ge)continue;const Me=ge.programConfigurations.get(a.id),xe={programConfiguration:Me,program:p.useProgram("circle",Me),layoutVertexBuffer:ge.layoutVertexBuffer,indexBuffer:ge.indexBuffer,uniformValues:Pn(p,ce,ye,a)};if(M){const $e=ge.segments.get();for(const Oe of $e)ue.push({segments:new f.SegmentVector([Oe]),sortKey:Oe.sortKey,state:xe})}else ue.push({segments:ge.segments,sortKey:0,state:xe})}M&&ue.sort((ie,ce)=>ie.sortKey-ce.sortKey);for(const ie of ue){const{programConfiguration:ce,program:ye,layoutVertexBuffer:ge,indexBuffer:Me,uniformValues:xe}=ie.state;ye.draw(S,z.TRIANGLES,q,X,re,$n.disabled,xe,a.id,ge,Me,ie.segments,a.paint,p.transform.zoom,ce)}},heatmap:function(p,r,a,h){if(0!==a.paint.get("heatmap-opacity"))if("offscreen"===p.renderPass){const g=p.context,v=g.gl,D=cn.disabled,M=new gt([v.ONE,v.ONE],f.Color.transparent,[!0,!0,!0,!0]);(function(S,z,q){const X=S.gl;S.activeTexture.set(X.TEXTURE1),S.viewport.set([0,0,z.width/4,z.height/4]);let re=q.heatmapFbo;if(re)X.bindTexture(X.TEXTURE_2D,re.colorAttachment.get()),S.bindFramebuffer.set(re.framebuffer);else{const ue=X.createTexture();X.bindTexture(X.TEXTURE_2D,ue),X.texParameteri(X.TEXTURE_2D,X.TEXTURE_WRAP_S,X.CLAMP_TO_EDGE),X.texParameteri(X.TEXTURE_2D,X.TEXTURE_WRAP_T,X.CLAMP_TO_EDGE),X.texParameteri(X.TEXTURE_2D,X.TEXTURE_MIN_FILTER,X.LINEAR),X.texParameteri(X.TEXTURE_2D,X.TEXTURE_MAG_FILTER,X.LINEAR),re=q.heatmapFbo=S.createFramebuffer(z.width/4,z.height/4,!1),function(ie,ce,ye,ge){const Me=ie.gl;Me.texImage2D(Me.TEXTURE_2D,0,Me.RGBA,ce.width/4,ce.height/4,0,Me.RGBA,ie.extRenderToTextureHalfFloat?ie.extTextureHalfFloat.HALF_FLOAT_OES:Me.UNSIGNED_BYTE,null),ge.colorAttachment.set(ye)}(S,z,ue,re)}})(g,p,a),g.clear({color:f.Color.transparent});for(let S=0;S<h.length;S++){const z=h[S];if(r.hasRenderableParent(z))continue;const q=r.getTile(z),X=q.getBucket(a);if(!X)continue;const re=X.programConfigurations.get(a.id),ue=p.useProgram("heatmap",re),{zoom:ie}=p.transform;ue.draw(g,v.TRIANGLES,Jt.disabled,D,M,$n.disabled,po(z.posMatrix,q,ie,a.paint.get("heatmap-intensity")),a.id,X.layoutVertexBuffer,X.indexBuffer,X.segments,a.paint,p.transform.zoom,re)}g.viewport.set([0,0,p.width,p.height])}else"translucent"===p.renderPass&&(p.context.setColorMode(p.colorModeForRenderPass()),function(g,v){const D=g.context,M=D.gl,S=v.heatmapFbo;if(!S)return;D.activeTexture.set(M.TEXTURE0),M.bindTexture(M.TEXTURE_2D,S.colorAttachment.get()),D.activeTexture.set(M.TEXTURE1);let z=v.colorRampTexture;z||(z=v.colorRampTexture=new Gt(D,v.colorRamp,M.RGBA)),z.bind(M.LINEAR,M.CLAMP_TO_EDGE),g.useProgram("heatmapTexture").draw(D,M.TRIANGLES,Jt.disabled,cn.disabled,g.colorModeForRenderPass(),$n.disabled,((q,X,re,ue)=>{const ie=f.create();f.ortho(ie,0,q.width,q.height,0,0,1);const ce=q.context.gl;return{u_matrix:ie,u_world:[ce.drawingBufferWidth,ce.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:X.paint.get("heatmap-opacity")}})(g,v),v.id,g.viewportBuffer,g.quadTriangleIndexBuffer,g.viewportSegments,v.paint,g.transform.zoom)}(p,a))},line:function(p,r,a,h){if("translucent"!==p.renderPass)return;const g=a.paint.get("line-opacity"),v=a.paint.get("line-width");if(0===g.constantOr(1)||0===v.constantOr(1))return;const D=p.depthModeForSublayer(0,Jt.ReadOnly),M=p.colorModeForRenderPass(),S=a.paint.get("line-dasharray"),z=a.paint.get("line-pattern"),q=z.constantOr(1),X=a.paint.get("line-gradient"),re=a.getCrossfadeParameters(),ue=q?"linePattern":S?"lineSDF":X?"lineGradient":"line",ie=p.context,ce=ie.gl;let ye=!0;for(const ge of h){const Me=r.getTile(ge);if(q&&!Me.patternsLoaded())continue;const xe=Me.getBucket(a);if(!xe)continue;const $e=xe.programConfigurations.get(a.id),Oe=p.context.program.get(),Ne=p.useProgram(ue,$e),Je=ye||Ne.program!==Oe,at=z.constantOr(null);if(at&&Me.imageAtlas){const At=Me.imageAtlas,vt=At.patternPositions[at.to.toString()],an=At.patternPositions[at.from.toString()];vt&&an&&$e.setConstantPatternPositions(vt,an)}const je=q?Ir(p,Me,a,re):S?Sr(p,Me,a,S,re):X?Mi(p,Me,a,xe.lineClipsArray.length):kr(p,Me,a);if(q)ie.activeTexture.set(ce.TEXTURE0),Me.imageAtlasTexture.bind(ce.LINEAR,ce.CLAMP_TO_EDGE),$e.updatePaintBuffers(re);else if(S&&(Je||p.lineAtlas.dirty))ie.activeTexture.set(ce.TEXTURE0),p.lineAtlas.bind(ie);else if(X){const At=xe.gradients[a.id];let vt=At.texture;if(a.gradientVersion!==At.version){let an=256;if(a.stepInterpolant){const Mn=r.getSource().maxzoom,In=ge.canonical.z===Mn?Math.ceil(1<<p.transform.maxZoom-ge.canonical.z):1;an=f.clamp(f.nextPowerOfTwo(xe.maxLineLength/f.EXTENT*1024*In),256,ie.maxTextureSize)}At.gradient=f.renderColorRamp({expression:a.gradientExpression(),evaluationKey:"lineProgress",resolution:an,image:At.gradient||void 0,clips:xe.lineClipsArray}),At.texture?At.texture.update(At.gradient):At.texture=new Gt(ie,At.gradient,ce.RGBA),At.version=a.gradientVersion,vt=At.texture}ie.activeTexture.set(ce.TEXTURE0),vt.bind(a.stepInterpolant?ce.NEAREST:ce.LINEAR,ce.CLAMP_TO_EDGE)}Ne.draw(ie,ce.TRIANGLES,D,p.stencilModeForClipping(ge),M,$n.disabled,je,a.id,xe.layoutVertexBuffer,xe.indexBuffer,xe.segments,a.paint,p.transform.zoom,$e,xe.layoutVertexBuffer2),ye=!1}},fill:function(p,r,a,h){const g=a.paint.get("fill-color"),v=a.paint.get("fill-opacity");if(0===v.constantOr(1))return;const D=p.colorModeForRenderPass(),M=a.paint.get("fill-pattern"),S=p.opaquePassEnabledForLayer()&&!M.constantOr(1)&&1===g.constantOr(f.Color.transparent).a&&1===v.constantOr(0)?"opaque":"translucent";if(p.renderPass===S){const z=p.depthModeForSublayer(1,"opaque"===p.renderPass?Jt.ReadWrite:Jt.ReadOnly);Es(p,r,a,h,z,D,!1)}if("translucent"===p.renderPass&&a.paint.get("fill-antialias")){const z=p.depthModeForSublayer(a.getPaintProperty("fill-outline-color")?2:0,Jt.ReadOnly);Es(p,r,a,h,z,D,!0)}},"fill-extrusion":function(p,r,a,h){const g=a.paint.get("fill-extrusion-opacity");if(0!==g&&"translucent"===p.renderPass){const v=new Jt(p.context.gl.LEQUAL,Jt.ReadWrite,p.depthRangeFor3D);if(1!==g||a.paint.get("fill-extrusion-pattern").constantOr(1))Ms(p,r,a,h,v,cn.disabled,gt.disabled),Ms(p,r,a,h,v,p.stencilModeFor3D(),p.colorModeForRenderPass());else{const D=p.colorModeForRenderPass();Ms(p,r,a,h,v,cn.disabled,D)}}},hillshade:function(p,r,a,h){if("offscreen"!==p.renderPass&&"translucent"!==p.renderPass)return;const g=p.context,v=p.depthModeForSublayer(0,Jt.ReadOnly),D=p.colorModeForRenderPass(),[M,S]="translucent"===p.renderPass?p.stencilConfigForOverlap(h):[{},h];for(const z of S){const q=r.getTile(z);q.needsHillshadePrepare&&"offscreen"===p.renderPass?Xi(p,q,a,v,cn.disabled,D):"translucent"===p.renderPass&&Ki(p,q,a,v,M[z.overscaledZ],D)}g.viewport.set([0,0,p.width,p.height])},raster:function(p,r,a,h){if("translucent"!==p.renderPass||0===a.paint.get("raster-opacity")||!h.length)return;const g=p.context,v=g.gl,D=r.getSource(),M=p.useProgram("raster"),S=p.colorModeForRenderPass(),[z,q]=D instanceof fr?[{},h]:p.stencilConfigForOverlap(h),X=q[q.length-1].overscaledZ,re=!p.options.moving;for(const ue of q){const ie=p.depthModeForSublayer(ue.overscaledZ-X,1===a.paint.get("raster-opacity")?Jt.ReadWrite:Jt.ReadOnly,v.LESS),ce=r.getTile(ue),ye=p.transform.calculatePosMatrix(ue.toUnwrapped(),re);ce.registerFadeDuration(a.paint.get("raster-fade-duration"));const ge=r.findLoadedParent(ue,0),Me=Ta(ce,ge,r,a,p.transform);let xe,$e;const Oe="nearest"===a.paint.get("raster-resampling")?v.NEAREST:v.LINEAR;g.activeTexture.set(v.TEXTURE0),ce.texture.bind(Oe,v.CLAMP_TO_EDGE,v.LINEAR_MIPMAP_NEAREST),g.activeTexture.set(v.TEXTURE1),ge?(ge.texture.bind(Oe,v.CLAMP_TO_EDGE,v.LINEAR_MIPMAP_NEAREST),xe=Math.pow(2,ge.tileID.overscaledZ-ce.tileID.overscaledZ),$e=[ce.tileID.canonical.x*xe%1,ce.tileID.canonical.y*xe%1]):ce.texture.bind(Oe,v.CLAMP_TO_EDGE,v.LINEAR_MIPMAP_NEAREST);const Ne=ts(ye,$e||[0,0],xe||1,Me,a);D instanceof fr?M.draw(g,v.TRIANGLES,ie,cn.disabled,S,$n.disabled,Ne,a.id,D.boundsBuffer,p.quadTriangleIndexBuffer,D.boundsSegments):M.draw(g,v.TRIANGLES,ie,z[ue.overscaledZ],S,$n.disabled,Ne,a.id,p.rasterBoundsBuffer,p.quadTriangleIndexBuffer,p.rasterBoundsSegments)}},background:function(p,r,a){const h=a.paint.get("background-color"),g=a.paint.get("background-opacity");if(0===g)return;const v=p.context,D=v.gl,M=p.transform,S=M.tileSize,z=a.paint.get("background-pattern");if(p.isPatternMissing(z))return;const q=!z&&1===h.a&&1===g&&p.opaquePassEnabledForLayer()?"opaque":"translucent";if(p.renderPass!==q)return;const X=cn.disabled,re=p.depthModeForSublayer(0,"opaque"===q?Jt.ReadWrite:Jt.ReadOnly),ue=p.colorModeForRenderPass(),ie=p.useProgram(z?"backgroundPattern":"background"),ce=M.coveringTiles({tileSize:S});z&&(v.activeTexture.set(D.TEXTURE0),p.imageManager.bind(p.context));const ye=a.getCrossfadeParameters();for(const ge of ce){const Me=p.transform.calculatePosMatrix(ge.toUnwrapped()),xe=z?vs(Me,g,p,z,{tileID:ge,tileSize:S},ye):Ja(Me,g,h);ie.draw(v,D.TRIANGLES,re,X,ue,$n.disabled,xe,a.id,p.tileExtentBuffer,p.quadTriangleIndexBuffer,p.tileExtentSegments)}},debug:function(p,r,a){for(let h=0;h<a.length;h++)I(p,r,a[h])},custom:function(p,r,a){const h=p.context,g=a.implementation;if("offscreen"===p.renderPass){const v=g.prerender;v&&(p.setCustomLayerDefaults(),h.setColorMode(p.colorModeForRenderPass()),v.call(g,h.gl,p.transform.customLayerMatrix()),h.setDirty(),p.setBaseState())}else if("translucent"===p.renderPass){p.setCustomLayerDefaults(),h.setColorMode(p.colorModeForRenderPass()),h.setStencilMode(cn.disabled);const v="3d"===g.renderingMode?new Jt(p.context.gl.LEQUAL,Jt.ReadWrite,p.depthRangeFor3D):p.depthModeForSublayer(0,Jt.ReadOnly);h.setDepthMode(v),g.render(h.gl,p.transform.customLayerMatrix()),h.setDirty(),p.setBaseState(),h.bindFramebuffer.set(null)}}};class Ie{constructor(r,a){this.context=new xn(r),this.transform=a,this._tileTextures={},this.setup(),this.numSublayers=mr.maxUnderzooming+mr.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new St,this.gpuTimers={}}resize(r,a,h){if(this.width=r*h,this.height=a*h,this.pixelRatio=h,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const g of this.style._order)this.style._layers[g].resize()}setup(){const r=this.context,a=new f.PosArray;a.emplaceBack(0,0),a.emplaceBack(f.EXTENT,0),a.emplaceBack(0,f.EXTENT),a.emplaceBack(f.EXTENT,f.EXTENT),this.tileExtentBuffer=r.createVertexBuffer(a,io.members),this.tileExtentSegments=f.SegmentVector.simpleSegment(0,0,4,2);const h=new f.PosArray;h.emplaceBack(0,0),h.emplaceBack(f.EXTENT,0),h.emplaceBack(0,f.EXTENT),h.emplaceBack(f.EXTENT,f.EXTENT),this.debugBuffer=r.createVertexBuffer(h,io.members),this.debugSegments=f.SegmentVector.simpleSegment(0,0,4,5);const g=new f.RasterBoundsArray;g.emplaceBack(0,0,0,0),g.emplaceBack(f.EXTENT,0,f.EXTENT,0),g.emplaceBack(0,f.EXTENT,0,f.EXTENT),g.emplaceBack(f.EXTENT,f.EXTENT,f.EXTENT,f.EXTENT),this.rasterBoundsBuffer=r.createVertexBuffer(g,An.members),this.rasterBoundsSegments=f.SegmentVector.simpleSegment(0,0,4,2);const v=new f.PosArray;v.emplaceBack(0,0),v.emplaceBack(1,0),v.emplaceBack(0,1),v.emplaceBack(1,1),this.viewportBuffer=r.createVertexBuffer(v,io.members),this.viewportSegments=f.SegmentVector.simpleSegment(0,0,4,2);const D=new f.LineStripIndexArray;D.emplaceBack(0),D.emplaceBack(1),D.emplaceBack(3),D.emplaceBack(2),D.emplaceBack(0),this.tileBorderIndexBuffer=r.createIndexBuffer(D);const M=new f.TriangleIndexArray;M.emplaceBack(0,1,2),M.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=r.createIndexBuffer(M),this.emptyTexture=new Gt(r,{width:1,height:1,data:new Uint8Array([0,0,0,0])},r.gl.RGBA);const S=this.context.gl;this.stencilClearMode=new cn({func:S.ALWAYS,mask:0},0,255,S.ZERO,S.ZERO,S.ZERO)}clearStencil(){const r=this.context,a=r.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const h=f.create();f.ortho(h,0,this.width,this.height,0,0,1),f.scale(h,h,[a.drawingBufferWidth,a.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(r,a.TRIANGLES,Jt.disabled,this.stencilClearMode,gt.disabled,$n.disabled,Yi(h),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(r,a){if(this.currentStencilSource===r.source||!r.isTileClipped()||!a||!a.length)return;this.currentStencilSource=r.source;const h=this.context,g=h.gl;this.nextStencilID+a.length>256&&this.clearStencil(),h.setColorMode(gt.disabled),h.setDepthMode(Jt.disabled);const v=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const D of a){const M=this._tileClippingMaskIDs[D.key]=this.nextStencilID++;v.draw(h,g.TRIANGLES,Jt.disabled,new cn({func:g.ALWAYS,mask:0},M,255,g.KEEP,g.KEEP,g.REPLACE),gt.disabled,$n.disabled,Yi(D.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const r=this.nextStencilID++,a=this.context.gl;return new cn({func:a.NOTEQUAL,mask:255},r,255,a.KEEP,a.KEEP,a.REPLACE)}stencilModeForClipping(r){const a=this.context.gl;return new cn({func:a.EQUAL,mask:255},this._tileClippingMaskIDs[r.key],0,a.KEEP,a.KEEP,a.REPLACE)}stencilConfigForOverlap(r){const a=this.context.gl,h=r.sort((D,M)=>M.overscaledZ-D.overscaledZ),g=h[h.length-1].overscaledZ,v=h[0].overscaledZ-g+1;if(v>1){this.currentStencilSource=void 0,this.nextStencilID+v>256&&this.clearStencil();const D={};for(let M=0;M<v;M++)D[M+g]=new cn({func:a.GEQUAL,mask:255},M+this.nextStencilID,255,a.KEEP,a.KEEP,a.REPLACE);return this.nextStencilID+=v,[D,h]}return[{[g]:cn.disabled},h]}colorModeForRenderPass(){const r=this.context.gl;return this._showOverdrawInspector?new gt([r.CONSTANT_COLOR,r.ONE],new f.Color(.125,.125,.125,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?gt.unblended:gt.alphaBlended}depthModeForSublayer(r,a,h){if(!this.opaquePassEnabledForLayer())return Jt.disabled;const g=1-((1+this.currentLayer)*this.numSublayers+r)*this.depthEpsilon;return new Jt(h||this.context.gl.LEQUAL,a,[g,g])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(r,a){this.style=r,this.options=a,this.lineAtlas=r.lineAtlas,this.imageManager=r.imageManager,this.glyphManager=r.glyphManager,this.symbolFadeChange=r.placement.symbolFadeChange(f.exported.now()),this.imageManager.beginFrame();const h=this.style._order,g=this.style.sourceCaches;for(const S in g){const z=g[S];z.used&&z.prepare(this.context)}const v={},D={},M={};for(const S in g){const z=g[S];v[S]=z.getVisibleCoordinates(),D[S]=v[S].slice().reverse(),M[S]=z.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let S=0;S<h.length;S++)if(this.style._layers[h[S]].is3D()){this.opaquePassCutoff=S;break}this.renderPass="offscreen";for(const S of h){const z=this.style._layers[S];if(!z.hasOffscreenPass()||z.isHidden(this.transform.zoom))continue;const q=D[z.source];("custom"===z.type||q.length)&&this.renderLayer(this,g[z.source],z,q)}for(this.context.bindFramebuffer.set(null),this.context.clear({color:a.showOverdrawInspector?f.Color.black:f.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=a.showOverdrawInspector,this.depthRangeFor3D=[0,1-(r._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=h.length-1;this.currentLayer>=0;this.currentLayer--){const S=this.style._layers[h[this.currentLayer]],z=g[S.source],q=v[S.source];this._renderTileClippingMasks(S,q),this.renderLayer(this,z,S,q)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<h.length;this.currentLayer++){const S=this.style._layers[h[this.currentLayer]],z=g[S.source],q=("symbol"===S.type?M:D)[S.source];this._renderTileClippingMasks(S,v[S.source]),this.renderLayer(this,z,S,q)}if(this.options.showTileBoundaries){let S,z;Object.values(this.style._layers).forEach(q=>{q.source&&!q.isHidden(this.transform.zoom)&&(q.source!==(z&&z.id)&&(z=this.style.sourceCaches[q.source]),(!S||S.getSource().maxzoom<z.getSource().maxzoom)&&(S=z))}),S&&j.debug(this,S,S.getVisibleCoordinates())}this.options.showPadding&&function(S){const z=S.transform.padding;Cl(S,S.transform.height-(z.top||0),3,gn),Cl(S,z.bottom||0,3,el),F(S,z.left||0,3,ia),F(S,S.transform.width-(z.right||0),3,Pa);const q=S.transform.centerPoint;var X,re,ue,ie;A(X=S,(re=q.x)-1,(ue=S.transform.height-q.y)-10,2,20,ie=tl),A(X,re-10,ue-1,20,2,ie)}(this),this.context.setDefault()}renderLayer(r,a,h,g){h.isHidden(this.transform.zoom)||("background"===h.type||"custom"===h.type||g.length)&&(this.id=h.id,this.gpuTimingStart(h),j[h.type](r,a,h,g,this.style.placement.variableOffsets),this.gpuTimingEnd())}gpuTimingStart(r){if(!this.options.gpuTiming)return;const a=this.context.extTimerQuery;let h=this.gpuTimers[r.id];h||(h=this.gpuTimers[r.id]={calls:0,cpuTime:0,query:a.createQueryEXT()}),h.calls++,a.beginQueryEXT(a.TIME_ELAPSED_EXT,h.query)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const r=this.context.extTimerQuery;r.endQueryEXT(r.TIME_ELAPSED_EXT)}collectGpuTimers(){const r=this.gpuTimers;return this.gpuTimers={},r}queryGpuTimers(r){const a={};for(const h in r){const g=r[h],v=this.context.extTimerQuery,D=v.getQueryObjectEXT(g.query,v.QUERY_RESULT_EXT)/1e6;v.deleteQueryEXT(g.query),a[h]=D}return a}translatePosMatrix(r,a,h,g,v){if(!h[0]&&!h[1])return r;const D=v?"map"===g?this.transform.angle:0:"viewport"===g?-this.transform.angle:0;if(D){const z=Math.sin(D),q=Math.cos(D);h=[h[0]*q-h[1]*z,h[0]*z+h[1]*q]}const M=[v?h[0]:Jn(a,h[0],this.transform.zoom),v?h[1]:Jn(a,h[1],this.transform.zoom),0],S=new Float32Array(16);return f.translate(S,r,M),S}saveTileTexture(r){const a=this._tileTextures[r.size[0]];a?a.push(r):this._tileTextures[r.size[0]]=[r]}getTileTexture(r){const a=this._tileTextures[r];return a&&a.length>0?a.pop():null}isPatternMissing(r){if(!r)return!1;if(!r.from||!r.to)return!0;const a=this.imageManager.getPattern(r.from.toString()),h=this.imageManager.getPattern(r.to.toString());return!a||!h}useProgram(r,a){this.cache=this.cache||{};const h=`${r}${a?a.cacheKey:""}${this._showOverdrawInspector?"/overdraw":""}`;return this.cache[h]||(this.cache[h]=new Ma(this.context,r,Zi[r],a,ns[r],this._showOverdrawInspector)),this.cache[h]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const r=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(r.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new Gt(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}}class Ht{constructor(r,a){this.points=r,this.planes=a}static fromInvProjectionMatrix(r,a,h){const g=Math.pow(2,h),v=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(M=>f.transformMat4([],M,r)).map(M=>f.scale$1([],M,1/M[3]/a*g)),D=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(M=>{const S=function(re,ue){var ie=ue[0],ce=ue[1],ye=ue[2],ge=ie*ie+ce*ce+ye*ye;return ge>0&&(ge=1/Math.sqrt(ge)),re[0]=ue[0]*ge,re[1]=ue[1]*ge,re[2]=ue[2]*ge,re}([],(re=[],ue=Vt([],v[M[0]],v[M[1]]),ie=Vt([],v[M[2]],v[M[1]]),ce=ue[0],Me=ie[0],re[0]=(ye=ue[1])*($e=ie[2])-(ge=ue[2])*(xe=ie[1]),re[1]=ge*Me-ce*$e,re[2]=ce*xe-ye*Me,re)),z=-((q=S)[0]*(X=v[M[1]])[0]+q[1]*X[1]+q[2]*X[2]);var re,ue,ie,ce,ye,ge,Me,xe,$e,q,X;return S.concat(z)});return new Ht(v,D)}}class ur{constructor(r,a){var h,g,v;this.min=r,this.max=a,this.center=function(h,g,v){return h[0]=.5*g[0],h[1]=.5*g[1],h[2]=.5*g[2],h}([],((h=[])[0]=(g=this.min)[0]+(v=this.max)[0],h[1]=g[1]+v[1],h[2]=g[2]+v[2],h))}quadrant(r){const a=[r%2==0,r<2],h=Wt(this.min),g=Wt(this.max);for(let v=0;v<a.length;v++)h[v]=a[v]?this.min[v]:this.center[v],g[v]=a[v]?this.center[v]:this.max[v];return g[2]=this.max[2],new ur(h,g)}distanceX(r){return Math.max(Math.min(this.max[0],r[0]),this.min[0])-r[0]}distanceY(r){return Math.max(Math.min(this.max[1],r[1]),this.min[1])-r[1]}intersects(r){const a=[[this.min[0],this.min[1],0,1],[this.max[0],this.min[1],0,1],[this.max[0],this.max[1],0,1],[this.min[0],this.max[1],0,1]];let h=!0;for(let g=0;g<r.planes.length;g++){const v=r.planes[g];let D=0;for(let M=0;M<a.length;M++)f.dot(v,a[M])>=0&&D++;if(0===D)return 0;D!==a.length&&(h=!1)}if(h)return 2;for(let g=0;g<3;g++){let v=Number.MAX_VALUE,D=-Number.MAX_VALUE;for(let M=0;M<r.points.length;M++){const S=r.points[M][g]-this.min[g];v=Math.min(v,S),D=Math.max(D,S)}if(D<0||v>this.max[g]-this.min[g])return 0}return 1}}class zn{constructor(r=0,a=0,h=0,g=0){if(isNaN(r)||r<0||isNaN(a)||a<0||isNaN(h)||h<0||isNaN(g)||g<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=r,this.bottom=a,this.left=h,this.right=g}interpolate(r,a,h){return null!=a.top&&null!=r.top&&(this.top=f.number(r.top,a.top,h)),null!=a.bottom&&null!=r.bottom&&(this.bottom=f.number(r.bottom,a.bottom,h)),null!=a.left&&null!=r.left&&(this.left=f.number(r.left,a.left,h)),null!=a.right&&null!=r.right&&(this.right=f.number(r.right,a.right,h)),this}getCenter(r,a){const h=f.clamp((this.left+r-this.right)/2,0,r),g=f.clamp((this.top+a-this.bottom)/2,0,a);return new f.pointGeometry(h,g)}equals(r){return this.top===r.top&&this.bottom===r.bottom&&this.left===r.left&&this.right===r.right}clone(){return new zn(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}class Oi{constructor(r,a,h,g,v){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=void 0===v||!!v,this._minZoom=r||0,this._maxZoom=a||22,this._minPitch=h??0,this._maxPitch=g??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new f.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new zn,this._posMatrixCache={},this._alignedPosMatrixCache={}}clone(){const r=new Oi(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return r.tileSize=this.tileSize,r.latRange=this.latRange,r.width=this.width,r.height=this.height,r._center=this._center,r.zoom=this.zoom,r.angle=this.angle,r._fov=this._fov,r._pitch=this._pitch,r._unmodified=this._unmodified,r._edgeInsets=this._edgeInsets.clone(),r._calcMatrices(),r}get minZoom(){return this._minZoom}set minZoom(r){this._minZoom!==r&&(this._minZoom=r,this.zoom=Math.max(this.zoom,r))}get maxZoom(){return this._maxZoom}set maxZoom(r){this._maxZoom!==r&&(this._maxZoom=r,this.zoom=Math.min(this.zoom,r))}get minPitch(){return this._minPitch}set minPitch(r){this._minPitch!==r&&(this._minPitch=r,this.pitch=Math.max(this.pitch,r))}get maxPitch(){return this._maxPitch}set maxPitch(r){this._maxPitch!==r&&(this._maxPitch=r,this.pitch=Math.min(this.pitch,r))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(r){void 0===r?r=!0:null===r&&(r=!1),this._renderWorldCopies=r}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new f.pointGeometry(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(r){const a=-f.wrap(r,-180,180)*Math.PI/180;var h;this.angle!==a&&(this._unmodified=!1,this.angle=a,this._calcMatrices(),this.rotationMatrix=(h=new f.ARRAY_TYPE(4),f.ARRAY_TYPE!=Float32Array&&(h[1]=0,h[2]=0),h[0]=1,h[3]=1,h),function(h,g,v){var D=g[0],M=g[1],S=g[2],z=g[3],q=Math.sin(v),X=Math.cos(v);h[0]=D*X+S*q,h[1]=M*X+z*q,h[2]=D*-q+S*X,h[3]=M*-q+z*X}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(r){const a=f.clamp(r,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==a&&(this._unmodified=!1,this._pitch=a,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(r){r=Math.max(.01,Math.min(60,r)),this._fov!==r&&(this._unmodified=!1,this._fov=r/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(r){const a=Math.min(Math.max(r,this.minZoom),this.maxZoom);this._zoom!==a&&(this._unmodified=!1,this._zoom=a,this.scale=this.zoomScale(a),this.tileZoom=Math.floor(a),this.zoomFraction=a-this.tileZoom,this._constrain(),this._calcMatrices())}get center(){return this._center}set center(r){r.lat===this._center.lat&&r.lng===this._center.lng||(this._unmodified=!1,this._center=r,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(r){this._edgeInsets.equals(r)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,r,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(r){return this._edgeInsets.equals(r)}interpolatePadding(r,a,h){this._unmodified=!1,this._edgeInsets.interpolate(r,a,h),this._constrain(),this._calcMatrices()}coveringZoomLevel(r){const a=(r.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/r.tileSize));return Math.max(0,a)}getVisibleUnwrappedCoordinates(r){const a=[new f.UnwrappedTileID(0,r)];if(this._renderWorldCopies){const h=this.pointCoordinate(new f.pointGeometry(0,0)),g=this.pointCoordinate(new f.pointGeometry(this.width,0)),v=this.pointCoordinate(new f.pointGeometry(this.width,this.height)),D=this.pointCoordinate(new f.pointGeometry(0,this.height)),M=Math.floor(Math.min(h.x,g.x,v.x,D.x)),S=Math.floor(Math.max(h.x,g.x,v.x,D.x)),z=1;for(let q=M-z;q<=S+z;q++)0!==q&&a.push(new f.UnwrappedTileID(q,r))}return a}coveringTiles(r){let a=this.coveringZoomLevel(r);const h=a;if(void 0!==r.minzoom&&a<r.minzoom)return[];void 0!==r.maxzoom&&a>r.maxzoom&&(a=r.maxzoom);const g=f.MercatorCoordinate.fromLngLat(this.center),v=Math.pow(2,a),D=[v*g.x,v*g.y,0],M=Ht.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,a);let S=r.minzoom||0;this.pitch<=60&&this._edgeInsets.top<.1&&(S=a);const z=ie=>({aabb:new ur([ie*v,0,0],[(ie+1)*v,v,0]),zoom:0,x:0,y:0,wrap:ie,fullyVisible:!1}),q=[],X=[],re=a,ue=r.reparseOverscaled?h:a;if(this._renderWorldCopies)for(let ie=1;ie<=3;ie++)q.push(z(-ie)),q.push(z(ie));for(q.push(z(0));q.length>0;){const ie=q.pop(),ce=ie.x,ye=ie.y;let ge=ie.fullyVisible;if(!ge){const Ne=ie.aabb.intersects(M);if(0===Ne)continue;ge=2===Ne}const Me=ie.aabb.distanceX(D),xe=ie.aabb.distanceY(D),$e=Math.max(Math.abs(Me),Math.abs(xe)),Oe=3+(1<<re-ie.zoom)-2;if(ie.zoom===re||$e>Oe&&ie.zoom>=S)X.push({tileID:new f.OverscaledTileID(ie.zoom===re?ue:ie.zoom,ie.wrap,ie.zoom,ce,ye),distanceSq:Un([D[0]-.5-ce,D[1]-.5-ye])});else for(let Ne=0;Ne<4;Ne++){const Je=(ce<<1)+Ne%2,at=(ye<<1)+(Ne>>1);q.push({aabb:ie.aabb.quadrant(Ne),zoom:ie.zoom+1,x:Je,y:at,wrap:ie.wrap,fullyVisible:ge})}}return X.sort((ie,ce)=>ie.distanceSq-ce.distanceSq).map(ie=>ie.tileID)}resize(r,a){this.width=r,this.height=a,this.pixelsToGLUnits=[2/r,-2/a],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(r){return Math.pow(2,r)}scaleZoom(r){return Math.log(r)/Math.LN2}project(r){const a=f.clamp(r.lat,-this.maxValidLatitude,this.maxValidLatitude);return new f.pointGeometry(f.mercatorXfromLng(r.lng)*this.worldSize,f.mercatorYfromLat(a)*this.worldSize)}unproject(r){return new f.MercatorCoordinate(r.x/this.worldSize,r.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}setLocationAtPoint(r,a){const h=this.pointCoordinate(a),g=this.pointCoordinate(this.centerPoint),v=this.locationCoordinate(r),D=new f.MercatorCoordinate(v.x-(h.x-g.x),v.y-(h.y-g.y));this.center=this.coordinateLocation(D),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(r){return this.coordinatePoint(this.locationCoordinate(r))}pointLocation(r){return this.coordinateLocation(this.pointCoordinate(r))}locationCoordinate(r){return f.MercatorCoordinate.fromLngLat(r)}coordinateLocation(r){return r.toLngLat()}pointCoordinate(r){const a=[r.x,r.y,0,1],h=[r.x,r.y,1,1];f.transformMat4(a,a,this.pixelMatrixInverse),f.transformMat4(h,h,this.pixelMatrixInverse);const g=a[3],v=h[3],D=a[1]/g,M=h[1]/v,S=a[2]/g,z=h[2]/v,q=S===z?0:(0-S)/(z-S);return new f.MercatorCoordinate(f.number(a[0]/g,h[0]/v,q)/this.worldSize,f.number(D,M,q)/this.worldSize)}coordinatePoint(r){const a=[r.x*this.worldSize,r.y*this.worldSize,0,1];return f.transformMat4(a,a,this.pixelMatrix),new f.pointGeometry(a[0]/a[3],a[1]/a[3])}getBounds(){return(new f.LngLatBounds).extend(this.pointLocation(new f.pointGeometry(0,0))).extend(this.pointLocation(new f.pointGeometry(this.width,0))).extend(this.pointLocation(new f.pointGeometry(this.width,this.height))).extend(this.pointLocation(new f.pointGeometry(0,this.height)))}getMaxBounds(){return this.latRange&&2===this.latRange.length&&this.lngRange&&2===this.lngRange.length?new f.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}setMaxBounds(r){r?(this.lngRange=[r.getWest(),r.getEast()],this.latRange=[r.getSouth(),r.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(r,a=!1){const h=r.key,g=a?this._alignedPosMatrixCache:this._posMatrixCache;if(g[h])return g[h];const v=r.canonical,D=this.worldSize/this.zoomScale(v.z),M=v.x+Math.pow(2,v.z)*r.wrap,S=f.identity(new Float64Array(16));return f.translate(S,S,[M*D,v.y*D,0]),f.scale(S,S,[D/f.EXTENT,D/f.EXTENT,1]),f.multiply(S,a?this.alignedProjMatrix:this.projMatrix,S),g[h]=new Float32Array(S),g[h]}customLayerMatrix(){return this.mercatorMatrix.slice()}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let r,a,h,g,v=-90,D=90,M=-180,S=180;const z=this.size,q=this._unmodified;if(this.latRange){const ue=this.latRange;v=f.mercatorYfromLat(ue[1])*this.worldSize,D=f.mercatorYfromLat(ue[0])*this.worldSize,r=D-v<z.y?z.y/(D-v):0}if(this.lngRange){const ue=this.lngRange;M=f.mercatorXfromLng(ue[0])*this.worldSize,S=f.mercatorXfromLng(ue[1])*this.worldSize,a=S-M<z.x?z.x/(S-M):0}const X=this.point,re=Math.max(a||0,r||0);if(re)return this.center=this.unproject(new f.pointGeometry(a?(S+M)/2:X.x,r?(D+v)/2:X.y)),this.zoom+=this.scaleZoom(re),this._unmodified=q,void(this._constraining=!1);if(this.latRange){const ue=X.y,ie=z.y/2;ue-ie<v&&(g=v+ie),ue+ie>D&&(g=D-ie)}if(this.lngRange){const ue=X.x,ie=z.x/2;ue-ie<M&&(h=M+ie),ue+ie>S&&(h=S-ie)}void 0===h&&void 0===g||(this.center=this.unproject(new f.pointGeometry(void 0!==h?h:X.x,void 0!==g?g:X.y))),this._unmodified=q,this._constraining=!1}_calcMatrices(){if(!this.height)return;const r=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;const a=Math.PI/2+this._pitch,h=this._fov*(.5+r.y/this.height),g=Math.sin(h)*this.cameraToCenterDistance/Math.sin(f.clamp(Math.PI-a-h,.01,Math.PI-.01)),v=this.point,D=v.x,M=v.y,S=1.01*(Math.cos(Math.PI/2-this._pitch)*g+this.cameraToCenterDistance),z=this.height/50;let q=new Float64Array(16);f.perspective(q,this._fov,this.width/this.height,z,S),q[8]=2*-r.x/this.width,q[9]=2*r.y/this.height,f.scale(q,q,[1,-1,1]),f.translate(q,q,[0,0,-this.cameraToCenterDistance]),f.rotateX(q,q,this._pitch),f.rotateZ(q,q,this.angle),f.translate(q,q,[-D,-M,0]),this.mercatorMatrix=f.scale([],q,[this.worldSize,this.worldSize,this.worldSize]),f.scale(q,q,[1,1,f.mercatorZfromAltitude(1,this.center.lat)*this.worldSize]),this.projMatrix=q,this.invProjMatrix=f.invert([],this.projMatrix);const X=this.width%2/2,re=this.height%2/2,ue=Math.cos(this.angle),ie=Math.sin(this.angle),ce=D-Math.round(D)+ue*X+ie*re,ye=M-Math.round(M)+ue*re+ie*X,ge=new Float64Array(q);if(f.translate(ge,ge,[ce>.5?ce-1:ce,ye>.5?ye-1:ye,0]),this.alignedProjMatrix=ge,q=f.create(),f.scale(q,q,[this.width/2,-this.height/2,1]),f.translate(q,q,[1,-1,0]),this.labelPlaneMatrix=q,q=f.create(),f.scale(q,q,[1,-1,1]),f.translate(q,q,[-1,-1,0]),f.scale(q,q,[2/this.width,2/this.height,1]),this.glCoordMatrix=q,this.pixelMatrix=f.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),q=f.invert(new Float64Array(16),this.pixelMatrix),!q)throw new Error("failed to invert matrix");this.pixelMatrixInverse=q,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const r=this.pointCoordinate(new f.pointGeometry(0,0)),a=[r.x*this.worldSize,r.y*this.worldSize,0,1];return f.transformMat4(a,a,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const r=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new f.pointGeometry(0,r))}getCameraQueryGeometry(r){const a=this.getCameraPoint();if(1===r.length)return[r[0],a];{let h=a.x,g=a.y,v=a.x,D=a.y;for(const M of r)h=Math.min(h,M.x),g=Math.min(g,M.y),v=Math.max(v,M.x),D=Math.max(D,M.y);return[new f.pointGeometry(h,g),new f.pointGeometry(v,g),new f.pointGeometry(v,D),new f.pointGeometry(h,D),new f.pointGeometry(h,g)]}}}class Ji{constructor(r){this._hashName=r&&encodeURIComponent(r),f.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=function(a,h){let g=!1,v=null;const D=()=>{v=null,g&&(a(),v=setTimeout(D,300),g=!1)};return()=>(g=!0,v||D(),v)}(this._updateHashUnthrottled.bind(this))}addTo(r){return this._map=r,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(r){const a=this._map.getCenter(),h=Math.round(100*this._map.getZoom())/100,g=Math.ceil((h*Math.LN2+Math.log(512/360/.5))/Math.LN10),v=Math.pow(10,g),D=Math.round(a.lng*v)/v,M=Math.round(a.lat*v)/v,S=this._map.getBearing(),z=this._map.getPitch();let q="";if(q+=r?`/${D}/${M}/${h}`:`${h}/${M}/${D}`,(S||z)&&(q+="/"+Math.round(10*S)/10),z&&(q+=`/${Math.round(z)}`),this._hashName){const X=this._hashName;let re=!1;const ue=window.location.hash.slice(1).split("&").map(ie=>{const ce=ie.split("=")[0];return ce===X?(re=!0,`${ce}=${q}`):ie}).filter(ie=>ie);return re||ue.push(`${X}=${q}`),`#${ue.join("&")}`}return`#${q}`}_getCurrentHash(){const r=window.location.hash.replace("#","");if(this._hashName){let a;return r.split("&").map(h=>h.split("=")).forEach(h=>{h[0]===this._hashName&&(a=h)}),(a&&a[1]||"").split("/")}return r.split("/")}_onHashChange(){const r=this._getCurrentHash();if(r.length>=3&&!r.some(a=>isNaN(a))){const a=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(r[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+r[2],+r[1]],zoom:+r[0],bearing:a,pitch:+(r[4]||0)}),!0}return!1}_updateHashUnthrottled(){const r=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,r)}catch{}}}const qr={linearity:.3,easing:f.bezier(0,0,.3,1)},os=f.extend({deceleration:2500,maxSpeed:1400},qr),oa=f.extend({deceleration:20,maxSpeed:1400},qr),Ic=f.extend({deceleration:1e3,maxSpeed:360},qr),sa=f.extend({deceleration:1e3,maxSpeed:90},qr);class Sc{constructor(r){this._map=r,this.clear()}clear(){this._inertiaBuffer=[]}record(r){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:f.exported.now(),settings:r})}_drainInertiaBuffer(){const r=this._inertiaBuffer,a=f.exported.now();for(;r.length>0&&a-r[0].time>160;)r.shift()}_onMoveEnd(r){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const a={zoom:0,bearing:0,pitch:0,pan:new f.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:v}of this._inertiaBuffer)a.zoom+=v.zoomDelta||0,a.bearing+=v.bearingDelta||0,a.pitch+=v.pitchDelta||0,v.panDelta&&a.pan._add(v.panDelta),v.around&&(a.around=v.around),v.pinchAround&&(a.pinchAround=v.pinchAround);const h=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,g={};if(a.pan.mag()){const v=Zr(a.pan.mag(),h,f.extend({},os,r||{}));g.offset=a.pan.mult(v.amount/a.pan.mag()),g.center=this._map.transform.center,ss(g,v)}if(a.zoom){const v=Zr(a.zoom,h,oa);g.zoom=this._map.transform.zoom+v.amount,ss(g,v)}if(a.bearing){const v=Zr(a.bearing,h,Ic);g.bearing=this._map.transform.bearing+f.clamp(v.amount,-179,179),ss(g,v)}if(a.pitch){const v=Zr(a.pitch,h,sa);g.pitch=this._map.transform.pitch+v.amount,ss(g,v)}if(g.zoom||g.bearing){const v=void 0===a.pinchAround?a.around:a.pinchAround;g.around=v?this._map.unproject(v):this._map.getCenter()}return this.clear(),f.extend(g,{noMoveStart:!0})}}function ss(p,r){(!p.duration||p.duration<r.duration)&&(p.duration=r.duration,p.easing=r.easing)}function Zr(p,r,a){const{maxSpeed:h,linearity:g,deceleration:v}=a,D=f.clamp(p*g/(r/1e3),-h,h),M=Math.abs(D)/(v*g);return{easing:a.easing,duration:1e3*M,amount:D*(M/2)}}class Br extends f.Event{constructor(r,a,h,g={}){const v=Ee.mousePos(a.getCanvasContainer(),h),D=a.unproject(v);super(r,f.extend({point:v,lngLat:D,originalEvent:h},g)),this._defaultPrevented=!1,this.target=a}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class Ii extends f.Event{constructor(r,a,h){const g="touchend"===r?h.changedTouches:h.touches,v=Ee.touchPos(a.getCanvasContainer(),g),D=v.map(S=>a.unproject(S)),M=v.reduce((S,z,q,X)=>S.add(z.div(X.length)),new f.pointGeometry(0,0));super(r,{points:v,point:M,lngLats:D,lngLat:a.unproject(M),originalEvent:h}),this._defaultPrevented=!1}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class aa extends f.Event{constructor(r,a,h){super(r,{originalEvent:h}),this._defaultPrevented=!1}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class Si{constructor(r,a){this._map=r,this._clickTolerance=a.clickTolerance}reset(){delete this._mousedownPos}wheel(r){return this._firePreventable(new aa(r.type,this._map,r))}mousedown(r,a){return this._mousedownPos=a,this._firePreventable(new Br(r.type,this._map,r))}mouseup(r){this._map.fire(new Br(r.type,this._map,r))}click(r,a){this._mousedownPos&&this._mousedownPos.dist(a)>=this._clickTolerance||this._map.fire(new Br(r.type,this._map,r))}dblclick(r){return this._firePreventable(new Br(r.type,this._map,r))}mouseover(r){this._map.fire(new Br(r.type,this._map,r))}mouseout(r){this._map.fire(new Br(r.type,this._map,r))}touchstart(r){return this._firePreventable(new Ii(r.type,this._map,r))}touchmove(r){this._map.fire(new Ii(r.type,this._map,r))}touchend(r){this._map.fire(new Ii(r.type,this._map,r))}touchcancel(r){this._map.fire(new Ii(r.type,this._map,r))}_firePreventable(r){if(this._map.fire(r),r.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class yu{constructor(r){this._map=r}reset(){this._delayContextMenu=!1,delete this._contextMenuEvent}mousemove(r){this._map.fire(new Br(r.type,this._map,r))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Br("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(r){this._delayContextMenu?this._contextMenuEvent=r:this._map.fire(new Br(r.type,this._map,r)),this._map.listens("contextmenu")&&r.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Is{constructor(r,a){this._map=r,this._el=r.getCanvasContainer(),this._container=r.getContainer(),this._clickTolerance=a.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(r,a){this.isEnabled()&&r.shiftKey&&0===r.button&&(Ee.disableDrag(),this._startPos=this._lastPos=a,this._active=!0)}mousemoveWindow(r,a){if(!this._active)return;const h=a;if(this._lastPos.equals(h)||!this._box&&h.dist(this._startPos)<this._clickTolerance)return;const g=this._startPos;this._lastPos=h,this._box||(this._box=Ee.create("div","maplibregl-boxzoom mapboxgl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair","mapboxgl-crosshair"),this._fireEvent("boxzoomstart",r));const v=Math.min(g.x,h.x),D=Math.max(g.x,h.x),M=Math.min(g.y,h.y),S=Math.max(g.y,h.y);Ee.setTransform(this._box,`translate(${v}px,${M}px)`),this._box.style.width=D-v+"px",this._box.style.height=S-M+"px"}mouseupWindow(r,a){if(!this._active||0!==r.button)return;const h=this._startPos,g=a;if(this.reset(),Ee.suppressClick(),h.x!==g.x||h.y!==g.y)return this._map.fire(new f.Event("boxzoomend",{originalEvent:r})),{cameraAnimation:v=>v.fitScreenCoordinates(h,g,this._map.getBearing(),{linear:!0})};this._fireEvent("boxzoomcancel",r)}keydown(r){this._active&&27===r.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",r))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair","mapboxgl-crosshair"),this._box&&(Ee.remove(this._box),this._box=null),Ee.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(r,a){return this._map.fire(new f.Event(r,{originalEvent:a}))}}function Ss(p,r){const a={};for(let h=0;h<p.length;h++)a[p[h].identifier]=r[h];return a}class Ac{constructor(r){this.reset(),this.numTouches=r.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(r,a,h){(this.centroid||h.length>this.numTouches)&&(this.aborted=!0),this.aborted||(void 0===this.startTime&&(this.startTime=r.timeStamp),h.length===this.numTouches&&(this.centroid=function(g){const v=new f.pointGeometry(0,0);for(const D of g)v._add(D);return v.div(g.length)}(a),this.touches=Ss(h,a)))}touchmove(r,a,h){if(this.aborted||!this.centroid)return;const g=Ss(h,a);for(const v in this.touches){const D=this.touches[v],M=g[v];(!M||M.dist(D)>30)&&(this.aborted=!0)}}touchend(r,a,h){if((!this.centroid||r.timeStamp-this.startTime>500)&&(this.aborted=!0),0===h.length){const g=!this.aborted&&this.centroid;if(this.reset(),g)return g}}}class Fa{constructor(r){this.singleTap=new Ac(r),this.numTaps=r.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(r,a,h){this.singleTap.touchstart(r,a,h)}touchmove(r,a,h){this.singleTap.touchmove(r,a,h)}touchend(r,a,h){const g=this.singleTap.touchend(r,a,h);if(g){const v=r.timeStamp-this.lastTime<500,D=!this.lastTap||this.lastTap.dist(g)<30;if(v&&D||this.reset(),this.count++,this.lastTime=r.timeStamp,this.lastTap=g,this.count===this.numTaps)return this.reset(),g}}}class El{constructor(){this._zoomIn=new Fa({numTouches:1,numTaps:2}),this._zoomOut=new Fa({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(r,a,h){this._zoomIn.touchstart(r,a,h),this._zoomOut.touchstart(r,a,h)}touchmove(r,a,h){this._zoomIn.touchmove(r,a,h),this._zoomOut.touchmove(r,a,h)}touchend(r,a,h){const g=this._zoomIn.touchend(r,a,h),v=this._zoomOut.touchend(r,a,h);return g?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:D=>D.easeTo({duration:300,zoom:D.getZoom()+1,around:D.unproject(g)},{originalEvent:r})}):v?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:D=>D.easeTo({duration:300,zoom:D.getZoom()-1,around:D.unproject(v)},{originalEvent:r})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Ml={0:1,2:2};class Go{constructor(r){this.reset(),this._clickTolerance=r.clickTolerance||1}reset(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton}_correctButton(r,a){return!1}_move(r,a){return{}}mousedown(r,a){if(this._lastPoint)return;const h=Ee.mouseButton(r);this._correctButton(r,h)&&(this._lastPoint=a,this._eventButton=h)}mousemoveWindow(r,a){const h=this._lastPoint;if(h)if(r.preventDefault(),function(g,v){const D=Ml[v];return void 0===g.buttons||(g.buttons&D)!==D}(r,this._eventButton))this.reset();else if(this._moved||!(a.dist(h)<this._clickTolerance))return this._moved=!0,this._lastPoint=a,this._move(h,a)}mouseupWindow(r){this._lastPoint&&Ee.mouseButton(r)===this._eventButton&&(this._moved&&Ee.suppressClick(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class la extends Go{mousedown(r,a){super.mousedown(r,a),this._lastPoint&&(this._active=!0)}_correctButton(r,a){return 0===a&&!r.ctrlKey}_move(r,a){return{around:a,panDelta:a.sub(r)}}}class Pt extends Go{_correctButton(r,a){return 0===a&&r.ctrlKey||2===a}_move(r,a){const h=.8*(a.x-r.x);if(h)return this._active=!0,{bearingDelta:h}}contextmenu(r){r.preventDefault()}}class ua extends Go{_correctButton(r,a){return 0===a&&r.ctrlKey||2===a}_move(r,a){const h=-.5*(a.y-r.y);if(h)return this._active=!0,{pitchDelta:h}}contextmenu(r){r.preventDefault()}}class ca{constructor(r){this._minTouches=1,this._clickTolerance=r.clickTolerance||1,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new f.pointGeometry(0,0)}touchstart(r,a,h){return this._calculateTransform(r,a,h)}touchmove(r,a,h){if(this._active&&!(h.length<this._minTouches))return r.preventDefault(),this._calculateTransform(r,a,h)}touchend(r,a,h){this._calculateTransform(r,a,h),this._active&&h.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(r,a,h){h.length>0&&(this._active=!0);const g=Ss(h,a),v=new f.pointGeometry(0,0),D=new f.pointGeometry(0,0);let M=0;for(const z in g){const q=g[z],X=this._touches[z];X&&(v._add(q),D._add(q.sub(X)),M++,g[z]=q)}if(this._touches=g,M<this._minTouches||!D.mag())return;const S=D.div(M);return this._sum._add(S),this._sum.mag()<this._clickTolerance?void 0:{around:v.div(M),panDelta:S}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class as{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}_start(r){}_move(r,a,h){return{}}touchstart(r,a,h){this._firstTwoTouches||h.length<2||(this._firstTwoTouches=[h[0].identifier,h[1].identifier],this._start([a[0],a[1]]))}touchmove(r,a,h){if(!this._firstTwoTouches)return;r.preventDefault();const[g,v]=this._firstTwoTouches,D=ha(h,a,g),M=ha(h,a,v);if(!D||!M)return;const S=this._aroundCenter?null:D.add(M).div(2);return this._move([D,M],S,r)}touchend(r,a,h){if(!this._firstTwoTouches)return;const[g,v]=this._firstTwoTouches,D=ha(h,a,g),M=ha(h,a,v);D&&M||(this._active&&Ee.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(r){this._enabled=!0,this._aroundCenter=!!r&&"center"===r.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function ha(p,r,a){for(let h=0;h<p.length;h++)if(p[h].identifier===a)return r[h]}function yt(p,r){return Math.log(p/r)/Math.LN2}class da extends as{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(r){this._startDistance=this._distance=r[0].dist(r[1])}_move(r,a){const h=this._distance;if(this._distance=r[0].dist(r[1]),this._active||!(Math.abs(yt(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:yt(this._distance,h),pinchAround:a}}}function _u(p,r){return 180*p.angleWith(r)/Math.PI}class Tc extends as{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(r){this._startVector=this._vector=r[0].sub(r[1]),this._minDiameter=r[0].dist(r[1])}_move(r,a){const h=this._vector;if(this._vector=r[0].sub(r[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:_u(this._vector,h),pinchAround:a}}_isBelowThreshold(r){this._minDiameter=Math.min(this._minDiameter,r.mag());const a=25/(Math.PI*this._minDiameter)*360,h=_u(r,this._startVector);return Math.abs(h)<a}}function Wr(p){return Math.abs(p.y)>Math.abs(p.x)}class Ho extends as{reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}_start(r){this._lastPoints=r,Wr(r[0].sub(r[1]))&&(this._valid=!1)}_move(r,a,h){const g=r[0].sub(this._lastPoints[0]),v=r[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(g,v,h.timeStamp),this._valid)return this._lastPoints=r,this._active=!0,{pitchDelta:(g.y+v.y)/2*-.5}}gestureBeginsVertically(r,a,h){if(void 0!==this._valid)return this._valid;const g=r.mag()>=2,v=a.mag()>=2;if(!g&&!v)return;if(!g||!v)return void 0===this._firstMove&&(this._firstMove=h),h-this._firstMove<100&&void 0;const D=r.y>0==a.y>0;return Wr(r)&&Wr(a)&&D}}const Tr={panStep:100,bearingStep:15,pitchStep:10};class Pc{constructor(){const r=Tr;this._panStep=r.panStep,this._bearingStep=r.bearingStep,this._pitchStep=r.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(r){if(r.altKey||r.ctrlKey||r.metaKey)return;let a=0,h=0,g=0,v=0,D=0;switch(r.keyCode){case 61:case 107:case 171:case 187:a=1;break;case 189:case 109:case 173:a=-1;break;case 37:r.shiftKey?h=-1:(r.preventDefault(),v=-1);break;case 39:r.shiftKey?h=1:(r.preventDefault(),v=1);break;case 38:r.shiftKey?g=1:(r.preventDefault(),D=-1);break;case 40:r.shiftKey?g=-1:(r.preventDefault(),D=1);break;default:return}return this._rotationDisabled&&(h=0,g=0),{cameraAnimation:M=>{const S=M.getZoom();M.easeTo({duration:300,easeId:"keyboardHandler",easing:Fc,zoom:a?Math.round(S)+a*(r.shiftKey?2:1):S,bearing:M.getBearing()+h*this._bearingStep,pitch:M.getPitch()+g*this._pitchStep,offset:[-v*this._panStep,-D*this._panStep],center:M.getCenter()},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Fc(p){return p*(2-p)}const nl=4.000244140625;class Il{constructor(r,a){this._map=r,this._el=r.getCanvasContainer(),this._handler=a,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,f.bindAll(["_onTimeout"],this)}setZoomRate(r){this._defaultZoomRate=r}setWheelZoomRate(r){this._wheelZoomRate=r}isEnabled(){return!!this._enabled}isActive(){return!!this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(r){this.isEnabled()||(this._enabled=!0,this._aroundCenter=r&&"center"===r.around)}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(r){if(!this.isEnabled())return;let a=r.deltaMode===WheelEvent.DOM_DELTA_LINE?40*r.deltaY:r.deltaY;const h=f.exported.now(),g=h-(this._lastWheelEventTime||0);this._lastWheelEventTime=h,0!==a&&a%nl==0?this._type="wheel":0!==a&&Math.abs(a)<4?this._type="trackpad":g>400?(this._type=null,this._lastValue=a,this._timeout=setTimeout(this._onTimeout,40,r)):this._type||(this._type=Math.abs(g*a)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,a+=this._lastValue)),r.shiftKey&&a&&(a/=4),this._type&&(this._lastWheelEvent=r,this._delta-=a,this._active||this._start(r)),r.preventDefault()}_onTimeout(r){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(r)}_start(r){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const a=Ee.mousePos(this._el,r);this._around=f.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(a)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const r=this._map.transform;if(0!==this._delta){const M="wheel"===this._type&&Math.abs(this._delta)>nl?this._wheelZoomRate:this._defaultZoomRate;let S=2/(1+Math.exp(-Math.abs(this._delta*M)));this._delta<0&&0!==S&&(S=1/S);const z="number"==typeof this._targetZoom?r.zoomScale(this._targetZoom):r.scale;this._targetZoom=Math.min(r.maxZoom,Math.max(r.minZoom,r.scaleZoom(z*S))),"wheel"===this._type&&(this._startZoom=r.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const a="number"==typeof this._targetZoom?this._targetZoom:r.zoom,h=this._startZoom,g=this._easing;let v,D=!1;if("wheel"===this._type&&h&&g){const M=Math.min((f.exported.now()-this._lastWheelEventTime)/200,1),S=g(M);v=f.number(h,a,S),M<1?this._frameId||(this._frameId=!0):D=!0}else v=a,D=!0;return this._active=!0,D&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!D,zoomDelta:v-r.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(r){let a=f.ease;if(this._prevEase){const h=this._prevEase,g=(f.exported.now()-h.start)/h.duration,v=h.easing(g+.01)-h.easing(g),D=.27/Math.sqrt(v*v+1e-4)*.01,M=Math.sqrt(.0729-D*D);a=f.bezier(D,M,.25,1)}return this._prevEase={start:f.exported.now(),duration:r,easing:a},a}reset(){this._active=!1}}class Sl{constructor(r,a){this._clickZoom=r,this._tapZoom=a}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Al{constructor(){this.reset()}reset(){this._active=!1}dblclick(r,a){return r.preventDefault(),{cameraAnimation:h=>{h.easeTo({duration:300,zoom:h.getZoom()+(r.shiftKey?-1:1),around:h.unproject(a)},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class di{constructor(){this._tap=new Fa({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()}touchstart(r,a,h){this._swipePoint||(this._tapTime&&r.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?h.length>0&&(this._swipePoint=a[0],this._swipeTouch=h[0].identifier):this._tap.touchstart(r,a,h))}touchmove(r,a,h){if(this._tapTime){if(this._swipePoint){if(h[0].identifier!==this._swipeTouch)return;const g=a[0],v=g.y-this._swipePoint.y;return this._swipePoint=g,r.preventDefault(),this._active=!0,{zoomDelta:v/128}}}else this._tap.touchmove(r,a,h)}touchend(r,a,h){this._tapTime?this._swipePoint&&0===h.length&&this.reset():this._tap.touchend(r,a,h)&&(this._tapTime=r.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class yo{constructor(r,a,h){this._el=r,this._mousePan=a,this._touchPan=h}enable(r){this._inertiaOptions=r||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan","mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan","mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class ka{constructor(r,a,h){this._pitchWithRotate=r.pitchWithRotate,this._mouseRotate=a,this._mousePitch=h}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class La{constructor(r,a,h,g){this._el=r,this._touchZoom=a,this._touchRotate=h,this._tapDragZoom=g,this._rotationDisabled=!1,this._enabled=!0}enable(r){this._touchZoom.enable(r),this._rotationDisabled||this._touchRotate.enable(r),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate","mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate","mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const As=p=>p.zoom||p.drag||p.pitch||p.rotate;class Tl extends f.Event{}function _o(p){return p.panDelta&&p.panDelta.mag()||p.zoomDelta||p.bearingDelta||p.pitchDelta}class wi{constructor(r,a){this._map=r,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Sc(r),this._bearingSnap=a.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(a),f.bindAll(["handleEvent","handleWindowEvent"],this);const h=this._el;this._listeners=[[h,"touchstart",{passive:!0}],[h,"touchmove",{passive:!1}],[h,"touchend",void 0],[h,"touchcancel",void 0],[h,"mousedown",void 0],[h,"mousemove",void 0],[h,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[h,"mouseover",void 0],[h,"mouseout",void 0],[h,"dblclick",void 0],[h,"click",void 0],[h,"keydown",{capture:!1}],[h,"keyup",void 0],[h,"wheel",{passive:!1}],[h,"contextmenu",void 0],[window,"blur",void 0]];for(const[g,v,D]of this._listeners)Ee.addEventListener(g,v,g===document?this.handleWindowEvent:this.handleEvent,D)}destroy(){for(const[r,a,h]of this._listeners)Ee.removeEventListener(r,a,r===document?this.handleWindowEvent:this.handleEvent,h)}_addDefaultHandlers(r){const a=this._map,h=a.getCanvasContainer();this._add("mapEvent",new Si(a,r));const g=a.boxZoom=new Is(a,r);this._add("boxZoom",g);const v=new El,D=new Al;a.doubleClickZoom=new Sl(D,v),this._add("tapZoom",v),this._add("clickZoom",D);const M=new di;this._add("tapDragZoom",M);const S=a.touchPitch=new Ho;this._add("touchPitch",S);const z=new Pt(r),q=new ua(r);a.dragRotate=new ka(r,z,q),this._add("mouseRotate",z,["mousePitch"]),this._add("mousePitch",q,["mouseRotate"]);const X=new la(r),re=new ca(r);a.dragPan=new yo(h,X,re),this._add("mousePan",X),this._add("touchPan",re,["touchZoom","touchRotate"]);const ue=new Tc,ie=new da;a.touchZoomRotate=new La(h,ie,ue,M),this._add("touchRotate",ue,["touchPan","touchZoom"]),this._add("touchZoom",ie,["touchPan","touchRotate"]);const ce=a.scrollZoom=new Il(a,this);this._add("scrollZoom",ce,["mousePan"]);const ye=a.keyboard=new Pc;this._add("keyboard",ye),this._add("blockableMapEvent",new yu(a));for(const ge of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])r.interactive&&r[ge]&&a[ge].enable(r[ge])}_add(r,a,h){this._handlers.push({handlerName:r,handler:a,allowed:h}),this._handlersById[r]=a}stop(r){if(!this._updatingCamera){for(const{handler:a}of this._handlers)a.reset();this._inertia.clear(),this._fireEvents({},{},r),this._changes=[]}}isActive(){for(const{handler:r}of this._handlers)if(r.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return Boolean(As(this._eventsInProgress))||this.isZooming()}_blockedByActive(r,a,h){for(const g in r)if(g!==h&&(!a||a.indexOf(g)<0))return!0;return!1}handleWindowEvent(r){this.handleEvent(r,`${r.type}Window`)}_getMapTouches(r){const a=[];for(const h of r)this._el.contains(h.target)&&a.push(h);return a}handleEvent(r,a){if("blur"===r.type)return void this.stop(!0);this._updatingCamera=!0;const h="renderFrame"===r.type?void 0:r,g={needsRenderFrame:!1},v={},D={},M=r.touches,S=M?this._getMapTouches(M):void 0,z=S?Ee.touchPos(this._el,S):Ee.mousePos(this._el,r);for(const{handlerName:re,handler:ue,allowed:ie}of this._handlers){if(!ue.isEnabled())continue;let ce;this._blockedByActive(D,ie,re)?ue.reset():ue[a||r.type]&&(ce=ue[a||r.type](r,z,S),this.mergeHandlerResult(g,v,ce,re,h),ce&&ce.needsRenderFrame&&this._triggerRenderFrame()),(ce||ue.isActive())&&(D[re]=ue)}const q={};for(const re in this._previousActiveHandlers)D[re]||(q[re]=h);this._previousActiveHandlers=D,(Object.keys(q).length||_o(g))&&(this._changes.push([g,v,q]),this._triggerRenderFrame()),(Object.keys(D).length||_o(g))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:X}=g;X&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],X(this._map))}mergeHandlerResult(r,a,h,g,v){if(!h)return;f.extend(r,h);const D={handlerName:g,originalEvent:h.originalEvent||v};void 0!==h.zoomDelta&&(a.zoom=D),void 0!==h.panDelta&&(a.drag=D),void 0!==h.pitchDelta&&(a.pitch=D),void 0!==h.bearingDelta&&(a.rotate=D)}_applyChanges(){const r={},a={},h={};for(const[g,v,D]of this._changes)g.panDelta&&(r.panDelta=(r.panDelta||new f.pointGeometry(0,0))._add(g.panDelta)),g.zoomDelta&&(r.zoomDelta=(r.zoomDelta||0)+g.zoomDelta),g.bearingDelta&&(r.bearingDelta=(r.bearingDelta||0)+g.bearingDelta),g.pitchDelta&&(r.pitchDelta=(r.pitchDelta||0)+g.pitchDelta),void 0!==g.around&&(r.around=g.around),void 0!==g.pinchAround&&(r.pinchAround=g.pinchAround),g.noInertia&&(r.noInertia=g.noInertia),f.extend(a,v),f.extend(h,D);this._updateMapTransform(r,a,h),this._changes=[]}_updateMapTransform(r,a,h){const g=this._map,v=g.transform;if(!_o(r))return this._fireEvents(a,h,!0);let{panDelta:D,zoomDelta:M,bearingDelta:S,pitchDelta:z,around:q,pinchAround:X}=r;void 0!==X&&(q=X),g._stop(!0),q=q||g.transform.centerPoint;const re=v.pointLocation(D?q.sub(D):q);S&&(v.bearing+=S),z&&(v.pitch+=z),M&&(v.zoom+=M),v.setLocationAtPoint(re,q),this._map._update(),r.noInertia||this._inertia.record(r),this._fireEvents(a,h,!0)}_fireEvents(r,a,h){const g=As(this._eventsInProgress),v=As(r),D={};for(const q in r){const{originalEvent:X}=r[q];this._eventsInProgress[q]||(D[`${q}start`]=X),this._eventsInProgress[q]=r[q]}!g&&v&&this._fireEvent("movestart",v.originalEvent);for(const q in D)this._fireEvent(q,D[q]);v&&this._fireEvent("move",v.originalEvent);for(const q in r){const{originalEvent:X}=r[q];this._fireEvent(q,X)}const M={};let S;for(const q in this._eventsInProgress){const{handlerName:X,originalEvent:re}=this._eventsInProgress[q];this._handlersById[X].isActive()||(delete this._eventsInProgress[q],S=a[X]||re,M[`${q}end`]=S)}for(const q in M)this._fireEvent(q,M[q]);const z=As(this._eventsInProgress);if(h&&(g||v)&&!z){this._updatingCamera=!0;const q=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),X=re=>0!==re&&-this._bearingSnap<re&&re<this._bearingSnap;q?(X(q.bearing||this._map.getBearing())&&(q.bearing=0),this._map.easeTo(q,{originalEvent:S})):(this._map.fire(new f.Event("moveend",{originalEvent:S})),X(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(r,a){this._map.fire(new f.Event(r,a?{originalEvent:a}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(r=>{delete this._frameId,this.handleEvent(new Tl("renderFrame",{timeStamp:r})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const yr={extend:(p,...r)=>f.extend(p,...r),run(p){p()},logToElement(p,r=!1,a="log"){const h=window.document.getElementById(a);h&&(r&&(h.innerHTML=""),h.innerHTML+=`<br>${p}`)}};class rl extends f.Evented{constructor(r,a){super(),this._moving=!1,this._zooming=!1,this.transform=r,this._bearingSnap=a.bearingSnap,f.bindAll(["_renderFrameCallback"],this)}getCenter(){return new f.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(r,a){return this.jumpTo({center:r},a)}panBy(r,a,h){return r=f.pointGeometry.convert(r).mult(-1),this.panTo(this.transform.center,f.extend({offset:r},a),h)}panTo(r,a,h){return this.easeTo(f.extend({center:r},a),h)}getZoom(){return this.transform.zoom}setZoom(r,a){return this.jumpTo({zoom:r},a),this}zoomTo(r,a,h){return this.easeTo(f.extend({zoom:r},a),h)}zoomIn(r,a){return this.zoomTo(this.getZoom()+1,r,a),this}zoomOut(r,a){return this.zoomTo(this.getZoom()-1,r,a),this}getBearing(){return this.transform.bearing}setBearing(r,a){return this.jumpTo({bearing:r},a),this}getPadding(){return this.transform.padding}setPadding(r,a){return this.jumpTo({padding:r},a),this}rotateTo(r,a,h){return this.easeTo(f.extend({bearing:r},a),h)}resetNorth(r,a){return this.rotateTo(0,f.extend({duration:1e3},r),a),this}resetNorthPitch(r,a){return this.easeTo(f.extend({bearing:0,pitch:0,duration:1e3},r),a),this}snapToNorth(r,a){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(r,a):this}getPitch(){return this.transform.pitch}setPitch(r,a){return this.jumpTo({pitch:r},a),this}cameraForBounds(r,a){r=f.LngLatBounds.convert(r);const h=a&&a.bearing||0;return this._cameraForBoxAndBearing(r.getNorthWest(),r.getSouthEast(),h,a)}_cameraForBoxAndBearing(r,a,h,g){const v={top:0,bottom:0,right:0,left:0};if("number"==typeof(g=f.extend({padding:v,offset:[0,0],maxZoom:this.transform.maxZoom},g)).padding){const Oe=g.padding;g.padding={top:Oe,bottom:Oe,right:Oe,left:Oe}}g.padding=f.extend(v,g.padding);const D=this.transform,M=D.padding,S=D.project(f.LngLat.convert(r)),z=D.project(f.LngLat.convert(a)),q=S.rotate(-h*Math.PI/180),X=z.rotate(-h*Math.PI/180),re=new f.pointGeometry(Math.max(q.x,X.x),Math.max(q.y,X.y)),ue=new f.pointGeometry(Math.min(q.x,X.x),Math.min(q.y,X.y)),ie=re.sub(ue),ce=(D.width-(M.left+M.right+g.padding.left+g.padding.right))/ie.x,ye=(D.height-(M.top+M.bottom+g.padding.top+g.padding.bottom))/ie.y;if(ye<0||ce<0)return void f.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const ge=Math.min(D.scaleZoom(D.scale*Math.min(ce,ye)),g.maxZoom),Me=f.pointGeometry.convert(g.offset),xe=new f.pointGeometry((g.padding.left-g.padding.right)/2,(g.padding.top-g.padding.bottom)/2).rotate(h*Math.PI/180),$e=Me.add(xe).mult(D.scale/D.zoomScale(ge));return{center:D.unproject(S.add(z).div(2).sub($e)),zoom:ge,bearing:h}}fitBounds(r,a,h){return this._fitInternal(this.cameraForBounds(r,a),a,h)}fitScreenCoordinates(r,a,h,g,v){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(f.pointGeometry.convert(r)),this.transform.pointLocation(f.pointGeometry.convert(a)),h,g),g,v)}_fitInternal(r,a,h){return r?(delete(a=f.extend(r,a)).padding,a.linear?this.easeTo(a,h):this.flyTo(a,h)):this}jumpTo(r,a){this.stop();const h=this.transform;let g=!1,v=!1,D=!1;return"zoom"in r&&h.zoom!==+r.zoom&&(g=!0,h.zoom=+r.zoom),void 0!==r.center&&(h.center=f.LngLat.convert(r.center)),"bearing"in r&&h.bearing!==+r.bearing&&(v=!0,h.bearing=+r.bearing),"pitch"in r&&h.pitch!==+r.pitch&&(D=!0,h.pitch=+r.pitch),null==r.padding||h.isPaddingEqual(r.padding)||(h.padding=r.padding),this.fire(new f.Event("movestart",a)).fire(new f.Event("move",a)),g&&this.fire(new f.Event("zoomstart",a)).fire(new f.Event("zoom",a)).fire(new f.Event("zoomend",a)),v&&this.fire(new f.Event("rotatestart",a)).fire(new f.Event("rotate",a)).fire(new f.Event("rotateend",a)),D&&this.fire(new f.Event("pitchstart",a)).fire(new f.Event("pitch",a)).fire(new f.Event("pitchend",a)),this.fire(new f.Event("moveend",a))}easeTo(r,a){this._stop(!1,r.easeId),(!1===(r=f.extend({offset:[0,0],duration:500,easing:f.ease},r)).animate||!r.essential&&f.exported.prefersReducedMotion)&&(r.duration=0);const h=this.transform,g=this.getZoom(),v=this.getBearing(),D=this.getPitch(),M=this.getPadding(),S="zoom"in r?+r.zoom:g,z="bearing"in r?this._normalizeBearing(r.bearing,v):v,q="pitch"in r?+r.pitch:D,X="padding"in r?r.padding:h.padding,re=f.pointGeometry.convert(r.offset);let ue=h.centerPoint.add(re);const ie=h.pointLocation(ue),ce=f.LngLat.convert(r.center||ie);this._normalizeCenter(ce);const ye=h.project(ie),ge=h.project(ce).sub(ye),Me=h.zoomScale(S-g);let xe,$e;r.around&&(xe=f.LngLat.convert(r.around),$e=h.locationPoint(xe));const Oe={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||S!==g,this._rotating=this._rotating||v!==z,this._pitching=this._pitching||q!==D,this._padding=!h.isPaddingEqual(X),this._easeId=r.easeId,this._prepareEase(a,r.noMoveStart,Oe),this._ease(Ne=>{if(this._zooming&&(h.zoom=f.number(g,S,Ne)),this._rotating&&(h.bearing=f.number(v,z,Ne)),this._pitching&&(h.pitch=f.number(D,q,Ne)),this._padding&&(h.interpolatePadding(M,X,Ne),ue=h.centerPoint.add(re)),xe)h.setLocationAtPoint(xe,$e);else{const Je=h.zoomScale(h.zoom-g),at=S>g?Math.min(2,Me):Math.max(.5,Me),je=Math.pow(at,1-Ne),At=h.unproject(ye.add(ge.mult(Ne*je)).mult(Je));h.setLocationAtPoint(h.renderWorldCopies?At.wrap():At,ue)}this._fireMoveEvents(a)},Ne=>{this._afterEase(a,Ne)},r),this}_prepareEase(r,a,h={}){this._moving=!0,a||h.moving||this.fire(new f.Event("movestart",r)),this._zooming&&!h.zooming&&this.fire(new f.Event("zoomstart",r)),this._rotating&&!h.rotating&&this.fire(new f.Event("rotatestart",r)),this._pitching&&!h.pitching&&this.fire(new f.Event("pitchstart",r))}_fireMoveEvents(r){this.fire(new f.Event("move",r)),this._zooming&&this.fire(new f.Event("zoom",r)),this._rotating&&this.fire(new f.Event("rotate",r)),this._pitching&&this.fire(new f.Event("pitch",r))}_afterEase(r,a){if(this._easeId&&a&&this._easeId===a)return;delete this._easeId;const h=this._zooming,g=this._rotating,v=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,h&&this.fire(new f.Event("zoomend",r)),g&&this.fire(new f.Event("rotateend",r)),v&&this.fire(new f.Event("pitchend",r)),this.fire(new f.Event("moveend",r))}flyTo(r,a){if(!r.essential&&f.exported.prefersReducedMotion){const Ln=f.pick(r,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Ln,a)}this.stop(),r=f.extend({offset:[0,0],speed:1.2,curve:1.42,easing:f.ease},r);const h=this.transform,g=this.getZoom(),v=this.getBearing(),D=this.getPitch(),M=this.getPadding(),S="zoom"in r?f.clamp(+r.zoom,h.minZoom,h.maxZoom):g,z="bearing"in r?this._normalizeBearing(r.bearing,v):v,q="pitch"in r?+r.pitch:D,X="padding"in r?r.padding:h.padding,re=h.zoomScale(S-g),ue=f.pointGeometry.convert(r.offset);let ie=h.centerPoint.add(ue);const ce=h.pointLocation(ie),ye=f.LngLat.convert(r.center||ce);this._normalizeCenter(ye);const ge=h.project(ce),Me=h.project(ye).sub(ge);let xe=r.curve;const $e=Math.max(h.width,h.height),Oe=$e/re,Ne=Me.mag();if("minZoom"in r){const Ln=f.clamp(Math.min(r.minZoom,g,S),h.minZoom,h.maxZoom),pn=$e/h.zoomScale(Ln-g);xe=Math.sqrt(pn/Ne*2)}const Je=xe*xe;function at(Ln){const pn=(Oe*Oe-$e*$e+(Ln?-1:1)*Je*Je*Ne*Ne)/(2*(Ln?Oe:$e)*Je*Ne);return Math.log(Math.sqrt(pn*pn+1)-pn)}function je(Ln){return(Math.exp(Ln)-Math.exp(-Ln))/2}function At(Ln){return(Math.exp(Ln)+Math.exp(-Ln))/2}const vt=at(0);let an=function(Ln){return At(vt)/At(vt+xe*Ln)},Mn=function(Ln){return $e*((At(vt)*(je(pn=vt+xe*Ln)/At(pn))-je(vt))/Je)/Ne;var pn},In=(at(1)-vt)/xe;if(Math.abs(Ne)<1e-6||!isFinite(In)){if(Math.abs($e-Oe)<1e-6)return this.easeTo(r,a);const Ln=Oe<$e?-1:1;In=Math.abs(Math.log(Oe/$e))/xe,Mn=function(){return 0},an=function(pn){return Math.exp(Ln*xe*pn)}}return r.duration="duration"in r?+r.duration:1e3*In/("screenSpeed"in r?+r.screenSpeed/xe:+r.speed),r.maxDuration&&r.duration>r.maxDuration&&(r.duration=0),this._zooming=!0,this._rotating=v!==z,this._pitching=q!==D,this._padding=!h.isPaddingEqual(X),this._prepareEase(a,!1),this._ease(Ln=>{const pn=Ln*In,_n=1/an(pn);h.zoom=1===Ln?S:g+h.scaleZoom(_n),this._rotating&&(h.bearing=f.number(v,z,Ln)),this._pitching&&(h.pitch=f.number(D,q,Ln)),this._padding&&(h.interpolatePadding(M,X,Ln),ie=h.centerPoint.add(ue));const Gn=1===Ln?ye:h.unproject(ge.add(Me.mult(Mn(pn))).mult(_n));h.setLocationAtPoint(h.renderWorldCopies?Gn.wrap():Gn,ie),this._fireMoveEvents(a)},()=>this._afterEase(a),r),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(r,a){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const h=this._onEaseEnd;delete this._onEaseEnd,h.call(this,a)}if(!r){const h=this.handlers;h&&h.stop(!1)}return this}_ease(r,a,h){!1===h.animate||0===h.duration?(r(1),a()):(this._easeStart=f.exported.now(),this._easeOptions=h,this._onEaseFrame=r,this._onEaseEnd=a,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const r=Math.min((f.exported.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(r)),r<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(r,a){r=f.wrap(r,-180,180);const h=Math.abs(r-a);return Math.abs(r-360-a)<h&&(r-=360),Math.abs(r+360-a)<h&&(r+=360),r}_normalizeCenter(r){const a=this.transform;if(!a.renderWorldCopies||a.lngRange)return;const h=r.lng-a.center.lng;r.lng+=h>180?-360:h<-180?360:0}}class ls{constructor(r={}){this.options=r,f.bindAll(["_toggleAttribution","_updateData","_updateCompact","_updateCompactMinimize"],this)}getDefaultPosition(){return"bottom-right"}onAdd(r){return this._map=r,this._compact=this.options&&this.options.compact,this._container=Ee.create("details","maplibregl-ctrl maplibregl-ctrl-attrib mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Ee.create("summary","maplibregl-ctrl-attrib-button mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Ee.create("div","maplibregl-ctrl-attrib-inner mapboxgl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){Ee.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(r,a){const h=this._map._getUIString(`AttributionControl.${a}`);r.title=h,r.setAttribute("aria-label",h)}_toggleAttribution(){this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show","mapboxgl-compact-show")):(this._container.classList.add("maplibregl-compact-show","mapboxgl-compact-show"),this._container.removeAttribute("open")))}_updateData(r){!r||"metadata"!==r.sourceDataType&&"visibility"!==r.sourceDataType&&"style"!==r.dataType||this._updateAttributions()}_updateAttributions(){if(!this._map.style)return;let r=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?r=r.concat(this.options.customAttribution.map(g=>"string"!=typeof g?"":g)):"string"==typeof this.options.customAttribution&&r.push(this.options.customAttribution)),this._map.style.stylesheet){const g=this._map.style.stylesheet;this.styleOwner=g.owner,this.styleId=g.id}const a=this._map.style.sourceCaches;for(const g in a){const v=a[g];if(v.used){const D=v.getSource();D.attribution&&r.indexOf(D.attribution)<0&&r.push(D.attribution)}}r=r.filter(g=>String(g).trim()),r.sort((g,v)=>g.length-v.length),r=r.filter((g,v)=>{for(let D=v+1;D<r.length;D++)if(r[D].indexOf(g)>=0)return!1;return!0});const h=r.join(" | ");h!==this._attribHTML&&(this._attribHTML=h,r.length?(this._innerContainer.innerHTML=h,this._container.classList.remove("maplibregl-attrib-empty","mapboxgl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty","mapboxgl-attrib-empty"),this._updateCompact(),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640||this._compact?!1===this._compact?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","mapboxgl-compact","maplibregl-compact-show","mapboxgl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show","mapboxgl-compact","mapboxgl-compact-show"))}_updateCompactMinimize(){this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show","mapboxgl-compact-show")}}class Ra{constructor(r={}){this.options=r,f.bindAll(["_updateCompact"],this)}getDefaultPosition(){return"bottom-left"}onAdd(r){this._map=r,this._compact=this.options&&this.options.compact,this._container=Ee.create("div","maplibregl-ctrl mapboxgl-ctrl");const a=Ee.create("a","maplibregl-ctrl-logo mapboxgl-ctrl-logo");return a.target="_blank",a.rel="noopener nofollow",a.href="https://maplibre.org/",a.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),a.setAttribute("rel","noopener nofollow"),this._container.appendChild(a),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){Ee.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}_updateCompact(){const r=this._container.children;if(r.length){const a=r[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?!1!==this._compact&&a.classList.add("maplibregl-compact","mapboxgl-compact"):a.classList.remove("maplibregl-compact","mapboxgl-compact")}}}class vu{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(r){const a=++this._id;return this._queue.push({callback:r,id:a,cancelled:!1}),a}remove(r){const a=this._currentlyRunning,h=a?this._queue.concat(a):this._queue;for(const g of h)if(g.id===r)return void(g.cancelled=!0)}run(r=0){const a=this._currentlyRunning=this._queue;this._queue=[];for(const h of a)if(!h.cancelled&&(h.callback(r),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}const xu={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},Ph={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,fadeDuration:300,crossSourceCollisions:!0},qo={showCompass:!0,showZoom:!0,visualizePitch:!1};class Ts{constructor(r,a,h=!1){this._clickTolerance=10,this.element=a,this.mouseRotate=new Pt({clickTolerance:r.dragRotate._mouseRotate._clickTolerance}),this.map=r,h&&(this.mousePitch=new ua({clickTolerance:r.dragRotate._mousePitch._clickTolerance})),f.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),Ee.addEventListener(a,"mousedown",this.mousedown),Ee.addEventListener(a,"touchstart",this.touchstart,{passive:!1}),Ee.addEventListener(a,"touchmove",this.touchmove),Ee.addEventListener(a,"touchend",this.touchend),Ee.addEventListener(a,"touchcancel",this.reset)}down(r,a){this.mouseRotate.mousedown(r,a),this.mousePitch&&this.mousePitch.mousedown(r,a),Ee.disableDrag()}move(r,a){const h=this.map,g=this.mouseRotate.mousemoveWindow(r,a);if(g&&g.bearingDelta&&h.setBearing(h.getBearing()+g.bearingDelta),this.mousePitch){const v=this.mousePitch.mousemoveWindow(r,a);v&&v.pitchDelta&&h.setPitch(h.getPitch()+v.pitchDelta)}}off(){const r=this.element;Ee.removeEventListener(r,"mousedown",this.mousedown),Ee.removeEventListener(r,"touchstart",this.touchstart,{passive:!1}),Ee.removeEventListener(r,"touchmove",this.touchmove),Ee.removeEventListener(r,"touchend",this.touchend),Ee.removeEventListener(r,"touchcancel",this.reset),this.offTemp()}offTemp(){Ee.enableDrag(),Ee.removeEventListener(window,"mousemove",this.mousemove),Ee.removeEventListener(window,"mouseup",this.mouseup)}mousedown(r){this.down(f.extend({},r,{ctrlKey:!0,preventDefault:()=>r.preventDefault()}),Ee.mousePos(this.element,r)),Ee.addEventListener(window,"mousemove",this.mousemove),Ee.addEventListener(window,"mouseup",this.mouseup)}mousemove(r){this.move(r,Ee.mousePos(this.element,r))}mouseup(r){this.mouseRotate.mouseupWindow(r),this.mousePitch&&this.mousePitch.mouseupWindow(r),this.offTemp()}touchstart(r){1!==r.targetTouches.length?this.reset():(this._startPos=this._lastPos=Ee.touchPos(this.element,r.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>r.preventDefault()},this._startPos))}touchmove(r){1!==r.targetTouches.length?this.reset():(this._lastPos=Ee.touchPos(this.element,r.targetTouches)[0],this.move({preventDefault:()=>r.preventDefault()},this._lastPos))}touchend(r){0===r.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function zt(p,r,a){if(p=new f.LngLat(p.lng,p.lat),r){const h=new f.LngLat(p.lng-360,p.lat),g=new f.LngLat(p.lng+360,p.lat),v=a.locationPoint(p).distSqr(r);a.locationPoint(h).distSqr(r)<v?p=h:a.locationPoint(g).distSqr(r)<v&&(p=g)}for(;Math.abs(p.lng-a.center.lng)>180;){const h=a.locationPoint(p);if(h.x>=0&&h.y>=0&&h.x<=a.width&&h.y<=a.height)break;p.lng>a.center.lng?p.lng-=360:p.lng+=360}return p}const Kt={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function us(p,r,a){const h=p.classList;for(const g in Kt)h.remove(`maplibregl-${a}-anchor-${g}`,`mapboxgl-${a}-anchor-${g}`);h.add(`maplibregl-${a}-anchor-${r}`,`mapboxgl-${a}-anchor-${r}`)}class pa extends f.Evented{constructor(r,a){if(super(),(r instanceof HTMLElement||a)&&(r=f.extend({element:r},a)),f.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=r&&r.anchor||"center",this._color=r&&r.color||"#3FB1CE",this._scale=r&&r.scale||1,this._draggable=r&&r.draggable||!1,this._clickTolerance=r&&r.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=r&&r.rotation||0,this._rotationAlignment=r&&r.rotationAlignment||"auto",this._pitchAlignment=r&&r.pitchAlignment&&"auto"!==r.pitchAlignment?r.pitchAlignment:this._rotationAlignment,r&&r.element)this._element=r.element,this._offset=f.pointGeometry.convert(r&&r.offset||[0,0]);else{this._defaultMarker=!0,this._element=Ee.create("div"),this._element.setAttribute("aria-label","Map marker");const h=Ee.createNS("http://www.w3.org/2000/svg","svg"),g=41,v=27;h.setAttributeNS(null,"display","block"),h.setAttributeNS(null,"height",`${g}px`),h.setAttributeNS(null,"width",`${v}px`),h.setAttributeNS(null,"viewBox",`0 0 ${v} ${g}`);const D=Ee.createNS("http://www.w3.org/2000/svg","g");D.setAttributeNS(null,"stroke","none"),D.setAttributeNS(null,"stroke-width","1"),D.setAttributeNS(null,"fill","none"),D.setAttributeNS(null,"fill-rule","evenodd");const M=Ee.createNS("http://www.w3.org/2000/svg","g");M.setAttributeNS(null,"fill-rule","nonzero");const S=Ee.createNS("http://www.w3.org/2000/svg","g");S.setAttributeNS(null,"transform","translate(3.0, 29.0)"),S.setAttributeNS(null,"fill","#000000");const z=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const Me of z){const xe=Ee.createNS("http://www.w3.org/2000/svg","ellipse");xe.setAttributeNS(null,"opacity","0.04"),xe.setAttributeNS(null,"cx","10.5"),xe.setAttributeNS(null,"cy","5.80029008"),xe.setAttributeNS(null,"rx",Me.rx),xe.setAttributeNS(null,"ry",Me.ry),S.appendChild(xe)}const q=Ee.createNS("http://www.w3.org/2000/svg","g");q.setAttributeNS(null,"fill",this._color);const X=Ee.createNS("http://www.w3.org/2000/svg","path");X.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),q.appendChild(X);const re=Ee.createNS("http://www.w3.org/2000/svg","g");re.setAttributeNS(null,"opacity","0.25"),re.setAttributeNS(null,"fill","#000000");const ue=Ee.createNS("http://www.w3.org/2000/svg","path");ue.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),re.appendChild(ue);const ie=Ee.createNS("http://www.w3.org/2000/svg","g");ie.setAttributeNS(null,"transform","translate(6.0, 7.0)"),ie.setAttributeNS(null,"fill","#FFFFFF");const ce=Ee.createNS("http://www.w3.org/2000/svg","g");ce.setAttributeNS(null,"transform","translate(8.0, 8.0)");const ye=Ee.createNS("http://www.w3.org/2000/svg","circle");ye.setAttributeNS(null,"fill","#000000"),ye.setAttributeNS(null,"opacity","0.25"),ye.setAttributeNS(null,"cx","5.5"),ye.setAttributeNS(null,"cy","5.5"),ye.setAttributeNS(null,"r","5.4999962");const ge=Ee.createNS("http://www.w3.org/2000/svg","circle");ge.setAttributeNS(null,"fill","#FFFFFF"),ge.setAttributeNS(null,"cx","5.5"),ge.setAttributeNS(null,"cy","5.5"),ge.setAttributeNS(null,"r","5.4999962"),ce.appendChild(ye),ce.appendChild(ge),M.appendChild(S),M.appendChild(q),M.appendChild(re),M.appendChild(ie),M.appendChild(ce),h.appendChild(M),h.setAttributeNS(null,"height",g*this._scale+"px"),h.setAttributeNS(null,"width",v*this._scale+"px"),this._element.appendChild(h),this._offset=f.pointGeometry.convert(r&&r.offset||[0,-14])}this._element.classList.add("maplibregl-marker","mapboxgl-marker"),this._element.addEventListener("dragstart",h=>{h.preventDefault()}),this._element.addEventListener("mousedown",h=>{h.preventDefault()}),us(this._element,this._anchor,"marker"),this._popup=null}addTo(r){return this.remove(),this._map=r,r.getCanvasContainer().appendChild(this._element),r.on("move",this._update),r.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),Ee.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(r){return this._lngLat=f.LngLat.convert(r),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(r){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),r){if(!("offset"in r.options)){const g=Math.sqrt(Math.pow(13.5,2)/2);r.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[g,-1*(24.6+g)],"bottom-right":[-g,-1*(24.6+g)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=r,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}_onKeyPress(r){const a=r.code,h=r.charCode||r.keyCode;"Space"!==a&&"Enter"!==a&&32!==h&&13!==h||this.togglePopup()}_onMapClick(r){const a=r.originalEvent.target,h=this._element;this._popup&&(a===h||h.contains(a))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const r=this._popup;return r?(r.isOpen()?r.remove():r.addTo(this._map),this):this}_update(r){if(!this._map)return;this._map.transform.renderWorldCopies&&(this._lngLat=zt(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);let a="";"viewport"===this._rotationAlignment||"auto"===this._rotationAlignment?a=`rotateZ(${this._rotation}deg)`:"map"===this._rotationAlignment&&(a=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let h="";"viewport"===this._pitchAlignment||"auto"===this._pitchAlignment?h="rotateX(0deg)":"map"===this._pitchAlignment&&(h=`rotateX(${this._map.getPitch()}deg)`),r&&"moveend"!==r.type||(this._pos=this._pos.round()),Ee.setTransform(this._element,`${Kt[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${h} ${a}`)}getOffset(){return this._offset}setOffset(r){return this._offset=f.pointGeometry.convert(r),this._update(),this}_onMove(r){if(!this._isDragging){const a=this._clickTolerance||this._map._clickTolerance;this._isDragging=r.point.dist(this._pointerdownPos)>=a}this._isDragging&&(this._pos=r.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new f.Event("dragstart"))),this.fire(new f.Event("drag")))}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),"active"===this._state&&this.fire(new f.Event("dragend")),this._state="inactive"}_addDragHandler(r){this._element.contains(r.originalEvent.target)&&(r.preventDefault(),this._positionDelta=r.point.sub(this._pos).add(this._offset),this._pointerdownPos=r.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))}setDraggable(r){return this._draggable=!!r,this._map&&(r?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(r){return this._rotation=r||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(r){return this._rotationAlignment=r||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(r){return this._pitchAlignment=r&&"auto"!==r?r:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}const il={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Cr,Ps=0,Yr=!1;const Pl={maxWidth:100,unit:"metric"};function cs(p,r,a){const h=a&&a.maxWidth||100,g=p._container.clientHeight/2,v=p.unproject([0,g]),D=p.unproject([h,g]),M=v.distanceTo(D);if(a&&"imperial"===a.unit){const S=3.2808*M;S>5280?_r(r,h,S/5280,p._getUIString("ScaleControl.Miles")):_r(r,h,S,p._getUIString("ScaleControl.Feet"))}else a&&"nautical"===a.unit?_r(r,h,M/1852,p._getUIString("ScaleControl.NauticalMiles")):M>=1e3?_r(r,h,M/1e3,p._getUIString("ScaleControl.Kilometers")):_r(r,h,M,p._getUIString("ScaleControl.Meters"))}function _r(p,r,a,h){const g=function(v){const D=Math.pow(10,`${Math.floor(v)}`.length-1);let M=v/D;return M=M>=10?10:M>=5?5:M>=3?3:M>=2?2:M>=1?1:function(S){const z=Math.pow(10,Math.ceil(-Math.log(S)/Math.LN10));return Math.round(S*z)/z}(M),D*M}(a);p.style.width=r*(g/a)+"px",p.innerHTML=`${g}&nbsp;${h}`}const $r={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Fl=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function fa(p){if(p){if("number"==typeof p){const r=Math.round(Math.sqrt(.5*Math.pow(p,2)));return{center:new f.pointGeometry(0,0),top:new f.pointGeometry(0,p),"top-left":new f.pointGeometry(r,r),"top-right":new f.pointGeometry(-r,r),bottom:new f.pointGeometry(0,-p),"bottom-left":new f.pointGeometry(r,-r),"bottom-right":new f.pointGeometry(-r,-r),left:new f.pointGeometry(p,0),right:new f.pointGeometry(-p,0)}}if(p instanceof f.pointGeometry||Array.isArray(p)){const r=f.pointGeometry.convert(p);return{center:r,top:r,"top-left":r,"top-right":r,bottom:r,"bottom-left":r,"bottom-right":r,left:r,right:r}}return{center:f.pointGeometry.convert(p.center||[0,0]),top:f.pointGeometry.convert(p.top||[0,0]),"top-left":f.pointGeometry.convert(p["top-left"]||[0,0]),"top-right":f.pointGeometry.convert(p["top-right"]||[0,0]),bottom:f.pointGeometry.convert(p.bottom||[0,0]),"bottom-left":f.pointGeometry.convert(p["bottom-left"]||[0,0]),"bottom-right":f.pointGeometry.convert(p["bottom-right"]||[0,0]),left:f.pointGeometry.convert(p.left||[0,0]),right:f.pointGeometry.convert(p.right||[0,0])}}return fa(new f.pointGeometry(0,0))}const zi={supported:it,setRTLTextPlugin:f.setRTLTextPlugin,getRTLTextPluginStatus:f.getRTLTextPluginStatus,Map:class extends rl{constructor(p){var r;if(f.PerformanceUtils.mark(f.PerformanceMarkers.create),null!=(p=f.extend({},Ph,p)).minZoom&&null!=p.maxZoom&&p.minZoom>p.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=p.minPitch&&null!=p.maxPitch&&p.minPitch>p.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=p.minPitch&&p.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=p.maxPitch&&p.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new Oi(p.minZoom,p.maxZoom,p.minPitch,p.maxPitch,p.renderWorldCopies),{bearingSnap:p.bearingSnap}),this._interactive=p.interactive,this._maxTileCacheSize=p.maxTileCacheSize,this._failIfMajorPerformanceCaveat=p.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=p.preserveDrawingBuffer,this._antialias=p.antialias,this._trackResize=p.trackResize,this._bearingSnap=p.bearingSnap,this._refreshExpiredTiles=p.refreshExpiredTiles,this._fadeDuration=p.fadeDuration,this._crossSourceCollisions=p.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=p.collectResourceTiming,this._renderTaskQueue=new vu,this._controls=[],this._mapId=f.uniqueId(),this._locale=f.extend({},xu,p.locale),this._clickTolerance=p.clickTolerance,this._pixelRatio=null!==(r=p.pixelRatio)&&void 0!==r?r:devicePixelRatio,this._requestManager=new xt(p.transformRequest),"string"==typeof p.container){if(this._container=document.getElementById(p.container),!this._container)throw new Error(`Container '${p.container}' not found.`)}else{if(!(p.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=p.container}if(p.maxBounds&&this.setMaxBounds(p.maxBounds),f.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),typeof window<"u"&&(addEventListener("online",this._onWindowOnline,!1),addEventListener("resize",this._onWindowResize,!1),addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new wi(this,p),this._hash=p.hash&&new Ji("string"==typeof p.hash&&p.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:p.center,zoom:p.zoom,bearing:p.bearing,pitch:p.pitch}),p.bounds&&(this.resize(),this.fitBounds(p.bounds,f.extend({},p.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=p.localIdeographFontFamily,p.style&&this.setStyle(p.style,{localIdeographFontFamily:p.localIdeographFontFamily}),p.attributionControl&&this.addControl(new ls({customAttribution:p.customAttribution})),p.maplibreLogo&&this.addControl(new Ra,p.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",a=>{this._update("style"===a.dataType),this.fire(new f.Event(`${a.dataType}data`,a))}),this.on("dataloading",a=>{this.fire(new f.Event(`${a.dataType}dataloading`,a))}),this.on("dataabort",a=>{this.fire(new f.Event("sourcedataabort",a))})}_getMapId(){return this._mapId}addControl(p,r){if(void 0===r&&(r=p.getDefaultPosition?p.getDefaultPosition():"top-right"),!p||!p.onAdd)return this.fire(new f.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const a=p.onAdd(this);this._controls.push(p);const h=this._controlPositions[r];return-1!==r.indexOf("bottom")?h.insertBefore(a,h.firstChild):h.appendChild(a),this}removeControl(p){if(!p||!p.onRemove)return this.fire(new f.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const r=this._controls.indexOf(p);return r>-1&&this._controls.splice(r,1),p.onRemove(this),this}hasControl(p){return this._controls.indexOf(p)>-1}resize(p){const r=this._containerDimensions(),a=r[0],h=r[1];this._resizeCanvas(a,h,this.getPixelRatio()),this.transform.resize(a,h),this.painter.resize(a,h,this.getPixelRatio());const g=!this._moving;return g&&(this.stop(),this.fire(new f.Event("movestart",p)).fire(new f.Event("move",p))),this.fire(new f.Event("resize",p)),g&&this.fire(new f.Event("moveend",p)),this}getPixelRatio(){return this._pixelRatio}setPixelRatio(p){const[r,a]=this._containerDimensions();this._pixelRatio=p,this._resizeCanvas(r,a,p),this.painter.resize(r,a,p)}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(p){return this.transform.setMaxBounds(f.LngLatBounds.convert(p)),this._update()}setMinZoom(p){if((p=p??-2)>=-2&&p<=this.transform.maxZoom)return this.transform.minZoom=p,this._update(),this.getZoom()<p&&this.setZoom(p),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(p){if((p=p??22)>=this.transform.minZoom)return this.transform.maxZoom=p,this._update(),this.getZoom()>p&&this.setZoom(p),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(p){if((p=p??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(p>=0&&p<=this.transform.maxPitch)return this.transform.minPitch=p,this._update(),this.getPitch()<p&&this.setPitch(p),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(p){if((p=p??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(p>=this.transform.minPitch)return this.transform.maxPitch=p,this._update(),this.getPitch()>p&&this.setPitch(p),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(p){return this.transform.renderWorldCopies=p,this._update()}project(p){return this.transform.locationPoint(f.LngLat.convert(p))}unproject(p){return this.transform.pointLocation(f.pointGeometry.convert(p))}isMoving(){return this._moving||this.handlers.isMoving()}isZooming(){return this._zooming||this.handlers.isZooming()}isRotating(){return this._rotating||this.handlers.isRotating()}_createDelegatedListener(p,r,a){if("mouseenter"===p||"mouseover"===p){let h=!1;return{layer:r,listener:a,delegates:{mousemove:v=>{const D=this.getLayer(r)?this.queryRenderedFeatures(v.point,{layers:[r]}):[];D.length?h||(h=!0,a.call(this,new Br(p,this,v.originalEvent,{features:D}))):h=!1},mouseout:()=>{h=!1}}}}if("mouseleave"===p||"mouseout"===p){let h=!1;return{layer:r,listener:a,delegates:{mousemove:D=>{(this.getLayer(r)?this.queryRenderedFeatures(D.point,{layers:[r]}):[]).length?h=!0:h&&(h=!1,a.call(this,new Br(p,this,D.originalEvent)))},mouseout:D=>{h&&(h=!1,a.call(this,new Br(p,this,D.originalEvent)))}}}}{const h=g=>{const v=this.getLayer(r)?this.queryRenderedFeatures(g.point,{layers:[r]}):[];v.length&&(g.features=v,a.call(this,g),delete g.features)};return{layer:r,listener:a,delegates:{[p]:h}}}}on(p,r,a){if(void 0===a)return super.on(p,r);const h=this._createDelegatedListener(p,r,a);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[p]=this._delegatedListeners[p]||[],this._delegatedListeners[p].push(h);for(const g in h.delegates)this.on(g,h.delegates[g]);return this}once(p,r,a){if(void 0===a)return super.once(p,r);const h=this._createDelegatedListener(p,r,a);for(const g in h.delegates)this.once(g,h.delegates[g]);return this}off(p,r,a){return void 0===a?super.off(p,r):(this._delegatedListeners&&this._delegatedListeners[p]&&(h=>{const g=this._delegatedListeners[p];for(let v=0;v<g.length;v++){const D=g[v];if(D.layer===r&&D.listener===a){for(const M in D.delegates)this.off(M,D.delegates[M]);return g.splice(v,1),this}}})(),this)}queryRenderedFeatures(p,r){if(!this.style)return[];let a;if(void 0!==r||void 0===p||p instanceof f.pointGeometry||Array.isArray(p)||(r=p,p=void 0),r=r||{},(p=p||[[0,0],[this.transform.width,this.transform.height]])instanceof f.pointGeometry||"number"==typeof p[0])a=[f.pointGeometry.convert(p)];else{const h=f.pointGeometry.convert(p[0]),g=f.pointGeometry.convert(p[1]);a=[h,new f.pointGeometry(g.x,h.y),g,new f.pointGeometry(h.x,g.y),h]}return this.style.queryRenderedFeatures(a,r,this.transform)}querySourceFeatures(p,r){return this.style.querySourceFeatures(p,r)}setStyle(p,r){return!1!==(r=f.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},r)).diff&&r.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&p?(this._diffStyle(p,r),this):(this._localIdeographFontFamily=r.localIdeographFontFamily,this._updateStyle(p,r))}setTransformRequest(p){return this._requestManager.setTransformRequest(p),this}_getUIString(p){const r=this._locale[p];if(null==r)throw new Error(`Missing UI string '${p}'`);return r}_updateStyle(p,r){return this.style&&(this.style.setEventedParent(null),this.style._remove()),p?(this.style=new bn(this,r||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof p?this.style.loadURL(p):this.style.loadJSON(p),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new bn(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(p,r){if("string"==typeof p){const a=this._requestManager.transformRequest(p,f.ResourceType.Style);f.getJSON(a,(h,g)=>{h?this.fire(new f.ErrorEvent(h)):g&&this._updateDiff(g,r)})}else"object"==typeof p&&this._updateDiff(p,r)}_updateDiff(p,r){try{this.style.setState(p)&&this._update(!0)}catch(a){f.warnOnce(`Unable to perform style diff: ${a.message||a.error||a}.  Rebuilding the style from scratch.`),this._updateStyle(p,r)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():f.warnOnce("There is no style added to the map.")}addSource(p,r){return this._lazyInitEmptyStyle(),this.style.addSource(p,r),this._update(!0)}isSourceLoaded(p){const r=this.style&&this.style.sourceCaches[p];if(void 0!==r)return r.loaded();this.fire(new f.ErrorEvent(new Error(`There is no source with ID '${p}'`)))}areTilesLoaded(){const p=this.style&&this.style.sourceCaches;for(const r in p){const a=p[r]._tiles;for(const h in a){const g=a[h];if("loaded"!==g.state&&"errored"!==g.state)return!1}}return!0}addSourceType(p,r,a){return this._lazyInitEmptyStyle(),this.style.addSourceType(p,r,a)}removeSource(p){return this.style.removeSource(p),this._update(!0)}getSource(p){return this.style.getSource(p)}addImage(p,r,{pixelRatio:a=1,sdf:h=!1,stretchX:g,stretchY:v,content:D}={}){if(this._lazyInitEmptyStyle(),r instanceof HTMLImageElement||f.isImageBitmap(r)){const{width:M,height:S,data:z}=f.exported.getImageData(r);this.style.addImage(p,{data:new f.RGBAImage({width:M,height:S},z),pixelRatio:a,stretchX:g,stretchY:v,content:D,sdf:h,version:0})}else{if(void 0===r.width||void 0===r.height)return this.fire(new f.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:M,height:S,data:z}=r,q=r;this.style.addImage(p,{data:new f.RGBAImage({width:M,height:S},new Uint8Array(z)),pixelRatio:a,stretchX:g,stretchY:v,content:D,sdf:h,version:0,userImage:q}),q.onAdd&&q.onAdd(this,p)}}}updateImage(p,r){const a=this.style.getImage(p);if(!a)return this.fire(new f.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const h=r instanceof HTMLImageElement||f.isImageBitmap(r)?f.exported.getImageData(r):r,{width:g,height:v,data:D}=h;if(void 0===g||void 0===v)return this.fire(new f.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(g!==a.data.width||v!==a.data.height)return this.fire(new f.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image")));const M=!(r instanceof HTMLImageElement||f.isImageBitmap(r));a.data.replace(D,M),this.style.updateImage(p,a)}hasImage(p){return p?!!this.style.getImage(p):(this.fire(new f.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(p){this.style.removeImage(p)}loadImage(p,r){f.getImage(this._requestManager.transformRequest(p,f.ResourceType.Image),r)}listImages(){return this.style.listImages()}addLayer(p,r){return this._lazyInitEmptyStyle(),this.style.addLayer(p,r),this._update(!0)}moveLayer(p,r){return this.style.moveLayer(p,r),this._update(!0)}removeLayer(p){return this.style.removeLayer(p),this._update(!0)}getLayer(p){return this.style.getLayer(p)}setLayerZoomRange(p,r,a){return this.style.setLayerZoomRange(p,r,a),this._update(!0)}setFilter(p,r,a={}){return this.style.setFilter(p,r,a),this._update(!0)}getFilter(p){return this.style.getFilter(p)}setPaintProperty(p,r,a,h={}){return this.style.setPaintProperty(p,r,a,h),this._update(!0)}getPaintProperty(p,r){return this.style.getPaintProperty(p,r)}setLayoutProperty(p,r,a,h={}){return this.style.setLayoutProperty(p,r,a,h),this._update(!0)}getLayoutProperty(p,r){return this.style.getLayoutProperty(p,r)}setLight(p,r={}){return this._lazyInitEmptyStyle(),this.style.setLight(p,r),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(p,r){return this.style.setFeatureState(p,r),this._update()}removeFeatureState(p,r){return this.style.removeFeatureState(p,r),this._update()}getFeatureState(p){return this.style.getFeatureState(p)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let p=0,r=0;return this._container&&(p=this._container.clientWidth||400,r=this._container.clientHeight||300),[p,r]}_setupContainer(){const p=this._container;p.classList.add("maplibregl-map","mapboxgl-map");const r=this._canvasContainer=Ee.create("div","maplibregl-canvas-container mapboxgl-canvas-container",p);this._interactive&&r.classList.add("maplibregl-interactive","mapboxgl-interactive"),this._canvas=Ee.create("canvas","maplibregl-canvas mapboxgl-canvas",r),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const a=this._containerDimensions();this._resizeCanvas(a[0],a[1],this.getPixelRatio());const h=this._controlContainer=Ee.create("div","maplibregl-control-container mapboxgl-control-container",p),g=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(v=>{g[v]=Ee.create("div",`maplibregl-ctrl-${v} mapboxgl-ctrl-${v}`,h)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(p,r,a){this._canvas.width=a*p,this._canvas.height=a*r,this._canvas.style.width=`${p}px`,this._canvas.style.height=`${r}px`}_setupPainter(){const p=f.extend({},it.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),r=this._canvas.getContext("webgl",p)||this._canvas.getContext("experimental-webgl",p);r?(this.painter=new Ie(r,this.transform),f.exported$1.testSupport(r)):this.fire(new f.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(p){p.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new f.Event("webglcontextlost",{originalEvent:p}))}_contextRestored(p){this._setupPainter(),this.resize(),this._update(),this.fire(new f.Event("webglcontextrestored",{originalEvent:p}))}_onMapScroll(p){if(p.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(p){return this.style?(this._styleDirty=this._styleDirty||p,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(p){return this._update(),this._renderTaskQueue.add(p)}_cancelRenderFrame(p){this._renderTaskQueue.remove(p)}_render(p){let r,a=0;const h=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(r=h.createQueryEXT(),h.beginQueryEXT(h.TIME_ELAPSED_EXT,r),a=f.exported.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(p),this._removed)return;let g=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const D=this.transform.zoom,M=f.exported.now();this.style.zoomHistory.update(D,M);const S=new f.EvaluationParameters(D,{now:M,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),z=S.crossFadingFactor();1===z&&z===this._crossFadingFactor||(g=!0,this._crossFadingFactor=z),this.style.update(S)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new f.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,f.PerformanceUtils.mark(f.PerformanceMarkers.load),this.fire(new f.Event("load"))),this.style&&(this.style.hasTransitions()||g)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){const D=f.exported.now()-a;h.endQueryEXT(h.TIME_ELAPSED_EXT,r),setTimeout(()=>{const M=h.getQueryObjectEXT(r,h.QUERY_RESULT_EXT)/1e6;h.deleteQueryEXT(r),this.fire(new f.Event("gpu-timing-frame",{cpuTime:D,gpuTime:M}))},50)}if(this.listens("gpu-timing-layer")){const D=this.painter.collectGpuTimers();setTimeout(()=>{const M=this.painter.queryGpuTimers(D);this.fire(new f.Event("gpu-timing-layer",{layerTimes:M}))},50)}const v=this._sourcesDirty||this._styleDirty||this._placementDirty;return v||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new f.Event("idle")),!this._loaded||this._fullyLoaded||v||(this._fullyLoaded=!0,f.PerformanceUtils.mark(f.PerformanceMarkers.fullLoad)),this}redraw(){return this.style&&(this._frame&&(this._frame.cancel(),this._frame=null),this._render(0)),this}remove(){this._hash&&this._hash.remove();for(const r of this._controls)r.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&(removeEventListener("resize",this._onWindowResize,!1),removeEventListener("orientationchange",this._onWindowResize,!1),removeEventListener("online",this._onWindowOnline,!1));const p=this.painter.context.gl.getExtension("WEBGL_lose_context");p&&p.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),Ee.remove(this._canvasContainer),Ee.remove(this._controlContainer),this._container.classList.remove("maplibregl-map","mapboxgl-map"),f.PerformanceUtils.clearMetrics(),this._removed=!0,this.fire(new f.Event("remove"))}triggerRepaint(){this.style&&!this._frame&&(this._frame=f.exported.frame(p=>{f.PerformanceUtils.frame(p),this._frame=null,this._render(p)}))}_onWindowOnline(){this._update()}_onWindowResize(p){this._trackResize&&this.resize({originalEvent:p})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(p){this._showTileBoundaries!==p&&(this._showTileBoundaries=p,this._update())}get showPadding(){return!!this._showPadding}set showPadding(p){this._showPadding!==p&&(this._showPadding=p,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(p){this._showCollisionBoxes!==p&&(this._showCollisionBoxes=p,p?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(p){this._showOverdrawInspector!==p&&(this._showOverdrawInspector=p,this._update())}get repaint(){return!!this._repaint}set repaint(p){this._repaint!==p&&(this._repaint=p,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(p){this._vertices=p,this._update()}_setCacheLimits(p,r){f.setCacheLimits(p,r)}},NavigationControl:class{constructor(p){this.options=f.extend({},qo,p),this._container=Ee.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",r=>r.preventDefault()),this.options.showZoom&&(f.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in mapboxgl-ctrl-zoom-in",r=>this._map.zoomIn({},{originalEvent:r})),Ee.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out mapboxgl-ctrl-zoom-out",r=>this._map.zoomOut({},{originalEvent:r})),Ee.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(f.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("maplibregl-ctrl-compass mapboxgl-ctrl-compass",r=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:r}):this._map.resetNorth({},{originalEvent:r})}),this._compassIcon=Ee.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const p=this._map.getZoom(),r=p===this._map.getMaxZoom(),a=p===this._map.getMinZoom();this._zoomInButton.disabled=r,this._zoomOutButton.disabled=a,this._zoomInButton.setAttribute("aria-disabled",r.toString()),this._zoomOutButton.setAttribute("aria-disabled",a.toString())}_rotateCompassArrow(){const p=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=p}onAdd(p){return this._map=p,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Ts(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){Ee.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(p,r){const a=Ee.create("button",p,this._container);return a.type="button",a.addEventListener("click",r),a}_setButtonTitle(p,r){const a=this._map._getUIString(`NavigationControl.${r}`);p.title=a,p.setAttribute("aria-label",a)}},GeolocateControl:class extends f.Evented{constructor(p){super(),this.options=f.extend({},il,p),f.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}onAdd(p){var r;return this._map=p,this._container=Ee.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),r=this._setupUI,void 0!==Cr?r(Cr):void 0!==window.navigator.permissions?window.navigator.permissions.query({name:"geolocation"}).then(a=>{Cr="denied"!==a.state,r(Cr)}):(Cr=!!window.navigator.geolocation,r(Cr)),this._container}onRemove(){void 0!==this._geolocationWatchID&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),Ee.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Ps=0,Yr=!1}_isOutOfMapMaxBounds(p){const r=this._map.getMaxBounds(),a=p.coords;return r&&(a.longitude<r.getWest()||a.longitude>r.getEast()||a.latitude<r.getSouth()||a.latitude>r.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(p){if(this._map){if(this._isOutOfMapMaxBounds(p))return this._setErrorState(),this.fire(new f.Event("outofmaxbounds",p)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=p,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(p),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(p),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale","mapboxgl-user-location-dot-stale"),this.fire(new f.Event("geolocate",p)),this._finish()}}_updateCamera(p){const r=new f.LngLat(p.coords.longitude,p.coords.latitude),a=p.coords.accuracy,h=this._map.getBearing(),g=f.extend({bearing:h},this.options.fitBoundsOptions);this._map.fitBounds(r.toBounds(a),g,{geolocateSource:!0})}_updateMarker(p){if(p){const r=new f.LngLat(p.coords.longitude,p.coords.latitude);this._accuracyCircleMarker.setLngLat(r).addTo(this._map),this._userLocationDotMarker.setLngLat(r).addTo(this._map),this._accuracy=p.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const p=this._map._container.clientHeight/2,r=this._map.unproject([0,p]),a=this._map.unproject([1,p]),h=r.distanceTo(a),g=Math.ceil(2*this._accuracy/h);this._circleElement.style.width=`${g}px`,this._circleElement.style.height=`${g}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_onError(p){if(this._map){if(this.options.trackUserLocation)if(1===p.code){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=r,this._geolocateButton.setAttribute("aria-label",r),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===p.code&&Yr)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale","mapboxgl-user-location-dot-stale"),this.fire(new f.Event("error",p)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(p){if(this._container.addEventListener("contextmenu",r=>r.preventDefault()),this._geolocateButton=Ee.create("button","maplibregl-ctrl-geolocate mapboxgl-ctrl-geolocate",this._container),Ee.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===p){f.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=r,this._geolocateButton.setAttribute("aria-label",r)}else{const r=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=r,this._geolocateButton.setAttribute("aria-label",r)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Ee.create("div","maplibregl-user-location-dot mapboxgl-user-location-dot"),this._userLocationDotMarker=new pa(this._dotElement),this._circleElement=Ee.create("div","maplibregl-user-location-accuracy-circle mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new pa({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",r=>{r.geolocateSource||"ACTIVE_LOCK"!==this._watchState||r.originalEvent&&"resize"===r.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this.fire(new f.Event("trackuserlocationend")))})}trigger(){if(!this._setup)return f.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new f.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Ps--,Yr=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this.fire(new f.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new f.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let p;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Ps++,Ps>1?(p={maximumAge:6e5,timeout:0},Yr=!0):(p=this.options.positionOptions,Yr=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,p)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:ls,LogoControl:Ra,ScaleControl:class{constructor(p){this.options=f.extend({},Pl,p),f.bindAll(["_onMove","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_onMove(){cs(this._map,this._container,this.options)}onAdd(p){return this._map=p,this._container=Ee.create("div","maplibregl-ctrl maplibregl-ctrl-scale mapboxgl-ctrl mapboxgl-ctrl-scale",p.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){Ee.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}setUnit(p){this.options.unit=p,cs(this._map,this._container,this.options)}},FullscreenControl:class{constructor(p){this._fullscreen=!1,p&&p.container&&(p.container instanceof HTMLElement?this._container=p.container:f.warnOnce("Full screen control 'container' must be a DOM element.")),f.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(p){return this._map=p,this._container||(this._container=this._map.getContainer()),this._controlContainer=Ee.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",f.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){Ee.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!!(document.fullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled||document.webkitFullscreenEnabled)}_setupUI(){const p=this._fullscreenButton=Ee.create("button","maplibregl-ctrl-fullscreen mapboxgl-ctrl-fullscreen",this._controlContainer);Ee.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",p).setAttribute("aria-hidden","true"),p.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const p=this._getTitle();this._fullscreenButton.setAttribute("aria-label",p),this._fullscreenButton.title=p}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen&&window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends f.Evented{constructor(p){super(),this.options=f.extend(Object.create($r),p),f.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}addTo(p){return this._map&&this.remove(),this._map=p,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer","mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new f.Event("open")),this}isOpen(){return!!this._map}remove(){return this._content&&Ee.remove(this._content),this._container&&(Ee.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new f.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(p){return this._lngLat=f.LngLat.convert(p),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer","mapboxgl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer","mapboxgl-track-pointer")),this}getElement(){return this._container}setText(p){return this.setDOMContent(document.createTextNode(p))}setHTML(p){const r=document.createDocumentFragment(),a=document.createElement("body");let h;for(a.innerHTML=p;h=a.firstChild,h;)r.appendChild(h);return this.setDOMContent(r)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(p){return this.options.maxWidth=p,this._update(),this}setDOMContent(p){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=Ee.create("div","maplibregl-popup-content mapboxgl-popup-content",this._container);return this._content.appendChild(p),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(p){this._container&&this._container.classList.add(p)}removeClassName(p){this._container&&this._container.classList.remove(p)}setOffset(p){return this.options.offset=p,this._update(),this}toggleClassName(p){if(this._container)return this._container.classList.toggle(p)}_createCloseButton(){this.options.closeButton&&(this._closeButton=Ee.create("button","maplibregl-popup-close-button mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_onMouseUp(p){this._update(p.point)}_onMouseMove(p){this._update(p.point)}_onDrag(p){this._update(p.point)}_update(p){if(!this._map||!this._lngLat&&!this._trackPointer||!this._content||(this._container||(this._container=Ee.create("div","maplibregl-popup mapboxgl-popup",this._map.getContainer()),this._tip=Ee.create("div","maplibregl-popup-tip mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(v=>this._container.classList.add(v)),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=zt(this._lngLat,this._pos,this._map.transform)),this._trackPointer&&!p))return;const r=this._pos=this._trackPointer&&p?p:this._map.project(this._lngLat);let a=this.options.anchor;const h=fa(this.options.offset);if(!a){const v=this._container.offsetWidth,D=this._container.offsetHeight;let M;M=r.y+h.bottom.y<D?["top"]:r.y>this._map.transform.height-D?["bottom"]:[],r.x<v/2?M.push("left"):r.x>this._map.transform.width-v/2&&M.push("right"),a=0===M.length?"bottom":M.join("-")}const g=r.add(h[a]).round();Ee.setTransform(this._container,`${Kt[a]} translate(${g.x}px,${g.y}px)`),us(this._container,a,"popup")}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const p=this._container.querySelector(Fl);p&&p.focus()}_onClose(){this.remove()}},Marker:pa,Style:bn,LngLat:f.LngLat,LngLatBounds:f.LngLatBounds,Point:f.pointGeometry,MercatorCoordinate:f.MercatorCoordinate,Evented:f.Evented,AJAXError:f.AJAXError,config:f.config,CanvasSource:qn,GeoJSONSource:bt,ImageSource:fr,RasterDEMTileSource:ze,RasterTileSource:De,VectorTileSource:ke,VideoSource:on,prewarm:function(){fn().acquire(Ci)},clearPrewarmedResources:function(){const p=tr;p&&(p.isPreloaded()&&1===p.numActive()?(p.release(Ci),tr=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get workerCount(){return Qr.workerCount},set workerCount(p){Qr.workerCount=p},get maxParallelImageRequests(){return f.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(p){f.config.MAX_PARALLEL_IMAGE_REQUESTS=p},clearStorage(p){f.clearTileCache(p)},workerUrl:"",addProtocol(p,r){f.config.REGISTERED_PROTOCOLS[p]=r},removeProtocol(p){delete f.config.REGISTERED_PROTOCOLS[p]}};return yr.extend(zi,{isSafari:f.isSafari,getPerformanceMetrics:f.PerformanceUtils.getPerformanceMetrics}),zi}),N}()},666:(jn,Lt,we)=>{"use strict";we.d(Lt,{HT:()=>it,JF:()=>ra,K0:()=>kt,Mx:()=>rr,O5:()=>_i,bD:()=>jo,ez:()=>Qs,mk:()=>bn,q:()=>Rt,sg:()=>Bo,w_:()=>Qt});var N=we(888);let Ae=null;function Rt(){return Ae}function it(L){Ae||(Ae=L)}class Qt{}const kt=new N.OlP("DocumentToken");function rr(L,K){K=encodeURIComponent(K);for(const R of L.split(";")){const oe=R.indexOf("="),[ve,Ue]=-1==oe?[R,""]:[R.slice(0,oe),R.slice(oe+1)];if(ve.trim()===K)return decodeURIComponent(Ue)}return null}let bn=(()=>{class L{constructor(R,oe,ve,Ue){this._iterableDiffers=R,this._keyValueDiffers=oe,this._ngEl=ve,this._renderer=Ue,this._iterableDiffer=null,this._keyValueDiffer=null,this._initialClasses=[],this._rawClass=null}set klass(R){this._removeClasses(this._initialClasses),this._initialClasses="string"==typeof R?R.split(/\s+/):[],this._applyClasses(this._initialClasses),this._applyClasses(this._rawClass)}set ngClass(R){this._removeClasses(this._rawClass),this._applyClasses(this._initialClasses),this._iterableDiffer=null,this._keyValueDiffer=null,this._rawClass="string"==typeof R?R.split(/\s+/):R,this._rawClass&&((0,N.sIi)(this._rawClass)?this._iterableDiffer=this._iterableDiffers.find(this._rawClass).create():this._keyValueDiffer=this._keyValueDiffers.find(this._rawClass).create())}ngDoCheck(){if(this._iterableDiffer){const R=this._iterableDiffer.diff(this._rawClass);R&&this._applyIterableChanges(R)}else if(this._keyValueDiffer){const R=this._keyValueDiffer.diff(this._rawClass);R&&this._applyKeyValueChanges(R)}}_applyKeyValueChanges(R){R.forEachAddedItem(oe=>this._toggleClass(oe.key,oe.currentValue)),R.forEachChangedItem(oe=>this._toggleClass(oe.key,oe.currentValue)),R.forEachRemovedItem(oe=>{oe.previousValue&&this._toggleClass(oe.key,!1)})}_applyIterableChanges(R){R.forEachAddedItem(oe=>{if("string"!=typeof oe.item)throw new Error(`NgClass can only toggle CSS classes expressed as strings, got ${(0,N.AaK)(oe.item)}`);this._toggleClass(oe.item,!0)}),R.forEachRemovedItem(oe=>this._toggleClass(oe.item,!1))}_applyClasses(R){R&&(Array.isArray(R)||R instanceof Set?R.forEach(oe=>this._toggleClass(oe,!0)):Object.keys(R).forEach(oe=>this._toggleClass(oe,!!R[oe])))}_removeClasses(R){R&&(Array.isArray(R)||R instanceof Set?R.forEach(oe=>this._toggleClass(oe,!1)):Object.keys(R).forEach(oe=>this._toggleClass(oe,!1)))}_toggleClass(R,oe){(R=R.trim())&&R.split(/\s+/g).forEach(ve=>{oe?this._renderer.addClass(this._ngEl.nativeElement,ve):this._renderer.removeClass(this._ngEl.nativeElement,ve)})}}return L.\u0275fac=function(R){return new(R||L)(N.Y36(N.ZZ4),N.Y36(N.aQg),N.Y36(N.SBq),N.Y36(N.Qsj))},L.\u0275dir=N.lG2({type:L,selectors:[["","ngClass",""]],inputs:{klass:["class","klass"],ngClass:"ngClass"}}),L})();class Ot{constructor(K,R,oe,ve){this.$implicit=K,this.ngForOf=R,this.index=oe,this.count=ve}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let Bo=(()=>{class L{constructor(R,oe,ve){this._viewContainer=R,this._template=oe,this._differs=ve,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForOf(R){this._ngForOf=R,this._ngForOfDirty=!0}set ngForTrackBy(R){this._trackByFn=R}get ngForTrackBy(){return this._trackByFn}set ngForTemplate(R){R&&(this._template=R)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const R=this._ngForOf;!this._differ&&R&&(this._differ=this._differs.find(R).create(this.ngForTrackBy))}if(this._differ){const R=this._differ.diff(this._ngForOf);R&&this._applyChanges(R)}}_applyChanges(R){const oe=this._viewContainer;R.forEachOperation((ve,Ue,ot)=>{if(null==ve.previousIndex)oe.createEmbeddedView(this._template,new Ot(ve.item,this._ngForOf,-1,-1),null===ot?void 0:ot);else if(null==ot)oe.remove(null===Ue?void 0:Ue);else if(null!==Ue){const Bt=oe.get(Ue);oe.move(Bt,ot),Ri(Bt,ve)}});for(let ve=0,Ue=oe.length;ve<Ue;ve++){const Bt=oe.get(ve).context;Bt.index=ve,Bt.count=Ue,Bt.ngForOf=this._ngForOf}R.forEachIdentityChange(ve=>{Ri(oe.get(ve.currentIndex),ve)})}static ngTemplateContextGuard(R,oe){return!0}}return L.\u0275fac=function(R){return new(R||L)(N.Y36(N.s_b),N.Y36(N.Rgc),N.Y36(N.ZZ4))},L.\u0275dir=N.lG2({type:L,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"}}),L})();function Ri(L,K){L.context.$implicit=K.item}let _i=(()=>{class L{constructor(R,oe){this._viewContainer=R,this._context=new zr,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=oe}set ngIf(R){this._context.$implicit=this._context.ngIf=R,this._updateView()}set ngIfThen(R){Wi("ngIfThen",R),this._thenTemplateRef=R,this._thenViewRef=null,this._updateView()}set ngIfElse(R){Wi("ngIfElse",R),this._elseTemplateRef=R,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(R,oe){return!0}}return L.\u0275fac=function(R){return new(R||L)(N.Y36(N.s_b),N.Y36(N.Rgc))},L.\u0275dir=N.lG2({type:L,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"}}),L})();class zr{constructor(){this.$implicit=null,this.ngIf=null}}function Wi(L,K){if(K&&!K.createEmbeddedView)throw new Error(`${L} must be a TemplateRef, but received '${(0,N.AaK)(K)}'.`)}let Qs=(()=>{class L{}return L.\u0275fac=function(R){return new(R||L)},L.\u0275mod=N.oAB({type:L}),L.\u0275inj=N.cJS({}),L})();const jo="browser";class ra{}},888:(jn,Lt,we)=>{"use strict";we.d(Lt,{AFp:()=>X_,ip1:()=>K_,CZH:()=>ip,hGG:()=>C1,sBO:()=>l1,EJc:()=>$w,SBq:()=>Ch,qLn:()=>Wl,vpe:()=>Ca,OlP:()=>pn,zs3:()=>sr,ZZ4:()=>mm,aQg:()=>gm,soG:()=>op,h0i:()=>fu,R0b:()=>es,Lbi:()=>Vw,g9A:()=>Q_,Qsj:()=>Ib,FYo:()=>c_,JOm:()=>Yo,Rgc:()=>Sh,dDg:()=>Jw,eoX:()=>iv,GfV:()=>h_,s_b:()=>tp,ifc:()=>Yn,hM9:()=>zb,eFA:()=>lv,G48:()=>a1,Gpc:()=>en,_c5:()=>D1,zSh:()=>Ve,wAp:()=>yn,vHH:()=>De,lri:()=>nv,rWj:()=>rv,D6c:()=>E1,cg1:()=>Rf,kL8:()=>ky,dqk:()=>rn,sIi:()=>yh,CqO:()=>zg,QGY:()=>Sf,F4k:()=>Og,RDi:()=>ir,AaK:()=>Yt,qOj:()=>vf,TTD:()=>ta,_Bn:()=>a_,xp6:()=>Td,uIk:()=>wf,Tol:()=>sy,ekj:()=>Ff,Xpm:()=>Q,lG2:()=>Be,Yz7:()=>Xe,cJS:()=>T,oAB:()=>te,Yjl:()=>Pe,Y36:()=>va,_UZ:()=>Ef,qZA:()=>Hd,TgZ:()=>Gd,n5z:()=>xe,LFG:()=>Kr,$8M:()=>Je,NdJ:()=>Af,CRH:()=>S_,Hsn:()=>jg,F$t:()=>Ug,Q6J:()=>Df,DdM:()=>m_,iGM:()=>M_,MAs:()=>Lg,Akn:()=>Hs,YNc:()=>kg,_uU:()=>py,Oqu:()=>Lf,hij:()=>Zd,Gf:()=>I_});var N=we(635),Ae=we(987),Rt=we(944),f=we(817),it=we(945),kt=we(971);function It(e,n,o=1/0){return(0,kt.m)(n)?It((l,c)=>(0,N.U)((m,x)=>n(l,m,c,x))((0,Ae.Xf)(e(l,c))),o):("number"==typeof n&&(o=n),(0,Rt.e)((l,c)=>function Qt(e,n,o,l,c,m,x,w){const E=[];let O=0,W=0,se=!1;const fe=()=>{se&&!E.length&&!O&&n.complete()},Se=et=>O<l?qe(et):E.push(et),qe=et=>{m&&n.next(et),O++;let Ct=!1;(0,Ae.Xf)(o(et,W++)).subscribe((0,it.x)(n,Et=>{c?.(Et),m?Se(Et):n.next(Et)},()=>{Ct=!0},void 0,()=>{if(Ct)try{for(O--;E.length&&O<l;){const Et=E.shift();x?(0,f.f)(n,x,()=>qe(Et)):qe(Et)}fe()}catch(Et){n.error(Et)}}))};return e.subscribe((0,it.x)(n,Se,()=>{se=!0,fe()})),()=>{w?.()}}(l,c,e,o)))}var Ee=we(173),Ze=we(591),Wt=we(273),Vn=we(957);function Vt(...e){const n=(0,Wt.yG)(e),o=(0,Wt._6)(e,1/0),l=e;return l.length?1===l.length?(0,Ae.Xf)(l[0]):function xt(e=1/0){return It(Ee.y,e)}(o)((0,Vn.D)(l,n)):Ze.E}var Un=we(253),Gt=we(714),dn=we(336),wn=we(295),Dn=we(138);function pt(e,n,...o){return!0===n?(e(),null):!1===n?null:n(...o).pipe((0,wn.q)(1)).subscribe(()=>e())}function Ge(e){for(let n in e)if(e[n]===Ge)return n;throw Error("Could not find renamed property on target object.")}function Xt(e,n){for(const o in n)n.hasOwnProperty(o)&&!e.hasOwnProperty(o)&&(e[o]=n[o])}function Yt(e){if("string"==typeof e)return e;if(Array.isArray(e))return"["+e.map(Yt).join(", ")+"]";if(null==e)return""+e;if(e.overriddenName)return`${e.overriddenName}`;if(e.name)return`${e.name}`;const n=e.toString();if(null==n)return""+n;const o=n.indexOf("\n");return-1===o?n:n.substring(0,o)}function jt(e,n){return null==e||""===e?null===n?"":n:null==n||""===n?e:e+" "+n}const tn=Ge({__forward_ref__:Ge});function en(e){return e.__forward_ref__=en,e.toString=function(){return Yt(this())},e}function me(e){return _e(e)?e():e}function _e(e){return"function"==typeof e&&e.hasOwnProperty(tn)&&e.__forward_ref__===en}class De extends Error{constructor(n,o){super(function Re(e,n){return`NG0${Math.abs(e)}${n?": "+n.trim():""}`}(n,o)),this.code=n}}function ze(e){return"string"==typeof e?e:null==e?"":String(e)}function qn(e,n){throw new De(-201,!1)}function tr(e,n){null==e&&function fn(e,n,o,l){throw new Error(`ASSERTION ERROR: ${e}`+(null==l?"":` [Expected=> ${o} ${l} ${n} <=Actual]`))}(n,e,null,"!=")}function Xe(e){return{token:e.token,providedIn:e.providedIn||null,factory:e.factory,value:void 0}}function T(e){return{providers:e.providers||[],imports:e.imports||[]}}function ae(e){return pe(e,ut)||pe(e,lr)}function pe(e,n){return e.hasOwnProperty(n)?e[n]:null}function ht(e){return e&&(e.hasOwnProperty(Dr)||e.hasOwnProperty(Wn))?e[Dr]:null}const ut=Ge({\u0275prov:Ge}),Dr=Ge({\u0275inj:Ge}),lr=Ge({ngInjectableDef:Ge}),Wn=Ge({ngInjectorDef:Ge});var mt=(()=>((mt=mt||{})[mt.Default=0]="Default",mt[mt.Host=1]="Host",mt[mt.Self=2]="Self",mt[mt.SkipSelf=4]="SkipSelf",mt[mt.Optional=8]="Optional",mt))();let Qe;function _t(e){const n=Qe;return Qe=e,n}function Or(e,n,o){const l=ae(e);return l&&"root"==l.providedIn?void 0===l.value?l.value=l.factory():l.value:o&mt.Optional?null:void 0!==n?n:void qn(Yt(e))}function nn(e){return{toString:e}.toString()}var gr=(()=>((gr=gr||{})[gr.OnPush=0]="OnPush",gr[gr.Default=1]="Default",gr))(),Yn=(()=>{return(e=Yn||(Yn={}))[e.Emulated=0]="Emulated",e[e.None=2]="None",e[e.ShadowDom=3]="ShadowDom",Yn;var e})();const rn=(()=>typeof globalThis<"u"&&globalThis||typeof global<"u"&&global||typeof window<"u"&&window||typeof self<"u"&&typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&self)(),Jn={},vn=[],jr=Ge({\u0275cmp:Ge}),Li=Ge({\u0275dir:Ge}),ui=Ge({\u0275pipe:Ge}),Ei=Ge({\u0275mod:Ge}),ne=Ge({\u0275fac:Ge}),k=Ge({__NG_ELEMENT_ID__:Ge});let B=0;function Q(e){return nn(()=>{const o=!0===e.standalone,l={},c={type:e.type,providersResolver:null,decls:e.decls,vars:e.vars,factory:null,template:e.template||null,consts:e.consts||null,ngContentSelectors:e.ngContentSelectors,hostBindings:e.hostBindings||null,hostVars:e.hostVars||0,hostAttrs:e.hostAttrs||null,contentQueries:e.contentQueries||null,declaredInputs:l,inputs:null,outputs:null,exportAs:e.exportAs||null,onPush:e.changeDetection===gr.OnPush,directiveDefs:null,pipeDefs:null,standalone:o,dependencies:o&&e.dependencies||null,getStandaloneInjector:null,selectors:e.selectors||vn,viewQuery:e.viewQuery||null,features:e.features||null,data:e.data||{},encapsulation:e.encapsulation||Yn.Emulated,id:"c"+B++,styles:e.styles||vn,_:null,setInput:null,schemas:e.schemas||null,tView:null},m=e.dependencies,x=e.features;return c.inputs=Ce(e.inputs,l),c.outputs=Ce(e.outputs),x&&x.forEach(w=>w(c)),c.directiveDefs=m?()=>("function"==typeof m?m():m).map(U).filter(G):null,c.pipeDefs=m?()=>("function"==typeof m?m():m).map(ct).filter(G):null,c})}function U(e){return tt(e)||st(e)}function G(e){return null!==e}const Y={};function te(e){return nn(()=>{const n={type:e.type,bootstrap:e.bootstrap||vn,declarations:e.declarations||vn,imports:e.imports||vn,exports:e.exports||vn,transitiveCompileScopes:null,schemas:e.schemas||null,id:e.id||null};return null!=e.id&&(Y[e.id]=e.type),n})}function Ce(e,n){if(null==e)return Jn;const o={};for(const l in e)if(e.hasOwnProperty(l)){let c=e[l],m=c;Array.isArray(c)&&(m=c[1],c=c[0]),o[c]=l,n&&(n[c]=m)}return o}const Be=Q;function Pe(e){return{type:e.type,name:e.name,factory:null,pure:!1!==e.pure,standalone:!0===e.standalone,onDestroy:e.type.prototype.ngOnDestroy||null}}function tt(e){return e[jr]||null}function st(e){return e[Li]||null}function ct(e){return e[ui]||null}function Nr(e){return Array.isArray(e)&&"object"==typeof e[1]}function xi(e){return Array.isArray(e)&&!0===e[1]}function ts(e){return 0!=(8&e.flags)}function Ao(e){return 2==(2&e.flags)}function fo(e){return 1==(1&e.flags)}function ti(e){return null!==e.template}function Ws(e){return 0!=(256&e[2])}function go(e,n){return e.hasOwnProperty(ne)?e[ne]:null}class To{constructor(n,o,l){this.previousValue=n,this.currentValue=o,this.firstChange=l}isFirstChange(){return this.firstChange}}function ta(){return ws}function ws(e){return e.type.prototype.ngOnChanges&&(e.setInput=na),Qa}function Qa(){const e=Aa(this),n=e?.current;if(n){const o=e.previous;if(o===Jn)e.previous=n;else for(let l in n)o[l]=n[l];e.current=null,this.ngOnChanges(n)}}function na(e,n,o,l){const c=Aa(e)||function ra(e,n){return e[Ds]=n}(e,{previous:Jn,current:null}),m=c.current||(c.current={}),x=c.previous,w=this.declaredInputs[o],E=x[w];m[w]=new To(E&&E.currentValue,n,x===Jn),e[l]=n}ta.ngInherit=!0;const Ds="__ngSimpleChanges__";function Aa(e){return e[Ds]||null}let Bn;function ir(e){Bn=e}function xn(e){return!!e.listen}const Jt={createRenderer:(e,n)=>function Kn(){return void 0!==Bn?Bn:typeof document<"u"?document:void 0}()};function cn(e){for(;Array.isArray(e);)e=e[0];return e}function bi(e,n){return cn(n[e])}function ci(e,n){return cn(n[e.index])}function ko(e,n){return e.data[n]}function hi(e,n){const o=n[e];return Nr(o)?o:o[0]}function Cs(e){return 4==(4&e[2])}function Es(e){return 64==(64&e[2])}function Ki(e,n){return null==n?null:e[n]}function Xi(e){e[18]=0}function Ta(e,n){e[5]+=n;let o=e,l=e[3];for(;null!==l&&(1===n&&1===o[5]||-1===n&&0===o[5]);)l[5]+=n,o=l,l=l[3]}const gn={lFrame:as(null),bindingsEnabled:!0};function F(){return gn.bindingsEnabled}function j(){return gn.lFrame.lView}function Ie(){return gn.lFrame.tView}function zn(){let e=Oi();for(;null!==e&&64===e.type;)e=e.parent;return e}function Oi(){return gn.lFrame.currentTNode}function qr(e,n){const o=gn.lFrame;o.currentTNode=e,o.isParent=n}function os(){return gn.lFrame.isParent}function oa(){gn.lFrame.isParent=!1}function aa(){return gn.lFrame.bindingIndex++}function Si(e){const n=gn.lFrame,o=n.bindingIndex;return n.bindingIndex=n.bindingIndex+e,o}function Ss(e,n){const o=gn.lFrame;o.bindingIndex=o.bindingRootIndex=e,Fa(n)}function Fa(e){gn.lFrame.currentDirectiveIndex=e}function Ml(){return gn.lFrame.currentQueryIndex}function Go(e){gn.lFrame.currentQueryIndex=e}function la(e){const n=e[1];return 2===n.type?n.declTNode:1===n.type?e[6]:null}function Pt(e,n,o){if(o&mt.SkipSelf){let c=n,m=e;for(;!(c=c.parent,null!==c||o&mt.Host||(c=la(m),null===c||(m=m[15],10&c.type))););if(null===c)return!1;n=c,e=m}const l=gn.lFrame=ca();return l.currentTNode=n,l.lView=e,!0}function ua(e){const n=ca(),o=e[1];gn.lFrame=n,n.currentTNode=o.firstChild,n.lView=e,n.tView=o,n.contextLView=e,n.bindingIndex=o.bindingStartIndex,n.inI18n=!1}function ca(){const e=gn.lFrame,n=null===e?null:e.child;return null===n?as(e):n}function as(e){const n={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:e,child:null,inI18n:!1};return null!==e&&(e.child=n),n}function ha(){const e=gn.lFrame;return gn.lFrame=e.parent,e.currentTNode=null,e.lView=null,e}const yt=ha;function da(){const e=ha();e.isParent=!0,e.tView=null,e.selectedIndex=-1,e.contextLView=null,e.elementDepthCount=0,e.currentDirectiveIndex=-1,e.currentNamespace=null,e.bindingRootIndex=-1,e.bindingIndex=-1,e.currentQueryIndex=0}function Wr(){return gn.lFrame.selectedIndex}function Ho(e){gn.lFrame.selectedIndex=e}function Tr(){const e=gn.lFrame;return ko(e.tView,e.selectedIndex)}function di(e,n){for(let o=n.directiveStart,l=n.directiveEnd;o<l;o++){const m=e.data[o].type.prototype,{ngAfterContentInit:x,ngAfterContentChecked:w,ngAfterViewInit:E,ngAfterViewChecked:O,ngOnDestroy:W}=m;x&&(e.contentHooks||(e.contentHooks=[])).push(-o,x),w&&((e.contentHooks||(e.contentHooks=[])).push(o,w),(e.contentCheckHooks||(e.contentCheckHooks=[])).push(o,w)),E&&(e.viewHooks||(e.viewHooks=[])).push(-o,E),O&&((e.viewHooks||(e.viewHooks=[])).push(o,O),(e.viewCheckHooks||(e.viewCheckHooks=[])).push(o,O)),null!=W&&(e.destroyHooks||(e.destroyHooks=[])).push(o,W)}}function yo(e,n,o){As(e,n,3,o)}function ka(e,n,o,l){(3&e[2])===o&&As(e,n,o,l)}function La(e,n){let o=e[2];(3&o)===n&&(o&=2047,o+=1,e[2]=o)}function As(e,n,o,l){const m=l??-1,x=n.length-1;let w=0;for(let E=void 0!==l?65535&e[18]:0;E<x;E++)if("number"==typeof n[E+1]){if(w=n[E],null!=l&&w>=l)break}else n[E]<0&&(e[18]+=65536),(w<m||-1==m)&&(Tl(e,o,n,E),e[18]=(4294901760&e[18])+E+2),E++}function Tl(e,n,o,l){const c=o[l]<0,m=o[l+1],w=e[c?-o[l]:o[l]];if(c){if(e[2]>>11<e[18]>>16&&(3&e[2])===n){e[2]+=2048;try{m.call(w)}finally{}}}else try{m.call(w)}finally{}}class wi{constructor(n,o,l){this.factory=n,this.resolving=!1,this.canSeeViewProviders=o,this.injectImpl=l}}function Ts(e,n,o){const l=xn(e);let c=0;for(;c<o.length;){const m=o[c];if("number"==typeof m){if(0!==m)break;c++;const x=o[c++],w=o[c++],E=o[c++];l?e.setAttribute(n,w,E,x):n.setAttributeNS(x,w,E)}else{const x=m,w=o[++c];Kt(x)?l&&e.setProperty(n,x,w):l?e.setAttribute(n,x,w):n.setAttribute(x,w),c++}}return c}function zt(e){return 3===e||4===e||6===e}function Kt(e){return 64===e.charCodeAt(0)}function us(e,n){if(null!==n&&0!==n.length)if(null===e||0===e.length)e=n.slice();else{let o=-1;for(let l=0;l<n.length;l++){const c=n[l];"number"==typeof c?o=c:0===o||pa(e,o,c,null,-1===o||2===o?n[++l]:null)}}return e}function pa(e,n,o,l,c){let m=0,x=e.length;if(-1===n)x=-1;else for(;m<e.length;){const w=e[m++];if("number"==typeof w){if(w===n){x=-1;break}if(w>n){x=m-1;break}}}for(;m<e.length;){const w=e[m];if("number"==typeof w)break;if(w===o){if(null===l)return void(null!==c&&(e[m+1]=c));if(l===e[m+1])return void(e[m+2]=c)}m++,null!==l&&m++,null!==c&&m++}-1!==x&&(e.splice(x,0,n),m=x+1),e.splice(m++,0,o),null!==l&&e.splice(m++,0,l),null!==c&&e.splice(m++,0,c)}function il(e){return-1!==e}function Cr(e){return 32767&e}function Yr(e,n){let o=function Ps(e){return e>>16}(e),l=n;for(;o>0;)l=l[15],o--;return l}let Pl=!0;function cs(e){const n=Pl;return Pl=e,n}let fa=0;const zi={};function r(e,n){const o=h(e,n);if(-1!==o)return o;const l=n[1];l.firstCreatePass&&(e.injectorIndex=n.length,a(l.data,e),a(n,null),a(l.blueprint,null));const c=g(e,n),m=e.injectorIndex;if(il(c)){const x=Cr(c),w=Yr(c,n),E=w[1].data;for(let O=0;O<8;O++)n[m+O]=w[x+O]|E[x+O]}return n[m+8]=c,m}function a(e,n){e.push(0,0,0,0,0,0,0,0,n)}function h(e,n){return-1===e.injectorIndex||e.parent&&e.parent.injectorIndex===e.injectorIndex||null===n[e.injectorIndex+8]?-1:e.injectorIndex}function g(e,n){if(e.parent&&-1!==e.parent.injectorIndex)return e.parent.injectorIndex;let o=0,l=null,c=n;for(;null!==c;){if(l=Ne(c),null===l)return-1;if(o++,c=c[15],-1!==l.injectorIndex)return l.injectorIndex|o<<16}return-1}function v(e,n,o){!function p(e,n,o){let l;"string"==typeof o?l=o.charCodeAt(0)||0:o.hasOwnProperty(k)&&(l=o[k]),null==l&&(l=o[k]=fa++);const c=255&l;n.data[e+(c>>5)]|=1<<c}(e,n,o)}function M(e,n,o){if(o&mt.Optional)return e;qn()}function S(e,n,o,l){if(o&mt.Optional&&void 0===l&&(l=null),0==(o&(mt.Self|mt.Host))){const c=e[9],m=_t(void 0);try{return c?c.get(n,l,o&mt.Optional):Or(n,l,o&mt.Optional)}finally{_t(m)}}return M(l,0,o)}function z(e,n,o,l=mt.Default,c){if(null!==e){if(1024&n[2]){const x=function Oe(e,n,o,l,c){let m=e,x=n;for(;null!==m&&null!==x&&1024&x[2]&&!(256&x[2]);){const w=q(m,x,o,l|mt.Self,zi);if(w!==zi)return w;let E=m.parent;if(!E){const O=x[21];if(O){const W=O.get(o,zi,l);if(W!==zi)return W}E=Ne(x),x=x[15]}m=E}return c}(e,n,o,l,zi);if(x!==zi)return x}const m=q(e,n,o,l,zi);if(m!==zi)return m}return S(n,o,l,c)}function q(e,n,o,l,c){const m=function ie(e){if("string"==typeof e)return e.charCodeAt(0)||0;const n=e.hasOwnProperty(k)?e[k]:void 0;return"number"==typeof n?n>=0?255&n:Me:n}(o);if("function"==typeof m){if(!Pt(n,e,l))return l&mt.Host?M(c,0,l):S(n,o,l,c);try{const x=m(l);if(null!=x||l&mt.Optional)return x;qn()}finally{yt()}}else if("number"==typeof m){let x=null,w=h(e,n),E=-1,O=l&mt.Host?n[16][6]:null;for((-1===w||l&mt.SkipSelf)&&(E=-1===w?g(e,n):n[w+8],-1!==E&&ye(l,!1)?(x=n[1],w=Cr(E),n=Yr(E,n)):w=-1);-1!==w;){const W=n[1];if(ce(m,w,W.data)){const se=X(w,n,o,x,l,O);if(se!==zi)return se}E=n[w+8],-1!==E&&ye(l,n[1].data[w+8]===O)&&ce(m,w,n)?(x=W,w=Cr(E),n=Yr(E,n)):w=-1}}return c}function X(e,n,o,l,c,m){const x=n[1],w=x.data[e+8],W=re(w,x,o,null==l?Ao(w)&&Pl:l!=x&&0!=(3&w.type),c&mt.Host&&m===w);return null!==W?ue(n,x,W,w):zi}function re(e,n,o,l,c){const m=e.providerIndexes,x=n.data,w=1048575&m,E=e.directiveStart,W=m>>20,fe=c?w+W:e.directiveEnd;for(let Se=l?w:w+W;Se<fe;Se++){const qe=x[Se];if(Se<E&&o===qe||Se>=E&&qe.type===o)return Se}if(c){const Se=x[E];if(Se&&ti(Se)&&Se.type===o)return E}return null}function ue(e,n,o,l){let c=e[o];const m=n.data;if(function yr(e){return e instanceof wi}(c)){const x=c;x.resolving&&function An(e,n){const o=n?`. Dependency path: ${n.join(" > ")} > ${e}`:"";throw new De(-200,`Circular dependency in DI detected for ${e}${o}`)}(function bt(e){return"function"==typeof e?e.name||e.toString():"object"==typeof e&&null!=e&&"function"==typeof e.type?e.type.name||e.type.toString():ze(e)}(m[o]));const w=cs(x.canSeeViewProviders);x.resolving=!0;const E=x.injectImpl?_t(x.injectImpl):null;Pt(e,l,mt.Default);try{c=e[o]=x.factory(void 0,m,e,l),n.firstCreatePass&&o>=l.directiveStart&&function Al(e,n,o){const{ngOnChanges:l,ngOnInit:c,ngDoCheck:m}=n.type.prototype;if(l){const x=ws(n);(o.preOrderHooks||(o.preOrderHooks=[])).push(e,x),(o.preOrderCheckHooks||(o.preOrderCheckHooks=[])).push(e,x)}c&&(o.preOrderHooks||(o.preOrderHooks=[])).push(0-e,c),m&&((o.preOrderHooks||(o.preOrderHooks=[])).push(e,m),(o.preOrderCheckHooks||(o.preOrderCheckHooks=[])).push(e,m))}(o,m[o],n)}finally{null!==E&&_t(E),cs(w),x.resolving=!1,yt()}}return c}function ce(e,n,o){return!!(o[n+(e>>5)]&1<<e)}function ye(e,n){return!(e&mt.Self||e&mt.Host&&n)}class ge{constructor(n,o){this._tNode=n,this._lView=o}get(n,o,l){return z(this._tNode,this._lView,n,l,o)}}function Me(){return new ge(zn(),j())}function xe(e){return nn(()=>{const n=e.prototype.constructor,o=n[ne]||$e(n),l=Object.prototype;let c=Object.getPrototypeOf(e.prototype).constructor;for(;c&&c!==l;){const m=c[ne]||$e(c);if(m&&m!==o)return m;c=Object.getPrototypeOf(c)}return m=>new m})}function $e(e){return _e(e)?()=>{const n=$e(me(e));return n&&n()}:go(e)}function Ne(e){const n=e[1],o=n.type;return 2===o?n.declTNode:1===o?e[6]:null}function Je(e){return function D(e,n){if("class"===n)return e.classes;if("style"===n)return e.styles;const o=e.attrs;if(o){const l=o.length;let c=0;for(;c<l;){const m=o[c];if(zt(m))break;if(0===m)c+=2;else if("number"==typeof m)for(c++;c<l&&"string"==typeof o[c];)c++;else{if(m===n)return o[c+1];c+=2}}}return null}(zn(),e)}const je="__parameters__";function Mn(e,n,o){return nn(()=>{const l=function an(e){return function(...o){if(e){const l=e(...o);for(const c in l)this[c]=l[c]}}}(n);function c(...m){if(this instanceof c)return l.apply(this,m),this;const x=new c(...m);return w.annotation=x,w;function w(E,O,W){const se=E.hasOwnProperty(je)?E[je]:Object.defineProperty(E,je,{value:[]})[je];for(;se.length<=W;)se.push(null);return(se[W]=se[W]||[]).push(x),E}}return o&&(c.prototype=Object.create(o.prototype)),c.prototype.ngMetadataName=e,c.annotationCls=c,c})}class pn{constructor(n,o){this._desc=n,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof o?this.__NG_ELEMENT_ID__=o:void 0!==o&&(this.\u0275prov=Xe({token:this,providedIn:o.providedIn||"root",factory:o.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}}function dr(e,n){void 0===n&&(n=e);for(let o=0;o<e.length;o++){let l=e[o];Array.isArray(l)?(n===e&&(n=e.slice(0,o)),dr(l,n)):n!==e&&n.push(l)}return n}function Hn(e,n){e.forEach(o=>Array.isArray(o)?Hn(o,n):n(o))}function hs(e,n,o){n>=e.length?e.push(o):e.splice(n,0,o)}function eo(e,n){return n>=e.length-1?e.pop():e.splice(n,1)[0]}function ds(e,n){const o=[];for(let l=0;l<e;l++)o.push(n);return o}function ri(e,n,o){let l=Oa(e,n);return l>=0?e[1|l]=o:(l=~l,function bu(e,n,o,l){let c=e.length;if(c==n)e.push(o,l);else if(1===c)e.push(l,e[0]),e[0]=o;else{for(c--,e.push(e[c-1],e[c]);c>n;)e[c]=e[c-2],c--;e[n]=o,e[n+1]=l}}(e,l,n,o)),l}function wu(e,n){const o=Oa(e,n);if(o>=0)return e[1|o]}function Oa(e,n){return function Du(e,n,o){let l=0,c=e.length>>o;for(;c!==l;){const m=l+(c-l>>1),x=e[m<<o];if(n===x)return m<<o;x>n?c=m:l=m+1}return~(c<<o)}(e,n,1)}const Pr={},Rl="__NG_DI_FLAG__",Ol="ngTempTokenPath",Na=/\n/gm,Mu="__source";let ll;function Iu(e){const n=ll;return ll=e,n}function kh(e,n=mt.Default){if(void 0===ll)throw new De(-203,"");return null===ll?Or(e,void 0,n):ll.get(e,n&mt.Optional?null:void 0,n)}function Kr(e,n=mt.Default){return(function hn(){return Qe}()||kh)(me(e),n)}function zl(e){const n=[];for(let o=0;o<e.length;o++){const l=me(e[o]);if(Array.isArray(l)){if(0===l.length)throw new De(900,"");let c,m=mt.Default;for(let x=0;x<l.length;x++){const w=l[x],E=Lh(w);"number"==typeof E?-1===E?c=w.token:m|=E:c=w}n.push(Kr(c,m))}else n.push(Kr(l))}return n}function ul(e,n){return e[Rl]=n,e.prototype[Rl]=n,e}function Lh(e){return e[Rl]}const Va=ul(Mn("Optional"),8),Au=ul(Mn("SkipSelf"),4);function Rs(e){return e instanceof class Lr{constructor(n){this.changingThisBreaksApplicationSecurity=n}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see https://g.co/ng/security#xss)`}}?e.changingThisBreaksApplicationSecurity:e}function $u(e){return e.ngOriginalError}class Wl{constructor(){this._console=console}handleError(n){const o=this._findOriginalError(n);this._console.error("ERROR",n),o&&this._console.error("ORIGINAL ERROR",o)}_findOriginalError(n){let o=n&&$u(n);for(;o&&$u(o);)o=$u(o);return o||null}}const Kl=new Map;let td=0;const Zc="__ngContext__";function Ni(e,n){Nr(n)?(e[Zc]=n[20],function zs(e){Kl.set(e[20],e)}(n)):e[Zc]=n}function Xl(e){const n=e[Zc];return"number"==typeof n?function qa(e){return Kl.get(e)||null}(n):n||null}function Wc(e){const n=Xl(e);return n?Nr(n)?n:n.lView:null}const ud=(()=>(typeof requestAnimationFrame<"u"&&requestAnimationFrame||setTimeout).bind(rn))();var Yo=(()=>((Yo=Yo||{})[Yo.Important=1]="Important",Yo[Yo.DashCase=2]="DashCase",Yo))();function eu(e,n){return undefined(e,n)}function yl(e){const n=e[3];return xi(n)?n[3]:n}function ms(e){return Xc(e[13])}function Zu(e){return Xc(e[4])}function Xc(e){for(;null!==e&&!xi(e);)e=e[4];return e}function Wa(e,n,o,l,c){if(null!=l){let m,x=!1;xi(l)?m=l:Nr(l)&&(x=!0,l=l[0]);const w=cn(l);0===e&&null!==o?null==c?Bs(n,o,w):Ya(n,o,w,c||null,!0):1===e&&null!==o?Ya(n,o,w,c||null,!0):2===e?function ru(e,n,o){const l=ec(e,n);l&&function _d(e,n,o,l){xn(e)?e.removeChild(n,o,l):n.removeChild(o)}(e,l,n,o)}(n,w,x):3===e&&n.destroyNode(w),null!=m&&function Gp(e,n,o,l,c){const m=o[7];m!==cn(o)&&Wa(n,e,l,m,c);for(let w=10;w<o.length;w++){const E=o[w];ou(E[1],E,e,n,l,m)}}(n,e,m,o,c)}}function Wu(e,n,o){if(xn(e))return e.createElement(n,o);{const l=null!==o?function Bt(e){const n=e.toLowerCase();return"svg"===n?"http://www.w3.org/2000/svg":"math"===n?"http://www.w3.org/1998/MathML/":null}(o):null;return null===l?e.createElement(n):e.createElementNS(l,n)}}function gd(e,n){const o=e[9],l=o.indexOf(n),c=n[3];512&n[2]&&(n[2]&=-513,Ta(c,-1)),o.splice(l,1)}function Qc(e,n){if(e.length<=10)return;const o=10+n,l=e[o];if(l){const c=l[17];null!==c&&c!==e&&gd(c,l),n>0&&(e[o-1][4]=l[4]);const m=eo(e,10+n);!function fd(e,n){ou(e,n,n[11],2,null,null),n[0]=null,n[6]=null}(l[1],l);const x=m[19];null!==x&&x.detachView(m[1]),l[3]=null,l[4]=null,l[2]&=-65}return l}function yd(e,n){if(!(128&n[2])){const o=n[11];xn(o)&&o.destroyNode&&ou(e,n,o,3,null,null),function Ku(e){let n=e[13];if(!n)return eh(e[1],e);for(;n;){let o=null;if(Nr(n))o=n[13];else{const l=n[10];l&&(o=l)}if(!o){for(;n&&!n[4]&&n!==e;)Nr(n)&&eh(n[1],n),n=n[3];null===n&&(n=e),Nr(n)&&eh(n[1],n),o=n&&n[4]}n=o}}(n)}}function eh(e,n){if(!(128&n[2])){n[2]&=-65,n[2]|=128,function th(e,n){let o;if(null!=e&&null!=(o=e.destroyHooks))for(let l=0;l<o.length;l+=2){const c=n[o[l]];if(!(c instanceof wi)){const m=o[l+1];if(Array.isArray(m))for(let x=0;x<m.length;x+=2){const w=c[m[x]],E=m[x+1];try{E.call(w)}finally{}}else try{m.call(c)}finally{}}}}(e,n),function _l(e,n){const o=e.cleanup,l=n[7];let c=-1;if(null!==o)for(let m=0;m<o.length-1;m+=2)if("string"==typeof o[m]){const x=o[m+1],w="function"==typeof x?x(n):cn(n[x]),E=l[c=o[m+2]],O=o[m+3];"boolean"==typeof O?w.removeEventListener(o[m],E,O):O>=0?l[c=O]():l[c=-O].unsubscribe(),m+=2}else{const x=l[c=o[m+1]];o[m].call(x)}if(null!==l){for(let m=c+1;m<l.length;m++)l[m]();n[7]=null}}(e,n),1===n[1].type&&xn(n[11])&&n[11].destroy();const o=n[17];if(null!==o&&xi(n[3])){o!==n[3]&&gd(o,n);const l=n[19];null!==l&&l.detachView(e)}!function rd(e){Kl.delete(e[20])}(n)}}function nh(e,n,o){return function Qu(e,n,o){let l=n;for(;null!==l&&40&l.type;)l=(n=l).parent;if(null===l)return o[0];if(2&l.flags){const c=e.data[l.directiveStart].encapsulation;if(c===Yn.None||c===Yn.Emulated)return null}return ci(l,o)}(e,n.parent,o)}function Ya(e,n,o,l,c){xn(e)?e.insertBefore(n,o,l,c):(vd(n)?n.content:n).insertBefore(o,l,c)}function Bs(e,n,o){xn(e)?e.appendChild(n,o):(vd(n)?n.content:n).appendChild(o)}function rh(e,n,o,l,c){null!==l?Ya(e,n,o,l,c):Bs(e,n,o)}function vd(e){return"TEMPLATE"===e.tagName&&void 0!==e.content}function ec(e,n){return xn(e)?e.parentNode(n):n.parentNode}function tu(e,n,o){return xd(e,n,o)}let xd=function tc(e,n,o){return 40&e.type?ci(e,o):null};function Vs(e,n,o,l){const c=nh(e,l,n),m=n[11],w=tu(l.parent||n[6],l,n);if(null!=c)if(Array.isArray(o))for(let E=0;E<o.length;E++)rh(m,c,o[E],w,!1);else rh(m,c,o,w,!1)}function rc(e,n){if(null!==n){const o=n.type;if(3&o)return ci(n,e);if(4&o)return oc(-1,e[n.index]);if(8&o){const l=n.child;if(null!==l)return rc(e,l);{const c=e[n.index];return xi(c)?oc(-1,c):cn(c)}}if(32&o)return eu(n,e)()||cn(e[n.index]);{const l=ic(e,n);return null!==l?Array.isArray(l)?l[0]:rc(yl(e[16]),l):rc(e,n.next)}}return null}function ic(e,n){return null!==n?e[16][6].projection[n.projection]:null}function oc(e,n){const o=10+e+1;if(o<n.length){const l=n[o],c=l[1].firstChild;if(null!==c)return rc(l,c)}return n[7]}function iu(e,n,o,l,c,m,x){for(;null!=o;){const w=l[o.index],E=o.type;if(x&&0===n&&(w&&Ni(cn(w),l),o.flags|=4),64!=(64&o.flags))if(8&E)iu(e,n,o.child,l,c,m,!1),Wa(n,e,c,w,m);else if(32&E){const O=eu(o,l);let W;for(;W=O();)Wa(n,e,c,W,m);Wa(n,e,c,w,m)}else 16&E?bd(e,n,l,o,c,m):Wa(n,e,c,w,m);o=x?o.projectionNext:o.next}}function ou(e,n,o,l,c,m){iu(o,l,e.firstChild,n,c,m,!1)}function bd(e,n,o,l,c,m){const x=o[16],E=x[6].projection[l.projection];if(Array.isArray(E))for(let O=0;O<E.length;O++)Wa(n,e,c,E[O],m);else iu(e,n,E,x[3],c,m,!0)}function ih(e,n,o){xn(e)?e.setAttribute(n,"style",o):n.style.cssText=o}function Er(e,n,o){xn(e)?""===o?e.removeAttribute(n,"class"):e.setAttribute(n,"class",o):n.className=o}function _a(e,n,o){let l=e.length;for(;;){const c=e.indexOf(n,o);if(-1===c)return c;if(0===c||e.charCodeAt(c-1)<=32){const m=n.length;if(c+m===l||e.charCodeAt(c+m)<=32)return c}o=c+1}}const oh="ng-template";function wd(e,n,o){let l=0;for(;l<e.length;){let c=e[l++];if(o&&"class"===c){if(c=e[l],-1!==_a(c.toLowerCase(),n,0))return!0}else if(1===c){for(;l<e.length&&"string"==typeof(c=e[l++]);)if(c.toLowerCase()===n)return!0;return!1}}return!1}function sh(e){return 4===e.type&&e.value!==oh}function Dd(e,n,o){return n===(4!==e.type||o?e.value:oh)}function ah(e,n,o){let l=4;const c=e.attrs||[],m=function Oo(e){for(let n=0;n<e.length;n++)if(zt(e[n]))return n;return e.length}(c);let x=!1;for(let w=0;w<n.length;w++){const E=n[w];if("number"!=typeof E){if(!x)if(4&l){if(l=2|1&l,""!==E&&!Dd(e,E,o)||""===E&&1===n.length){if(ao(l))return!1;x=!0}}else{const O=8&l?E:n[++w];if(8&l&&null!==e.attrs){if(!wd(e.attrs,O,o)){if(ao(l))return!1;x=!0}continue}const se=Cd(8&l?"class":E,c,sh(e),o);if(-1===se){if(ao(l))return!1;x=!0;continue}if(""!==O){let fe;fe=se>m?"":c[se+1].toLowerCase();const Se=8&l?fe:null;if(Se&&-1!==_a(Se,O,0)||2&l&&O!==fe){if(ao(l))return!1;x=!0}}}}else{if(!x&&!ao(l)&&!ao(E))return!1;if(x&&ao(E))continue;x=!1,l=E|1&l}}return ao(l)||x}function ao(e){return 0==(1&e)}function Cd(e,n,o,l){if(null===n)return-1;let c=0;if(l||!o){let m=!1;for(;c<n.length;){const x=n[c];if(x===e)return c;if(3===x||6===x)m=!0;else{if(1===x||2===x){let w=n[++c];for(;"string"==typeof w;)w=n[++c];continue}if(4===x)break;if(0===x){c+=4;continue}}c+=m?1:2}return-1}return function su(e,n){let o=e.indexOf(4);if(o>-1)for(o++;o<e.length;){const l=e[o];if("number"==typeof l)return-1;if(l===n)return o;o++}return-1}(n,e)}function sc(e,n,o=!1){for(let l=0;l<n.length;l++)if(ah(e,n[l],o))return!0;return!1}function Md(e,n){e:for(let o=0;o<n.length;o++){const l=n[o];if(e.length===l.length){for(let c=0;c<e.length;c++)if(e[c]!==l[c])continue e;return!0}}return!1}function lh(e,n){return e?":not("+n.trim()+")":n}function Id(e){let n=e[0],o=1,l=2,c="",m=!1;for(;o<e.length;){let x=e[o];if("string"==typeof x)if(2&l){const w=e[++o];c+="["+x+(w.length>0?'="'+w+'"':"")+"]"}else 8&l?c+="."+x:4&l&&(c+=" "+x);else""!==c&&!ao(x)&&(n+=lh(m,c),c=""),l=x,m=m||!ao(l);o++}return""!==c&&(n+=lh(m,c)),n}const Cn={};function Td(e){ac(Ie(),j(),Wr()+e,!1)}function ac(e,n,o,l){if(!l)if(3==(3&n[2])){const m=e.preOrderCheckHooks;null!==m&&yo(n,m,o)}else{const m=e.preOrderHooks;null!==m&&ka(n,m,0,o)}Ho(o)}const y=new pn("ENVIRONMENT_INITIALIZER"),_=new pn("INJECTOR_DEF_TYPES");function b(...e){return{\u0275providers:C(0,e)}}function C(e,...n){const o=[],l=new Set;let c;return Hn(n,m=>{const x=m;V(x,o,[],l)&&(c||(c=[]),c.push(x))}),void 0!==c&&P(c,o),o}function P(e,n){for(let o=0;o<e.length;o++){const{providers:c}=e[o];Hn(c,m=>{n.push(m)})}}function V(e,n,o,l){if(!(e=me(e)))return!1;let c=null,m=ht(e);const x=!m&&tt(e);if(m||x){if(x&&!x.standalone)return!1;c=e}else{const E=e.ngModule;if(m=ht(E),!m)return!1;c=E}const w=l.has(c);if(x){if(w)return!1;if(l.add(c),x.dependencies){const E="function"==typeof x.dependencies?x.dependencies():x.dependencies;for(const O of E)V(O,n,o,l)}}else{if(!m)return!1;{if(null!=m.imports&&!w){let O;l.add(c);try{Hn(m.imports,W=>{V(W,n,o,l)&&(O||(O=[]),O.push(W))})}finally{}void 0!==O&&P(O,n)}if(!w){const O=go(c)||(()=>new c);n.push({provide:c,useFactory:O,deps:vn},{provide:_,useValue:c,multi:!0},{provide:y,useValue:()=>Kr(c),multi:!0})}const E=m.providers;null==E||w||Hn(E,W=>{n.push(W)})}}return c!==e&&void 0!==e.providers}const Z=Ge({provide:String,useValue:Ge});function J(e){return null!==e&&"object"==typeof e&&Z in e}function he(e){return"function"==typeof e}const Le=new pn("INJECTOR",-1);class Fe{get(n,o=Pr){if(o===Pr){const l=new Error(`NullInjectorError: No provider for ${Yt(n)}!`);throw l.name="NullInjectorError",l}return o}}const Ve=new pn("Set Injector scope."),Ye={},He={};let Tt;function $t(){return void 0===Tt&&(Tt=new Fe),Tt}class ft{}class wt extends ft{constructor(n,o,l,c){super(),this.parent=o,this.source=l,this.scopes=c,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,pr(n,x=>this.processProvider(x)),this.records.set(Le,qt(void 0,this)),c.has("environment")&&this.records.set(ft,qt(void 0,this));const m=this.records.get(Ve);null!=m&&"string"==typeof m.value&&this.scopes.add(m.value),this.injectorDefTypes=new Set(this.get(_.multi,vn,mt.Self))}get destroyed(){return this._destroyed}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{for(const n of this._ngOnDestroyHooks)n.ngOnDestroy();for(const n of this._onDestroyHooks)n()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),this._onDestroyHooks.length=0}}onDestroy(n){this._onDestroyHooks.push(n)}get(n,o=Pr,l=mt.Default){this.assertNotDestroyed();const c=Iu(this),m=_t(void 0);try{if(!(l&mt.SkipSelf)){let w=this.records.get(n);if(void 0===w){const E=function Xn(e){return"function"==typeof e||"object"==typeof e&&e instanceof pn}(n)&&ae(n);w=E&&this.injectableDefInScope(E)?qt(lt(n),Ye):null,this.records.set(n,w)}if(null!=w)return this.hydrate(n,w)}return(l&mt.Self?$t():this.parent).get(n,o=l&mt.Optional&&o===Pr?null:o)}catch(x){if("NullInjectorError"===x.name){if((x[Ol]=x[Ol]||[]).unshift(Yt(n)),c)throw x;return function cl(e,n,o,l){const c=e[Ol];throw n[Mu]&&c.unshift(n[Mu]),e.message=function hp(e,n,o,l=null){e=e&&"\n"===e.charAt(0)&&"\u0275"==e.charAt(1)?e.slice(2):e;let c=Yt(n);if(Array.isArray(n))c=n.map(Yt).join(" -> ");else if("object"==typeof n){let m=[];for(let x in n)if(n.hasOwnProperty(x)){let w=n[x];m.push(x+":"+("string"==typeof w?JSON.stringify(w):Yt(w)))}c=`{${m.join(", ")}}`}return`${o}${l?"("+l+")":""}[${c}]: ${e.replace(Na,"\n  ")}`}("\n"+e.message,c,o,l),e.ngTokenPath=c,e[Ol]=null,e}(x,n,"R3InjectorError",this.source)}throw x}finally{_t(m),Iu(c)}}resolveInjectorInitializers(){const n=Iu(this),o=_t(void 0);try{const l=this.get(y.multi,vn,mt.Self);for(const c of l)c()}finally{Iu(n),_t(o)}}toString(){const n=[],o=this.records;for(const l of o.keys())n.push(Yt(l));return`R3Injector[${n.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new De(205,!1)}processProvider(n){let o=he(n=me(n))?n:me(n&&n.provide);const l=function Dt(e){return J(e)?qt(void 0,e.useValue):qt(rt(e),Ye)}(n);if(he(n)||!0!==n.multi)this.records.get(o);else{let c=this.records.get(o);c||(c=qt(void 0,Ye,!0),c.factory=()=>zl(c.multi),this.records.set(o,c)),o=n,c.multi.push(n)}this.records.set(o,l)}hydrate(n,o){return o.value===Ye&&(o.value=He,o.value=o.factory()),"object"==typeof o.value&&o.value&&function On(e){return null!==e&&"object"==typeof e&&"function"==typeof e.ngOnDestroy}(o.value)&&this._ngOnDestroyHooks.add(o.value),o.value}injectableDefInScope(n){if(!n.providedIn)return!1;const o=me(n.providedIn);return"string"==typeof o?"any"===o||this.scopes.has(o):this.injectorDefTypes.has(o)}}function lt(e){const n=ae(e),o=null!==n?n.factory:go(e);if(null!==o)return o;if(e instanceof pn)throw new De(204,!1);if(e instanceof Function)return function Ft(e){const n=e.length;if(n>0)throw ds(n,"?"),new De(204,!1);const o=function Te(e){const n=e&&(e[ut]||e[lr]);if(n){const o=function Nt(e){if(e.hasOwnProperty("name"))return e.name;const n=(""+e).match(/^function\s*([^\s(]+)/);return null===n?"":n[1]}(e);return console.warn(`DEPRECATED: DI is instantiating a token "${o}" that inherits its @Injectable decorator but does not provide one itself.\nThis will become an error in a future version of Angular. Please add @Injectable() to the "${o}" class.`),n}return null}(e);return null!==o?()=>o.factory(e):()=>new e}(e);throw new De(204,!1)}function rt(e,n,o){let l;if(he(e)){const c=me(e);return go(c)||lt(c)}if(J(e))l=()=>me(e.useValue);else if(function de(e){return!(!e||!e.useFactory)}(e))l=()=>e.useFactory(...zl(e.deps||[]));else if(function ee(e){return!(!e||!e.useExisting)}(e))l=()=>Kr(me(e.useExisting));else{const c=me(e&&(e.useClass||e.provide));if(!function Zt(e){return!!e.deps}(e))return go(c)||lt(c);l=()=>new c(...zl(e.deps))}return l}function qt(e,n,o=!1){return{factory:e,value:n,multi:o?[]:void 0}}function xr(e){return!!e.\u0275providers}function pr(e,n){for(const o of e)Array.isArray(o)?pr(o,n):xr(o)?pr(o.\u0275providers,n):n(o)}function fi(e,n=null,o=null,l){const c=Vr(e,n,o,l);return c.resolveInjectorInitializers(),c}function Vr(e,n=null,o=null,l,c=new Set){const m=[o||vn,b(e)];return l=l||("object"==typeof e?void 0:Yt(e)),new wt(m,n||$t(),l||null,c)}let sr=(()=>{class e{static create(o,l){if(Array.isArray(o))return fi({name:""},l,o,"");{const c=o.name??"";return fi({name:c},o.parent,o.providers,c)}}}return e.THROW_IF_NOT_FOUND=Pr,e.NULL=new Fe,e.\u0275prov=Xe({token:e,providedIn:"any",factory:()=>Kr(Le)}),e.__NG_ELEMENT_ID__=-1,e})();function va(e,n=mt.Default){const o=j();return null===o?Kr(e,n):z(zn(),o,me(e),n)}function Od(e,n){return e<<17|n<<2}function $s(e){return e>>17&32767}function Kp(e){return 2|e}function Ka(e){return(131068&e)>>2}function Xp(e,n){return-131069&e|n<<2}function Jp(e){return 1|e}function qm(e,n){const o=e.contentQueries;if(null!==o)for(let l=0;l<o.length;l+=2){const c=o[l],m=o[l+1];if(-1!==m){const x=e.data[m];Go(c),x.contentQueries(2,n[m],m)}}}function mh(e,n,o,l,c,m,x,w,E,O,W){const se=n.blueprint.slice();return se[0]=c,se[2]=76|l,(null!==W||e&&1024&e[2])&&(se[2]|=1024),Xi(se),se[3]=se[15]=e,se[8]=o,se[10]=x||e&&e[10],se[11]=w||e&&e[11],se[12]=E||e&&e[12]||null,se[9]=O||e&&e[9]||null,se[6]=m,se[20]=function nd(){return td++}(),se[21]=W,se[16]=2==n.type?e[16]:se,se}function lc(e,n,o,l,c){let m=e.data[n];if(null===m)m=function lf(e,n,o,l,c){const m=Oi(),x=os(),E=e.data[n]=function jv(e,n,o,l,c,m){return{type:o,index:l,insertBeforeIndex:null,injectorIndex:n?n.injectorIndex:-1,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,propertyBindings:null,flags:0,providerIndexes:0,value:c,attrs:m,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tViews:null,next:null,projectionNext:null,child:null,parent:n,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,x?m:m&&m.parent,o,n,l,c);return null===e.firstChild&&(e.firstChild=E),null!==m&&(x?null==m.child&&null!==E.parent&&(m.child=E):null===m.next&&(m.next=E)),E}(e,n,o,l,c),function yu(){return gn.lFrame.inI18n}()&&(m.flags|=64);else if(64&m.type){m.type=o,m.value=l,m.attrs=c;const x=function Ji(){const e=gn.lFrame,n=e.currentTNode;return e.isParent?n:n.parent}();m.injectorIndex=null===x?-1:x.injectorIndex}return qr(m,!0),m}function uc(e,n,o,l){if(0===o)return-1;const c=n.length;for(let m=0;m<o;m++)n.push(l),e.blueprint.push(l),e.data.push(null);return c}function gh(e,n,o){ua(n);try{const l=e.viewQuery;null!==l&&yf(1,l,o);const c=e.template;null!==c&&Zm(e,n,c,1,o),e.firstCreatePass&&(e.firstCreatePass=!1),e.staticContentQueries&&qm(e,n),e.staticViewQueries&&yf(2,e.viewQuery,o);const m=e.components;null!==m&&function Bv(e,n){for(let o=0;o<n.length;o++)sx(e,n[o])}(n,m)}catch(l){throw e.firstCreatePass&&(e.incompleteFirstPass=!0,e.firstCreatePass=!1),l}finally{n[2]&=-5,da()}}function cc(e,n,o,l){const c=n[2];if(128!=(128&c)){ua(n);try{Xi(n),function Ii(e){return gn.lFrame.bindingIndex=e}(e.bindingStartIndex),null!==o&&Zm(e,n,o,2,l);const x=3==(3&c);if(x){const O=e.preOrderCheckHooks;null!==O&&yo(n,O,null)}else{const O=e.preOrderHooks;null!==O&&ka(n,O,0,null),La(n,0)}if(function ix(e){for(let n=ms(e);null!==n;n=Zu(n)){if(!n[2])continue;const o=n[9];for(let l=0;l<o.length;l++){const c=o[l],m=c[3];0==(512&c[2])&&Ta(m,1),c[2]|=512}}}(n),function rx(e){for(let n=ms(e);null!==n;n=Zu(n))for(let o=10;o<n.length;o++){const l=n[o],c=l[1];Es(l)&&cc(c,l,c.template,l[8])}}(n),null!==e.contentQueries&&qm(e,n),x){const O=e.contentCheckHooks;null!==O&&yo(n,O)}else{const O=e.contentHooks;null!==O&&ka(n,O,1),La(n,1)}!function zv(e,n){const o=e.hostBindingOpCodes;if(null!==o)try{for(let l=0;l<o.length;l++){const c=o[l];if(c<0)Ho(~c);else{const m=c,x=o[++l],w=o[++l];Ss(x,m),w(2,n[m])}}}finally{Ho(-1)}}(e,n);const w=e.components;null!==w&&function Nv(e,n){for(let o=0;o<n.length;o++)ox(e,n[o])}(n,w);const E=e.viewQuery;if(null!==E&&yf(2,E,l),x){const O=e.viewCheckHooks;null!==O&&yo(n,O)}else{const O=e.viewHooks;null!==O&&ka(n,O,2),La(n,2)}!0===e.firstUpdatePass&&(e.firstUpdatePass=!1),n[2]&=-41,512&n[2]&&(n[2]&=-513,Ta(n[3],-1))}finally{da()}}}function Vv(e,n,o,l){const c=n[10],x=Cs(n);try{!x&&c.begin&&c.begin(),x&&gh(e,n,l),cc(e,n,o,l)}finally{!x&&c.end&&c.end()}}function Zm(e,n,o,l,c){const m=Wr(),x=2&l;try{Ho(-1),x&&n.length>22&&ac(e,n,22,!1),o(l,c)}finally{Ho(m)}}function uf(e,n,o){!F()||(function Yv(e,n,o,l){const c=o.directiveStart,m=o.directiveEnd;e.firstCreatePass||r(o,n),Ni(l,n);const x=o.initialInputs;for(let w=c;w<m;w++){const E=e.data[w],O=ti(E);O&&ex(n,o,E);const W=ue(n,e,w,o);Ni(W,n),null!==x&&tx(0,w-c,W,E,0,x),O&&(hi(o.index,n)[8]=W)}}(e,n,o,ci(o,n)),128==(128&o.flags)&&function Kv(e,n,o){const l=o.directiveStart,c=o.directiveEnd,m=o.index,x=function Ac(){return gn.lFrame.currentDirectiveIndex}();try{Ho(m);for(let w=l;w<c;w++){const E=e.data[w],O=n[w];Fa(w),(null!==E.hostBindings||0!==E.hostVars||null!==E.hostAttrs)&&tg(E,O)}}finally{Ho(-1),Fa(x)}}(e,n,o))}function cf(e,n,o=ci){const l=n.localNames;if(null!==l){let c=n.index+1;for(let m=0;m<l.length;m+=2){const x=l[m+1],w=-1===x?o(n,e):e[x];e[c++]=w}}}function Ym(e){const n=e.tView;return null===n||n.incompleteFirstPass?e.tView=Bd(1,null,e.template,e.decls,e.vars,e.directiveDefs,e.pipeDefs,e.viewQuery,e.schemas,e.consts):n}function Bd(e,n,o,l,c,m,x,w,E,O){const W=22+l,se=W+c,fe=function Uv(e,n){const o=[];for(let l=0;l<n;l++)o.push(l<e?null:Cn);return o}(W,se),Se="function"==typeof O?O():O;return fe[1]={type:e,blueprint:fe,template:o,queries:null,viewQuery:w,declTNode:n,data:fe.slice().fill(null,W),bindingStartIndex:W,expandoStartIndex:se,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof m?m():m,pipeRegistry:"function"==typeof x?x():x,firstChild:null,schemas:E,consts:Se,incompleteFirstPass:!1}}function Jm(e,n,o,l){const c=ag(n);null===o?c.push(l):(c.push(o),e.firstCreatePass&&lg(e).push(l,c.length-1))}function Qm(e,n,o){for(let l in e)if(e.hasOwnProperty(l)){const c=e[l];(o=null===o?{}:o).hasOwnProperty(l)?o[l].push(n,c):o[l]=[n,c]}return o}function hf(e,n,o,l){let c=!1;if(F()){const m=function Xv(e,n,o){const l=e.directiveRegistry;let c=null;if(l)for(let m=0;m<l.length;m++){const x=l[m];sc(o,x.selectors,!1)&&(c||(c=[]),v(r(o,n),e,x.type),ti(x)?(ng(e,o),c.unshift(x)):c.push(x))}return c}(e,n,o),x=null===l?null:{"":-1};if(null!==m){c=!0,rg(o,e.data.length,m.length);for(let W=0;W<m.length;W++){const se=m[W];se.providersResolver&&se.providersResolver(se)}let w=!1,E=!1,O=uc(e,n,m.length,null);for(let W=0;W<m.length;W++){const se=m[W];o.mergedAttrs=us(o.mergedAttrs,se.hostAttrs),ig(e,o,n,O,se),Qv(O,se,x),null!==se.contentQueries&&(o.flags|=8),(null!==se.hostBindings||null!==se.hostAttrs||0!==se.hostVars)&&(o.flags|=128);const fe=se.type.prototype;!w&&(fe.ngOnChanges||fe.ngOnInit||fe.ngDoCheck)&&((e.preOrderHooks||(e.preOrderHooks=[])).push(o.index),w=!0),!E&&(fe.ngOnChanges||fe.ngDoCheck)&&((e.preOrderCheckHooks||(e.preOrderCheckHooks=[])).push(o.index),E=!0),O++}!function $v(e,n){const l=n.directiveEnd,c=e.data,m=n.attrs,x=[];let w=null,E=null;for(let O=n.directiveStart;O<l;O++){const W=c[O],se=W.inputs,fe=null===m||sh(n)?null:nx(se,m);x.push(fe),w=Qm(se,O,w),E=Qm(W.outputs,O,E)}null!==w&&(w.hasOwnProperty("class")&&(n.flags|=16),w.hasOwnProperty("style")&&(n.flags|=32)),n.initialInputs=x,n.inputs=w,n.outputs=E}(e,o)}x&&function Jv(e,n,o){if(n){const l=e.localNames=[];for(let c=0;c<n.length;c+=2){const m=o[n[c+1]];if(null==m)throw new De(-301,!1);l.push(n[c],m)}}}(o,l,x)}return o.mergedAttrs=us(o.mergedAttrs,o.attrs),c}function eg(e,n,o,l,c,m){const x=m.hostBindings;if(x){let w=e.hostBindingOpCodes;null===w&&(w=e.hostBindingOpCodes=[]);const E=~n.index;(function Wv(e){let n=e.length;for(;n>0;){const o=e[--n];if("number"==typeof o&&o<0)return o}return 0})(w)!=E&&w.push(E),w.push(l,c,x)}}function tg(e,n){null!==e.hostBindings&&e.hostBindings(1,n)}function ng(e,n){n.flags|=2,(e.components||(e.components=[])).push(n.index)}function Qv(e,n,o){if(o){if(n.exportAs)for(let l=0;l<n.exportAs.length;l++)o[n.exportAs[l]]=e;ti(n)&&(o[""]=e)}}function rg(e,n,o){e.flags|=1,e.directiveStart=n,e.directiveEnd=n+o,e.providerIndexes=n}function ig(e,n,o,l,c){e.data[l]=c;const m=c.factory||(c.factory=go(c.type)),x=new wi(m,ti(c),va);e.blueprint[l]=x,o[l]=x,eg(e,n,0,l,uc(e,o,c.hostVars,Cn),c)}function ex(e,n,o){const l=ci(n,e),c=Ym(o),m=e[10],x=Vd(e,mh(e,c,null,o.onPush?32:16,l,n,m,m.createRenderer(l,o),null,null,null));e[n.index]=x}function ba(e,n,o,l,c,m){const x=ci(e,n);!function df(e,n,o,l,c,m,x){if(null==m)xn(e)?e.removeAttribute(n,c,o):n.removeAttribute(c);else{const w=null==x?ze(m):x(m,l||"",c);xn(e)?e.setAttribute(n,c,w,o):o?n.setAttributeNS(o,c,w):n.setAttribute(c,w)}}(n[11],x,m,e.value,o,l,c)}function tx(e,n,o,l,c,m){const x=m[n];if(null!==x){const w=l.setInput;for(let E=0;E<x.length;){const O=x[E++],W=x[E++],se=x[E++];null!==w?l.setInput(o,se,O,W):o[W]=se}}}function nx(e,n){let o=null,l=0;for(;l<n.length;){const c=n[l];if(0!==c)if(5!==c){if("number"==typeof c)break;e.hasOwnProperty(c)&&(null===o&&(o=[]),o.push(c,e[c],n[l+1])),l+=2}else l+=2;else l+=4}return o}function og(e,n,o,l){return new Array(e,!0,!1,n,null,0,l,o,null,null)}function ox(e,n){const o=hi(n,e);if(Es(o)){const l=o[1];48&o[2]?cc(l,o,l.template,o[8]):o[5]>0&&pf(o)}}function pf(e){for(let l=ms(e);null!==l;l=Zu(l))for(let c=10;c<l.length;c++){const m=l[c];if(512&m[2]){const x=m[1];cc(x,m,x.template,m[8])}else m[5]>0&&pf(m)}const o=e[1].components;if(null!==o)for(let l=0;l<o.length;l++){const c=hi(o[l],e);Es(c)&&c[5]>0&&pf(c)}}function sx(e,n){const o=hi(n,e),l=o[1];(function ax(e,n){for(let o=n.length;o<e.blueprint.length;o++)n.push(e.blueprint[o])})(l,o),gh(l,o,o[8])}function Vd(e,n){return e[13]?e[14][4]=n:e[13]=n,e[14]=n,n}function ff(e){for(;e;){e[2]|=32;const n=yl(e);if(Ws(e)&&!n)return e;e=n}return null}function sg(e){!function mf(e){for(let n=0;n<e.components.length;n++){const o=e.components[n],l=Wc(o);if(null!==l){const c=l[1];Vv(c,l,c.template,o)}}}(e[8])}function yf(e,n,o){Go(0),n(e,o)}const ux=(()=>Promise.resolve(null))();function ag(e){return e[7]||(e[7]=[])}function lg(e){return e.cleanup||(e.cleanup=[])}function cg(e,n){const o=e[9],l=o?o.get(Wl,null):null;l&&l.handleError(n)}function hg(e,n,o,l,c){for(let m=0;m<o.length;){const x=o[m++],w=o[m++],E=n[x],O=e.data[x];null!==O.setInput?O.setInput(E,c,l,w):E[w]=c}}function Xa(e,n,o){const l=bi(n,e);!function dd(e,n,o){xn(e)?e.setValue(n,o):n.textContent=o}(e[11],l,o)}function Ud(e,n,o){let l=o?e.styles:null,c=o?e.classes:null,m=0;if(null!==n)for(let x=0;x<n.length;x++){const w=n[x];"number"==typeof w?m=w:1==m?c=jt(c,w):2==m&&(l=jt(l,w+": "+n[++x]+";"))}o?e.styles=l:e.stylesWithoutHost=l,o?e.classes=c:e.classesWithoutHost=c}function xx(){const e=zn();di(j()[1],e)}function vf(e){let n=function Dg(e){return Object.getPrototypeOf(e.prototype).constructor}(e.type),o=!0;const l=[e];for(;n;){let c;if(ti(e))c=n.\u0275cmp||n.\u0275dir;else{if(n.\u0275cmp)throw new De(903,"");c=n.\u0275dir}if(c){if(o){l.push(c);const x=e;x.inputs=xf(e.inputs),x.declaredInputs=xf(e.declaredInputs),x.outputs=xf(e.outputs);const w=c.hostBindings;w&&Cx(e,w);const E=c.viewQuery,O=c.contentQueries;if(E&&wx(e,E),O&&Dx(e,O),Xt(e.inputs,c.inputs),Xt(e.declaredInputs,c.declaredInputs),Xt(e.outputs,c.outputs),ti(c)&&c.data.animation){const W=e.data;W.animation=(W.animation||[]).concat(c.data.animation)}}const m=c.features;if(m)for(let x=0;x<m.length;x++){const w=m[x];w&&w.ngInherit&&w(e),w===vf&&(o=!1)}}n=Object.getPrototypeOf(n)}!function bx(e){let n=0,o=null;for(let l=e.length-1;l>=0;l--){const c=e[l];c.hostVars=n+=c.hostVars,c.hostAttrs=us(c.hostAttrs,o=us(o,c.hostAttrs))}}(l)}function xf(e){return e===Jn?{}:e===vn?[]:e}function wx(e,n){const o=e.viewQuery;e.viewQuery=o?(l,c)=>{n(l,c),o(l,c)}:n}function Dx(e,n){const o=e.contentQueries;e.contentQueries=o?(l,c,m)=>{n(l,c,m),o(l,c,m)}:n}function Cx(e,n){const o=e.hostBindings;e.hostBindings=o?(l,c)=>{n(l,c),o(l,c)}:n}let jd=null;function hu(){if(!jd){const e=rn.Symbol;if(e&&e.iterator)jd=e.iterator;else{const n=Object.getOwnPropertyNames(Map.prototype);for(let o=0;o<n.length;++o){const l=n[o];"entries"!==l&&"size"!==l&&Map.prototype[l]===Map.prototype.entries&&(jd=l)}}}return jd}function yh(e){return!!bf(e)&&(Array.isArray(e)||!(e instanceof Map)&&hu()in e)}function bf(e){return null!==e&&("function"==typeof e||"object"==typeof e)}function uo(e,n,o){return!Object.is(e[n],o)&&(e[n]=o,!0)}function wf(e,n,o,l){const c=j();return uo(c,aa(),n)&&(Ie(),ba(Tr(),c,e,n,o,l)),wf}function kg(e,n,o,l,c,m,x,w){const E=j(),O=Ie(),W=e+22,se=O.firstCreatePass?function Px(e,n,o,l,c,m,x,w,E){const O=n.consts,W=lc(n,e,4,x||null,Ki(O,w));hf(n,o,W,Ki(O,E)),di(n,W);const se=W.tViews=Bd(2,W,l,c,m,n.directiveRegistry,n.pipeRegistry,null,n.schemas,O);return null!==n.queries&&(n.queries.template(n,W),se.queries=n.queries.embeddedTView(W)),W}(W,O,E,n,o,l,c,m,x):O.data[W];qr(se,!1);const fe=E[11].createComment("");Vs(O,E,fe,se),Ni(fe,E),Vd(E,E[W]=og(fe,E,fe,se)),fo(se)&&uf(O,E,se),null!=x&&cf(E,se,w)}function Lg(e){return function Lo(e,n){return e[n]}(function sa(){return gn.lFrame.contextLView}(),22+e)}function Df(e,n,o){const l=j();return uo(l,aa(),n)&&function Qo(e,n,o,l,c,m,x,w){const E=ci(n,o);let W,O=n.inputs;!w&&null!=O&&(W=O[l])?(hg(e,o,W,l,c),Ao(n)&&function Hv(e,n){const o=hi(n,e);16&o[2]||(o[2]|=32)}(o,n.index)):3&n.type&&(l=function Gv(e){return"class"===e?"className":"for"===e?"htmlFor":"formaction"===e?"formAction":"innerHtml"===e?"innerHTML":"readonly"===e?"readOnly":"tabindex"===e?"tabIndex":e}(l),c=null!=x?x(c,n.value||"",l):c,xn(m)?m.setProperty(E,l,c):Kt(l)||(E.setProperty?E.setProperty(l,c):E[l]=c))}(Ie(),Tr(),l,e,n,l[11],o,!1),Df}function Cf(e,n,o,l,c){const x=c?"class":"style";hg(e,o,n.inputs[x],x,l)}function Gd(e,n,o,l){const c=j(),m=Ie(),x=22+e,w=c[11],E=c[x]=Wu(w,n,function Sl(){return gn.lFrame.currentNamespace}()),O=m.firstCreatePass?function kx(e,n,o,l,c,m,x){const w=n.consts,O=lc(n,e,2,c,Ki(w,m));return hf(n,o,O,Ki(w,x)),null!==O.attrs&&Ud(O,O.attrs,!1),null!==O.mergedAttrs&&Ud(O,O.mergedAttrs,!0),null!==n.queries&&n.queries.elementStart(n,O),O}(x,m,c,0,n,o,l):m.data[x];qr(O,!0);const W=O.mergedAttrs;null!==W&&Ts(w,E,W);const se=O.classes;null!==se&&Er(w,E,se);const fe=O.styles;return null!==fe&&ih(w,E,fe),64!=(64&O.flags)&&Vs(m,c,E,O),0===function Pa(){return gn.lFrame.elementDepthCount}()&&Ni(E,c),function tl(){gn.lFrame.elementDepthCount++}(),fo(O)&&(uf(m,c,O),function Wm(e,n,o){if(ts(n)){const c=n.directiveEnd;for(let m=n.directiveStart;m<c;m++){const x=e.data[m];x.contentQueries&&x.contentQueries(1,o[m],m)}}}(m,O,c)),null!==l&&cf(c,O),Gd}function Hd(){let e=zn();os()?oa():(e=e.parent,qr(e,!1));const n=e;!function Cl(){gn.lFrame.elementDepthCount--}();const o=Ie();return o.firstCreatePass&&(di(o,e),ts(e)&&o.queries.elementEnd(e)),null!=n.classesWithoutHost&&function vu(e){return 0!=(16&e.flags)}(n)&&Cf(o,n,j(),n.classesWithoutHost,!0),null!=n.stylesWithoutHost&&function xu(e){return 0!=(32&e.flags)}(n)&&Cf(o,n,j(),n.stylesWithoutHost,!1),Hd}function Ef(e,n,o,l){return Gd(e,n,o,l),Hd(),Ef}function Sf(e){return!!e&&"function"==typeof e.then}function Og(e){return!!e&&"function"==typeof e.subscribe}const zg=Og;function Af(e,n,o,l){const c=j(),m=Ie(),x=zn();return function Bg(e,n,o,l,c,m,x,w){const E=fo(l),W=e.firstCreatePass&&lg(e),se=n[8],fe=ag(n);let Se=!0;if(3&l.type||w){const Ct=ci(l,n),Et=w?w(Ct):Ct,ln=fe.length,nt=w?un=>w(cn(un[l.index])):l.index;if(xn(o)){let un=null;if(!w&&E&&(un=function Ox(e,n,o,l){const c=e.cleanup;if(null!=c)for(let m=0;m<c.length-1;m+=2){const x=c[m];if(x===o&&c[m+1]===l){const w=n[7],E=c[m+2];return w.length>E?w[E]:null}"string"==typeof x&&(m+=2)}return null}(e,n,c,l.index)),null!==un)(un.__ngLastListenerFn__||un).__ngNextListenerFn__=m,un.__ngLastListenerFn__=m,Se=!1;else{m=Tf(l,n,se,m,!1);const nr=o.listen(Et,c,m);fe.push(m,nr),W&&W.push(c,nt,ln,ln+1)}}else m=Tf(l,n,se,m,!0),Et.addEventListener(c,m,x),fe.push(m),W&&W.push(c,nt,ln,x)}else m=Tf(l,n,se,m,!1);const qe=l.outputs;let et;if(Se&&null!==qe&&(et=qe[c])){const Ct=et.length;if(Ct)for(let Et=0;Et<Ct;Et+=2){const Ur=n[et[Et]][et[Et+1]].subscribe(m),gu=fe.length;fe.push(m,Ur),W&&W.push(c,l.index,gu,-(gu+1))}}}(m,c,c[11],x,e,n,!!o,l),Af}function Vg(e,n,o,l){try{return!1!==o(l)}catch(c){return cg(e,c),!1}}function Tf(e,n,o,l,c){return function m(x){if(x===Function)return l;ff(2&e.flags?hi(e.index,n):n);let E=Vg(n,0,l,x),O=m.__ngNextListenerFn__;for(;O;)E=Vg(n,0,O,x)&&E,O=O.__ngNextListenerFn__;return c&&!1===E&&(x.preventDefault(),x.returnValue=!1),E}}function Nx(e,n){let o=null;const l=function Ed(e){const n=e.attrs;if(null!=n){const o=n.indexOf(5);if(0==(1&o))return n[o+1]}return null}(e);for(let c=0;c<n.length;c++){const m=n[c];if("*"!==m){if(null===l?sc(e,m,!0):Md(l,m))return c}else o=c}return o}function Ug(e){const n=j()[16][6];if(!n.projection){const l=n.projection=ds(e?e.length:1,null),c=l.slice();let m=n.child;for(;null!==m;){const x=e?Nx(m,e):0;null!==x&&(c[x]?c[x].projectionNext=m:l[x]=m,c[x]=m),m=m.next}}}function jg(e,n=0,o){const l=j(),c=Ie(),m=lc(c,22+e,16,null,o||null);null===m.projection&&(m.projection=n),oa(),64!=(64&m.flags)&&function $p(e,n,o){bd(n[11],0,n,o,nh(e,o,n),tu(o.parent||n[6],o,n))}(c,l,m)}function Jg(e,n,o,l,c){const m=e[o+1],x=null===n;let w=l?$s(m):Ka(m),E=!1;for(;0!==w&&(!1===E||x);){const W=e[w+1];Ux(e[w],n)&&(E=!0,e[w+1]=l?Jp(W):Kp(W)),w=l?$s(W):Ka(W)}E&&(e[o+1]=l?Kp(m):Jp(m))}function Ux(e,n){return null===e||null==n||(Array.isArray(e)?e[1]:e)===n||!(!Array.isArray(e)||"string"!=typeof n)&&Oa(e,n)>=0}const Fi={textEnd:0,key:0,keyEnd:0,value:0,valueEnd:0};function Qg(e){return e.substring(Fi.key,Fi.keyEnd)}function jx(e){return e.substring(Fi.value,Fi.valueEnd)}function ey(e,n){const o=Fi.textEnd;return o===n?-1:(n=Fi.keyEnd=function Hx(e,n,o){for(;n<o&&e.charCodeAt(n)>32;)n++;return n}(e,Fi.key=n,o),xc(e,n,o))}function ty(e,n){const o=Fi.textEnd;let l=Fi.key=xc(e,n,o);return o===l?-1:(l=Fi.keyEnd=function qx(e,n,o){let l;for(;n<o&&(45===(l=e.charCodeAt(n))||95===l||(-33&l)>=65&&(-33&l)<=90||l>=48&&l<=57);)n++;return n}(e,l,o),l=ry(e,l,o),l=Fi.value=xc(e,l,o),l=Fi.valueEnd=function Zx(e,n,o){let l=-1,c=-1,m=-1,x=n,w=x;for(;x<o;){const E=e.charCodeAt(x++);if(59===E)return w;34===E||39===E?w=x=iy(e,E,x,o):n===x-4&&85===m&&82===c&&76===l&&40===E?w=x=iy(e,41,x,o):E>32&&(w=x),m=c,c=l,l=-33&E}return w}(e,l,o),ry(e,l,o))}function ny(e){Fi.key=0,Fi.keyEnd=0,Fi.value=0,Fi.valueEnd=0,Fi.textEnd=e.length}function xc(e,n,o){for(;n<o&&e.charCodeAt(n)<=32;)n++;return n}function ry(e,n,o,l){return(n=xc(e,n,o))<o&&n++,n}function iy(e,n,o,l){let c=-1,m=o;for(;m<l;){const x=e.charCodeAt(m++);if(x==n&&92!==c)return m;c=92==x&&92===c?0:x}throw new Error}function Ff(e,n){return function qs(e,n,o,l){const c=j(),m=Ie(),x=Si(2);m.firstUpdatePass&&ly(m,e,x,l),n!==Cn&&uo(c,x,n)&&cy(m,m.data[Wr()],c,c[11],e,c[x+1]=function t0(e,n){return null==e||("string"==typeof n?e+=n:"object"==typeof e&&(e=Yt(Rs(e)))),e}(n,o),l,x)}(e,n,null,!0),Ff}function Hs(e){Zs(uy,Wx,e,!1)}function Wx(e,n){for(let o=function Gx(e){return ny(e),ty(e,xc(e,0,Fi.textEnd))}(n);o>=0;o=ty(n,o))uy(e,Qg(n),jx(n))}function sy(e){Zs(ri,Da,e,!0)}function Da(e,n){for(let o=function $x(e){return ny(e),ey(e,xc(e,0,Fi.textEnd))}(n);o>=0;o=ey(n,o))ri(e,Qg(n),!0)}function Zs(e,n,o,l){const c=Ie(),m=Si(2);c.firstUpdatePass&&ly(c,null,m,l);const x=j();if(o!==Cn&&uo(x,m,o)){const w=c.data[Wr()];if(dy(w,l)&&!ay(c,m)){let E=l?w.classesWithoutHost:w.stylesWithoutHost;null!==E&&(o=jt(E,o||"")),Cf(c,w,x,o,l)}else!function e0(e,n,o,l,c,m,x,w){c===Cn&&(c=vn);let E=0,O=0,W=0<c.length?c[0]:null,se=0<m.length?m[0]:null;for(;null!==W||null!==se;){const fe=E<c.length?c[E+1]:void 0,Se=O<m.length?m[O+1]:void 0;let et,qe=null;W===se?(E+=2,O+=2,fe!==Se&&(qe=se,et=Se)):null===se||null!==W&&W<se?(E+=2,qe=W):(O+=2,qe=se,et=Se),null!==qe&&cy(e,n,o,l,qe,et,x,w),W=E<c.length?c[E]:null,se=O<m.length?m[O]:null}}(c,w,x,x[11],x[m+1],x[m+1]=function Qx(e,n,o){if(null==o||""===o)return vn;const l=[],c=Rs(o);if(Array.isArray(c))for(let m=0;m<c.length;m++)e(l,c[m],!0);else if("object"==typeof c)for(const m in c)c.hasOwnProperty(m)&&e(l,m,c[m]);else"string"==typeof c&&n(l,c);return l}(e,n,o),l,m)}}function ay(e,n){return n>=e.expandoStartIndex}function ly(e,n,o,l){const c=e.data;if(null===c[o+1]){const m=c[Wr()],x=ay(e,o);dy(m,l)&&null===n&&!x&&(n=!1),n=function Yx(e,n,o,l){const c=function El(e){const n=gn.lFrame.currentDirectiveIndex;return-1===n?null:e[n]}(e);let m=l?n.residualClasses:n.residualStyles;if(null===c)0===(l?n.classBindings:n.styleBindings)&&(o=vh(o=kf(null,e,n,o,l),n.attrs,l),m=null);else{const x=n.directiveStylingLast;if(-1===x||e[x]!==c)if(o=kf(c,e,n,o,l),null===m){let E=function Kx(e,n,o){const l=o?n.classBindings:n.styleBindings;if(0!==Ka(l))return e[$s(l)]}(e,n,l);void 0!==E&&Array.isArray(E)&&(E=kf(null,e,n,E[1],l),E=vh(E,n.attrs,l),function Xx(e,n,o,l){e[$s(o?n.classBindings:n.styleBindings)]=l}(e,n,l,E))}else m=function Jx(e,n,o){let l;const c=n.directiveEnd;for(let m=1+n.directiveStylingLast;m<c;m++)l=vh(l,e[m].hostAttrs,o);return vh(l,n.attrs,o)}(e,n,l)}return void 0!==m&&(l?n.residualClasses=m:n.residualStyles=m),o}(c,m,n,l),function Bx(e,n,o,l,c,m){let x=m?n.classBindings:n.styleBindings,w=$s(x),E=Ka(x);e[l]=o;let W,O=!1;if(Array.isArray(o)){const se=o;W=se[1],(null===W||Oa(se,W)>0)&&(O=!0)}else W=o;if(c)if(0!==E){const fe=$s(e[w+1]);e[l+1]=Od(fe,w),0!==fe&&(e[fe+1]=Xp(e[fe+1],l)),e[w+1]=function Iv(e,n){return 131071&e|n<<17}(e[w+1],l)}else e[l+1]=Od(w,0),0!==w&&(e[w+1]=Xp(e[w+1],l)),w=l;else e[l+1]=Od(E,0),0===w?w=l:e[E+1]=Xp(e[E+1],l),E=l;O&&(e[l+1]=Kp(e[l+1])),Jg(e,W,l,!0),Jg(e,W,l,!1),function Vx(e,n,o,l,c){const m=c?e.residualClasses:e.residualStyles;null!=m&&"string"==typeof n&&Oa(m,n)>=0&&(o[l+1]=Jp(o[l+1]))}(n,W,e,l,m),x=Od(w,E),m?n.classBindings=x:n.styleBindings=x}(c,m,n,o,x,l)}}function kf(e,n,o,l,c){let m=null;const x=o.directiveEnd;let w=o.directiveStylingLast;for(-1===w?w=o.directiveStart:w++;w<x&&(m=n[w],l=vh(l,m.hostAttrs,c),m!==e);)w++;return null!==e&&(o.directiveStylingLast=w),l}function vh(e,n,o){const l=o?1:2;let c=-1;if(null!==n)for(let m=0;m<n.length;m++){const x=n[m];"number"==typeof x?c=x:c===l&&(Array.isArray(e)||(e=void 0===e?[]:["",e]),ri(e,x,!!o||n[++m]))}return void 0===e?null:e}function uy(e,n,o){ri(e,n,Rs(o))}function cy(e,n,o,l,c,m,x,w){if(!(3&n.type))return;const E=e.data,O=E[w+1];qd(function Nm(e){return 1==(1&e)}(O)?hy(E,n,o,c,Ka(O),x):void 0)||(qd(m)||function zm(e){return 2==(2&e)}(O)&&(m=hy(E,null,o,c,w,x)),function Hp(e,n,o,l,c){const m=xn(e);if(n)c?m?e.addClass(o,l):o.classList.add(l):m?e.removeClass(o,l):o.classList.remove(l);else{let x=-1===l.indexOf("-")?void 0:Yo.DashCase;if(null==c)m?e.removeStyle(o,l,x):o.style.removeProperty(l);else{const w="string"==typeof c&&c.endsWith("!important");w&&(c=c.slice(0,-10),x|=Yo.Important),m?e.setStyle(o,l,c,x):o.style.setProperty(l,c,w?"important":"")}}}(l,x,bi(Wr(),o),c,m))}function hy(e,n,o,l,c,m){const x=null===n;let w;for(;c>0;){const E=e[c],O=Array.isArray(E),W=O?E[1]:E,se=null===W;let fe=o[c+1];fe===Cn&&(fe=se?vn:void 0);let Se=se?wu(fe,l):W===l?fe:void 0;if(O&&!qd(Se)&&(Se=wu(E,l)),qd(Se)&&(w=Se,x))return w;const qe=e[c+1];c=x?$s(qe):Ka(qe)}if(null!==n){let E=m?n.residualClasses:n.residualStyles;null!=E&&(w=wu(E,l))}return w}function qd(e){return void 0!==e}function dy(e,n){return 0!=(e.flags&(n?16:32))}function py(e,n=""){const o=j(),l=Ie(),c=e+22,m=l.firstCreatePass?lc(l,c,1,n,null):l.data[c],x=o[c]=function Jc(e,n){return xn(e)?e.createText(n):e.createTextNode(n)}(o[11],n);Vs(l,o,x,m),qr(m,!1)}function Lf(e){return Zd("",e,""),Lf}function Zd(e,n,o){const l=j(),c=function dc(e,n,o,l){return uo(e,aa(),o)?n+ze(o)+l:Cn}(l,e,n,o);return c!==Cn&&Xa(l,Wr(),c),Zd}const pu=void 0;var w0=["en",[["a","p"],["AM","PM"],pu],[["AM","PM"],pu,pu],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],pu,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],pu,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",pu,"{1} 'at' {0}",pu],[".",",",";","%","+","-","E","\xd7","\u2030","\u221e","NaN",":"],["#,##0.###","#,##0%","\xa4#,##0.00","#E0"],"USD","$","US Dollar",{},"ltr",function b0(e){const o=Math.floor(Math.abs(e)),l=e.toString().replace(/^[^.]*\.?/,"").length;return 1===o&&0===l?1:5}];let bc={};function Rf(e){const n=function D0(e){return e.toLowerCase().replace(/_/g,"-")}(e);let o=Ly(n);if(o)return o;const l=n.split("-")[0];if(o=Ly(l),o)return o;if("en"===l)return w0;throw new Error(`Missing locale data for the locale "${e}".`)}function ky(e){return Rf(e)[yn.PluralCase]}function Ly(e){return e in bc||(bc[e]=rn.ng&&rn.ng.common&&rn.ng.common.locales&&rn.ng.common.locales[e]),bc[e]}var yn=(()=>((yn=yn||{})[yn.LocaleId=0]="LocaleId",yn[yn.DayPeriodsFormat=1]="DayPeriodsFormat",yn[yn.DayPeriodsStandalone=2]="DayPeriodsStandalone",yn[yn.DaysFormat=3]="DaysFormat",yn[yn.DaysStandalone=4]="DaysStandalone",yn[yn.MonthsFormat=5]="MonthsFormat",yn[yn.MonthsStandalone=6]="MonthsStandalone",yn[yn.Eras=7]="Eras",yn[yn.FirstDayOfWeek=8]="FirstDayOfWeek",yn[yn.WeekendRange=9]="WeekendRange",yn[yn.DateFormat=10]="DateFormat",yn[yn.TimeFormat=11]="TimeFormat",yn[yn.DateTimeFormat=12]="DateTimeFormat",yn[yn.NumberSymbols=13]="NumberSymbols",yn[yn.NumberFormats=14]="NumberFormats",yn[yn.CurrencyCode=15]="CurrencyCode",yn[yn.CurrencySymbol=16]="CurrencySymbol",yn[yn.CurrencyName=17]="CurrencyName",yn[yn.Currencies=18]="Currencies",yn[yn.Directionality=19]="Directionality",yn[yn.PluralCase=20]="PluralCase",yn[yn.ExtraData=21]="ExtraData",yn))();const wc="en-US";let Ry=wc;function Nf(e,n,o,l,c){if(e=me(e),Array.isArray(e))for(let m=0;m<e.length;m++)Nf(e[m],n,o,l,c);else{const m=Ie(),x=j();let w=he(e)?e:me(e.provide),E=rt(e);const O=zn(),W=1048575&O.providerIndexes,se=O.directiveStart,fe=O.providerIndexes>>20;if(he(e)||!e.multi){const Se=new wi(E,c,va),qe=Vf(w,n,c?W:W+fe,se);-1===qe?(v(r(O,x),m,w),Bf(m,e,n.length),n.push(w),O.directiveStart++,O.directiveEnd++,c&&(O.providerIndexes+=1048576),o.push(Se),x.push(Se)):(o[qe]=Se,x[qe]=Se)}else{const Se=Vf(w,n,W+fe,se),qe=Vf(w,n,W,W+fe),et=Se>=0&&o[Se],Ct=qe>=0&&o[qe];if(c&&!Ct||!c&&!et){v(r(O,x),m,w);const Et=function xb(e,n,o,l,c){const m=new wi(e,o,va);return m.multi=[],m.index=n,m.componentProviders=0,s_(m,c,l&&!o),m}(c?vb:_b,o.length,c,l,E);!c&&Ct&&(o[qe].providerFactory=Et),Bf(m,e,n.length,0),n.push(w),O.directiveStart++,O.directiveEnd++,c&&(O.providerIndexes+=1048576),o.push(Et),x.push(Et)}else Bf(m,e,Se>-1?Se:qe,s_(o[c?qe:Se],E,!c&&l));!c&&l&&Ct&&o[qe].componentProviders++}}}function Bf(e,n,o,l){const c=he(n),m=function be(e){return!!e.useClass}(n);if(c||m){const E=(m?me(n.useClass):n).prototype.ngOnDestroy;if(E){const O=e.destroyHooks||(e.destroyHooks=[]);if(!c&&n.multi){const W=O.indexOf(o);-1===W?O.push(o,[l,E]):O[W+1].push(l,E)}else O.push(o,E)}}}function s_(e,n,o){return o&&e.componentProviders++,e.multi.push(n)-1}function Vf(e,n,o,l){for(let c=o;c<l;c++)if(n[c]===e)return c;return-1}function _b(e,n,o,l){return Uf(this.multi,[])}function vb(e,n,o,l){const c=this.multi;let m;if(this.providerFactory){const x=this.providerFactory.componentProviders,w=ue(o,o[1],this.providerFactory.index,l);m=w.slice(0,x),Uf(c,m);for(let E=x;E<w.length;E++)m.push(w[E])}else m=[],Uf(c,m);return m}function Uf(e,n){for(let o=0;o<e.length;o++)n.push((0,e[o])());return n}function a_(e,n=[]){return o=>{o.providersResolver=(l,c)=>function yb(e,n,o){const l=Ie();if(l.firstCreatePass){const c=ti(e);Nf(o,l.data,l.blueprint,c,!0),Nf(n,l.data,l.blueprint,c,!1)}}(l,c?c(e):e,n)}}class wb{resolveComponentFactory(n){throw function bb(e){const n=Error(`No component factory found for ${Yt(e)}. Did you add it to @NgModule.entryComponents?`);return n.ngComponent=e,n}(n)}}let Jd=(()=>{class e{}return e.NULL=new wb,e})();class fu{}class u_{}function Eb(){return Cc(zn(),j())}function Cc(e,n){return new Ch(ci(e,n))}let Ch=(()=>{class e{constructor(o){this.nativeElement=o}}return e.__NG_ELEMENT_ID__=Eb,e})();function Mb(e){return e instanceof Ch?e.nativeElement:e}class c_{}let Ib=(()=>{class e{}return e.__NG_ELEMENT_ID__=()=>function Ab(){const e=j(),o=hi(zn().index,e);return function Sb(e){return e[11]}(Nr(o)?o:e)}(),e})(),Tb=(()=>{class e{}return e.\u0275prov=Xe({token:e,providedIn:"root",factory:()=>null}),e})();class h_{constructor(n){this.full=n,this.major=n.split(".")[0],this.minor=n.split(".")[1],this.patch=n.split(".").slice(2).join(".")}}const Pb=new h_("14.0.1"),jf={};function Qd(e,n,o,l,c=!1){for(;null!==o;){const m=n[o.index];if(null!==m&&l.push(cn(m)),xi(m))for(let w=10;w<m.length;w++){const E=m[w],O=E[1].firstChild;null!==O&&Qd(E[1],E,O,l)}const x=o.type;if(8&x)Qd(e,n,o.child,l);else if(32&x){const w=eu(o,n);let E;for(;E=w();)l.push(E)}else if(16&x){const w=ic(n,o);if(Array.isArray(w))l.push(...w);else{const E=yl(n[16]);Qd(E[1],E,w,l,!0)}}o=c?o.projectionNext:o.next}return l}class Eh{constructor(n,o){this._lView=n,this._cdRefInjectingView=o,this._appRef=null,this._attachedToViewContainer=!1}get rootNodes(){const n=this._lView,o=n[1];return Qd(o,n,o.firstChild,[])}get context(){return this._lView[8]}set context(n){this._lView[8]=n}get destroyed(){return 128==(128&this._lView[2])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const n=this._lView[3];if(xi(n)){const o=n[8],l=o?o.indexOf(this):-1;l>-1&&(Qc(n,l),eo(o,l))}this._attachedToViewContainer=!1}yd(this._lView[1],this._lView)}onDestroy(n){Jm(this._lView[1],this._lView,null,n)}markForCheck(){ff(this._cdRefInjectingView||this._lView)}detach(){this._lView[2]&=-65}reattach(){this._lView[2]|=64}detectChanges(){!function gf(e,n,o){const l=n[10];l.begin&&l.begin();try{cc(e,n,e.template,o)}catch(c){throw cg(n,c),c}finally{l.end&&l.end()}}(this._lView[1],this._lView,this.context)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new De(902,"");this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function md(e,n){ou(e,n,n[11],2,null,null)}(this._lView[1],this._lView)}attachToAppRef(n){if(this._attachedToViewContainer)throw new De(902,"");this._appRef=n}}class Fb extends Eh{constructor(n){super(n),this._view=n}detectChanges(){sg(this._view)}checkNoChanges(){}get context(){return null}}class $f extends Jd{constructor(n){super(),this.ngModule=n}resolveComponentFactory(n){const o=tt(n);return new Gf(o,this.ngModule)}}function d_(e){const n=[];for(let o in e)e.hasOwnProperty(o)&&n.push({propName:e[o],templateName:o});return n}class Lb{constructor(n,o){this.injector=n,this.parentInjector=o}get(n,o,l){const c=this.injector.get(n,jf,l);return c!==jf||o===jf?c:this.parentInjector.get(n,o,l)}}class Gf extends u_{constructor(n,o){super(),this.componentDef=n,this.ngModule=o,this.componentType=n.type,this.selector=function Sd(e){return e.map(Id).join(",")}(n.selectors),this.ngContentSelectors=n.ngContentSelectors?n.ngContentSelectors:[],this.isBoundToModule=!!o}get inputs(){return d_(this.componentDef.inputs)}get outputs(){return d_(this.componentDef.outputs)}create(n,o,l,c){let m=(c=c||this.ngModule)instanceof ft?c:c?.injector;m&&null!==this.componentDef.getStandaloneInjector&&(m=this.componentDef.getStandaloneInjector(m)||m);const x=m?new Lb(n,m):n,w=x.get(c_,Jt),E=x.get(Tb,null),O=w.createRenderer(null,this.componentDef),W=this.componentDef.selectors[0][0]||"div",se=l?function Xm(e,n,o){if(xn(e))return e.selectRootElement(n,o===Yn.ShadowDom);let l="string"==typeof n?e.querySelector(n):n;return l.textContent="",l}(O,l,this.componentDef.encapsulation):Wu(w.createRenderer(null,this.componentDef),W,function kb(e){const n=e.toLowerCase();return"svg"===n?"svg":"math"===n?"math":null}(W)),fe=this.componentDef.onPush?288:272,Se=function wg(e,n){return{components:[],scheduler:e||ud,clean:ux,playerHandler:n||null,flags:0}}(),qe=Bd(0,null,null,1,0,null,null,null,null,null),et=mh(null,qe,Se,fe,null,null,w,O,E,x,null);let Ct,Et;ua(et);try{const ln=function xg(e,n,o,l,c,m){const x=o[1];o[22]=e;const E=lc(x,22,2,"#host",null),O=E.mergedAttrs=n.hostAttrs;null!==O&&(Ud(E,O,!0),null!==e&&(Ts(c,e,O),null!==E.classes&&Er(c,e,E.classes),null!==E.styles&&ih(c,e,E.styles)));const W=l.createRenderer(e,n),se=mh(o,Ym(n),null,n.onPush?32:16,o[22],E,l,W,m||null,null,null);return x.firstCreatePass&&(v(r(E,o),x,n.type),ng(x,E),rg(E,o.length,1)),Vd(o,se),o[22]=se}(se,this.componentDef,et,w,O);if(se)if(l)Ts(O,se,["ng-version",Pb.full]);else{const{attrs:nt,classes:un}=function Ad(e){const n=[],o=[];let l=1,c=2;for(;l<e.length;){let m=e[l];if("string"==typeof m)2===c?""!==m&&n.push(m,e[++l]):8===c&&o.push(m);else{if(!ao(c))break;c=m}l++}return{attrs:n,classes:o}}(this.componentDef.selectors[0]);nt&&Ts(O,se,nt),un&&un.length>0&&Er(O,se,un.join(" "))}if(Et=ko(qe,22),void 0!==o){const nt=Et.projection=[];for(let un=0;un<this.ngContentSelectors.length;un++){const nr=o[un];nt.push(null!=nr?Array.from(nr):null)}}Ct=function bg(e,n,o,l,c){const m=o[1],x=function Zv(e,n,o){const l=zn();e.firstCreatePass&&(o.providersResolver&&o.providersResolver(o),ig(e,l,n,uc(e,n,1,null),o));const c=ue(n,e,l.directiveStart,l);Ni(c,n);const m=ci(l,n);return m&&Ni(m,n),c}(m,o,n);if(l.components.push(x),e[8]=x,null!==c)for(const E of c)E(x,n);if(n.contentQueries){const E=zn();n.contentQueries(1,x,E.directiveStart)}const w=zn();return!m.firstCreatePass||null===n.hostBindings&&null===n.hostAttrs||(Ho(w.index),eg(o[1],w,0,w.directiveStart,w.directiveEnd,n),tg(n,x)),x}(ln,this.componentDef,et,Se,[xx]),gh(qe,et,null)}finally{da()}return new Ob(this.componentType,Ct,Cc(Et,et),et,Et)}}class Ob extends class Cb{}{constructor(n,o,l,c,m){super(),this.location=l,this._rootLView=c,this._tNode=m,this.instance=o,this.hostView=this.changeDetectorRef=new Fb(c),this.componentType=n}get injector(){return new ge(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(n){this.hostView.onDestroy(n)}}function zb(e,n){return new p_(e,n??null)}class p_ extends fu{constructor(n,o){super(),this._parent=o,this._bootstrapComponents=[],this.injector=this,this.destroyCbs=[],this.componentFactoryResolver=new $f(this);const l=function Mt(e,n){const o=e[Ei]||null;if(!o&&!0===n)throw new Error(`Type ${Yt(e)} does not have '\u0275mod' property.`);return o}(n);this._bootstrapComponents=function Ro(e){return e instanceof Function?e():e}(l.bootstrap),this._r3Injector=Vr(n,o,[{provide:fu,useValue:this},{provide:Jd,useValue:this.componentFactoryResolver}],Yt(n),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this.get(n)}get(n,o=sr.THROW_IF_NOT_FOUND,l=mt.Default){return n===sr||n===fu||n===Le?this:this._r3Injector.get(n,o,l)}destroy(){const n=this._r3Injector;!n.destroyed&&n.destroy(),this.destroyCbs.forEach(o=>o()),this.destroyCbs=null}onDestroy(n){this.destroyCbs.push(n)}}class Hf extends class Db{}{constructor(n){super(),this.moduleType=n}create(n){return new p_(this.moduleType,n)}}function m_(e,n,o){const l=function Zr(){const e=gn.lFrame;let n=e.bindingRootIndex;return-1===n&&(n=e.bindingRootIndex=e.tView.bindingStartIndex),n}()+e,c=j();return c[l]===Cn?function wa(e,n,o){return e[n]=o}(c,l,o?n.call(o):n()):function _h(e,n){return e[n]}(c,l)}function qf(e){return n=>{setTimeout(e,void 0,n)}}const Ca=class iw extends Un.x{constructor(n=!1){super(),this.__isAsync=n}emit(n){super.next(n)}subscribe(n,o,l){let c=n,m=o||(()=>null),x=l;if(n&&"object"==typeof n){const E=n;c=E.next?.bind(E),m=E.error?.bind(E),x=E.complete?.bind(E)}this.__isAsync&&(m=qf(m),c&&(c=qf(c)),x&&(x=qf(x)));const w=super.subscribe({next:c,error:m,complete:x});return n instanceof Gt.w0&&n.add(w),w}};function ow(){return this._results[hu()]()}class Zf{constructor(n=!1){this._emitDistinctChangesOnly=n,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=null,this.length=0,this.first=void 0,this.last=void 0;const o=hu(),l=Zf.prototype;l[o]||(l[o]=ow)}get changes(){return this._changes||(this._changes=new Ca)}get(n){return this._results[n]}map(n){return this._results.map(n)}filter(n){return this._results.filter(n)}find(n){return this._results.find(n)}reduce(n,o){return this._results.reduce(n,o)}forEach(n){this._results.forEach(n)}some(n){return this._results.some(n)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(n,o){const l=this;l.dirty=!1;const c=dr(n);(this._changesDetected=!function Gr(e,n,o){if(e.length!==n.length)return!1;for(let l=0;l<e.length;l++){let c=e[l],m=n[l];if(o&&(c=o(c),m=o(m)),m!==c)return!1}return!0}(l._results,c,o))&&(l._results=c,l.length=c.length,l.last=c[this.length-1],l.first=c[0])}notifyOnChanges(){this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}let Sh=(()=>{class e{}return e.__NG_ELEMENT_ID__=lw,e})();const sw=Sh,aw=class extends sw{constructor(n,o,l){super(),this._declarationLView=n,this._declarationTContainer=o,this.elementRef=l}createEmbeddedView(n,o){const l=this._declarationTContainer.tViews,c=mh(this._declarationLView,l,n,16,null,l.declTNode,null,null,null,null,o||null);c[17]=this._declarationLView[this._declarationTContainer.index];const x=this._declarationLView[19];return null!==x&&(c[19]=x.createEmbeddedView(l)),gh(l,c,n),new Eh(c)}};function lw(){return ep(zn(),j())}function ep(e,n){return 4&e.type?new aw(n,e,Cc(e,n)):null}let tp=(()=>{class e{}return e.__NG_ELEMENT_ID__=uw,e})();function uw(){return D_(zn(),j())}const cw=tp,b_=class extends cw{constructor(n,o,l){super(),this._lContainer=n,this._hostTNode=o,this._hostLView=l}get element(){return Cc(this._hostTNode,this._hostLView)}get injector(){return new ge(this._hostTNode,this._hostLView)}get parentInjector(){const n=g(this._hostTNode,this._hostLView);if(il(n)){const o=Yr(n,this._hostLView),l=Cr(n);return new ge(o[1].data[l+8],o)}return new ge(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(n){const o=w_(this._lContainer);return null!==o&&o[n]||null}get length(){return this._lContainer.length-10}createEmbeddedView(n,o,l){let c,m;"number"==typeof l?c=l:null!=l&&(c=l.index,m=l.injector);const x=n.createEmbeddedView(o||{},m);return this.insert(x,c),x}createComponent(n,o,l,c,m){const x=n&&!function Rn(e){return"function"==typeof e}(n);let w;if(x)w=o;else{const se=o||{};w=se.index,l=se.injector,c=se.projectableNodes,m=se.environmentInjector||se.ngModuleRef}const E=x?n:new Gf(tt(n)),O=l||this.parentInjector;if(!m&&null==E.ngModule){const fe=(x?O:this.parentInjector).get(ft,null);fe&&(m=fe)}const W=E.create(O,c,void 0,m);return this.insert(W.hostView,w),W}insert(n,o){const l=n._lView,c=l[1];if(function Ms(e){return xi(e[3])}(l)){const W=this.indexOf(n);if(-1!==W)this.detach(W);else{const se=l[3],fe=new b_(se,se[6],se[3]);fe.detach(fe.indexOf(n))}}const m=this._adjustIndex(o),x=this._lContainer;!function Xu(e,n,o,l){const c=10+l,m=o.length;l>0&&(o[c-1][4]=n),l<m-10?(n[4]=o[c],hs(o,10+l,n)):(o.push(n),n[4]=null),n[3]=o;const x=n[17];null!==x&&o!==x&&function Ju(e,n){const o=e[9];n[16]!==n[3][3][16]&&(e[2]=!0),null===o?e[9]=[n]:o.push(n)}(x,n);const w=n[19];null!==w&&w.insertView(e),n[2]|=64}(c,l,x,m);const w=oc(m,x),E=l[11],O=ec(E,x[7]);return null!==O&&function Yu(e,n,o,l,c,m){l[0]=c,l[6]=n,ou(e,l,o,1,c,m)}(c,x[6],E,l,O,w),n.attachToViewContainerRef(),hs(Wf(x),m,n),n}move(n,o){return this.insert(n,o)}indexOf(n){const o=w_(this._lContainer);return null!==o?o.indexOf(n):-1}remove(n){const o=this._adjustIndex(n,-1),l=Qc(this._lContainer,o);l&&(eo(Wf(this._lContainer),o),yd(l[1],l))}detach(n){const o=this._adjustIndex(n,-1),l=Qc(this._lContainer,o);return l&&null!=eo(Wf(this._lContainer),o)?new Eh(l):null}_adjustIndex(n,o=0){return n??this.length+o}};function w_(e){return e[8]}function Wf(e){return e[8]||(e[8]=[])}function D_(e,n){let o;const l=n[e.index];if(xi(l))o=l;else{let c;if(8&e.type)c=cn(l);else{const m=n[11];c=m.createComment("");const x=ci(e,n);Ya(m,ec(m,x),c,function jp(e,n){return xn(e)?e.nextSibling(n):n.nextSibling}(m,x),!1)}n[e.index]=o=og(l,n,c,e),Vd(n,o)}return new b_(o,e,n)}class Yf{constructor(n){this.queryList=n,this.matches=null}clone(){return new Yf(this.queryList)}setDirty(){this.queryList.setDirty()}}class Kf{constructor(n=[]){this.queries=n}createEmbeddedView(n){const o=n.queries;if(null!==o){const l=null!==n.contentQueries?n.contentQueries[0]:o.length,c=[];for(let m=0;m<l;m++){const x=o.getByIndex(m);c.push(this.queries[x.indexInDeclarationView].clone())}return new Kf(c)}return null}insertView(n){this.dirtyQueriesWithMatches(n)}detachView(n){this.dirtyQueriesWithMatches(n)}dirtyQueriesWithMatches(n){for(let o=0;o<this.queries.length;o++)null!==P_(n,o).matches&&this.queries[o].setDirty()}}class C_{constructor(n,o,l=null){this.predicate=n,this.flags=o,this.read=l}}class Xf{constructor(n=[]){this.queries=n}elementStart(n,o){for(let l=0;l<this.queries.length;l++)this.queries[l].elementStart(n,o)}elementEnd(n){for(let o=0;o<this.queries.length;o++)this.queries[o].elementEnd(n)}embeddedTView(n){let o=null;for(let l=0;l<this.length;l++){const c=null!==o?o.length:0,m=this.getByIndex(l).embeddedTView(n,c);m&&(m.indexInDeclarationView=l,null!==o?o.push(m):o=[m])}return null!==o?new Xf(o):null}template(n,o){for(let l=0;l<this.queries.length;l++)this.queries[l].template(n,o)}getByIndex(n){return this.queries[n]}get length(){return this.queries.length}track(n){this.queries.push(n)}}class Jf{constructor(n,o=-1){this.metadata=n,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=o}elementStart(n,o){this.isApplyingToNode(o)&&this.matchTNode(n,o)}elementEnd(n){this._declarationNodeIndex===n.index&&(this._appliesToNextNode=!1)}template(n,o){this.elementStart(n,o)}embeddedTView(n,o){return this.isApplyingToNode(n)?(this.crossesNgTemplate=!0,this.addMatch(-n.index,o),new Jf(this.metadata)):null}isApplyingToNode(n){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const o=this._declarationNodeIndex;let l=n.parent;for(;null!==l&&8&l.type&&l.index!==o;)l=l.parent;return o===(null!==l?l.index:-1)}return this._appliesToNextNode}matchTNode(n,o){const l=this.metadata.predicate;if(Array.isArray(l))for(let c=0;c<l.length;c++){const m=l[c];this.matchTNodeWithReadOption(n,o,pw(o,m)),this.matchTNodeWithReadOption(n,o,re(o,n,m,!1,!1))}else l===Sh?4&o.type&&this.matchTNodeWithReadOption(n,o,-1):this.matchTNodeWithReadOption(n,o,re(o,n,l,!1,!1))}matchTNodeWithReadOption(n,o,l){if(null!==l){const c=this.metadata.read;if(null!==c)if(c===Ch||c===tp||c===Sh&&4&o.type)this.addMatch(o.index,-2);else{const m=re(o,n,c,!1,!1);null!==m&&this.addMatch(o.index,m)}else this.addMatch(o.index,l)}}addMatch(n,o){null===this.matches?this.matches=[n,o]:this.matches.push(n,o)}}function pw(e,n){const o=e.localNames;if(null!==o)for(let l=0;l<o.length;l+=2)if(o[l]===n)return o[l+1];return null}function mw(e,n,o,l){return-1===o?function fw(e,n){return 11&e.type?Cc(e,n):4&e.type?ep(e,n):null}(n,e):-2===o?function gw(e,n,o){return o===Ch?Cc(n,e):o===Sh?ep(n,e):o===tp?D_(n,e):void 0}(e,n,l):ue(e,e[1],o,n)}function E_(e,n,o,l){const c=n[19].queries[l];if(null===c.matches){const m=e.data,x=o.matches,w=[];for(let E=0;E<x.length;E+=2){const O=x[E];w.push(O<0?null:mw(n,m[O],x[E+1],o.metadata.read))}c.matches=w}return c.matches}function Qf(e,n,o,l){const c=e.queries.getByIndex(o),m=c.matches;if(null!==m){const x=E_(e,n,c,o);for(let w=0;w<m.length;w+=2){const E=m[w];if(E>0)l.push(x[w/2]);else{const O=m[w+1],W=n[-E];for(let se=10;se<W.length;se++){const fe=W[se];fe[17]===fe[3]&&Qf(fe[1],fe,O,l)}if(null!==W[9]){const se=W[9];for(let fe=0;fe<se.length;fe++){const Se=se[fe];Qf(Se[1],Se,O,l)}}}}}return l}function M_(e){const n=j(),o=Ie(),l=Ml();Go(l+1);const c=P_(o,l);if(e.dirty&&Cs(n)===(2==(2&c.metadata.flags))){if(null===c.matches)e.reset([]);else{const m=c.crossesNgTemplate?Qf(o,n,l,[]):E_(o,n,c,l);e.reset(m,Mb),e.notifyOnChanges()}return!0}return!1}function I_(e,n,o){const l=Ie();l.firstCreatePass&&(function T_(e,n,o){null===e.queries&&(e.queries=new Xf),e.queries.track(new Jf(n,o))}(l,new C_(e,n,o),-1),2==(2&n)&&(l.staticViewQueries=!0)),function A_(e,n,o){const l=new Zf(4==(4&o));Jm(e,n,l,l.destroy),null===n[19]&&(n[19]=new Kf),n[19].queries.push(new Yf(l))}(l,j(),n)}function S_(){return function _w(e,n){return e[19].queries[n].queryList}(j(),Ml())}function P_(e,n){return e.queries.getByIndex(n)}function rp(...e){}const K_=new pn("Application Initializer");let ip=(()=>{class e{constructor(o){this.appInits=o,this.resolve=rp,this.reject=rp,this.initialized=!1,this.done=!1,this.donePromise=new Promise((l,c)=>{this.resolve=l,this.reject=c})}runInitializers(){if(this.initialized)return;const o=[],l=()=>{this.done=!0,this.resolve()};if(this.appInits)for(let c=0;c<this.appInits.length;c++){const m=this.appInits[c]();if(Sf(m))o.push(m);else if(zg(m)){const x=new Promise((w,E)=>{m.subscribe({complete:w,error:E})});o.push(x)}}Promise.all(o).then(()=>{l()}).catch(c=>{this.reject(c)}),0===o.length&&l(),this.initialized=!0}}return e.\u0275fac=function(o){return new(o||e)(Kr(K_,8))},e.\u0275prov=Xe({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();const X_=new pn("AppId",{providedIn:"root",factory:function J_(){return`${im()}${im()}${im()}`}});function im(){return String.fromCharCode(97+Math.floor(25*Math.random()))}const Q_=new pn("Platform Initializer"),Vw=new pn("Platform ID",{providedIn:"platform",factory:()=>"unknown"}),Uw=new pn("appBootstrapListener"),op=new pn("LocaleId",{providedIn:"root",factory:()=>function cp(e,n=mt.Default){return Kr(e,n)}(op,mt.Optional|mt.SkipSelf)||function jw(){return typeof $localize<"u"&&$localize.locale||wc}()}),$w=new pn("DefaultCurrencyCode",{providedIn:"root",factory:()=>"USD"}),qw=(()=>Promise.resolve(0))();function om(e){typeof Zone>"u"?qw.then(()=>{e&&e.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",e)}class es{constructor({enableLongStackTrace:n=!1,shouldCoalesceEventChangeDetection:o=!1,shouldCoalesceRunChangeDetection:l=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new Ca(!1),this.onMicrotaskEmpty=new Ca(!1),this.onStable=new Ca(!1),this.onError=new Ca(!1),typeof Zone>"u")throw new Error("In this configuration Angular requires Zone.js");Zone.assertZonePatched();const c=this;c._nesting=0,c._outer=c._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(c._inner=c._inner.fork(new Zone.TaskTrackingZoneSpec)),n&&Zone.longStackTraceZoneSpec&&(c._inner=c._inner.fork(Zone.longStackTraceZoneSpec)),c.shouldCoalesceEventChangeDetection=!l&&o,c.shouldCoalesceRunChangeDetection=l,c.lastRequestAnimationFrameId=-1,c.nativeRequestAnimationFrame=function Zw(){let e=rn.requestAnimationFrame,n=rn.cancelAnimationFrame;if(typeof Zone<"u"&&e&&n){const o=e[Zone.__symbol__("OriginalDelegate")];o&&(e=o);const l=n[Zone.__symbol__("OriginalDelegate")];l&&(n=l)}return{nativeRequestAnimationFrame:e,nativeCancelAnimationFrame:n}}().nativeRequestAnimationFrame,function Kw(e){const n=()=>{!function Yw(e){e.isCheckStableRunning||-1!==e.lastRequestAnimationFrameId||(e.lastRequestAnimationFrameId=e.nativeRequestAnimationFrame.call(rn,()=>{e.fakeTopEventTask||(e.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{e.lastRequestAnimationFrameId=-1,am(e),e.isCheckStableRunning=!0,sm(e),e.isCheckStableRunning=!1},void 0,()=>{},()=>{})),e.fakeTopEventTask.invoke()}),am(e))}(e)};e._inner=e._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(o,l,c,m,x,w)=>{try{return ev(e),o.invokeTask(c,m,x,w)}finally{(e.shouldCoalesceEventChangeDetection&&"eventTask"===m.type||e.shouldCoalesceRunChangeDetection)&&n(),tv(e)}},onInvoke:(o,l,c,m,x,w,E)=>{try{return ev(e),o.invoke(c,m,x,w,E)}finally{e.shouldCoalesceRunChangeDetection&&n(),tv(e)}},onHasTask:(o,l,c,m)=>{o.hasTask(c,m),l===c&&("microTask"==m.change?(e._hasPendingMicrotasks=m.microTask,am(e),sm(e)):"macroTask"==m.change&&(e.hasPendingMacrotasks=m.macroTask))},onHandleError:(o,l,c,m)=>(o.handleError(c,m),e.runOutsideAngular(()=>e.onError.emit(m)),!1)})}(c)}static isInAngularZone(){return typeof Zone<"u"&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!es.isInAngularZone())throw new Error("Expected to be in Angular Zone, but it is not!")}static assertNotInAngularZone(){if(es.isInAngularZone())throw new Error("Expected to not be in Angular Zone, but it is!")}run(n,o,l){return this._inner.run(n,o,l)}runTask(n,o,l,c){const m=this._inner,x=m.scheduleEventTask("NgZoneEvent: "+c,n,Ww,rp,rp);try{return m.runTask(x,o,l)}finally{m.cancelTask(x)}}runGuarded(n,o,l){return this._inner.runGuarded(n,o,l)}runOutsideAngular(n){return this._outer.run(n)}}const Ww={};function sm(e){if(0==e._nesting&&!e.hasPendingMicrotasks&&!e.isStable)try{e._nesting++,e.onMicrotaskEmpty.emit(null)}finally{if(e._nesting--,!e.hasPendingMicrotasks)try{e.runOutsideAngular(()=>e.onStable.emit(null))}finally{e.isStable=!0}}}function am(e){e.hasPendingMicrotasks=!!(e._hasPendingMicrotasks||(e.shouldCoalesceEventChangeDetection||e.shouldCoalesceRunChangeDetection)&&-1!==e.lastRequestAnimationFrameId)}function ev(e){e._nesting++,e.isStable&&(e.isStable=!1,e.onUnstable.emit(null))}function tv(e){e._nesting--,sm(e)}class Xw{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new Ca,this.onMicrotaskEmpty=new Ca,this.onStable=new Ca,this.onError=new Ca}run(n,o,l){return n.apply(o,l)}runGuarded(n,o,l){return n.apply(o,l)}runOutsideAngular(n){return n()}runTask(n,o,l,c){return n.apply(o,l)}}const nv=new pn(""),rv=new pn("");let lm,Jw=(()=>{class e{constructor(o,l,c){this._ngZone=o,this.registry=l,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,lm||(function Qw(e){lm=e}(c),c.addToWindow(l)),this._watchAngularEvents(),o.run(()=>{this.taskTrackingZone=typeof Zone>"u"?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{es.assertNotInAngularZone(),om(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())om(()=>{for(;0!==this._callbacks.length;){let o=this._callbacks.pop();clearTimeout(o.timeoutId),o.doneCb(this._didWork)}this._didWork=!1});else{let o=this.getPendingTasks();this._callbacks=this._callbacks.filter(l=>!l.updateCb||!l.updateCb(o)||(clearTimeout(l.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(o=>({source:o.source,creationLocation:o.creationLocation,data:o.data})):[]}addCallback(o,l,c){let m=-1;l&&l>0&&(m=setTimeout(()=>{this._callbacks=this._callbacks.filter(x=>x.timeoutId!==m),o(this._didWork,this.getPendingTasks())},l)),this._callbacks.push({doneCb:o,timeoutId:m,updateCb:c})}whenStable(o,l,c){if(c&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(o,l,c),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}registerApplication(o){this.registry.registerApplication(o,this)}unregisterApplication(o){this.registry.unregisterApplication(o)}findProviders(o,l,c){return[]}}return e.\u0275fac=function(o){return new(o||e)(Kr(es),Kr(iv),Kr(rv))},e.\u0275prov=Xe({token:e,factory:e.\u0275fac}),e})(),iv=(()=>{class e{constructor(){this._applications=new Map}registerApplication(o,l){this._applications.set(o,l)}unregisterApplication(o){this._applications.delete(o)}unregisterAllApplications(){this._applications.clear()}getTestability(o){return this._applications.get(o)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(o,l=!0){return lm?.findTestabilityInTree(this,o,l)??null}}return e.\u0275fac=function(o){return new(o||e)},e.\u0275prov=Xe({token:e,factory:e.\u0275fac,providedIn:"platform"}),e})(),Dl=null;const ov=new pn("AllowMultipleToken"),sv=new pn("PlatformOnDestroy");function lv(e,n,o=[]){const l=`Platform: ${n}`,c=new pn(l);return(m=[])=>{let x=um();if(!x||x.injector.get(ov,!1)){const w=[...o,...m,{provide:c,useValue:!0}];e?e(w):function n1(e){if(Dl&&!Dl.get(ov,!1))throw new De(400,"");Dl=e;const n=e.get(cv);(function av(e){const n=e.get(Q_,null);n&&n.forEach(o=>o())})(e)}(function uv(e=[],n){return sr.create({name:n,providers:[{provide:Ve,useValue:"platform"},{provide:sv,useValue:()=>Dl=null},...e]})}(w,l))}return function i1(e){const n=um();if(!n)throw new De(401,"");return n}()}}function um(){return Dl?.get(cv)??null}let cv=(()=>{class e{constructor(o){this._injector=o,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(o,l){const c=function o1(e,n){let o;return o="noop"===e?new Xw:("zone.js"===e?void 0:e)||new es(n),o}(l?.ngZone,function hv(e){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:!(!e||!e.ngZoneEventCoalescing)||!1,shouldCoalesceRunChangeDetection:!(!e||!e.ngZoneRunCoalescing)||!1}}(l)),m=[{provide:es,useValue:c}];return c.run(()=>{const x=sr.create({providers:m,parent:this.injector,name:o.moduleType.name}),w=o.create(x),E=w.injector.get(Wl,null);if(!E)throw new De(402,"");return c.runOutsideAngular(()=>{const O=c.onError.subscribe({next:W=>{E.handleError(W)}});w.onDestroy(()=>{sp(this._modules,w),O.unsubscribe()})}),function dv(e,n,o){try{const l=o();return Sf(l)?l.catch(c=>{throw n.runOutsideAngular(()=>e.handleError(c)),c}):l}catch(l){throw n.runOutsideAngular(()=>e.handleError(l)),l}}(E,c,()=>{const O=w.injector.get(ip);return O.runInitializers(),O.donePromise.then(()=>(function Oy(e){tr(e,"Expected localeId to be defined"),"string"==typeof e&&(Ry=e.toLowerCase().replace(/_/g,"-"))}(w.injector.get(op,wc)||wc),this._moduleDoBootstrap(w),w))})})}bootstrapModule(o,l=[]){const c=pv({},l);return function e1(e,n,o){const l=new Hf(o);return Promise.resolve(l)}(0,0,o).then(m=>this.bootstrapModuleFactory(m,c))}_moduleDoBootstrap(o){const l=o.injector.get(cm);if(o._bootstrapComponents.length>0)o._bootstrapComponents.forEach(c=>l.bootstrap(c));else{if(!o.instance.ngDoBootstrap)throw new De(403,"");o.instance.ngDoBootstrap(l)}this._modules.push(o)}onDestroy(o){this._destroyListeners.push(o)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new De(404,"");this._modules.slice().forEach(l=>l.destroy()),this._destroyListeners.forEach(l=>l()),this._injector.get(sv,null)?.(),this._destroyed=!0}get destroyed(){return this._destroyed}}return e.\u0275fac=function(o){return new(o||e)(Kr(sr))},e.\u0275prov=Xe({token:e,factory:e.\u0275fac,providedIn:"platform"}),e})();function pv(e,n){return Array.isArray(n)?n.reduce(pv,e):{...e,...n}}let cm=(()=>{class e{constructor(o,l,c,m){this._zone=o,this._injector=l,this._exceptionHandler=c,this._initStatus=m,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._stable=!0,this._destroyed=!1,this._destroyListeners=[],this.componentTypes=[],this.components=[],this._onMicrotaskEmptySubscription=this._zone.onMicrotaskEmpty.subscribe({next:()=>{this._zone.run(()=>{this.tick()})}});const x=new dn.y(E=>{this._stable=this._zone.isStable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks,this._zone.runOutsideAngular(()=>{E.next(this._stable),E.complete()})}),w=new dn.y(E=>{let O;this._zone.runOutsideAngular(()=>{O=this._zone.onStable.subscribe(()=>{es.assertNotInAngularZone(),om(()=>{!this._stable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks&&(this._stable=!0,E.next(!0))})})});const W=this._zone.onUnstable.subscribe(()=>{es.assertInAngularZone(),this._stable&&(this._stable=!1,this._zone.runOutsideAngular(()=>{E.next(!1)}))});return()=>{O.unsubscribe(),W.unsubscribe()}});this.isStable=Vt(x,w.pipe(function Fn(e={}){const{connector:n=(()=>new Un.x),resetOnError:o=!0,resetOnComplete:l=!0,resetOnRefCountZero:c=!0}=e;return m=>{let x=null,w=null,E=null,O=0,W=!1,se=!1;const fe=()=>{w?.unsubscribe(),w=null},Se=()=>{fe(),x=E=null,W=se=!1},qe=()=>{const et=x;Se(),et?.unsubscribe()};return(0,Rt.e)((et,Ct)=>{O++,!se&&!W&&fe();const Et=E=E??n();Ct.add(()=>{O--,0===O&&!se&&!W&&(w=pt(qe,c))}),Et.subscribe(Ct),x||(x=new Dn.Hp({next:ln=>Et.next(ln),error:ln=>{se=!0,fe(),w=pt(Se,o,ln),Et.error(ln)},complete:()=>{W=!0,fe(),w=pt(Se,l),Et.complete()}}),(0,Vn.D)(et).subscribe(x))})(m)}}()))}get destroyed(){return this._destroyed}get injector(){return this._injector}bootstrap(o,l){const c=o instanceof u_;if(!this._initStatus.done)throw!c&&function Th(e){const n=tt(e)||st(e)||ct(e);return null!==n&&n.standalone}(o),new De(405,false);let m;m=c?o:this._injector.get(Jd).resolveComponentFactory(o),this.componentTypes.push(m.componentType);const x=function t1(e){return e.isBoundToModule}(m)?void 0:this._injector.get(fu),E=m.create(sr.NULL,[],l||m.selector,x),O=E.location.nativeElement,W=E.injector.get(nv,null);return W?.registerApplication(O),E.onDestroy(()=>{this.detachView(E.hostView),sp(this.components,E),W?.unregisterApplication(O)}),this._loadComponent(E),E}tick(){if(this._runningTick)throw new De(101,"");try{this._runningTick=!0;for(let o of this._views)o.detectChanges()}catch(o){this._zone.runOutsideAngular(()=>this._exceptionHandler.handleError(o))}finally{this._runningTick=!1}}attachView(o){const l=o;this._views.push(l),l.attachToAppRef(this)}detachView(o){const l=o;sp(this._views,l),l.detachFromAppRef()}_loadComponent(o){this.attachView(o.hostView),this.tick(),this.components.push(o),this._injector.get(Uw,[]).concat(this._bootstrapListeners).forEach(c=>c(o))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(o=>o()),this._views.slice().forEach(o=>o.destroy()),this._onMicrotaskEmptySubscription.unsubscribe()}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(o){return this._destroyListeners.push(o),()=>sp(this._destroyListeners,o)}destroy(){if(this._destroyed)throw new De(406,false);const o=this._injector;o.destroy&&!o.destroyed&&o.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}}return e.\u0275fac=function(o){return new(o||e)(Kr(es),Kr(sr),Kr(Wl),Kr(ip))},e.\u0275prov=Xe({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();function sp(e,n){const o=e.indexOf(n);o>-1&&e.splice(o,1)}let mv=!0;function a1(){mv=!1}let l1=(()=>{class e{}return e.__NG_ELEMENT_ID__=u1,e})();function u1(e){return function c1(e,n,o){if(Ao(e)&&!o){const l=hi(e.index,n);return new Eh(l,l)}return 47&e.type?new Eh(n[16],n):null}(zn(),j(),16==(16&e))}class xv{constructor(){}supports(n){return yh(n)}create(n){return new g1(n)}}const m1=(e,n)=>n;class g1{constructor(n){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=n||m1}forEachItem(n){let o;for(o=this._itHead;null!==o;o=o._next)n(o)}forEachOperation(n){let o=this._itHead,l=this._removalsHead,c=0,m=null;for(;o||l;){const x=!l||o&&o.currentIndex<wv(l,c,m)?o:l,w=wv(x,c,m),E=x.currentIndex;if(x===l)c--,l=l._nextRemoved;else if(o=o._next,null==x.previousIndex)c++;else{m||(m=[]);const O=w-c,W=E-c;if(O!=W){for(let fe=0;fe<O;fe++){const Se=fe<m.length?m[fe]:m[fe]=0,qe=Se+fe;W<=qe&&qe<O&&(m[fe]=Se+1)}m[x.previousIndex]=W-O}}w!==E&&n(x,w,E)}}forEachPreviousItem(n){let o;for(o=this._previousItHead;null!==o;o=o._nextPrevious)n(o)}forEachAddedItem(n){let o;for(o=this._additionsHead;null!==o;o=o._nextAdded)n(o)}forEachMovedItem(n){let o;for(o=this._movesHead;null!==o;o=o._nextMoved)n(o)}forEachRemovedItem(n){let o;for(o=this._removalsHead;null!==o;o=o._nextRemoved)n(o)}forEachIdentityChange(n){let o;for(o=this._identityChangesHead;null!==o;o=o._nextIdentityChange)n(o)}diff(n){if(null==n&&(n=[]),!yh(n))throw new De(900,"");return this.check(n)?this:null}onDestroy(){}check(n){this._reset();let c,m,x,o=this._itHead,l=!1;if(Array.isArray(n)){this.length=n.length;for(let w=0;w<this.length;w++)m=n[w],x=this._trackByFn(w,m),null!==o&&Object.is(o.trackById,x)?(l&&(o=this._verifyReinsertion(o,m,x,w)),Object.is(o.item,m)||this._addIdentityChange(o,m)):(o=this._mismatch(o,m,x,w),l=!0),o=o._next}else c=0,function Ax(e,n){if(Array.isArray(e))for(let o=0;o<e.length;o++)n(e[o]);else{const o=e[hu()]();let l;for(;!(l=o.next()).done;)n(l.value)}}(n,w=>{x=this._trackByFn(c,w),null!==o&&Object.is(o.trackById,x)?(l&&(o=this._verifyReinsertion(o,w,x,c)),Object.is(o.item,w)||this._addIdentityChange(o,w)):(o=this._mismatch(o,w,x,c),l=!0),o=o._next,c++}),this.length=c;return this._truncate(o),this.collection=n,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let n;for(n=this._previousItHead=this._itHead;null!==n;n=n._next)n._nextPrevious=n._next;for(n=this._additionsHead;null!==n;n=n._nextAdded)n.previousIndex=n.currentIndex;for(this._additionsHead=this._additionsTail=null,n=this._movesHead;null!==n;n=n._nextMoved)n.previousIndex=n.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(n,o,l,c){let m;return null===n?m=this._itTail:(m=n._prev,this._remove(n)),null!==(n=null===this._unlinkedRecords?null:this._unlinkedRecords.get(l,null))?(Object.is(n.item,o)||this._addIdentityChange(n,o),this._reinsertAfter(n,m,c)):null!==(n=null===this._linkedRecords?null:this._linkedRecords.get(l,c))?(Object.is(n.item,o)||this._addIdentityChange(n,o),this._moveAfter(n,m,c)):n=this._addAfter(new y1(o,l),m,c),n}_verifyReinsertion(n,o,l,c){let m=null===this._unlinkedRecords?null:this._unlinkedRecords.get(l,null);return null!==m?n=this._reinsertAfter(m,n._prev,c):n.currentIndex!=c&&(n.currentIndex=c,this._addToMoves(n,c)),n}_truncate(n){for(;null!==n;){const o=n._next;this._addToRemovals(this._unlink(n)),n=o}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(n,o,l){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(n);const c=n._prevRemoved,m=n._nextRemoved;return null===c?this._removalsHead=m:c._nextRemoved=m,null===m?this._removalsTail=c:m._prevRemoved=c,this._insertAfter(n,o,l),this._addToMoves(n,l),n}_moveAfter(n,o,l){return this._unlink(n),this._insertAfter(n,o,l),this._addToMoves(n,l),n}_addAfter(n,o,l){return this._insertAfter(n,o,l),this._additionsTail=null===this._additionsTail?this._additionsHead=n:this._additionsTail._nextAdded=n,n}_insertAfter(n,o,l){const c=null===o?this._itHead:o._next;return n._next=c,n._prev=o,null===c?this._itTail=n:c._prev=n,null===o?this._itHead=n:o._next=n,null===this._linkedRecords&&(this._linkedRecords=new bv),this._linkedRecords.put(n),n.currentIndex=l,n}_remove(n){return this._addToRemovals(this._unlink(n))}_unlink(n){null!==this._linkedRecords&&this._linkedRecords.remove(n);const o=n._prev,l=n._next;return null===o?this._itHead=l:o._next=l,null===l?this._itTail=o:l._prev=o,n}_addToMoves(n,o){return n.previousIndex===o||(this._movesTail=null===this._movesTail?this._movesHead=n:this._movesTail._nextMoved=n),n}_addToRemovals(n){return null===this._unlinkedRecords&&(this._unlinkedRecords=new bv),this._unlinkedRecords.put(n),n.currentIndex=null,n._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=n,n._prevRemoved=null):(n._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=n),n}_addIdentityChange(n,o){return n.item=o,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=n:this._identityChangesTail._nextIdentityChange=n,n}}class y1{constructor(n,o){this.item=n,this.trackById=o,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class _1{constructor(){this._head=null,this._tail=null}add(n){null===this._head?(this._head=this._tail=n,n._nextDup=null,n._prevDup=null):(this._tail._nextDup=n,n._prevDup=this._tail,n._nextDup=null,this._tail=n)}get(n,o){let l;for(l=this._head;null!==l;l=l._nextDup)if((null===o||o<=l.currentIndex)&&Object.is(l.trackById,n))return l;return null}remove(n){const o=n._prevDup,l=n._nextDup;return null===o?this._head=l:o._nextDup=l,null===l?this._tail=o:l._prevDup=o,null===this._head}}class bv{constructor(){this.map=new Map}put(n){const o=n.trackById;let l=this.map.get(o);l||(l=new _1,this.map.set(o,l)),l.add(n)}get(n,o){const c=this.map.get(n);return c?c.get(n,o):null}remove(n){const o=n.trackById;return this.map.get(o).remove(n)&&this.map.delete(o),n}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function wv(e,n,o){const l=e.previousIndex;if(null===l)return l;let c=0;return o&&l<o.length&&(c=o[l]),l+n+c}class Dv{constructor(){}supports(n){return n instanceof Map||bf(n)}create(){return new v1}}class v1{constructor(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}get isDirty(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead}forEachItem(n){let o;for(o=this._mapHead;null!==o;o=o._next)n(o)}forEachPreviousItem(n){let o;for(o=this._previousMapHead;null!==o;o=o._nextPrevious)n(o)}forEachChangedItem(n){let o;for(o=this._changesHead;null!==o;o=o._nextChanged)n(o)}forEachAddedItem(n){let o;for(o=this._additionsHead;null!==o;o=o._nextAdded)n(o)}forEachRemovedItem(n){let o;for(o=this._removalsHead;null!==o;o=o._nextRemoved)n(o)}diff(n){if(n){if(!(n instanceof Map||bf(n)))throw new De(900,"")}else n=new Map;return this.check(n)?this:null}onDestroy(){}check(n){this._reset();let o=this._mapHead;if(this._appendAfter=null,this._forEach(n,(l,c)=>{if(o&&o.key===c)this._maybeAddToChanges(o,l),this._appendAfter=o,o=o._next;else{const m=this._getOrCreateRecordForKey(c,l);o=this._insertBeforeOrAppend(o,m)}}),o){o._prev&&(o._prev._next=null),this._removalsHead=o;for(let l=o;null!==l;l=l._nextRemoved)l===this._mapHead&&(this._mapHead=null),this._records.delete(l.key),l._nextRemoved=l._next,l.previousValue=l.currentValue,l.currentValue=null,l._prev=null,l._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(n,o){if(n){const l=n._prev;return o._next=n,o._prev=l,n._prev=o,l&&(l._next=o),n===this._mapHead&&(this._mapHead=o),this._appendAfter=n,n}return this._appendAfter?(this._appendAfter._next=o,o._prev=this._appendAfter):this._mapHead=o,this._appendAfter=o,null}_getOrCreateRecordForKey(n,o){if(this._records.has(n)){const c=this._records.get(n);this._maybeAddToChanges(c,o);const m=c._prev,x=c._next;return m&&(m._next=x),x&&(x._prev=m),c._next=null,c._prev=null,c}const l=new x1(n);return this._records.set(n,l),l.currentValue=o,this._addToAdditions(l),l}_reset(){if(this.isDirty){let n;for(this._previousMapHead=this._mapHead,n=this._previousMapHead;null!==n;n=n._next)n._nextPrevious=n._next;for(n=this._changesHead;null!==n;n=n._nextChanged)n.previousValue=n.currentValue;for(n=this._additionsHead;null!=n;n=n._nextAdded)n.previousValue=n.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(n,o){Object.is(o,n.currentValue)||(n.previousValue=n.currentValue,n.currentValue=o,this._addToChanges(n))}_addToAdditions(n){null===this._additionsHead?this._additionsHead=this._additionsTail=n:(this._additionsTail._nextAdded=n,this._additionsTail=n)}_addToChanges(n){null===this._changesHead?this._changesHead=this._changesTail=n:(this._changesTail._nextChanged=n,this._changesTail=n)}_forEach(n,o){n instanceof Map?n.forEach(o):Object.keys(n).forEach(l=>o(n[l],l))}}class x1{constructor(n){this.key=n,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}}function Cv(){return new mm([new xv])}let mm=(()=>{class e{constructor(o){this.factories=o}static create(o,l){if(null!=l){const c=l.factories.slice();o=o.concat(c)}return new e(o)}static extend(o){return{provide:e,useFactory:l=>e.create(o,l||Cv()),deps:[[e,new Au,new Va]]}}find(o){const l=this.factories.find(c=>c.supports(o));if(null!=l)return l;throw new De(901,"")}}return e.\u0275prov=Xe({token:e,providedIn:"root",factory:Cv}),e})();function Ev(){return new gm([new Dv])}let gm=(()=>{class e{constructor(o){this.factories=o}static create(o,l){if(l){const c=l.factories.slice();o=o.concat(c)}return new e(o)}static extend(o){return{provide:e,useFactory:l=>e.create(o,l||Ev()),deps:[[e,new Au,new Va]]}}find(o){const l=this.factories.find(m=>m.supports(o));if(l)return l;throw new De(901,"")}}return e.\u0275prov=Xe({token:e,providedIn:"root",factory:Ev}),e})();const D1=lv(null,"core",[]);let C1=(()=>{class e{constructor(o){}}return e.\u0275fac=function(o){return new(o||e)(Kr(cm))},e.\u0275mod=te({type:e}),e.\u0275inj=T({}),e})();function E1(e){return"boolean"==typeof e?e:null!=e&&"false"!==e}},156:(jn,Lt,we)=>{"use strict";we.d(Lt,{u5:()=>Es});var N=we(888);we(666),we(336);we(987),we(273),we(945),we(635);we(957);let Ks=(()=>{class F{}return F.\u0275fac=function(I){return new(I||F)},F.\u0275mod=N.oAB({type:F}),F.\u0275inj=N.cJS({}),F})(),Cs=(()=>{class F{}return F.\u0275fac=function(I){return new(I||F)},F.\u0275mod=N.oAB({type:F}),F.\u0275inj=N.cJS({imports:[Ks]}),F})(),Es=(()=>{class F{}return F.\u0275fac=function(I){return new(I||F)},F.\u0275mod=N.oAB({type:F}),F.\u0275inj=N.cJS({imports:[Cs]}),F})()},497:(jn,Lt,we)=>{"use strict";we.d(Lt,{b2:()=>Xe,q6:()=>fn});var N=we(666),Ae=we(888);class Rt extends N.w_{constructor(){super(...arguments),this.supportsDOMEvents=!0}}class f extends Rt{static makeCurrent(){(0,N.HT)(new f)}onAndCancel(U,G,Y){return U.addEventListener(G,Y,!1),()=>{U.removeEventListener(G,Y,!1)}}dispatchEvent(U,G){U.dispatchEvent(G)}remove(U){U.parentNode&&U.parentNode.removeChild(U)}createElement(U,G){return(G=G||this.getDefaultDocument()).createElement(U)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(U){return U.nodeType===Node.ELEMENT_NODE}isShadowRoot(U){return U instanceof DocumentFragment}getGlobalEventTarget(U,G){return"window"===G?window:"document"===G?U:"body"===G?U.body:null}getBaseHref(U){const G=function Qt(){return it=it||document.querySelector("base"),it?it.getAttribute("href"):null}();return null==G?null:function It(H){kt=kt||document.createElement("a"),kt.setAttribute("href",H);const U=kt.pathname;return"/"===U.charAt(0)?U:`/${U}`}(G)}resetBaseElement(){it=null}getUserAgent(){return window.navigator.userAgent}getCookie(U){return(0,N.Mx)(document.cookie,U)}}let kt,it=null;const Ee=new Ae.OlP("TRANSITION_ID"),Ze=[{provide:Ae.ip1,useFactory:function xt(H,U,G){return()=>{G.get(Ae.CZH).donePromise.then(()=>{const Y=(0,N.q)(),te=U.querySelectorAll(`style[ng-transition="${H}"]`);for(let le=0;le<te.length;le++)Y.remove(te[le])})}},deps:[Ee,N.K0,Ae.zs3],multi:!0}];let Vn=(()=>{class H{build(){return new XMLHttpRequest}}return H.\u0275fac=function(G){return new(G||H)},H.\u0275prov=Ae.Yz7({token:H,factory:H.\u0275fac}),H})();const Vt=new Ae.OlP("EventManagerPlugins");let Un=(()=>{class H{constructor(G,Y){this._zone=Y,this._eventNameToPlugin=new Map,G.forEach(te=>te.manager=this),this._plugins=G.slice().reverse()}addEventListener(G,Y,te){return this._findPluginFor(Y).addEventListener(G,Y,te)}addGlobalEventListener(G,Y,te){return this._findPluginFor(Y).addGlobalEventListener(G,Y,te)}getZone(){return this._zone}_findPluginFor(G){const Y=this._eventNameToPlugin.get(G);if(Y)return Y;const te=this._plugins;for(let le=0;le<te.length;le++){const Ce=te[le];if(Ce.supports(G))return this._eventNameToPlugin.set(G,Ce),Ce}throw new Error(`No event manager plugin found for event ${G}`)}}return H.\u0275fac=function(G){return new(G||H)(Ae.LFG(Vt),Ae.LFG(Ae.R0b))},H.\u0275prov=Ae.Yz7({token:H,factory:H.\u0275fac}),H})();class Gt{constructor(U){this._doc=U}addGlobalEventListener(U,G,Y){const te=(0,N.q)().getGlobalEventTarget(this._doc,U);if(!te)throw new Error(`Unsupported event target ${te} for event ${G}`);return this.addEventListener(te,G,Y)}}let dn=(()=>{class H{constructor(){this._stylesSet=new Set}addStyles(G){const Y=new Set;G.forEach(te=>{this._stylesSet.has(te)||(this._stylesSet.add(te),Y.add(te))}),this.onStylesAdded(Y)}onStylesAdded(G){}getAllStyles(){return Array.from(this._stylesSet)}}return H.\u0275fac=function(G){return new(G||H)},H.\u0275prov=Ae.Yz7({token:H,factory:H.\u0275fac}),H})(),wn=(()=>{class H extends dn{constructor(G){super(),this._doc=G,this._hostNodes=new Map,this._hostNodes.set(G.head,[])}_addStylesToHost(G,Y,te){G.forEach(le=>{const Ce=this._doc.createElement("style");Ce.textContent=le,te.push(Y.appendChild(Ce))})}addHost(G){const Y=[];this._addStylesToHost(this._stylesSet,G,Y),this._hostNodes.set(G,Y)}removeHost(G){const Y=this._hostNodes.get(G);Y&&Y.forEach(Dn),this._hostNodes.delete(G)}onStylesAdded(G){this._hostNodes.forEach((Y,te)=>{this._addStylesToHost(G,te,Y)})}ngOnDestroy(){this._hostNodes.forEach(G=>G.forEach(Dn))}}return H.\u0275fac=function(G){return new(G||H)(Ae.LFG(N.K0))},H.\u0275prov=Ae.Yz7({token:H,factory:H.\u0275fac}),H})();function Dn(H){(0,N.q)().remove(H)}const Fn={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},pt=/%COMP%/g;function me(H,U,G){for(let Y=0;Y<U.length;Y++){let te=U[Y];Array.isArray(te)?me(H,te,G):(te=te.replace(pt,H),G.push(te))}return G}function _e(H){return U=>{if("__ngUnwrap__"===U)return H;!1===H(U)&&(U.preventDefault(),U.returnValue=!1)}}let De=(()=>{class H{constructor(G,Y,te){this.eventManager=G,this.sharedStylesHost=Y,this.appId=te,this.rendererByCompId=new Map,this.defaultRenderer=new Re(G)}createRenderer(G,Y){if(!G||!Y)return this.defaultRenderer;switch(Y.encapsulation){case Ae.ifc.Emulated:{let te=this.rendererByCompId.get(Y.id);return te||(te=new fr(this.eventManager,this.sharedStylesHost,Y,this.appId),this.rendererByCompId.set(Y.id,te)),te.applyToHost(G),te}case 1:case Ae.ifc.ShadowDom:return new on(this.eventManager,this.sharedStylesHost,G,Y);default:if(!this.rendererByCompId.has(Y.id)){const te=me(Y.id,Y.styles,[]);this.sharedStylesHost.addStyles(te),this.rendererByCompId.set(Y.id,this.defaultRenderer)}return this.defaultRenderer}}begin(){}end(){}}return H.\u0275fac=function(G){return new(G||H)(Ae.LFG(Un),Ae.LFG(wn),Ae.LFG(Ae.AFp))},H.\u0275prov=Ae.Yz7({token:H,factory:H.\u0275fac}),H})();class Re{constructor(U){this.eventManager=U,this.data=Object.create(null),this.destroyNode=null}destroy(){}createElement(U,G){return G?document.createElementNS(Fn[G]||G,U):document.createElement(U)}createComment(U){return document.createComment(U)}createText(U){return document.createTextNode(U)}appendChild(U,G){(An(U)?U.content:U).appendChild(G)}insertBefore(U,G,Y){U&&(An(U)?U.content:U).insertBefore(G,Y)}removeChild(U,G){U&&U.removeChild(G)}selectRootElement(U,G){let Y="string"==typeof U?document.querySelector(U):U;if(!Y)throw new Error(`The selector "${U}" did not match any elements`);return G||(Y.textContent=""),Y}parentNode(U){return U.parentNode}nextSibling(U){return U.nextSibling}setAttribute(U,G,Y,te){if(te){G=te+":"+G;const le=Fn[te];le?U.setAttributeNS(le,G,Y):U.setAttribute(G,Y)}else U.setAttribute(G,Y)}removeAttribute(U,G,Y){if(Y){const te=Fn[Y];te?U.removeAttributeNS(te,G):U.removeAttribute(`${Y}:${G}`)}else U.removeAttribute(G)}addClass(U,G){U.classList.add(G)}removeClass(U,G){U.classList.remove(G)}setStyle(U,G,Y,te){te&(Ae.JOm.DashCase|Ae.JOm.Important)?U.style.setProperty(G,Y,te&Ae.JOm.Important?"important":""):U.style[G]=Y}removeStyle(U,G,Y){Y&Ae.JOm.DashCase?U.style.removeProperty(G):U.style[G]=""}setProperty(U,G,Y){U[G]=Y}setValue(U,G){U.nodeValue=G}listen(U,G,Y){return"string"==typeof U?this.eventManager.addGlobalEventListener(U,G,_e(Y)):this.eventManager.addEventListener(U,G,_e(Y))}}function An(H){return"TEMPLATE"===H.tagName&&void 0!==H.content}class fr extends Re{constructor(U,G,Y,te){super(U),this.component=Y;const le=me(te+"-"+Y.id,Y.styles,[]);G.addStyles(le),this.contentAttr=function tn(H){return"_ngcontent-%COMP%".replace(pt,H)}(te+"-"+Y.id),this.hostAttr=function en(H){return"_nghost-%COMP%".replace(pt,H)}(te+"-"+Y.id)}applyToHost(U){super.setAttribute(U,this.hostAttr,"")}createElement(U,G){const Y=super.createElement(U,G);return super.setAttribute(Y,this.contentAttr,""),Y}}class on extends Re{constructor(U,G,Y,te){super(U),this.sharedStylesHost=G,this.hostEl=Y,this.shadowRoot=Y.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const le=me(te.id,te.styles,[]);for(let Ce=0;Ce<le.length;Ce++){const Be=document.createElement("style");Be.textContent=le[Ce],this.shadowRoot.appendChild(Be)}}nodeOrShadowRoot(U){return U===this.hostEl?this.shadowRoot:U}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}appendChild(U,G){return super.appendChild(this.nodeOrShadowRoot(U),G)}insertBefore(U,G,Y){return super.insertBefore(this.nodeOrShadowRoot(U),G,Y)}removeChild(U,G){return super.removeChild(this.nodeOrShadowRoot(U),G)}parentNode(U){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(U)))}}let qn=(()=>{class H extends Gt{constructor(G){super(G)}supports(G){return!0}addEventListener(G,Y,te){return G.addEventListener(Y,te,!1),()=>this.removeEventListener(G,Y,te)}removeEventListener(G,Y,te){return G.removeEventListener(Y,te)}}return H.\u0275fac=function(G){return new(G||H)(Ae.LFG(N.K0))},H.\u0275prov=Ae.Yz7({token:H,factory:H.\u0275fac}),H})();const kn=["alt","control","meta","shift"],hr={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},Rr={A:"1",B:"2",C:"3",D:"4",E:"5",F:"6",G:"7",H:"8",I:"9",J:"*",K:"+",M:"-",N:".",O:"/","`":"0","\x90":"NumLock"},ar={alt:H=>H.altKey,control:H=>H.ctrlKey,meta:H=>H.metaKey,shift:H=>H.shiftKey};let br=(()=>{class H extends Gt{constructor(G){super(G)}supports(G){return null!=H.parseEventName(G)}addEventListener(G,Y,te){const le=H.parseEventName(Y),Ce=H.eventCallback(le.fullKey,te,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>(0,N.q)().onAndCancel(G,le.domEventName,Ce))}static parseEventName(G){const Y=G.toLowerCase().split("."),te=Y.shift();if(0===Y.length||"keydown"!==te&&"keyup"!==te)return null;const le=H._normalizeKey(Y.pop());let Ce="";if(kn.forEach(Pe=>{const tt=Y.indexOf(Pe);tt>-1&&(Y.splice(tt,1),Ce+=Pe+".")}),Ce+=le,0!=Y.length||0===le.length)return null;const Be={};return Be.domEventName=te,Be.fullKey=Ce,Be}static getEventFullKey(G){let Y="",te=function Gi(H){let U=H.key;if(null==U){if(U=H.keyIdentifier,null==U)return"Unidentified";U.startsWith("U+")&&(U=String.fromCharCode(parseInt(U.substring(2),16)),3===H.location&&Rr.hasOwnProperty(U)&&(U=Rr[U]))}return hr[U]||U}(G);return te=te.toLowerCase()," "===te?te="space":"."===te&&(te="dot"),kn.forEach(le=>{le!=te&&ar[le](G)&&(Y+=le+".")}),Y+=te,Y}static eventCallback(G,Y,te){return le=>{H.getEventFullKey(le)===G&&te.runGuarded(()=>Y(le))}}static _normalizeKey(G){return"esc"===G?"escape":G}}return H.\u0275fac=function(G){return new(G||H)(Ae.LFG(N.K0))},H.\u0275prov=Ae.Yz7({token:H,factory:H.\u0275fac}),H})();const fn=(0,Ae.eFA)(Ae._c5,"browser",[{provide:Ae.Lbi,useValue:N.bD},{provide:Ae.g9A,useValue:function Ci(){f.makeCurrent()},multi:!0},{provide:N.K0,useFactory:function qi(){return(0,Ae.RDi)(document),document},deps:[]}]),li=new Ae.OlP(""),wr=[{provide:Ae.rWj,useClass:class Wt{addToWindow(U){Ae.dqk.getAngularTestability=(Y,te=!0)=>{const le=U.findTestabilityInTree(Y,te);if(null==le)throw new Error("Could not find testability for element.");return le},Ae.dqk.getAllAngularTestabilities=()=>U.getAllTestabilities(),Ae.dqk.getAllAngularRootElements=()=>U.getAllRootElements(),Ae.dqk.frameworkStabilizers||(Ae.dqk.frameworkStabilizers=[]),Ae.dqk.frameworkStabilizers.push(Y=>{const te=Ae.dqk.getAllAngularTestabilities();let le=te.length,Ce=!1;const Be=function(Pe){Ce=Ce||Pe,le--,0==le&&Y(Ce)};te.forEach(function(Pe){Pe.whenStable(Be)})})}findTestabilityInTree(U,G,Y){return null==G?null:U.getTestability(G)??(Y?(0,N.q)().isShadowRoot(G)?this.findTestabilityInTree(U,G.host,!0):this.findTestabilityInTree(U,G.parentElement,!0):null)}},deps:[]},{provide:Ae.lri,useClass:Ae.dDg,deps:[Ae.R0b,Ae.eoX,Ae.rWj]},{provide:Ae.dDg,useClass:Ae.dDg,deps:[Ae.R0b,Ae.eoX,Ae.rWj]}],mn=[{provide:Ae.zSh,useValue:"root"},{provide:Ae.qLn,useFactory:function Qr(){return new Ae.qLn},deps:[]},{provide:Vt,useClass:qn,multi:!0,deps:[N.K0,Ae.R0b,Ae.Lbi]},{provide:Vt,useClass:br,multi:!0,deps:[N.K0]},{provide:De,useClass:De,deps:[Un,wn,Ae.AFp]},{provide:Ae.FYo,useExisting:De},{provide:dn,useExisting:wn},{provide:wn,useClass:wn,deps:[N.K0]},{provide:Un,useClass:Un,deps:[Vt,Ae.R0b]},{provide:N.JF,useClass:Vn,deps:[]},[]];let Xe=(()=>{class H{constructor(G){}static withServerTransition(G){return{ngModule:H,providers:[{provide:Ae.AFp,useValue:G.appId},{provide:Ee,useExisting:Ae.AFp},Ze]}}}return H.\u0275fac=function(G){return new(G||H)(Ae.LFG(li,12))},H.\u0275mod=Ae.oAB({type:H}),H.\u0275inj=Ae.cJS({providers:[...mn,...wr],imports:[N.ez,Ae.hGG]}),H})();typeof window<"u"&&window},767:(jn,Lt,we)=>{"use strict";function N(Xe,Ke,T,ae,pe,Te,Nt){try{var ht=Xe[Te](Nt),ut=ht.value}catch(Dr){return void T(Dr)}ht.done?Ke(ut):Promise.resolve(ut).then(ae,pe)}function Ae(Xe){return function(){var Ke=this,T=arguments;return new Promise(function(ae,pe){var Te=Xe.apply(Ke,T);function Nt(ut){N(Te,ae,pe,Nt,ht,"next",ut)}function ht(ut){N(Te,ae,pe,Nt,ht,"throw",ut)}Nt(void 0)})}}we.d(Lt,{Gd:()=>ar,CI:()=>br,Nn:()=>mn,RX:()=>Ci});var Rt=we(666),f=we(888),it=we(22),Qt=we(253);class kt extends Qt.x{constructor(){super(...arguments),this._value=null,this._hasValue=!1,this._isComplete=!1}_checkFinalizedStatuses(Ke){const{hasError:T,_hasValue:ae,_value:pe,thrownError:Te,isStopped:Nt,_isComplete:ht}=this;T?Ke.error(Te):(Nt||ht)&&(ae&&Ke.next(pe),Ke.complete())}next(Ke){this.isStopped||(this._value=Ke,this._hasValue=!0)}complete(){const{_hasValue:Ke,_value:T,_isComplete:ae}=this;ae||(this._isComplete=!0,Ke&&super.next(T),super.complete())}}var It=we(714);const xt=(0,we(543).d)(Xe=>function(){Xe(this),this.name="EmptyError",this.message="no elements in sequence"});var Ze=we(944),Wt=we(945);function Vn(Xe,Ke){return(0,Ze.e)((T,ae)=>{let pe=0;T.subscribe((0,Wt.x)(ae,Te=>Xe.call(Ke,Te,pe++)&&ae.next(Te)))})}var Vt=we(295);function Un(Xe){return(0,Ze.e)((Ke,T)=>{let ae=!1;Ke.subscribe((0,Wt.x)(T,pe=>{ae=!0,T.next(pe)},()=>{ae||T.next(Xe),T.complete()}))})}function Gt(Xe=dn){return(0,Ze.e)((Ke,T)=>{let ae=!1;Ke.subscribe((0,Wt.x)(T,pe=>{ae=!0,T.next(pe)},()=>ae?T.complete():T.error(Xe())))})}function dn(){return new xt}var wn=we(173);const Fn=["content"],pt=["*"],Ge=["container"];let ke=(()=>{class Xe{constructor(T){this.zone=T,this.mapCreated=new kt,this.mapLoaded=new kt,this.markersToRemove=[],this.popupsToRemove=[],this.imageIdsToRemove=[],this.subscription=new It.w0,this.mapCreated$=this.mapCreated.asObservable(),this.mapLoaded$=this.mapLoaded.asObservable()}setup(T){this.zone.onStable.pipe(function Dn(Xe,Ke){const T=arguments.length>=2;return ae=>ae.pipe(Xe?Vn((pe,Te)=>Xe(pe,Te,ae)):wn.y,(0,Vt.q)(1),T?Un(Ke):Gt(()=>new xt))}()).subscribe(()=>{this.createMap(T.mapOptions),this.hookEvents(T.mapEvents),this.mapEvents=T.mapEvents,this.mapCreated.next(void 0),this.mapCreated.complete()})}destroyMap(){this.mapInstance&&(this.subscription.unsubscribe(),this.mapInstance.remove())}updateMinZoom(T){return this.zone.runOutsideAngular(()=>{this.mapInstance.setMinZoom(T)})}updateMaxZoom(T){return this.zone.runOutsideAngular(()=>{this.mapInstance.setMaxZoom(T)})}updateMinPitch(T){return this.zone.runOutsideAngular(()=>{this.mapInstance.setMinPitch(T)})}updateMaxPitch(T){return this.zone.runOutsideAngular(()=>{this.mapInstance.setMaxPitch(T)})}updateRenderWorldCopies(T){return this.zone.runOutsideAngular(()=>{this.mapInstance.setRenderWorldCopies(T)})}updateScrollZoom(T){return this.zone.runOutsideAngular(()=>{T?this.mapInstance.scrollZoom.enable():this.mapInstance.scrollZoom.disable()})}updateDragRotate(T){return this.zone.runOutsideAngular(()=>{T?this.mapInstance.dragRotate.enable():this.mapInstance.dragRotate.disable()})}updateTouchPitch(T){return this.zone.runOutsideAngular(()=>{T?this.mapInstance.touchPitch.enable():this.mapInstance.touchPitch.disable()})}updateTouchZoomRotate(T){return this.zone.runOutsideAngular(()=>{T?this.mapInstance.touchZoomRotate.enable():this.mapInstance.touchZoomRotate.disable()})}updateDoubleClickZoom(T){return this.zone.runOutsideAngular(()=>{T?this.mapInstance.doubleClickZoom.enable():this.mapInstance.doubleClickZoom.disable()})}updateKeyboard(T){return this.zone.runOutsideAngular(()=>{T?this.mapInstance.keyboard.enable():this.mapInstance.keyboard.disable()})}updateDragPan(T){return this.zone.runOutsideAngular(()=>{T?this.mapInstance.dragPan.enable():this.mapInstance.dragPan.disable()})}updateBoxZoom(T){return this.zone.runOutsideAngular(()=>{T?this.mapInstance.boxZoom.enable():this.mapInstance.boxZoom.disable()})}updateStyle(T){return this.zone.runOutsideAngular(()=>{this.mapInstance.setStyle(T)})}updateMaxBounds(T){return this.zone.runOutsideAngular(()=>{this.mapInstance.setMaxBounds(T)})}changeCanvasCursor(T){this.mapInstance.getCanvasContainer().style.cursor=T}queryRenderedFeatures(T,ae){return this.mapInstance.queryRenderedFeatures(T,ae)}panTo(T,ae){return this.zone.runOutsideAngular(()=>{this.mapInstance.panTo(T,ae)})}move(T,ae,pe,Te,Nt,ht){return this.zone.runOutsideAngular(()=>{this.mapInstance[T]({...ae,zoom:pe??this.mapInstance.getZoom(),center:Te??this.mapInstance.getCenter(),bearing:Nt??this.mapInstance.getBearing(),pitch:ht??this.mapInstance.getPitch()})})}addLayer(T,ae,pe){this.zone.runOutsideAngular(()=>{Object.keys(T.layerOptions).forEach(Te=>{void 0===T.layerOptions[Te]&&delete T.layerOptions[Te]}),this.mapInstance.addLayer(T.layerOptions,pe),ae&&(T.layerEvents.layerClick.observers.length&&this.mapInstance.on("click",T.layerOptions.id,Te=>{this.zone.run(()=>{T.layerEvents.layerClick.emit(Te)})}),T.layerEvents.layerDblClick.observers.length&&this.mapInstance.on("dblclick",T.layerOptions.id,Te=>{this.zone.run(()=>{T.layerEvents.layerDblClick.emit(Te)})}),T.layerEvents.layerMouseDown.observers.length&&this.mapInstance.on("mousedown",T.layerOptions.id,Te=>{this.zone.run(()=>{T.layerEvents.layerMouseDown.emit(Te)})}),T.layerEvents.layerMouseUp.observers.length&&this.mapInstance.on("mouseup",T.layerOptions.id,Te=>{this.zone.run(()=>{T.layerEvents.layerMouseUp.emit(Te)})}),T.layerEvents.layerMouseEnter.observers.length&&this.mapInstance.on("mouseenter",T.layerOptions.id,Te=>{this.zone.run(()=>{T.layerEvents.layerMouseEnter.emit(Te)})}),T.layerEvents.layerMouseLeave.observers.length&&this.mapInstance.on("mouseleave",T.layerOptions.id,Te=>{this.zone.run(()=>{T.layerEvents.layerMouseLeave.emit(Te)})}),T.layerEvents.layerMouseMove.observers.length&&this.mapInstance.on("mousemove",T.layerOptions.id,Te=>{this.zone.run(()=>{T.layerEvents.layerMouseMove.emit(Te)})}),T.layerEvents.layerMouseOver.observers.length&&this.mapInstance.on("mouseover",T.layerOptions.id,Te=>{this.zone.run(()=>{T.layerEvents.layerMouseOver.emit(Te)})}),T.layerEvents.layerMouseOut.observers.length&&this.mapInstance.on("mouseout",T.layerOptions.id,Te=>{this.zone.run(()=>{T.layerEvents.layerMouseOut.emit(Te)})}),T.layerEvents.layerContextMenu.observers.length&&this.mapInstance.on("contextmenu",T.layerOptions.id,Te=>{this.zone.run(()=>{T.layerEvents.layerContextMenu.emit(Te)})}),T.layerEvents.layerTouchStart.observers.length&&this.mapInstance.on("touchstart",T.layerOptions.id,Te=>{this.zone.run(()=>{T.layerEvents.layerTouchStart.emit(Te)})}),T.layerEvents.layerTouchEnd.observers.length&&this.mapInstance.on("touchend",T.layerOptions.id,Te=>{this.zone.run(()=>{T.layerEvents.layerTouchEnd.emit(Te)})}),T.layerEvents.layerTouchCancel.observers.length&&this.mapInstance.on("touchcancel",T.layerOptions.id,Te=>{this.zone.run(()=>{T.layerEvents.layerTouchCancel.emit(Te)})}))})}removeLayer(T){this.zone.runOutsideAngular(()=>{null!=this.mapInstance.getLayer(T)&&this.mapInstance.removeLayer(T)})}addMarker(T){const ae={offset:T.markersOptions.offset,anchor:T.markersOptions.anchor,draggable:!!T.markersOptions.draggable,rotationAlignment:T.markersOptions.rotationAlignment,pitchAlignment:T.markersOptions.pitchAlignment,clickTolerance:T.markersOptions.clickTolerance};T.markersOptions.element.childNodes.length>0&&(ae.element=T.markersOptions.element);const pe=new it.Marker(ae);return T.markersEvents.markerDragStart.observers.length&&pe.on("dragstart",Nt=>{if(Nt){const{target:ht}=Nt;this.zone.run(()=>{T.markersEvents.markerDragStart.emit(ht)})}}),T.markersEvents.markerDrag.observers.length&&pe.on("drag",Nt=>{if(Nt){const{target:ht}=Nt;this.zone.run(()=>{T.markersEvents.markerDrag.emit(ht)})}}),T.markersEvents.markerDragEnd.observers.length&&pe.on("dragend",Nt=>{if(Nt){const{target:ht}=Nt;this.zone.run(()=>{T.markersEvents.markerDragEnd.emit(ht)})}}),pe.setLngLat(T.markersOptions.feature?T.markersOptions.feature.geometry.coordinates:T.markersOptions.lngLat),this.zone.runOutsideAngular(()=>(pe.addTo(this.mapInstance),pe))}removeMarker(T){this.markersToRemove.push(T)}createPopup(T,ae){return this.zone.runOutsideAngular(()=>{Object.keys(T.popupOptions).forEach(Te=>void 0===T.popupOptions[Te]&&delete T.popupOptions[Te]);const pe=new it.Popup(T.popupOptions);return pe.setDOMContent(ae),T.popupEvents.popupClose.observers.length&&pe.on("close",()=>{this.zone.run(()=>{T.popupEvents.popupClose.emit()})}),T.popupEvents.popupOpen.observers.length&&pe.on("open",()=>{this.zone.run(()=>{T.popupEvents.popupOpen.emit()})}),pe})}addPopupToMap(T,ae,pe=!1){return this.zone.runOutsideAngular(()=>{pe&&T._listeners&&delete T._listeners.open,T.setLngLat(ae),T.addTo(this.mapInstance)})}addPopupToMarker(T,ae){return this.zone.runOutsideAngular(()=>{T.setPopup(ae)})}removePopupFromMap(T,ae=!1){ae&&T._listeners&&delete T._listeners.close,this.popupsToRemove.push(T)}removePopupFromMarker(T){return this.zone.runOutsideAngular(()=>{T.setPopup(void 0)})}addControl(T,ae){return this.zone.runOutsideAngular(()=>{this.mapInstance.addControl(T,ae)})}removeControl(T){return this.zone.runOutsideAngular(()=>{this.mapInstance.removeControl(T)})}loadAndAddImage(T,ae,pe){var Te=this;return Ae(function*(){return Te.zone.runOutsideAngular(()=>new Promise((Nt,ht)=>{Te.mapInstance.loadImage(ae,(ut,Dr)=>{ut?ht(ut):(Te.addImage(T,Dr,pe),Nt())})}))})()}addImage(T,ae,pe){return this.zone.runOutsideAngular(()=>{this.mapInstance.addImage(T,ae,pe)})}removeImage(T){this.imageIdsToRemove.push(T)}addSource(T,ae){return this.zone.runOutsideAngular(()=>{Object.keys(ae).forEach(pe=>void 0===ae[pe]&&delete ae[pe]),this.mapInstance.addSource(T,ae)})}getSource(T){return this.mapInstance.getSource(T)}removeSource(T){this.zone.runOutsideAngular(()=>{this.findLayersBySourceId(T).forEach(ae=>this.mapInstance.removeLayer(ae.id)),this.mapInstance.removeSource(T)})}setAllLayerPaintProperty(T,ae){return this.zone.runOutsideAngular(()=>{Object.keys(ae).forEach(pe=>{this.mapInstance.setPaintProperty(T,pe,ae[pe])})})}setAllLayerLayoutProperty(T,ae){return this.zone.runOutsideAngular(()=>{Object.keys(ae).forEach(pe=>{this.mapInstance.setLayoutProperty(T,pe,ae[pe])})})}setLayerFilter(T,ae){return this.zone.runOutsideAngular(()=>{this.mapInstance.setFilter(T,ae)})}setLayerBefore(T,ae){return this.zone.runOutsideAngular(()=>{this.mapInstance.moveLayer(T,ae)})}setLayerZoomRange(T,ae,pe){return this.zone.runOutsideAngular(()=>{this.mapInstance.setLayerZoomRange(T,ae||0,pe||20)})}fitBounds(T,ae){return this.zone.runOutsideAngular(()=>{this.mapInstance.fitBounds(T,ae)})}fitScreenCoordinates(T,ae,pe){return this.zone.runOutsideAngular(()=>{this.mapInstance.fitScreenCoordinates(T[0],T[1],ae,pe)})}applyChanges(){this.zone.runOutsideAngular(()=>{this.removeMarkers(),this.removePopups(),this.removeImages()})}createMap(T){f.R0b.assertNotInAngularZone(),Object.keys(T).forEach(pe=>{void 0===T[pe]&&delete T[pe]}),this.mapInstance=new it.Map(T),window&&/msie\s|trident\/|edge\//i.test(window.navigator.userAgent)&&this.mapInstance.setStyle(T.style),this.subscription.add(this.zone.onMicrotaskEmpty.subscribe(()=>this.applyChanges()))}removeMarkers(){for(const T of this.markersToRemove)T.remove();this.markersToRemove=[]}removePopups(){for(const T of this.popupsToRemove)T.remove();this.popupsToRemove=[]}removeImages(){for(const T of this.imageIdsToRemove)this.mapInstance.removeImage(T);this.imageIdsToRemove=[]}findLayersBySourceId(T){const ae=this.mapInstance.getStyle().layers;return null==ae?[]:ae.filter(pe=>"source"in pe&&pe.source===T)}hookEvents(T){this.mapInstance.on("load",ae=>{this.mapLoaded.next(void 0),this.mapLoaded.complete(),this.zone.run(()=>{T.mapLoad.emit(ae.target)})}),T.mapResize.observers.length&&this.mapInstance.on("resize",ae=>this.zone.run(()=>{T.mapResize.emit(ae)})),T.mapRemove.observers.length&&this.mapInstance.on("remove",ae=>this.zone.run(()=>{T.mapRemove.emit(ae)})),T.mapMouseDown.observers.length&&this.mapInstance.on("mousedown",ae=>this.zone.run(()=>{T.mapMouseDown.emit(ae)})),T.mapMouseUp.observers.length&&this.mapInstance.on("mouseup",ae=>this.zone.run(()=>{T.mapMouseUp.emit(ae)})),T.mapMouseMove.observers.length&&this.mapInstance.on("mousemove",ae=>this.zone.run(()=>{T.mapMouseMove.emit(ae)})),T.mapClick.observers.length&&this.mapInstance.on("click",ae=>this.zone.run(()=>{T.mapClick.emit(ae)})),T.mapDblClick.observers.length&&this.mapInstance.on("dblclick",ae=>this.zone.run(()=>{T.mapDblClick.emit(ae)})),T.mapMouseOver.observers.length&&this.mapInstance.on("mouseover",ae=>this.zone.run(()=>{T.mapMouseOver.emit(ae)})),T.mapMouseOut.observers.length&&this.mapInstance.on("mouseout",ae=>this.zone.run(()=>{T.mapMouseOut.emit(ae)})),T.mapContextMenu.observers.length&&this.mapInstance.on("contextmenu",ae=>this.zone.run(()=>{T.mapContextMenu.emit(ae)})),T.mapTouchStart.observers.length&&this.mapInstance.on("touchstart",ae=>this.zone.run(()=>{T.mapTouchStart.emit(ae)})),T.mapTouchEnd.observers.length&&this.mapInstance.on("touchend",ae=>this.zone.run(()=>{T.mapTouchEnd.emit(ae)})),T.mapTouchMove.observers.length&&this.mapInstance.on("touchmove",ae=>this.zone.run(()=>{T.mapTouchMove.emit(ae)})),T.mapTouchCancel.observers.length&&this.mapInstance.on("touchcancel",ae=>this.zone.run(()=>{T.mapTouchCancel.emit(ae)})),T.mapWheel.observers.length&&this.mapInstance.on("wheel",ae=>this.zone.run(()=>{T.mapWheel.emit(ae)})),T.moveStart.observers.length&&this.mapInstance.on("movestart",ae=>this.zone.run(()=>T.moveStart.emit(ae))),T.move.observers.length&&this.mapInstance.on("move",ae=>this.zone.run(()=>T.move.emit(ae))),T.moveEnd.observers.length&&this.mapInstance.on("moveend",ae=>this.zone.run(()=>T.moveEnd.emit(ae))),T.mapDragStart.observers.length&&this.mapInstance.on("dragstart",ae=>this.zone.run(()=>{T.mapDragStart.emit(ae)})),T.mapDrag.observers.length&&this.mapInstance.on("drag",ae=>this.zone.run(()=>{T.mapDrag.emit(ae)})),T.mapDragEnd.observers.length&&this.mapInstance.on("dragend",ae=>this.zone.run(()=>{T.mapDragEnd.emit(ae)})),T.zoomStart.observers.length&&this.mapInstance.on("zoomstart",ae=>this.zone.run(()=>T.zoomStart.emit(ae))),T.zoomEvt.observers.length&&this.mapInstance.on("zoom",ae=>this.zone.run(()=>T.zoomEvt.emit(ae))),T.zoomEnd.observers.length&&this.mapInstance.on("zoomend",ae=>this.zone.run(()=>T.zoomEnd.emit(ae))),T.rotateStart.observers.length&&this.mapInstance.on("rotatestart",ae=>this.zone.run(()=>T.rotateStart.emit(ae))),T.rotate.observers.length&&this.mapInstance.on("rotate",ae=>this.zone.run(()=>T.rotate.emit(ae))),T.rotateEnd.observers.length&&this.mapInstance.on("rotateend",ae=>this.zone.run(()=>T.rotateEnd.emit(ae))),T.pitchStart.observers.length&&this.mapInstance.on("pitchstart",ae=>this.zone.run(()=>T.pitchStart.emit(ae))),T.pitchEvt.observers.length&&this.mapInstance.on("pitch",ae=>this.zone.run(()=>T.pitchEvt.emit(ae))),T.pitchEnd.observers.length&&this.mapInstance.on("pitchend",ae=>this.zone.run(()=>T.pitchEnd.emit(ae))),T.boxZoomStart.observers.length&&this.mapInstance.on("boxzoomstart",ae=>this.zone.run(()=>T.boxZoomStart.emit(ae))),T.boxZoomEnd.observers.length&&this.mapInstance.on("boxzoomend",ae=>this.zone.run(()=>T.boxZoomEnd.emit(ae))),T.boxZoomCancel.observers.length&&this.mapInstance.on("boxzoomcancel",ae=>this.zone.run(()=>T.boxZoomCancel.emit(ae))),T.webGlContextLost.observers.length&&this.mapInstance.on("webglcontextlost",ae=>this.zone.run(()=>T.webGlContextLost.emit(ae))),T.webGlContextRestored.observers.length&&this.mapInstance.on("webglcontextrestored",ae=>this.zone.run(()=>T.webGlContextRestored.emit(ae))),T.render.observers.length&&this.mapInstance.on("render",ae=>this.zone.run(()=>T.render.emit(ae))),T.mapError.observers.length&&this.mapInstance.on("error",ae=>this.zone.run(()=>{T.mapError.emit(ae)})),T.data.observers.length&&this.mapInstance.on("data",ae=>this.zone.run(()=>T.data.emit(ae))),T.styleData.observers.length&&this.mapInstance.on("styledata",ae=>this.zone.run(()=>T.styleData.emit(ae))),T.sourceData.observers.length&&this.mapInstance.on("sourcedata",ae=>this.zone.run(()=>T.sourceData.emit(ae))),T.dataLoading.observers.length&&this.mapInstance.on("dataloading",ae=>this.zone.run(()=>T.dataLoading.emit(ae))),T.styleDataLoading.observers.length&&this.mapInstance.on("styledataloading",ae=>this.zone.run(()=>T.styleDataLoading.emit(ae))),T.sourceDataLoading.observers.length&&this.mapInstance.on("sourcedataloading",ae=>this.zone.run(()=>T.sourceDataLoading.emit(ae))),T.styleImageMissing.observers.length&&this.mapInstance.on("styleimagemissing",ae=>this.zone.run(()=>T.styleImageMissing.emit(ae))),T.idle.observers.length&&this.mapInstance.on("idle",ae=>this.zone.run(()=>T.idle.emit(ae)))}}return Xe.\u0275fac=function(T){return new(T||Xe)(f.LFG(f.R0b))},Xe.\u0275prov=f.Yz7({token:Xe,factory:Xe.\u0275fac}),Xe})(),ar=(()=>{class Xe{constructor(T){this.MapService=T,this.movingMethod="flyTo",this.mapResize=new f.vpe,this.mapRemove=new f.vpe,this.mapMouseDown=new f.vpe,this.mapMouseUp=new f.vpe,this.mapMouseMove=new f.vpe,this.mapClick=new f.vpe,this.mapDblClick=new f.vpe,this.mapMouseOver=new f.vpe,this.mapMouseOut=new f.vpe,this.mapContextMenu=new f.vpe,this.mapTouchStart=new f.vpe,this.mapTouchEnd=new f.vpe,this.mapTouchMove=new f.vpe,this.mapTouchCancel=new f.vpe,this.mapWheel=new f.vpe,this.moveStart=new f.vpe,this.move=new f.vpe,this.moveEnd=new f.vpe,this.mapDragStart=new f.vpe,this.mapDrag=new f.vpe,this.mapDragEnd=new f.vpe,this.zoomStart=new f.vpe,this.zoomEvt=new f.vpe,this.zoomEnd=new f.vpe,this.rotateStart=new f.vpe,this.rotate=new f.vpe,this.rotateEnd=new f.vpe,this.pitchStart=new f.vpe,this.pitchEvt=new f.vpe,this.pitchEnd=new f.vpe,this.boxZoomStart=new f.vpe,this.boxZoomEnd=new f.vpe,this.boxZoomCancel=new f.vpe,this.webGlContextLost=new f.vpe,this.webGlContextRestored=new f.vpe,this.mapLoad=new f.vpe,this.idle=new f.vpe,this.render=new f.vpe,this.mapError=new f.vpe,this.data=new f.vpe,this.styleData=new f.vpe,this.sourceData=new f.vpe,this.dataLoading=new f.vpe,this.styleDataLoading=new f.vpe,this.sourceDataLoading=new f.vpe,this.styleImageMissing=new f.vpe}get mapInstance(){return this.MapService.mapInstance}ngAfterViewInit(){this.MapService.setup({mapOptions:{collectResourceTiming:this.collectResourceTiming,container:this.mapContainer.nativeElement,crossSourceCollisions:this.crossSourceCollisions,fadeDuration:this.fadeDuration,minZoom:this.minZoom,maxZoom:this.maxZoom,minPitch:this.minPitch,maxPitch:this.maxPitch,style:this.style,hash:this.hash,interactive:this.interactive,bearingSnap:this.bearingSnap,pitchWithRotate:this.pitchWithRotate,clickTolerance:this.clickTolerance,attributionControl:this.attributionControl,logoPosition:this.logoPosition,failIfMajorPerformanceCaveat:this.failIfMajorPerformanceCaveat,preserveDrawingBuffer:this.preserveDrawingBuffer,refreshExpiredTiles:this.refreshExpiredTiles,maxBounds:this.maxBounds,scrollZoom:this.scrollZoom,boxZoom:this.boxZoom,dragRotate:this.dragRotate,dragPan:this.dragPan,keyboard:this.keyboard,doubleClickZoom:this.doubleClickZoom,touchPitch:this.touchPitch,touchZoomRotate:this.touchZoomRotate,trackResize:this.trackResize,center:this.center,zoom:this.zoom,bearing:this.bearing,pitch:this.pitch,renderWorldCopies:this.renderWorldCopies,maxTileCacheSize:this.maxTileCacheSize,localIdeographFontFamily:this.localIdeographFontFamily,transformRequest:this.transformRequest,bounds:this.bounds?this.bounds:this.fitBounds,fitBoundsOptions:this.fitBoundsOptions,antialias:this.antialias,locale:this.locale},mapEvents:this}),this.cursorStyle&&this.MapService.changeCanvasCursor(this.cursorStyle)}ngOnDestroy(){this.MapService.destroyMap()}ngOnChanges(T){var ae=this;return Ae(function*(){yield ae.MapService.mapCreated$.toPromise(),T.cursorStyle&&!T.cursorStyle.isFirstChange()&&ae.MapService.changeCanvasCursor(T.cursorStyle.currentValue),T.minZoom&&!T.minZoom.isFirstChange()&&ae.MapService.updateMinZoom(T.minZoom.currentValue),T.maxZoom&&!T.maxZoom.isFirstChange()&&ae.MapService.updateMaxZoom(T.maxZoom.currentValue),T.minPitch&&!T.minPitch.isFirstChange()&&ae.MapService.updateMinPitch(T.minPitch.currentValue),T.maxPitch&&!T.maxPitch.isFirstChange()&&ae.MapService.updateMaxPitch(T.maxPitch.currentValue),T.renderWorldCopies&&!T.renderWorldCopies.isFirstChange()&&ae.MapService.updateRenderWorldCopies(T.renderWorldCopies.currentValue),T.scrollZoom&&!T.scrollZoom.isFirstChange()&&ae.MapService.updateScrollZoom(T.scrollZoom.currentValue),T.dragRotate&&!T.dragRotate.isFirstChange()&&ae.MapService.updateDragRotate(T.dragRotate.currentValue),T.touchPitch&&!T.touchPitch.isFirstChange()&&ae.MapService.updateTouchPitch(T.touchPitch.currentValue),T.touchZoomRotate&&!T.touchZoomRotate.isFirstChange()&&ae.MapService.updateTouchZoomRotate(T.touchZoomRotate.currentValue),T.doubleClickZoom&&!T.doubleClickZoom.isFirstChange()&&ae.MapService.updateDoubleClickZoom(T.doubleClickZoom.currentValue),T.keyboard&&!T.keyboard.isFirstChange()&&ae.MapService.updateKeyboard(T.keyboard.currentValue),T.dragPan&&!T.dragPan.isFirstChange()&&ae.MapService.updateDragPan(T.dragPan.currentValue),T.boxZoom&&!T.boxZoom.isFirstChange()&&ae.MapService.updateBoxZoom(T.boxZoom.currentValue),T.style&&!T.style.isFirstChange()&&ae.MapService.updateStyle(T.style.currentValue),T.maxBounds&&!T.maxBounds.isFirstChange()&&ae.MapService.updateMaxBounds(T.maxBounds.currentValue),T.fitBounds&&T.fitBounds.currentValue&&!T.fitBounds.isFirstChange()&&ae.MapService.fitBounds(T.fitBounds.currentValue,ae.fitBoundsOptions),T.fitScreenCoordinates&&T.fitScreenCoordinates.currentValue&&((ae.center||ae.zoom||ae.pitch||ae.fitBounds)&&T.fitScreenCoordinates.isFirstChange()&&console.warn("[ngx-mapbox-gl] center / zoom / pitch / fitBounds inputs are being overridden by fitScreenCoordinates input"),ae.MapService.fitScreenCoordinates(T.fitScreenCoordinates.currentValue,ae.bearing?ae.bearing[0]:0,ae.movingOptions)),!ae.centerWithPanTo||!T.center||T.center.isFirstChange()||T.zoom||T.bearing||T.pitch?(T.center&&!T.center.isFirstChange()||T.zoom&&!T.zoom.isFirstChange()||T.bearing&&!T.bearing.isFirstChange()&&!T.fitScreenCoordinates||T.pitch&&!T.pitch.isFirstChange())&&ae.MapService.move(ae.movingMethod,ae.movingOptions,T.zoom&&ae.zoom?ae.zoom[0]:void 0,T.center?ae.center:void 0,T.bearing&&ae.bearing?ae.bearing[0]:void 0,T.pitch&&ae.pitch?ae.pitch[0]:void 0):ae.MapService.panTo(ae.center,ae.panToOptions)})()}}return Xe.\u0275fac=function(T){return new(T||Xe)(f.Y36(ke))},Xe.\u0275cmp=f.Xpm({type:Xe,selectors:[["mgl-map"]],viewQuery:function(T,ae){if(1&T&&f.Gf(Ge,7),2&T){let pe;f.iGM(pe=f.CRH())&&(ae.mapContainer=pe.first)}},inputs:{collectResourceTiming:"collectResourceTiming",crossSourceCollisions:"crossSourceCollisions",customMapboxApiUrl:"customMapboxApiUrl",fadeDuration:"fadeDuration",hash:"hash",refreshExpiredTiles:"refreshExpiredTiles",failIfMajorPerformanceCaveat:"failIfMajorPerformanceCaveat",bearingSnap:"bearingSnap",interactive:"interactive",pitchWithRotate:"pitchWithRotate",clickTolerance:"clickTolerance",attributionControl:"attributionControl",logoPosition:"logoPosition",maxTileCacheSize:"maxTileCacheSize",localIdeographFontFamily:"localIdeographFontFamily",preserveDrawingBuffer:"preserveDrawingBuffer",trackResize:"trackResize",transformRequest:"transformRequest",bounds:"bounds",antialias:"antialias",locale:"locale",minZoom:"minZoom",maxZoom:"maxZoom",minPitch:"minPitch",maxPitch:"maxPitch",scrollZoom:"scrollZoom",dragRotate:"dragRotate",touchPitch:"touchPitch",touchZoomRotate:"touchZoomRotate",doubleClickZoom:"doubleClickZoom",keyboard:"keyboard",dragPan:"dragPan",boxZoom:"boxZoom",style:"style",center:"center",maxBounds:"maxBounds",zoom:"zoom",bearing:"bearing",pitch:"pitch",fitBoundsOptions:"fitBoundsOptions",renderWorldCopies:"renderWorldCopies",movingMethod:"movingMethod",movingOptions:"movingOptions",fitBounds:"fitBounds",fitScreenCoordinates:"fitScreenCoordinates",centerWithPanTo:"centerWithPanTo",panToOptions:"panToOptions",cursorStyle:"cursorStyle"},outputs:{mapResize:"mapResize",mapRemove:"mapRemove",mapMouseDown:"mapMouseDown",mapMouseUp:"mapMouseUp",mapMouseMove:"mapMouseMove",mapClick:"mapClick",mapDblClick:"mapDblClick",mapMouseOver:"mapMouseOver",mapMouseOut:"mapMouseOut",mapContextMenu:"mapContextMenu",mapTouchStart:"mapTouchStart",mapTouchEnd:"mapTouchEnd",mapTouchMove:"mapTouchMove",mapTouchCancel:"mapTouchCancel",mapWheel:"mapWheel",moveStart:"moveStart",move:"move",moveEnd:"moveEnd",mapDragStart:"mapDragStart",mapDrag:"mapDrag",mapDragEnd:"mapDragEnd",zoomStart:"zoomStart",zoomEvt:"zoomEvt",zoomEnd:"zoomEnd",rotateStart:"rotateStart",rotate:"rotate",rotateEnd:"rotateEnd",pitchStart:"pitchStart",pitchEvt:"pitchEvt",pitchEnd:"pitchEnd",boxZoomStart:"boxZoomStart",boxZoomEnd:"boxZoomEnd",boxZoomCancel:"boxZoomCancel",webGlContextLost:"webGlContextLost",webGlContextRestored:"webGlContextRestored",mapLoad:"mapLoad",idle:"idle",render:"render",mapError:"mapError",data:"data",styleData:"styleData",sourceData:"sourceData",dataLoading:"dataLoading",styleDataLoading:"styleDataLoading",sourceDataLoading:"sourceDataLoading",styleImageMissing:"styleImageMissing"},features:[f._Bn([ke]),f.TTD],decls:2,vars:0,consts:[["container",""]],template:function(T,ae){1&T&&f._UZ(0,"div",null,0)},styles:["[_nghost-%COMP%]{display:block}div[_ngcontent-%COMP%]{height:100%;width:100%}"],changeDetection:0}),Xe})(),br=(()=>{class Xe{constructor(T){this.MapService=T,this.markerDragStart=new f.vpe,this.markerDragEnd=new f.vpe,this.markerDrag=new f.vpe}ngOnInit(){if(this.feature&&this.lngLat)throw new Error("feature and lngLat input are mutually exclusive")}ngOnChanges(T){T.lngLat&&!T.lngLat.isFirstChange()&&this.markerInstance.setLngLat(this.lngLat),T.feature&&!T.feature.isFirstChange()&&this.markerInstance.setLngLat(this.feature.geometry.coordinates),T.draggable&&!T.draggable.isFirstChange()&&this.markerInstance.setDraggable(!!this.draggable),T.popupShown&&!T.popupShown.isFirstChange()&&(T.popupShown.currentValue?this.markerInstance.getPopup().addTo(this.MapService.mapInstance):this.markerInstance.getPopup().remove()),T.pitchAlignment&&!T.pitchAlignment.isFirstChange()&&this.markerInstance.setPitchAlignment(T.pitchAlignment.currentValue),T.rotationAlignment&&!T.rotationAlignment.isFirstChange()&&this.markerInstance.setRotationAlignment(T.rotationAlignment.currentValue)}ngAfterViewInit(){this.MapService.mapCreated$.subscribe(()=>{this.markerInstance=this.MapService.addMarker({markersOptions:{offset:this.offset,anchor:this.anchor,pitchAlignment:this.pitchAlignment,rotationAlignment:this.rotationAlignment,draggable:!!this.draggable,element:this.content.nativeElement,feature:this.feature,lngLat:this.lngLat,clickTolerance:this.clickTolerance},markersEvents:{markerDragStart:this.markerDragStart,markerDrag:this.markerDrag,markerDragEnd:this.markerDragEnd}})})}ngOnDestroy(){this.MapService.removeMarker(this.markerInstance),this.markerInstance=void 0}togglePopup(){this.markerInstance.togglePopup()}updateCoordinates(T){this.markerInstance.setLngLat(T)}}return Xe.\u0275fac=function(T){return new(T||Xe)(f.Y36(ke))},Xe.\u0275cmp=f.Xpm({type:Xe,selectors:[["mgl-marker"]],viewQuery:function(T,ae){if(1&T&&f.Gf(Fn,7),2&T){let pe;f.iGM(pe=f.CRH())&&(ae.content=pe.first)}},inputs:{offset:"offset",anchor:"anchor",clickTolerance:"clickTolerance",feature:"feature",lngLat:"lngLat",draggable:"draggable",popupShown:"popupShown",className:"className",pitchAlignment:"pitchAlignment",rotationAlignment:"rotationAlignment"},outputs:{markerDragStart:"markerDragStart",markerDragEnd:"markerDragEnd",markerDrag:"markerDrag"},features:[f.TTD],ngContentSelectors:pt,decls:3,vars:2,consts:[["content",""]],template:function(T,ae){1&T&&(f.F$t(),f.TgZ(0,"div",null,0),f.Hsn(2),f.qZA()),2&T&&f.Tol(ae.className)},encapsulation:2,changeDetection:0}),Xe})(),Ci=(()=>{class Xe{constructor(T){this.MapService=T,this.popupClose=new f.vpe,this.popupOpen=new f.vpe}ngOnInit(){if(this.lngLat&&this.marker||this.feature&&this.lngLat||this.feature&&this.marker)throw new Error("marker, lngLat, feature input are mutually exclusive")}ngOnChanges(T){if(T.lngLat&&!T.lngLat.isFirstChange()||T.feature&&!T.feature.isFirstChange()){const ae=T.lngLat?this.lngLat:this.feature.geometry.coordinates;this.MapService.removePopupFromMap(this.popupInstance,!0);const pe=this.createPopup();this.MapService.addPopupToMap(pe,ae,this.popupInstance.isOpen()),this.popupInstance=pe}if(T.marker&&!T.marker.isFirstChange()){const ae=T.marker.previousValue;ae.markerInstance&&this.MapService.removePopupFromMarker(ae.markerInstance),this.marker&&this.marker.markerInstance&&this.popupInstance&&this.MapService.addPopupToMarker(this.marker.markerInstance,this.popupInstance)}T.offset&&!T.offset.isFirstChange()&&this.popupInstance&&this.popupInstance.setOffset(this.offset)}ngAfterViewInit(){this.popupInstance=this.createPopup(),this.addPopup(this.popupInstance)}ngOnDestroy(){this.popupInstance&&(this.lngLat||this.feature?this.MapService.removePopupFromMap(this.popupInstance):this.marker&&this.marker.markerInstance&&this.MapService.removePopupFromMarker(this.marker.markerInstance)),this.popupInstance=void 0}createPopup(){return this.MapService.createPopup({popupOptions:{closeButton:this.closeButton,closeOnClick:this.closeOnClick,closeOnMove:this.closeOnMove,focusAfterOpen:this.focusAfterOpen,anchor:this.anchor,offset:this.offset,className:this.className,maxWidth:this.maxWidth},popupEvents:{popupOpen:this.popupOpen,popupClose:this.popupClose}},this.content.nativeElement)}addPopup(T){this.MapService.mapCreated$.subscribe(()=>{if(this.lngLat||this.feature)this.MapService.addPopupToMap(T,this.lngLat?this.lngLat:this.feature.geometry.coordinates);else{if(!this.marker||!this.marker.markerInstance)throw new Error("mgl-popup need either lngLat/marker/feature to be set");this.MapService.addPopupToMarker(this.marker.markerInstance,T)}})}}return Xe.\u0275fac=function(T){return new(T||Xe)(f.Y36(ke))},Xe.\u0275cmp=f.Xpm({type:Xe,selectors:[["mgl-popup"]],viewQuery:function(T,ae){if(1&T&&f.Gf(Fn,7),2&T){let pe;f.iGM(pe=f.CRH())&&(ae.content=pe.first)}},inputs:{closeButton:"closeButton",closeOnClick:"closeOnClick",closeOnMove:"closeOnMove",focusAfterOpen:"focusAfterOpen",anchor:"anchor",className:"className",maxWidth:"maxWidth",feature:"feature",lngLat:"lngLat",marker:"marker",offset:"offset"},outputs:{popupClose:"popupClose",popupOpen:"popupOpen"},features:[f.TTD],ngContentSelectors:pt,decls:3,vars:0,consts:[["content",""]],template:function(T,ae){1&T&&(f.F$t(),f.TgZ(0,"div",null,0),f.Hsn(2),f.qZA())},encapsulation:2,changeDetection:0}),Xe})(),mn=(()=>{class Xe{}return Xe.\u0275fac=function(T){return new(T||Xe)},Xe.\u0275mod=f.oAB({type:Xe}),Xe.\u0275inj=f.cJS({imports:[[Rt.ez]]}),Xe})()}}]);
//# sourceMappingURL=vendor.8e8b2bd3b9ec5a3b.js.map